# ë©€í‹°í„´ ëŒ€í™” ì•„í‚¤í…ì²˜

## ğŸ“‹ ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì¼**: 2025-11-07
- **ì‘ì„±ì**: ìµœí˜„í™”[íŒ€ì¥]
- **í”„ë¡œì íŠ¸ëª…**: ë…¼ë¬¸ ë¦¬ë·° ì±—ë´‡ (AI Agent + RAG)
- **íŒ€ëª…**: ì—°ê²°ì˜ ë¯¼ì¡±
- **ë¬¸ì„œ ë²„ì „**: 1.0

---

## ğŸ“‘ ëª©ì°¨
1. [ë©€í‹°í„´ ëŒ€í™” ê°œìš”](#ë©€í‹°í„´-ëŒ€í™”-ê°œìš”)
2. [ë©€í‹°í„´ ëŒ€í™” ì‹¤í–‰ ì¡°ê±´](#ë©€í‹°í„´-ëŒ€í™”-ì‹¤í–‰-ì¡°ê±´)
3. [ë©€í‹°í„´ ëŒ€í™” ë©”ì»¤ë‹ˆì¦˜](#ë©€í‹°í„´-ëŒ€í™”-ë©”ì»¤ë‹ˆì¦˜)
4. [ë‹¨ìˆœ íë¦„ ì•„í‚¤í…ì²˜](#ë‹¨ìˆœ-íë¦„-ì•„í‚¤í…ì²˜)
5. [ìƒì„¸ ê¸°ëŠ¥ ë™ì‘ íë¦„ë„](#ìƒì„¸-ê¸°ëŠ¥-ë™ì‘-íë¦„ë„)
6. [ë™ì‘ ì„¤ëª…](#ë™ì‘-ì„¤ëª…)
7. [ì‚¬ìš© ì˜ˆì‹œ](#ì‚¬ìš©-ì˜ˆì‹œ)
8. [í•µì‹¬ í¬ì¸íŠ¸](#í•µì‹¬-í¬ì¸íŠ¸)
9. [ì°¸ê³  ì •ë³´](#ì°¸ê³ -ì •ë³´)

---

## ğŸ“Œ ë©€í‹°í„´ ëŒ€í™” ê°œìš”

### ëª©ì ê³¼ ì—­í• 

ë©€í‹°í„´ ëŒ€í™”ëŠ” ì´ì „ ëŒ€í™”ì˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìœ ì§€í•˜ë©° ì—°ì†ì ì¸ ëŒ€í™”ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆëŠ” ëŒ€í™” ê´€ë¦¬ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

**í•µì‹¬ ì—­í• :**
- ì´ì „ ëŒ€í™” íˆìŠ¤í† ë¦¬ë¥¼ ê¸°ì–µí•˜ê³  ì°¸ì¡°
- ë§¥ë½ ì°¸ì¡° í‘œí˜„ ("ê·¸ê±°", "ê·¸ ë…¼ë¬¸", "ë°©ê¸ˆ ë§í•œ ê±°") ì´í•´
- ì„¸ì…˜ë³„ ëŒ€í™” ìƒíƒœ ìœ ì§€
- ì—°ì†ì ì¸ ì§ˆë¬¸ì— ëŒ€í•œ ì¼ê´€ëœ ë‹µë³€ ì œê³µ

**ì§€ì› ê¸°ëŠ¥:**
- ëŒ€í™” íˆìŠ¤í† ë¦¬ ì €ì¥ ë° ë¡œë“œ
- ë§¥ë½ ì°¸ì¡° í‚¤ì›Œë“œ ê°ì§€
- ì„¸ì…˜ ê´€ë¦¬ (ì±„íŒ… ìƒì„±/ì „í™˜/ì‚­ì œ)
- ëŒ€í™” ë‚´ì—­ ë‚´ë³´ë‚´ê¸°

**ì‚¬ìš© ëª¨ë¸:**
- **easy ëª¨ë“œ**: Solar-pro2 (í•œêµ­ì–´ íŠ¹í™”, ë¹„ìš© íš¨ìœ¨)
- **hard ëª¨ë“œ**: GPT-5 (ê¸°ìˆ ì  ì •í™•ë„)

**ì„¸ì…˜ ê´€ë¦¬:**
- **ì„¸ì…˜ ID**: UUID ê¸°ë°˜ 8ìë¦¬ ê³ ìœ  ID
- **ì„¸ì…˜ ì €ì¥ì†Œ**: Streamlit session_state (ì¸ë©”ëª¨ë¦¬)
- **ì„¸ì…˜ ì§€ì† ì‹œê°„**: ë¸Œë¼ìš°ì € íƒ­ì´ ì—´ë ¤ìˆëŠ” ë™ì•ˆ ìœ ì§€

---

## ğŸ“‹ ë©€í‹°í„´ ëŒ€í™” ì‹¤í–‰ ì¡°ê±´

### ì–¸ì œ ì‹¤í–‰ë˜ëŠ”ê°€?

**ì¡°ê±´ 1: ë§¥ë½ ì°¸ì¡° í‚¤ì›Œë“œ ê°ì§€**

ì‚¬ìš©ì ì§ˆë¬¸ì— ì´ì „ ëŒ€í™”ë¥¼ ì°¸ì¡°í•˜ëŠ” í‚¤ì›Œë“œê°€ í¬í•¨ë  ë•Œ:

**ë§¥ë½ ì°¸ì¡° í‚¤ì›Œë“œ** (`src/agent/nodes.py:50`):
```python
contextual_keywords = ["ê´€ë ¨", "ê·¸ê±°", "ì´ê±°", "ì €ê±°", "í•´ë‹¹", "ë°©ê¸ˆ", "ìœ„", "ì•ì„œ", "ì´ì „", "ê·¸"]
```

**ë§¥ë½ ì°¸ì¡° ì˜ˆì‹œ:**
- "ê·¸ê±° ì¢€ ë” ìì„¸íˆ ì„¤ëª…í•´ì¤˜"
- "ê·¸ ë…¼ë¬¸ ìš”ì•½í•´ì¤˜"
- "ë°©ê¸ˆ ë§í•œ ê±° ì €ì¥í•´ì¤˜"
- "ì´ì „ì— ì°¾ì€ ë…¼ë¬¸ ê´€ë ¨í•´ì„œ ë” ì•Œë ¤ì¤˜"
- "í•´ë‹¹ ë‚´ìš©ì„ ì‰½ê²Œ ì„¤ëª…í•´ì¤˜"

**ì¡°ê±´ 2: ëŒ€í™” íˆìŠ¤í† ë¦¬ ì¡´ì¬**

- `state.get("messages", [])` ë¦¬ìŠ¤íŠ¸ì— 1ê°œ ì´ìƒì˜ ë©”ì‹œì§€ ì¡´ì¬
- ì„¸ì…˜ ìƒíƒœì— ì´ì „ ëŒ€í™” ê¸°ë¡ì´ ì €ì¥ë˜ì–´ ìˆìŒ

**ì¡°ê±´ 3: ë‹¤ì¤‘ ìš”ì²­ í‚¤ì›Œë“œê°€ ì—†ì„ ë•Œ**

ë§¥ë½ ì°¸ì¡°ê°€ ìˆì–´ë„ ëª…í™•í•œ ë‹¤ì¤‘ ìš”ì²­ í‚¤ì›Œë“œê°€ ìˆìœ¼ë©´ íŒ¨í„´ ë§¤ì¹­ ìš°ì„ :

**ë‹¤ì¤‘ ìš”ì²­ í‚¤ì›Œë“œ** (`src/agent/nodes.py:54`):
```python
multi_request_indicators = ["ì €ì¥", "ìš”ì•½", "ì •ë¦¬"]
```

**ë©€í‹°í„´ vs ë‹¤ì¤‘ ìš”ì²­ êµ¬ë¶„:**
- "ê·¸ ë…¼ë¬¸ ì €ì¥í•´ì¤˜" â†’ ë‹¤ì¤‘ ìš”ì²­ (íŒ¨í„´ ë§¤ì¹­)
- "ê·¸ ë…¼ë¬¸ ìì„¸íˆ ì•Œë ¤ì¤˜" â†’ ë©€í‹°í„´ (LLM ë¼ìš°íŒ…)

### ì‹¤í–‰ ì¡°ê±´ ë¡œì§

**íŒŒì¼**: `src/agent/nodes.py:48-73`

```python
# ë§¥ë½ ì°¸ì¡° ê°ì§€
contextual_keywords = ["ê´€ë ¨", "ê·¸ê±°", "ì´ê±°", "ì €ê±°", "í•´ë‹¹", "ë°©ê¸ˆ", "ìœ„", "ì•ì„œ", "ì´ì „", "ê·¸"]
has_contextual_ref = any(kw in question for kw in contextual_keywords)

# ë‹¤ì¤‘ ìš”ì²­ í‚¤ì›Œë“œ ê°ì§€
multi_request_indicators = ["ì €ì¥", "ìš”ì•½", "ì •ë¦¬"]
has_multi_request_indicator = any(kw in question for kw in multi_request_indicators)

# ë©€í‹°í„´ ëŒ€í™” ì¡°ê±´
skip_pattern_matching = (
    has_contextual_ref and                    # ë§¥ë½ ì°¸ì¡° ìˆìŒ
    len(state.get("messages", [])) > 1 and    # ëŒ€í™” íˆìŠ¤í† ë¦¬ ìˆìŒ
    not has_multi_request_indicator           # ë‹¤ì¤‘ ìš”ì²­ ì•„ë‹˜
)

if skip_pattern_matching:
    # íŒ¨í„´ ë§¤ì¹­ ê±´ë„ˆë›°ê³  LLM ë¼ìš°íŒ… ì‚¬ìš©
    # LLMì´ messages ë¦¬ìŠ¤íŠ¸ë¥¼ ì°¸ì¡°í•˜ì—¬ ì»¨í…ìŠ¤íŠ¸ ì´í•´
```

---

## ğŸ”„ ë©€í‹°í„´ ëŒ€í™” ë©”ì»¤ë‹ˆì¦˜

### ëŒ€í™” íë¦„

```
ì‚¬ìš©ì ì²« ë²ˆì§¸ ì§ˆë¬¸
  â†“
ë„êµ¬ ì‹¤í–‰ ë° ë‹µë³€ ìƒì„±
  â†“
ëŒ€í™” íˆìŠ¤í† ë¦¬ ì €ì¥ (ì„¸ì…˜ ë©”ëª¨ë¦¬)
  â””â”€ messages = [
       {"role": "user", "content": "ì²« ë²ˆì§¸ ì§ˆë¬¸"},
       {"role": "assistant", "content": "ì²« ë²ˆì§¸ ë‹µë³€"}
     ]
  â†“
ì‚¬ìš©ì ë‘ ë²ˆì§¸ ì§ˆë¬¸ (ì´ì „ ëŒ€í™” ì°¸ì¡°)
  ì˜ˆ: "ê·¸ê±° ì¢€ ë” ìì„¸íˆ ì„¤ëª…í•´ì¤˜"
  â†“
ë§¥ë½ ì°¸ì¡° í‚¤ì›Œë“œ ê°ì§€ ("ê·¸ê±°")
  â†“
ëŒ€í™” íˆìŠ¤í† ë¦¬ ë¡œë“œ
  â””â”€ messages ë¦¬ìŠ¤íŠ¸ì—ì„œ ì´ì „ ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ í™•ì¸
  â†“
íŒ¨í„´ ë§¤ì¹­ ê±´ë„ˆë›°ê¸°
  â†“
LLM ë¼ìš°íŒ… (messages í¬í•¨)
  â””â”€ LLMì´ ì´ì „ ëŒ€í™”ë¥¼ ì°¸ì¡°í•˜ì—¬ ì§ˆë¬¸ ì´í•´
  â””â”€ ì ì ˆí•œ ë„êµ¬ ì„ íƒ (general, search_paper, summarize ë“±)
  â†“
ë„êµ¬ ì‹¤í–‰ ë° ë‹µë³€ ìƒì„±
  â†“
ëŒ€í™” íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
  â””â”€ messages = [
       {"role": "user", "content": "ì²« ë²ˆì§¸ ì§ˆë¬¸"},
       {"role": "assistant", "content": "ì²« ë²ˆì§¸ ë‹µë³€"},
       {"role": "user", "content": "ê·¸ê±° ì¢€ ë” ìì„¸íˆ ì„¤ëª…í•´ì¤˜"},
       {"role": "assistant", "content": "ìƒì„¸ ì„¤ëª…..."}
     ]
  â†“
END
```

### ì„¸ì…˜ ê´€ë¦¬ êµ¬ì¡°

**ì„¸ì…˜ ë°ì´í„° êµ¬ì¡°** (`ui/components/chat_manager.py:62-67`):

```python
st.session_state.chats[chat_id] = {
    "messages": [],                 # ëŒ€í™” ë©”ì‹œì§€ ë¦¬ìŠ¤íŠ¸
    "difficulty": difficulty,       # ë‚œì´ë„ (easy/hard)
    "created_at": timestamp,        # ìƒì„± ì‹œê°„
    "title": "ìƒˆ ì±„íŒ…"              # ì±„íŒ… ì œëª©
}
```

**ì„¸ì…˜ ID ìƒì„±**:
```python
chat_id = str(uuid.uuid4())[:8]  # UUIDì˜ ì• 8ìë¦¬
# ì˜ˆ: "a3f2e8c1"
```

**ì„¸ì…˜ ì €ì¥ì†Œ**:
- **ìœ„ì¹˜**: `streamlit.session_state.chats` (ì¸ë©”ëª¨ë¦¬)
- **ì§€ì† ì‹œê°„**: ë¸Œë¼ìš°ì € íƒ­ì´ ì—´ë ¤ìˆëŠ” ë™ì•ˆ
- **ì œí•œ**: íƒ­ ë‹«ìœ¼ë©´ ì„¸ì…˜ ì‚­ì œ (ì˜êµ¬ ì €ì¥ ì•„ë‹˜)

### ë©”ì‹œì§€ êµ¬ì¡°

**ë©”ì‹œì§€ ê°ì²´** (`src/agent/state.py:59`):

```python
{
    "role": "user" | "assistant",
    "content": "ë©”ì‹œì§€ ë‚´ìš©",
    "tool_choice": "search_paper",       # AI ë‹µë³€ì¸ ê²½ìš° ì‚¬ìš©ëœ ë„êµ¬
    "sources": [...]                     # ì°¸ê³  ë¬¸ì„œ (ì„ íƒ)
}
```

**messages ë¦¬ìŠ¤íŠ¸ ì˜ˆì‹œ**:
```python
state["messages"] = [
    {"role": "user", "content": "Transformer ë…¼ë¬¸ ìš”ì•½í•´ì¤˜"},
    {"role": "assistant", "content": "TransformerëŠ”...", "tool_choice": "summarize"},
    {"role": "user", "content": "ì´ ë…¼ë¬¸ì˜ í•œê³„ì ì€ ë­ì•¼?"},
    {"role": "assistant", "content": "ì£¼ìš” í•œê³„ì ì€...", "tool_choice": "general"},
    {"role": "user", "content": "ê°œì„ í•œ í›„ì† ì—°êµ¬ ìˆì–´?"},
    {"role": "assistant", "content": "í›„ì† ì—°êµ¬ë¡œëŠ”...", "tool_choice": "search_paper"}
]
```

---

## ğŸ¨ ë‹¨ìˆœ íë¦„ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph MainFlow["ğŸ“‹ ë©€í‹°í„´ ëŒ€í™” ì‹¤í–‰ íë¦„"]
        direction TB

        subgraph FirstTurn["ğŸ”¸ ì²« ë²ˆì§¸ í„´ (ì»¨í…ìŠ¤íŠ¸ ìƒì„±)"]
            direction LR
            A[ì‚¬ìš©ì<br/>ì²« ì§ˆë¬¸] --> B[router_node<br/>ë„êµ¬ ì„ íƒ]
            B --> C[ë„êµ¬ ì‹¤í–‰<br/>ë‹µë³€ ìƒì„±]
            C --> D[messages ì €ì¥<br/>user + assistant]
            D --> E[UIì—<br/>ë‹µë³€ í‘œì‹œ]
        end

        subgraph SecondTurn["ğŸ”¹ ë‘ ë²ˆì§¸ í„´ (ì»¨í…ìŠ¤íŠ¸ ì°¸ì¡°)"]
            direction LR
            F[ì‚¬ìš©ì<br/>ë§¥ë½ ì°¸ì¡° ì§ˆë¬¸] --> G{ë§¥ë½ í‚¤ì›Œë“œ<br/>ê°ì§€?}
            G -->|Yes| H{messages<br/>ìˆìŒ?}
            G -->|No| I[ì¼ë°˜ ì²˜ë¦¬]
            H -->|Yes| J{ë‹¤ì¤‘ ìš”ì²­<br/>í‚¤ì›Œë“œ?}
            H -->|No| I
            J -->|No| K[ë©€í‹°í„´<br/>ëª¨ë“œ ì§„ì…]
            J -->|Yes| L[íŒ¨í„´ ë§¤ì¹­<br/>ìš°ì„ ]
        end

        subgraph MultiTurnRouting["ğŸ”º ë©€í‹°í„´ ë¼ìš°íŒ…"]
            direction LR
            M[íŒ¨í„´ ë§¤ì¹­<br/>ê±´ë„ˆë›°ê¸°] --> N[LLM ë¼ìš°íŒ…<br/>messages í¬í•¨]
            N --> O[LLMì´<br/>ì»¨í…ìŠ¤íŠ¸ ë¶„ì„]
            O --> P[ì ì ˆí•œ ë„êµ¬<br/>ì„ íƒ]
        end

        subgraph ToolExecution["ğŸ”¶ ë„êµ¬ ì‹¤í–‰"]
            direction LR
            Q[ì„ íƒëœ ë„êµ¬<br/>ì‹¤í–‰] --> R[ì´ì „ ë‹µë³€<br/>ì°¸ì¡°]
            R --> S[ìƒˆ ë‹µë³€<br/>ìƒì„±]
        end

        subgraph SessionUpdate["âœ… ì„¸ì…˜ ì—…ë°ì´íŠ¸"]
            direction LR
            T[messagesì—<br/>ì§ˆë¬¸ ì¶”ê°€] --> U[messagesì—<br/>ë‹µë³€ ì¶”ê°€]
            U --> V[ì„¸ì…˜ ìƒíƒœ<br/>ì €ì¥]
            V --> W[UI ì—…ë°ì´íŠ¸]
        end

        subgraph SessionManagement["ğŸ’¾ ì„¸ì…˜ ê´€ë¦¬"]
            direction LR
            X[ì±„íŒ… ì„¸ì…˜<br/>ìƒì„±] --> Y[UUID ê¸°ë°˜<br/>chat_id]
            Y --> Z[session_stateì—<br/>ì €ì¥]
            Z --> AA[ë¸Œë¼ìš°ì € íƒ­<br/>ìœ ì§€ ì‹œ ì§€ì†]
        end

        %% í„´ ê°„ ì—°ê²°
        FirstTurn --> SecondTurn
        SecondTurn --> MultiTurnRouting
        MultiTurnRouting --> ToolExecution
        ToolExecution --> SessionUpdate
        FirstTurn -.ì„¸ì…˜ ìƒì„±.-> SessionManagement
        SessionUpdate -.ì„¸ì…˜ ì €ì¥.-> SessionManagement
    end

    %% ë©”ì¸ ì›Œí¬í”Œë¡œìš° ë°°ê²½
    style MainFlow fill:#fffde7,stroke:#f9a825,stroke-width:4px,color:#000

    %% Subgraph ìŠ¤íƒ€ì¼
    style FirstTurn fill:#e0f7fa,stroke:#006064,stroke-width:3px,color:#000
    style SecondTurn fill:#e1f5ff,stroke:#01579b,stroke-width:3px,color:#000
    style MultiTurnRouting fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000
    style ToolExecution fill:#fff3e0,stroke:#e65100,stroke-width:3px,color:#000
    style SessionUpdate fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px,color:#000
    style SessionManagement fill:#ffebee,stroke:#c62828,stroke-width:3px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì²« ë²ˆì§¸ í„´ - ì²­ë¡ ê³„ì—´)
    style A fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000
    style B fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000
    style C fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000
    style D fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000
    style E fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ë‘ ë²ˆì§¸ í„´ - íŒŒë‘ ê³„ì—´)
    style F fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style G fill:#ce93d8,stroke:#7b1fa2,stroke-width:2px,color:#000
    style H fill:#ce93d8,stroke:#7b1fa2,stroke-width:2px,color:#000
    style I fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style J fill:#ce93d8,stroke:#7b1fa2,stroke-width:2px,color:#000
    style K fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style L fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ë©€í‹°í„´ ë¼ìš°íŒ… - ë³´ë¼ ê³„ì—´)
    style M fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style N fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style O fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style P fill:#ce93d8,stroke:#6a1b9a,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ë„êµ¬ ì‹¤í–‰ - ì£¼í™© ê³„ì—´)
    style Q fill:#ffb74d,stroke:#e65100,stroke-width:2px,color:#000
    style R fill:#ffb74d,stroke:#e65100,stroke-width:2px,color:#000
    style S fill:#ffa726,stroke:#ef6c00,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì„¸ì…˜ ì—…ë°ì´íŠ¸ - ë…¹ìƒ‰ ê³„ì—´)
    style T fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style U fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style V fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style W fill:#66bb6a,stroke:#1b5e20,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì„¸ì…˜ ê´€ë¦¬ - ë¹¨ê°• ê³„ì—´)
    style X fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style Y fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style Z fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style AA fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ì²« ë²ˆì§¸ í„´ - ì²­ë¡ 0~4)
    linkStyle 0 stroke:#006064,stroke-width:2px
    linkStyle 1 stroke:#006064,stroke-width:2px
    linkStyle 2 stroke:#006064,stroke-width:2px
    linkStyle 3 stroke:#006064,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ë‘ ë²ˆì§¸ í„´ - íŒŒë‘ 5~13)
    linkStyle 4 stroke:#1976d2,stroke-width:2px
    linkStyle 5 stroke:#1976d2,stroke-width:2px
    linkStyle 6 stroke:#1976d2,stroke-width:2px
    linkStyle 7 stroke:#1976d2,stroke-width:2px
    linkStyle 8 stroke:#1976d2,stroke-width:2px
    linkStyle 9 stroke:#1976d2,stroke-width:2px
    linkStyle 10 stroke:#1976d2,stroke-width:2px
    linkStyle 11 stroke:#1976d2,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ë©€í‹°í„´ ë¼ìš°íŒ… - ë³´ë¼ 14~16)
    linkStyle 12 stroke:#7b1fa2,stroke-width:2px
    linkStyle 13 stroke:#7b1fa2,stroke-width:2px
    linkStyle 14 stroke:#7b1fa2,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ë„êµ¬ ì‹¤í–‰ - ì£¼í™© 17~18)
    linkStyle 15 stroke:#e65100,stroke-width:2px
    linkStyle 16 stroke:#e65100,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ì„¸ì…˜ ì—…ë°ì´íŠ¸ - ë…¹ìƒ‰ 19~22)
    linkStyle 17 stroke:#2e7d32,stroke-width:2px
    linkStyle 18 stroke:#2e7d32,stroke-width:2px
    linkStyle 19 stroke:#2e7d32,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ì„¸ì…˜ ê´€ë¦¬ - ë¹¨ê°• 23~25)
    linkStyle 20 stroke:#c62828,stroke-width:2px
    linkStyle 21 stroke:#c62828,stroke-width:2px
    linkStyle 22 stroke:#c62828,stroke-width:2px

    %% í„´ ê°„ ì—°ê²° (íšŒìƒ‰ 26~30)
    linkStyle 23 stroke:#616161,stroke-width:3px
    linkStyle 24 stroke:#616161,stroke-width:3px
    linkStyle 25 stroke:#616161,stroke-width:3px
    linkStyle 26 stroke:#616161,stroke-width:3px
    linkStyle 27 stroke:#616161,stroke-width:2px,stroke-dasharray:5
    linkStyle 28 stroke:#616161,stroke-width:2px,stroke-dasharray:5
```

---

## ğŸ” ìƒì„¸ ê¸°ëŠ¥ ë™ì‘ íë¦„ë„

```mermaid
graph TB
    subgraph MainFlow["ğŸ“‹ ë©€í‹°í„´ ëŒ€í™” ìƒì„¸ ì‹¤í–‰ íë¦„"]
        direction TB

        subgraph SessionInit["ğŸ”¸ ì„¸ì…˜ ì´ˆê¸°í™”"]
            direction LR
            A[ui/app.py<br/>initialize_chat_sessions] --> B[session_state<br/>ì´ˆê¸°í™”]
            B --> C[chats ë”•ì…”ë„ˆë¦¬<br/>ìƒì„±]
            C --> D[current_chat_id<br/>None]
        end

        subgraph FirstTurnInit["ğŸ”¹ ì²« ë²ˆì§¸ í„´ ì‹œì‘"]
            direction LR
            E[ì‚¬ìš©ì<br/>ì²« ì§ˆë¬¸ ì…ë ¥] --> F[create_new_chat<br/>í˜¸ì¶œ]
            F --> G[UUID ìƒì„±<br/>chat_id]
            G --> H[ì„¸ì…˜ ë°ì´í„°<br/>ìƒì„±]
            H --> I[messages ë¹ˆ<br/>ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”]
        end

        subgraph FirstTurnRouting["ğŸ”º ì²« í„´ ë¼ìš°íŒ…"]
            direction LR
            J[router_node<br/>ì‹¤í–‰] --> K[messages<br/>ë¦¬ìŠ¤íŠ¸ í™•ì¸]
            K --> L{messages<br/>ë¹„ì–´ìˆìŒ?}
            L -->|Yes| M[ì¼ë°˜ ë¼ìš°íŒ…<br/>íŒ¨í„´ ë§¤ì¹­ ì‹œë„]
            L -->|No| N[ë©€í‹°í„´ ì²´í¬]
        end

        subgraph FirstTurnTool["ğŸ”¶ ì²« í„´ ë„êµ¬ ì‹¤í–‰"]
            direction LR
            O[ë„êµ¬ ì„ íƒ<br/>ì™„ë£Œ] --> P[ë„êµ¬ ë…¸ë“œ<br/>ì‹¤í–‰]
            P --> Q[ë‹µë³€ ìƒì„±<br/>final_answer]
            Q --> R[source_documents<br/>ì €ì¥]
        end

        subgraph FirstTurnSave["ğŸ’¾ ì²« í„´ ì €ì¥"]
            direction LR
            S[add_message_to_current_chat<br/>user] --> T[messagesì—<br/>ì§ˆë¬¸ ì¶”ê°€]
            T --> U[add_message_to_current_chat<br/>assistant] --> V[messagesì—<br/>ë‹µë³€ ì¶”ê°€]
            V --> W[ì±„íŒ… ì œëª©<br/>ì—…ë°ì´íŠ¸]
        end

        subgraph SecondTurnStart["ğŸ’¡ ë‘ ë²ˆì§¸ í„´ ì‹œì‘"]
            direction LR
            X[ì‚¬ìš©ì<br/>ë§¥ë½ ì°¸ì¡° ì§ˆë¬¸] --> Y[get_current_messages<br/>í˜¸ì¶œ]
            Y --> Z[ì´ì „ messages<br/>ë¡œë“œ]
            Z --> AA[stateì—<br/>messages ì „ë‹¬]
        end

        subgraph ContextDetection["ğŸ”· ë§¥ë½ ì°¸ì¡° ê°ì§€"]
            direction LR
            AB[router_node<br/>ì‹¤í–‰] --> AC[contextual_keywords<br/>ì²´í¬]
            AC --> AD{ë§¥ë½ í‚¤ì›Œë“œ<br/>í¬í•¨?}
            AD -->|Yes| AE[has_contextual_ref<br/>= True]
            AD -->|No| AF[ì¼ë°˜ ì²˜ë¦¬]
            AE --> AG{messages<br/>ê°œìˆ˜ > 1?}
            AG -->|Yes| AH{ë‹¤ì¤‘ ìš”ì²­<br/>í‚¤ì›Œë“œ?}
            AG -->|No| AF
        end

        subgraph MultiTurnMode["âœ¨ ë©€í‹°í„´ ëª¨ë“œ"]
            direction LR
            AI[skip_pattern_matching<br/>= True] --> AJ[íŒ¨í„´ ë§¤ì¹­<br/>ê±´ë„ˆë›°ê¸°]
            AJ --> AK[LLM ë¼ìš°íŒ…<br/>ì§í–‰]
            AK --> AL[routing_prompt<br/>ë¡œë“œ]
            AL --> AM[messages í¬í•¨<br/>í”„ë¡¬í”„íŠ¸ êµ¬ì„±]
        end

        subgraph LLMRouting["ğŸ”¹ LLM ë¼ìš°íŒ…"]
            direction LR
            AN[LLMì—<br/>ì§ˆë¬¸ ì „ë‹¬] --> AO[LLMì´<br/>messages ë¶„ì„]
            AO --> AP[ì»¨í…ìŠ¤íŠ¸<br/>ì´í•´]
            AP --> AQ[ì´ì „ ëŒ€í™”ì—ì„œ<br/>ì°¸ì¡° ëŒ€ìƒ íŒŒì•…]
            AQ --> AR[ì ì ˆí•œ ë„êµ¬<br/>ì„ íƒ]
        end

        subgraph SecondTurnTool["ğŸ”¶ ë‘ ë²ˆì§¸ í„´ ë„êµ¬ ì‹¤í–‰"]
            direction LR
            AS[ì„ íƒëœ ë„êµ¬<br/>ì‹¤í–‰] --> AT[ì´ì „ ë‹µë³€<br/>ì°¸ì¡° ê°€ëŠ¥]
            AT --> AU[ìƒˆ ë‹µë³€<br/>ìƒì„±]
            AU --> AV[ì»¨í…ìŠ¤íŠ¸ ì¼ê´€ì„±<br/>ìœ ì§€]
        end

        subgraph SecondTurnSave["âœ… ë‘ ë²ˆì§¸ í„´ ì €ì¥"]
            direction LR
            AW[messagesì—<br/>ìƒˆ ì§ˆë¬¸ ì¶”ê°€] --> AX[messagesì—<br/>ìƒˆ ë‹µë³€ ì¶”ê°€]
            AX --> AY[ì„¸ì…˜ ìƒíƒœ<br/>ì—…ë°ì´íŠ¸]
            AY --> AZ[UI ë¦¬ë Œë”ë§]
        end

        subgraph SessionManagement["âš ï¸ ì„¸ì…˜ ê´€ë¦¬ ê¸°ëŠ¥"]
            direction LR
            BA[switch_chat<br/>ì±„íŒ… ì „í™˜] --> BB[delete_chat<br/>ì±„íŒ… ì‚­ì œ]
            BB --> BC[export_chat<br/>ëŒ€í™” ë‚´ë³´ë‚´ê¸°]
            BC --> BD[get_chat_list<br/>ì±„íŒ… ëª©ë¡]
        end

        %% ë‹¨ê³„ ê°„ ì—°ê²°
        SessionInit --> FirstTurnInit
        FirstTurnInit --> FirstTurnRouting
        FirstTurnRouting --> FirstTurnTool
        FirstTurnTool --> FirstTurnSave
        FirstTurnSave --> SecondTurnStart
        SecondTurnStart --> ContextDetection
        ContextDetection --> MultiTurnMode
        MultiTurnMode --> LLMRouting
        LLMRouting --> SecondTurnTool
        SecondTurnTool --> SecondTurnSave
        FirstTurnInit -.ì„¸ì…˜ ìƒì„±.-> SessionManagement
        SecondTurnSave -.ì„¸ì…˜ ìœ ì§€.-> SessionManagement
    end

    %% ë©”ì¸ ì›Œí¬í”Œë¡œìš° ë°°ê²½
    style MainFlow fill:#fffde7,stroke:#f9a825,stroke-width:4px,color:#000

    %% Subgraph ìŠ¤íƒ€ì¼
    style SessionInit fill:#e0f7fa,stroke:#006064,stroke-width:3px,color:#000
    style FirstTurnInit fill:#e1f5ff,stroke:#01579b,stroke-width:3px,color:#000
    style FirstTurnRouting fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000
    style FirstTurnTool fill:#fff3e0,stroke:#e65100,stroke-width:3px,color:#000
    style FirstTurnSave fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px,color:#000
    style SecondTurnStart fill:#e3f2fd,stroke:#1565c0,stroke-width:3px,color:#000
    style ContextDetection fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000
    style MultiTurnMode fill:#fff3e0,stroke:#e65100,stroke-width:3px,color:#000
    style LLMRouting fill:#e1f5ff,stroke:#01579b,stroke-width:3px,color:#000
    style SecondTurnTool fill:#fff3e0,stroke:#e65100,stroke-width:3px,color:#000
    style SecondTurnSave fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px,color:#000
    style SessionManagement fill:#ffebee,stroke:#c62828,stroke-width:3px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì„¸ì…˜ ì´ˆê¸°í™” - ì²­ë¡ ê³„ì—´)
    style A fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000
    style B fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000
    style C fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000
    style D fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì²« í„´ ì´ˆê¸°í™” - íŒŒë‘ ê³„ì—´)
    style E fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style F fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style G fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style H fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style I fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì²« í„´ ë¼ìš°íŒ… - ë³´ë¼ ê³„ì—´)
    style J fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style K fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style L fill:#ce93d8,stroke:#6a1b9a,stroke-width:2px,color:#000
    style M fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style N fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì²« í„´ ë„êµ¬ - ì£¼í™© ê³„ì—´)
    style O fill:#ffb74d,stroke:#e65100,stroke-width:2px,color:#000
    style P fill:#ffb74d,stroke:#e65100,stroke-width:2px,color:#000
    style Q fill:#ffa726,stroke:#ef6c00,stroke-width:2px,color:#000
    style R fill:#ffb74d,stroke:#e65100,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì²« í„´ ì €ì¥ - ë…¹ìƒ‰ ê³„ì—´)
    style S fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style T fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style U fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style V fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style W fill:#66bb6a,stroke:#1b5e20,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ë‘ ë²ˆì§¸ í„´ ì‹œì‘ - íŒŒë‘ ê³„ì—´)
    style X fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style Y fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style Z fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style AA fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ë§¥ë½ ê°ì§€ - ë³´ë¼ ê³„ì—´)
    style AB fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style AC fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style AD fill:#ce93d8,stroke:#6a1b9a,stroke-width:2px,color:#000
    style AE fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style AF fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style AG fill:#ce93d8,stroke:#6a1b9a,stroke-width:2px,color:#000
    style AH fill:#ce93d8,stroke:#6a1b9a,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ë©€í‹°í„´ ëª¨ë“œ - ì£¼í™© ê³„ì—´)
    style AI fill:#ffb74d,stroke:#e65100,stroke-width:2px,color:#000
    style AJ fill:#ffb74d,stroke:#e65100,stroke-width:2px,color:#000
    style AK fill:#ffb74d,stroke:#e65100,stroke-width:2px,color:#000
    style AL fill:#ffa726,stroke:#ef6c00,stroke-width:2px,color:#000
    style AM fill:#ffa726,stroke:#ef6c00,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (LLM ë¼ìš°íŒ… - íŒŒë‘ ê³„ì—´)
    style AN fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style AO fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style AP fill:#64b5f6,stroke:#1565c0,stroke-width:2px,color:#000
    style AQ fill:#64b5f6,stroke:#1565c0,stroke-width:2px,color:#000
    style AR fill:#64b5f6,stroke:#1565c0,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ë‘ ë²ˆì§¸ í„´ ë„êµ¬ - ì£¼í™© ê³„ì—´)
    style AS fill:#ffb74d,stroke:#e65100,stroke-width:2px,color:#000
    style AT fill:#ffb74d,stroke:#e65100,stroke-width:2px,color:#000
    style AU fill:#ffa726,stroke:#ef6c00,stroke-width:2px,color:#000
    style AV fill:#ffa726,stroke:#ef6c00,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ë‘ ë²ˆì§¸ í„´ ì €ì¥ - ë…¹ìƒ‰ ê³„ì—´)
    style AW fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style AX fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style AY fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style AZ fill:#66bb6a,stroke:#1b5e20,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì„¸ì…˜ ê´€ë¦¬ - ë¹¨ê°• ê³„ì—´)
    style BA fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style BB fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style BC fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style BD fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ì„¸ì…˜ ì´ˆê¸°í™” - ì²­ë¡ 0~2)
    linkStyle 0 stroke:#006064,stroke-width:2px
    linkStyle 1 stroke:#006064,stroke-width:2px
    linkStyle 2 stroke:#006064,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ì²« í„´ ì´ˆê¸°í™” - íŒŒë‘ 3~7)
    linkStyle 3 stroke:#1976d2,stroke-width:2px
    linkStyle 4 stroke:#1976d2,stroke-width:2px
    linkStyle 5 stroke:#1976d2,stroke-width:2px
    linkStyle 6 stroke:#1976d2,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ì²« í„´ ë¼ìš°íŒ… - ë³´ë¼ 8~12)
    linkStyle 7 stroke:#7b1fa2,stroke-width:2px
    linkStyle 8 stroke:#7b1fa2,stroke-width:2px
    linkStyle 9 stroke:#7b1fa2,stroke-width:2px
    linkStyle 10 stroke:#7b1fa2,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ì²« í„´ ë„êµ¬ - ì£¼í™© 13~16)
    linkStyle 11 stroke:#e65100,stroke-width:2px
    linkStyle 12 stroke:#e65100,stroke-width:2px
    linkStyle 13 stroke:#e65100,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ì²« í„´ ì €ì¥ - ë…¹ìƒ‰ 17~21)
    linkStyle 14 stroke:#2e7d32,stroke-width:2px
    linkStyle 15 stroke:#2e7d32,stroke-width:2px
    linkStyle 16 stroke:#2e7d32,stroke-width:2px
    linkStyle 17 stroke:#2e7d32,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ë‘ ë²ˆì§¸ í„´ ì‹œì‘ - íŒŒë‘ 22~25)
    linkStyle 18 stroke:#1976d2,stroke-width:2px
    linkStyle 19 stroke:#1976d2,stroke-width:2px
    linkStyle 20 stroke:#1976d2,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ë§¥ë½ ê°ì§€ - ë³´ë¼ 26~33)
    linkStyle 21 stroke:#7b1fa2,stroke-width:2px
    linkStyle 22 stroke:#7b1fa2,stroke-width:2px
    linkStyle 23 stroke:#7b1fa2,stroke-width:2px
    linkStyle 24 stroke:#7b1fa2,stroke-width:2px
    linkStyle 25 stroke:#7b1fa2,stroke-width:2px
    linkStyle 26 stroke:#7b1fa2,stroke-width:2px
    linkStyle 27 stroke:#7b1fa2,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ë©€í‹°í„´ ëª¨ë“œ - ì£¼í™© 34~38)
    linkStyle 28 stroke:#e65100,stroke-width:2px
    linkStyle 29 stroke:#e65100,stroke-width:2px
    linkStyle 30 stroke:#e65100,stroke-width:2px
    linkStyle 31 stroke:#e65100,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (LLM ë¼ìš°íŒ… - íŒŒë‘ 39~43)
    linkStyle 32 stroke:#1976d2,stroke-width:2px
    linkStyle 33 stroke:#1976d2,stroke-width:2px
    linkStyle 34 stroke:#1976d2,stroke-width:2px
    linkStyle 35 stroke:#1976d2,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ë‘ ë²ˆì§¸ í„´ ë„êµ¬ - ì£¼í™© 44~47)
    linkStyle 36 stroke:#e65100,stroke-width:2px
    linkStyle 37 stroke:#e65100,stroke-width:2px
    linkStyle 38 stroke:#e65100,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ë‘ ë²ˆì§¸ í„´ ì €ì¥ - ë…¹ìƒ‰ 48~51)
    linkStyle 39 stroke:#2e7d32,stroke-width:2px
    linkStyle 40 stroke:#2e7d32,stroke-width:2px
    linkStyle 41 stroke:#2e7d32,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ì„¸ì…˜ ê´€ë¦¬ - ë¹¨ê°• 52~54)
    linkStyle 42 stroke:#c62828,stroke-width:2px
    linkStyle 43 stroke:#c62828,stroke-width:2px
    linkStyle 44 stroke:#c62828,stroke-width:2px

    %% ë‹¨ê³„ ê°„ ì—°ê²° (íšŒìƒ‰ 55~65)
    linkStyle 45 stroke:#616161,stroke-width:3px
    linkStyle 46 stroke:#616161,stroke-width:3px
    linkStyle 47 stroke:#616161,stroke-width:3px
    linkStyle 48 stroke:#616161,stroke-width:3px
    linkStyle 49 stroke:#616161,stroke-width:3px
    linkStyle 50 stroke:#616161,stroke-width:3px
    linkStyle 51 stroke:#616161,stroke-width:3px
    linkStyle 52 stroke:#616161,stroke-width:3px
    linkStyle 53 stroke:#616161,stroke-width:3px
    linkStyle 54 stroke:#616161,stroke-width:3px
    linkStyle 55 stroke:#616161,stroke-width:2px,stroke-dasharray:5
    linkStyle 56 stroke:#616161,stroke-width:2px,stroke-dasharray:5
```

---

### ì „ì²´ íë¦„ ìš”ì•½ í‘œ

| ë‹¨ê³„ | íŒŒì¼ëª… | ë©”ì„œë“œëª… | ë™ì‘ ì„¤ëª… | ì…ë ¥ | ì¶œë ¥ | ì„¸ì…˜ ì €ì¥ |
|------|--------|----------|-----------|------|------|----------|
| 1 | `ui/app.py` | `initialize_chat_sessions()` | ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™” | - | session_state ì´ˆê¸°í™” | chats ë”•ì…”ë„ˆë¦¬ ìƒì„± |
| 2 | `ui/components/chat_manager.py` | `create_new_chat()` | ìƒˆ ì±„íŒ… ìƒì„± | difficulty | chat_id | ì„¸ì…˜ ë°ì´í„° ì €ì¥ |
| 3 | `ui/components/chat_manager.py` | - | UUID ìƒì„± | - | 8ìë¦¬ ê³ ìœ  ID | - |
| 4 | `ui/components/chat_manager.py` | - | messages ì´ˆê¸°í™” | - | ë¹ˆ ë¦¬ìŠ¤íŠ¸ | session_state |
| 5 | `src/agent/nodes.py` | `router_node()` | ë¼ìš°í„° ë…¸ë“œ ì‹¤í–‰ | state (question, messages) | state (tool_choice) | - |
| 6 | `src/agent/nodes.py` | - | messages ê°œìˆ˜ í™•ì¸ | state["messages"] | len(messages) | - |
| 7 | `src/agent/nodes.py` | - | ë§¥ë½ í‚¤ì›Œë“œ ê°ì§€ | question | has_contextual_ref | - |
| 8 | `src/agent/nodes.py` | - | ë‹¤ì¤‘ ìš”ì²­ í‚¤ì›Œë“œ ê°ì§€ | question | has_multi_request_indicator | - |
| 9 | `src/agent/nodes.py` | - | ë©€í‹°í„´ ì¡°ê±´ ì²´í¬ | has_contextual_ref, messages, indicators | skip_pattern_matching | - |
| 10 | `src/agent/nodes.py` | - | íŒ¨í„´ ë§¤ì¹­ ê±´ë„ˆë›°ê¸° | skip_pattern_matching | - | - |
| 11 | `src/prompts/__init__.py` | `get_routing_prompt()` | ë¼ìš°íŒ… í”„ë¡¬í”„íŠ¸ ë¡œë“œ | - | routing_prompt | - |
| 12 | `src/agent/nodes.py` | - | messages í¬í•¨ í”„ë¡¬í”„íŠ¸ êµ¬ì„± | question, messages | full_prompt | - |
| 13 | `src/llm/client.py` | `llm.invoke()` | LLM ë¼ìš°íŒ… í˜¸ì¶œ | full_prompt | tool_choice | - |
| 14 | `src/tools/*.py` | `*_node()` | ì„ íƒëœ ë„êµ¬ ì‹¤í–‰ | state | state (final_answer) | - |
| 15 | `ui/components/chat_manager.py` | `add_message_to_current_chat()` | ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€ | role, content | - | messages ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ |
| 16 | `ui/components/chat_manager.py` | `add_message_to_current_chat()` | AI ë©”ì‹œì§€ ì¶”ê°€ | role, content, tool_choice | - | messages ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ |
| 17 | `ui/components/chat_manager.py` | `update_chat_title()` | ì±„íŒ… ì œëª© ì—…ë°ì´íŠ¸ | chat_id, first_message | - | title ì—…ë°ì´íŠ¸ |
| 18 | `ui/components/chat_manager.py` | `get_current_messages()` | í˜„ì¬ ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸° | - | messages ë¦¬ìŠ¤íŠ¸ | - |
| 19 | `ui/components/chat_manager.py` | `get_current_difficulty()` | í˜„ì¬ ë‚œì´ë„ ê°€ì ¸ì˜¤ê¸° | - | difficulty | - |
| 20 | `ui/components/chat_manager.py` | `switch_chat()` | ì±„íŒ… ì „í™˜ | chat_id | - | current_chat_id ë³€ê²½ |
| 21 | `ui/components/chat_manager.py` | `delete_chat()` | ì±„íŒ… ì‚­ì œ | chat_id | - | chats ë”•ì…”ë„ˆë¦¬ì—ì„œ ì œê±° |
| 22 | `ui/components/chat_manager.py` | `export_chat()` | ëŒ€í™” ë‚´ë³´ë‚´ê¸° | chat_id | markdown_text | - |

---

## ğŸ“ ë™ì‘ ì„¤ëª…

### ë©€í‹°í„´ ëŒ€í™” í”„ë¡œì„¸ìŠ¤ ìƒì„¸ ì„¤ëª…

#### 1ë‹¨ê³„: ì„¸ì…˜ ì´ˆê¸°í™”

**ëª©ì **: ì±„íŒ… ì„¸ì…˜ ê´€ë¦¬ë¥¼ ìœ„í•œ ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”

**íŒŒì¼**: `ui/components/chat_manager.py:24-44`

```python
def initialize_chat_sessions():
    # ì±„íŒ… ì„¸ì…˜ ë”•ì…”ë„ˆë¦¬ ì´ˆê¸°í™”
    if "chats" not in st.session_state:
        st.session_state.chats = {}

    # í˜„ì¬ í™œì„± ì±„íŒ… ID ì´ˆê¸°í™”
    if "current_chat_id" not in st.session_state:
        st.session_state.current_chat_id = None

    # ë§ˆì§€ë§‰ ë‚œì´ë„ ì¶”ì 
    if "last_difficulty" not in st.session_state:
        st.session_state.last_difficulty = None
```

**ì„¸ì…˜ ìƒíƒœ êµ¬ì¡°**:
```python
st.session_state = {
    "chats": {
        "a3f2e8c1": {
            "messages": [...],
            "difficulty": "easy",
            "created_at": "2025-11-07 15:30:00",
            "title": "Transformer ë…¼ë¬¸ ìš”ì•½í•´ì¤˜"
        },
        "b7d4c9a2": {
            "messages": [...],
            "difficulty": "hard",
            "created_at": "2025-11-07 16:00:00",
            "title": "Self-Attentionì˜ ì‹œê°„ ë³µì¡ë„ëŠ”?"
        }
    },
    "current_chat_id": "a3f2e8c1",
    "last_difficulty": "easy"
}
```

#### 2ë‹¨ê³„: ì²« ë²ˆì§¸ í„´ ì²˜ë¦¬

**ëª©ì **: ìƒˆ ì±„íŒ… ì„¸ì…˜ ìƒì„± ë° ì²« ë‹µë³€ ìƒì„±

**íŒŒì¼**: `ui/components/chat_manager.py:47-73`

**ì±„íŒ… ìƒì„±**:
```python
def create_new_chat(difficulty: str) -> str:
    # ê³ ìœ  ì±„íŒ… ID ìƒì„±
    chat_id = str(uuid.uuid4())[:8]  # "a3f2e8c1"
    timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")

    # ì±„íŒ… ì„¸ì…˜ ë°ì´í„° ìƒì„±
    st.session_state.chats[chat_id] = {
        "messages": [],                   # ë¹ˆ ë©”ì‹œì§€ ë¦¬ìŠ¤íŠ¸
        "difficulty": difficulty,
        "created_at": timestamp,
        "title": "ìƒˆ ì±„íŒ…"
    }

    # í˜„ì¬ ì±„íŒ…ìœ¼ë¡œ ì„¤ì •
    st.session_state.current_chat_id = chat_id

    return chat_id
```

**ì²« í„´ íë¦„**:
1. ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥: "Transformer ë…¼ë¬¸ ìš”ì•½í•´ì¤˜"
2. `router_node` ì‹¤í–‰ â†’ `messages`ê°€ ë¹„ì–´ìˆìœ¼ë¯€ë¡œ ì¼ë°˜ ë¼ìš°íŒ…
3. íŒ¨í„´ ë§¤ì¹­ ë˜ëŠ” LLM ë¼ìš°íŒ…ìœ¼ë¡œ ë„êµ¬ ì„ íƒ
4. `summarize_node` ì‹¤í–‰ â†’ ë…¼ë¬¸ ìš”ì•½ ìƒì„±
5. messagesì— ì €ì¥:
   ```python
   messages = [
       {"role": "user", "content": "Transformer ë…¼ë¬¸ ìš”ì•½í•´ì¤˜"},
       {"role": "assistant", "content": "TransformerëŠ”...", "tool_choice": "summarize"}
   ]
   ```

#### 3ë‹¨ê³„: ë§¥ë½ ì°¸ì¡° ê°ì§€

**ëª©ì **: ë‘ ë²ˆì§¸ ì§ˆë¬¸ì´ ì´ì „ ëŒ€í™”ë¥¼ ì°¸ì¡°í•˜ëŠ”ì§€ ê°ì§€

**íŒŒì¼**: `src/agent/nodes.py:48-73`

```python
# ë§¥ë½ ì°¸ì¡° í‚¤ì›Œë“œ
contextual_keywords = ["ê´€ë ¨", "ê·¸ê±°", "ì´ê±°", "ì €ê±°", "í•´ë‹¹", "ë°©ê¸ˆ", "ìœ„", "ì•ì„œ", "ì´ì „", "ê·¸"]
has_contextual_ref = any(kw in question for kw in contextual_keywords)

# ë‹¤ì¤‘ ìš”ì²­ í‚¤ì›Œë“œ
multi_request_indicators = ["ì €ì¥", "ìš”ì•½", "ì •ë¦¬"]
has_multi_request_indicator = any(kw in question for kw in multi_request_indicators)

# ë©€í‹°í„´ ì¡°ê±´
skip_pattern_matching = (
    has_contextual_ref and                    # ë§¥ë½ ì°¸ì¡° ìˆìŒ
    len(state.get("messages", [])) > 1 and    # ëŒ€í™” íˆìŠ¤í† ë¦¬ ìˆìŒ
    not has_multi_request_indicator           # ë‹¤ì¤‘ ìš”ì²­ ì•„ë‹˜
)
```

**ë‘ ë²ˆì§¸ ì§ˆë¬¸ ì˜ˆì‹œ**:
- "ì´ ë…¼ë¬¸ì˜ í•œê³„ì ì€ ë­ì•¼?" â†’ `has_contextual_ref = True` ("ì´")
- `messages` ê°œìˆ˜: 2 (user + assistant)
- `has_multi_request_indicator = False`
- **ê²°ê³¼**: `skip_pattern_matching = True` â†’ ë©€í‹°í„´ ëª¨ë“œ ì§„ì…

#### 4ë‹¨ê³„: LLM ë¼ìš°íŒ… with ì»¨í…ìŠ¤íŠ¸

**ëª©ì **: LLMì´ ì´ì „ ëŒ€í™”ë¥¼ ì°¸ì¡°í•˜ì—¬ ì§ˆë¬¸ ì´í•´

**íŒŒì¼**: `src/agent/nodes.py:140-200` (LLM ë¼ìš°íŒ… ë¶€ë¶„)

**í”„ë¡¬í”„íŠ¸ êµ¬ì„±**:
```python
routing_prompt = f"""
[ì´ì „ ëŒ€í™” ë‚´ì—­]
{format_messages(state["messages"])}

[í˜„ì¬ ì§ˆë¬¸]
{question}

ìœ„ ëŒ€í™” ë§¥ë½ì„ ê³ ë ¤í•˜ì—¬ í˜„ì¬ ì§ˆë¬¸ì— ì í•©í•œ ë„êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.
"""
```

**LLM ë¶„ì„ ê³¼ì •**:
1. ì´ì „ ëŒ€í™” í™•ì¸: "Transformer ë…¼ë¬¸ ìš”ì•½í•´ì¤˜" â†’ Transformer ë…¼ë¬¸ ìš”ì•½ ì™„ë£Œ
2. í˜„ì¬ ì§ˆë¬¸ ë¶„ì„: "ì´ ë…¼ë¬¸ì˜ í•œê³„ì ì€ ë­ì•¼?"
3. ì°¸ì¡° ëŒ€ìƒ íŒŒì•…: "ì´ ë…¼ë¬¸" = "Transformer ë…¼ë¬¸"
4. ë„êµ¬ ì„ íƒ: `general` (LLM ì§€ì‹ìœ¼ë¡œ í•œê³„ì  ì„¤ëª…)

#### 5ë‹¨ê³„: ë„êµ¬ ì‹¤í–‰ with ì»¨í…ìŠ¤íŠ¸

**ëª©ì **: ì„ íƒëœ ë„êµ¬ê°€ ì´ì „ ë‹µë³€ì„ ì°¸ì¡°í•˜ì—¬ ë‹µë³€ ìƒì„±

**ì˜ˆì‹œ**: general_answer_node ì‹¤í–‰

**íŒŒì¼**: `src/tools/general_answer.py:17-105`

```python
def general_answer_node(state: AgentState, exp_manager=None):
    question = state["question"]
    messages = state.get("messages", [])

    # LLMì— ì´ì „ ëŒ€í™” í¬í•¨í•˜ì—¬ í˜¸ì¶œ
    full_messages = messages + [HumanMessage(content=question)]
    response = llm_client.llm.invoke(full_messages)

    # LLMì´ ì´ì „ ëŒ€í™”ë¥¼ ì°¸ì¡°í•˜ì—¬ ë‹µë³€ ìƒì„±
    # "ì´ ë…¼ë¬¸"ì´ "Transformer ë…¼ë¬¸"ì„ì„ ì´í•´í•˜ê³ 
    # Transformerì˜ í•œê³„ì ì„ ì„¤ëª…
```

**LLM ë‹µë³€ ì˜ˆì‹œ**:
```
Transformer ë…¼ë¬¸ì˜ ì£¼ìš” í•œê³„ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. ê³„ì‚° ë³µì¡ë„: O(nÂ²) ì‹œê°„ ë³µì¡ë„ë¡œ ê¸´ ì‹œí€€ìŠ¤ ì²˜ë¦¬ ì‹œ ë¹„íš¨ìœ¨ì 
2. ìœ„ì¹˜ ì •ë³´: Positional Encodingì— ì˜ì¡´í•˜ì—¬ ìƒëŒ€ì  ìœ„ì¹˜ ì •ë³´ ë¶€ì¡±
3. ë¡œì»¬ ì •ë³´: ì¥ê±°ë¦¬ ì˜ì¡´ì„±ì— ì§‘ì¤‘í•˜ì—¬ ë¡œì»¬ íŒ¨í„´ í•™ìŠµ ë¶€ì¡±

ì´í›„ Longformer, Reformer ë“±ì´ ì´ë¥¼ ê°œì„ í–ˆìŠµë‹ˆë‹¤.
```

#### 6ë‹¨ê³„: ì„¸ì…˜ ì—…ë°ì´íŠ¸

**ëª©ì **: ìƒˆ ì§ˆë¬¸ê³¼ ë‹µë³€ì„ messages ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€

**íŒŒì¼**: `ui/components/chat_manager.py:168-190`

```python
def add_message_to_current_chat(role: str, content: str, **kwargs):
    chat_id = st.session_state.current_chat_id

    message = {
        "role": role,
        "content": content,
        **kwargs  # tool_choice, sources ë“±
    }

    st.session_state.chats[chat_id]["messages"].append(message)
```

**ì—…ë°ì´íŠ¸ í›„ messages**:
```python
messages = [
    {"role": "user", "content": "Transformer ë…¼ë¬¸ ìš”ì•½í•´ì¤˜"},
    {"role": "assistant", "content": "TransformerëŠ”...", "tool_choice": "summarize"},
    {"role": "user", "content": "ì´ ë…¼ë¬¸ì˜ í•œê³„ì ì€ ë­ì•¼?"},
    {"role": "assistant", "content": "ì£¼ìš” í•œê³„ì ì€...", "tool_choice": "general"}
]
```

### ì„¸ì…˜ ê´€ë¦¬ ë°©ë²•

#### ì„¸ì…˜ ID ìƒì„±

**íŒŒì¼**: `ui/components/chat_manager.py:58`

```python
chat_id = str(uuid.uuid4())[:8]
# UUID ì˜ˆì‹œ: "a3f2e8c1-b7d4-49a2-8c1e-f5d9a7b3c2e1"
# chat_id: "a3f2e8c1" (ì• 8ìë¦¬ë§Œ ì‚¬ìš©)
```

**ì¥ì **:
- ê³ ìœ ì„± ë³´ì¥ (ì¶©ëŒ í™•ë¥  ê·¹íˆ ë‚®ìŒ)
- ì§§ê³  ê°„ê²° (UI í‘œì‹œ ìš©ì´)
- ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ (ë³´ì•ˆ)

#### ì„¸ì…˜ ì €ì¥ì†Œ

**ì €ì¥ ìœ„ì¹˜**: Streamlit `session_state` (ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬)

**íŠ¹ì§•**:
- ë¸Œë¼ìš°ì € íƒ­ë§ˆë‹¤ ë…ë¦½ì ì¸ ì„¸ì…˜
- íƒ­ ìƒˆë¡œê³ ì¹¨ ì‹œ ì„¸ì…˜ ìœ ì§€
- íƒ­ ë‹«ìœ¼ë©´ ì„¸ì…˜ ì‚­ì œ
- ì„œë²„ ì¬ì‹œì‘ ì‹œ ì„¸ì…˜ ì‚­ì œ

**ì œí•œ ì‚¬í•­**:
- ì˜êµ¬ ì €ì¥ ì•„ë‹˜ (DB ì €ì¥ ì—†ìŒ)
- íƒ­ ê°„ ê³µìœ  ë¶ˆê°€
- ì„œë²„ ì¬ì‹œì‘ ì‹œ ì´ˆê¸°í™”

#### ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš° ê´€ë¦¬

**í˜„ì¬ êµ¬í˜„**:
- ëª¨ë“  messagesë¥¼ LLMì— ì „ë‹¬
- ìœˆë„ìš° í¬ê¸° ì œí•œ ì—†ìŒ

**ì ì¬ì  ë¬¸ì œ**:
- ëŒ€í™”ê°€ ê¸¸ì–´ì§€ë©´ í† í° ì œí•œ ì´ˆê³¼ ê°€ëŠ¥
- GPT-5: 128K í† í°, Solar-pro2: 32K í† í°

**í–¥í›„ ê°œì„  ë°©í–¥**:
1. ìŠ¬ë¼ì´ë”© ìœˆë„ìš°: ìµœê·¼ Nê°œ ë©”ì‹œì§€ë§Œ ìœ ì§€
2. ìš”ì•½: ì˜¤ë˜ëœ ëŒ€í™”ëŠ” ìš”ì•½í•˜ì—¬ ì••ì¶•
3. í† í° ì¹´ìš´íŒ…: í† í° ê°œìˆ˜ ëª¨ë‹ˆí„°ë§ ë° ê²½ê³ 

#### ë©”ëª¨ë¦¬ ìµœì í™”

**í˜„ì¬ ë©”ëª¨ë¦¬ ì‚¬ìš©**:
```python
# 1ê°œ ì±„íŒ… = ì„¸ì…˜ ë°ì´í„° + messages
# 1ê°œ ë©”ì‹œì§€ â‰ˆ 500~2000 bytes (í•œê¸€ ê¸°ì¤€)
# 10í„´ ëŒ€í™” â‰ˆ 10~40 KB
# 100ê°œ ì±„íŒ… â‰ˆ 1~4 MB (ë©”ëª¨ë¦¬ ë¶€ë‹´ ì ìŒ)
```

**ìµœì í™” ë°©ë²•**:
1. ì±„íŒ… ê°œìˆ˜ ì œí•œ (ì˜ˆ: ìµœëŒ€ 50ê°œ)
2. ì˜¤ë˜ëœ ì±„íŒ… ìë™ ì‚­ì œ
3. messages ì••ì¶• (ì¤‘ë³µ ì œê±°)
4. ëŒ€í™” ë‚´ë³´ë‚´ê¸° í›„ ì‚­ì œ

---

## ğŸ’¡ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ: ë©€í‹°í„´ ì„¸íŠ¸ 1 (ë…¼ë¬¸ ìš”ì•½ â†’ í•œê³„ì  â†’ í›„ì† ì—°êµ¬)

**ì¶œì²˜**: `docs/scenarios/00-2_ì „ë¬¸ê°€_ì§ˆë¬¸_ë¦¬ìŠ¤íŠ¸.md:154-164`

#### í„´ 1: ë…¼ë¬¸ ìš”ì•½

**ì‚¬ìš©ì ì§ˆë¬¸:**
```
"Attention Is All You Need" ë…¼ë¬¸ ìš”ì•½í•´ì¤˜
```

**ì‹¤í–‰ íë¦„:**

1. **ì„¸ì…˜ ìƒì„±**:
   - `create_new_chat("hard")` í˜¸ì¶œ
   - `chat_id = "d5a9b2c7"` ìƒì„±
   - `messages = []` ì´ˆê¸°í™”

2. **ë„êµ¬ ì„ íƒ**:
   - `router_node` ì‹¤í–‰
   - `messages` ë¹„ì–´ìˆìŒ â†’ ì¼ë°˜ ë¼ìš°íŒ…
   - íŒ¨í„´ ë§¤ì¹­: "ë…¼ë¬¸", "ìš”ì•½" â†’ `summarize` ì„ íƒ

3. **ë…¼ë¬¸ ìš”ì•½ ì‹¤í–‰**:
   - `summarize_node` ì‹¤í–‰
   - PostgreSQLì—ì„œ "Attention Is All You Need" ë…¼ë¬¸ ê²€ìƒ‰
   - pgvectorì—ì„œ ë…¼ë¬¸ ì²­í¬ 50ê°œ ì¡°íšŒ
   - hard ëª¨ë“œ â†’ intermediate + advanced ìˆ˜ì¤€ ìš”ì•½ ìƒì„±

4. **ë‹µë³€ ì˜ˆì‹œ** (intermediate ìˆ˜ì¤€):
   ```
   **ë…¼ë¬¸ ê°œìš”**
   - ì œëª©: Attention Is All You Need
   - ì €ì: Vaswani et al., Google Brain & Google Research
   - ë°œí‘œ: NIPS 2017

   **í•µì‹¬ ê¸°ì—¬**
   1. RNN/CNN ì—†ì´ ìˆœìˆ˜ Attention ë©”ì»¤ë‹ˆì¦˜ë§Œìœ¼ë¡œ êµ¬ì„±ëœ Transformer ì•„í‚¤í…ì²˜ ì œì•ˆ
   2. Multi-Head Attention: ë‹¤ì–‘í•œ ìœ„ì¹˜ì˜ ì •ë³´ë¥¼ ë³‘ë ¬ë¡œ í•™ìŠµ
   3. Positional Encoding: ìœ„ì¹˜ ì •ë³´ë¥¼ ë²¡í„°ì— ì¶”ê°€í•˜ì—¬ ì‹œí€€ìŠ¤ ìˆœì„œ í‘œí˜„

   **ì‹¤í—˜ ê²°ê³¼**
   - WMT 2014 ì˜-ë… ë²ˆì—­: BLEU 28.4 (ë‹¹ì‹œ SOTA)
   - WMT 2014 ì˜-ë¶ˆ ë²ˆì—­: BLEU 41.8 (ìƒˆë¡œìš´ SOTA)
   - í•™ìŠµ ì†ë„: RNN ëŒ€ë¹„ 10ë°° ì´ìƒ ë¹ ë¦„

   **ì•„í‚¤í…ì²˜**
   - Encoder: 6ê°œ ë ˆì´ì–´ (Multi-Head Attention + Feed-Forward)
   - Decoder: 6ê°œ ë ˆì´ì–´ (Masked Multi-Head Attention + Encoder-Decoder Attention + Feed-Forward)
   - ì‹œê°„ ë³µì¡ë„: O(nÂ²Â·d) (n: ì‹œí€€ìŠ¤ ê¸¸ì´, d: ì°¨ì›)
   ```

5. **ì„¸ì…˜ ì €ì¥**:
   ```python
   messages = [
       {
           "role": "user",
           "content": '"Attention Is All You Need" ë…¼ë¬¸ ìš”ì•½í•´ì¤˜'
       },
       {
           "role": "assistant",
           "content": "**ë…¼ë¬¸ ê°œìš”**\n- ì œëª©: Attention Is All You Need...",
           "tool_choice": "summarize"
       }
   ]
   ```

#### í„´ 2: í•œê³„ì  ì§ˆë¬¸

**ì‚¬ìš©ì ì§ˆë¬¸:**
```
ì´ ë…¼ë¬¸ì˜ í•œê³„ì ì€ ë­ì•¼?
```

**ì‹¤í–‰ íë¦„:**

1. **ë§¥ë½ ì°¸ì¡° ê°ì§€**:
   - `contextual_keywords` ì²´í¬: "ì´" í¬í•¨
   - `has_contextual_ref = True`
   - `messages` ê°œìˆ˜: 2 (> 1)
   - `has_multi_request_indicator = False`
   - **ê²°ê³¼**: `skip_pattern_matching = True`

2. **ë©€í‹°í„´ ëª¨ë“œ ì§„ì…**:
   - íŒ¨í„´ ë§¤ì¹­ ê±´ë„ˆë›°ê¸°
   - LLM ë¼ìš°íŒ…ìœ¼ë¡œ ì§í–‰

3. **LLM ë¼ìš°íŒ… with ì»¨í…ìŠ¤íŠ¸**:
   ```python
   routing_prompt = f"""
   [ì´ì „ ëŒ€í™” ë‚´ì—­]
   ì‚¬ìš©ì: "Attention Is All You Need" ë…¼ë¬¸ ìš”ì•½í•´ì¤˜
   AI: (Transformer ë…¼ë¬¸ ìš”ì•½ ì „ì²´ ë‚´ìš©)

   [í˜„ì¬ ì§ˆë¬¸]
   ì´ ë…¼ë¬¸ì˜ í•œê³„ì ì€ ë­ì•¼?

   ìœ„ ëŒ€í™” ë§¥ë½ì„ ê³ ë ¤í•˜ì—¬ í˜„ì¬ ì§ˆë¬¸ì— ì í•©í•œ ë„êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.
   ë„êµ¬ ëª©ë¡: general, search_paper, glossary, web_search, summarize, text2sql, save_file
   """
   ```

4. **LLM ë¶„ì„**:
   - "ì´ ë…¼ë¬¸" = "Attention Is All You Need" (Transformer ë…¼ë¬¸)
   - í•œê³„ì  ì§ˆë¬¸ = ê¸°ìˆ ì  ë¶„ì„ í•„ìš”
   - **ë„êµ¬ ì„ íƒ**: `general` (LLM ì§€ì‹ìœ¼ë¡œ í•œê³„ì  ì„¤ëª…)

5. **ì¼ë°˜ ë‹µë³€ ìƒì„±**:
   - `general_answer_node` ì‹¤í–‰
   - ì´ì „ ëŒ€í™” í¬í•¨í•˜ì—¬ LLM í˜¸ì¶œ
   - hard ëª¨ë“œ â†’ intermediate + advanced ìˆ˜ì¤€ ë‹µë³€

6. **ë‹µë³€ ì˜ˆì‹œ** (intermediate ìˆ˜ì¤€):
   ```
   Transformer ë…¼ë¬¸ì˜ ì£¼ìš” í•œê³„ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

   **1. ê³„ì‚° ë³µì¡ë„**
   - Self-Attention: O(nÂ²Â·d) ì‹œê°„ ë³µì¡ë„
   - ê¸´ ì‹œí€€ìŠ¤(nì´ í´ ë•Œ) ì²˜ë¦¬ ì‹œ ë©”ëª¨ë¦¬ì™€ ê³„ì‚° ë¹„ìš© ê¸‰ì¦
   - ì˜ˆ: n=1000 â†’ 100ë§Œ ê°œ attention ìŠ¤ì½”ì–´ ê³„ì‚°

   **2. ìœ„ì¹˜ ì •ë³´ í‘œí˜„ì˜ í•œê³„**
   - Sinusoidal Positional Encoding ì‚¬ìš©
   - ìƒëŒ€ì  ìœ„ì¹˜ ê´€ê³„ë¥¼ ëª…ì‹œì ìœ¼ë¡œ í•™ìŠµí•˜ì§€ ëª»í•¨
   - í•™ìŠµëœ ìœ„ì¹˜ë³´ë‹¤ ê¸´ ì‹œí€€ìŠ¤ ì²˜ë¦¬ ì‹œ ì„±ëŠ¥ ì €í•˜

   **3. ë¡œì»¬ ì»¨í…ìŠ¤íŠ¸ ë¬´ì‹œ**
   - ëª¨ë“  ìœ„ì¹˜ì— ë™ë“±í•˜ê²Œ Attention
   - CNNì²˜ëŸ¼ ì¸ì ‘í•œ í† í° ê°„ ë¡œì»¬ íŒ¨í„´ í•™ìŠµ ë¶€ì¡±
   - ì–¸ì–´ì˜ ì§€ì—­ì  êµ¬ì¡° ì •ë³´ í™œìš© ë¯¸í¡

   **4. ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±**
   - Key, Value, Query ë²¡í„°ë¥¼ ëª¨ë‘ ì €ì¥
   - Attention ë§µ (nÃ—n) ë©”ëª¨ë¦¬ ì‚¬ìš©
   - ë°°ì¹˜ í¬ê¸° ì œí•œ

   **í›„ì† ì—°êµ¬ì—ì„œ ê°œì„ **
   - Longformer: Sparse Attentionìœ¼ë¡œ O(n) ë³µì¡ë„ ë‹¬ì„±
   - Reformer: LSH Attentionìœ¼ë¡œ ë©”ëª¨ë¦¬ ì ˆê°
   - Relative Positional Encoding: ìƒëŒ€ì  ìœ„ì¹˜ í•™ìŠµ
   ```

7. **ì„¸ì…˜ ì—…ë°ì´íŠ¸**:
   ```python
   messages = [
       {
           "role": "user",
           "content": '"Attention Is All You Need" ë…¼ë¬¸ ìš”ì•½í•´ì¤˜'
       },
       {
           "role": "assistant",
           "content": "**ë…¼ë¬¸ ê°œìš”**...",
           "tool_choice": "summarize"
       },
       {
           "role": "user",
           "content": "ì´ ë…¼ë¬¸ì˜ í•œê³„ì ì€ ë­ì•¼?"
       },
       {
           "role": "assistant",
           "content": "Transformer ë…¼ë¬¸ì˜ ì£¼ìš” í•œê³„ì ì€...",
           "tool_choice": "general"
       }
   ]
   ```

#### í„´ 3: í›„ì† ì—°êµ¬ ì§ˆë¬¸

**ì‚¬ìš©ì ì§ˆë¬¸:**
```
ê°œì„ í•œ í›„ì† ì—°êµ¬ ìˆì–´?
```

**ì‹¤í–‰ íë¦„:**

1. **ë§¥ë½ ì°¸ì¡° ê°ì§€**:
   - "ê°œì„ í•œ" = ì´ì „ ëŒ€í™”ì˜ "í•œê³„ì "ì„ ê°œì„ 
   - `has_contextual_ref = True` (ì•”ë¬µì  ì°¸ì¡°)
   - `messages` ê°œìˆ˜: 4 (> 1)
   - **ê²°ê³¼**: ë©€í‹°í„´ ëª¨ë“œ ì§„ì…

2. **LLM ë¼ìš°íŒ… with ì „ì²´ ì»¨í…ìŠ¤íŠ¸**:
   ```python
   routing_prompt = f"""
   [ì´ì „ ëŒ€í™” ë‚´ì—­]
   1. ì‚¬ìš©ì: "Attention Is All You Need" ë…¼ë¬¸ ìš”ì•½í•´ì¤˜
      AI: (Transformer ë…¼ë¬¸ ìš”ì•½)
   2. ì‚¬ìš©ì: ì´ ë…¼ë¬¸ì˜ í•œê³„ì ì€ ë­ì•¼?
      AI: (í•œê³„ì : ê³„ì‚° ë³µì¡ë„, ìœ„ì¹˜ ì •ë³´, ë¡œì»¬ ì»¨í…ìŠ¤íŠ¸, ë©”ëª¨ë¦¬)

   [í˜„ì¬ ì§ˆë¬¸]
   ê°œì„ í•œ í›„ì† ì—°êµ¬ ìˆì–´?

   ìœ„ ëŒ€í™” ë§¥ë½ì„ ê³ ë ¤í•˜ì—¬ í˜„ì¬ ì§ˆë¬¸ì— ì í•©í•œ ë„êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.
   """
   ```

3. **LLM ë¶„ì„**:
   - "ê°œì„ í•œ" = Transformerì˜ í•œê³„ì ì„ ê°œì„ 
   - "í›„ì† ì—°êµ¬" = ê´€ë ¨ ë…¼ë¬¸ ê²€ìƒ‰ í•„ìš”
   - **ë„êµ¬ ì„ íƒ**: `search_paper` (DBì—ì„œ í›„ì† ì—°êµ¬ ê²€ìƒ‰)

4. **ë…¼ë¬¸ ê²€ìƒ‰ ì‹¤í–‰**:
   - `search_paper_node` ì‹¤í–‰
   - ê²€ìƒ‰ ì¿¼ë¦¬: "Transformer improvement Longformer Reformer"
   - pgvector ìœ ì‚¬ë„ ê²€ìƒ‰

5. **ë‹µë³€ ì˜ˆì‹œ**:
   ```
   Transformerì˜ í•œê³„ë¥¼ ê°œì„ í•œ ì£¼ìš” í›„ì† ì—°êµ¬ë“¤ì…ë‹ˆë‹¤:

   **1. Longformer (Beltagy et al., 2020)**
   - ì œëª©: Longformer: The Long-Document Transformer
   - ê°œì„ : Sparse Attention â†’ O(n) ë³µì¡ë„
   - í•µì‹¬: Sliding Window + Global Attention ê²°í•©
   - ì„±ëŠ¥: 4096 í† í°ê¹Œì§€ íš¨ìœ¨ì  ì²˜ë¦¬

   **2. Reformer (Kitaev et al., 2020)**
   - ì œëª©: Reformer: The Efficient Transformer
   - ê°œì„ : LSH Attention + Reversible Layers
   - ë©”ëª¨ë¦¬: ê¸°ì¡´ ëŒ€ë¹„ 1/8 ì ˆê°
   - ì‘ìš©: ê¸´ ì‹œí€€ìŠ¤ ì²˜ë¦¬ (64K í† í°)

   **3. Linformer (Wang et al., 2020)**
   - ì œëª©: Linformer: Self-Attention with Linear Complexity
   - ê°œì„ : Low-rank Approximation
   - ë³µì¡ë„: O(n) ì„ í˜• ì‹œê°„
   - íŠ¹ì§•: Attention ë§µì„ ì €ì°¨ì›ìœ¼ë¡œ ê·¼ì‚¬

   **4. Performer (Choromanski et al., 2021)**
   - ì œëª©: Rethinking Attention with Performers
   - ê°œì„ : FAVOR+ (Fast Attention Via positive Orthogonal Random features)
   - ë³µì¡ë„: O(n) ì„ í˜•
   - ì¥ì : ì •í™•ë„ ìœ ì§€í•˜ë©° ì†ë„ í–¥ìƒ

   **5. Relative Positional Encoding**
   - Transformer-XL, T5, DeBERTa ë“±ì— ì ìš©
   - ê°œì„ : ìƒëŒ€ì  ìœ„ì¹˜ ê´€ê³„ ëª…ì‹œì  í•™ìŠµ
   - íš¨ê³¼: ê¸´ ì‹œí€€ìŠ¤ì—ì„œ ì¼ë°˜í™” ì„±ëŠ¥ í–¥ìƒ
   ```

6. **ìµœì¢… ì„¸ì…˜ ìƒíƒœ**:
   ```python
   messages = [
       {
           "role": "user",
           "content": '"Attention Is All You Need" ë…¼ë¬¸ ìš”ì•½í•´ì¤˜'
       },
       {
           "role": "assistant",
           "content": "**ë…¼ë¬¸ ê°œìš”**...",
           "tool_choice": "summarize"
       },
       {
           "role": "user",
           "content": "ì´ ë…¼ë¬¸ì˜ í•œê³„ì ì€ ë­ì•¼?"
       },
       {
           "role": "assistant",
           "content": "Transformer ë…¼ë¬¸ì˜ ì£¼ìš” í•œê³„ì ì€...",
           "tool_choice": "general"
       },
       {
           "role": "user",
           "content": "ê°œì„ í•œ í›„ì† ì—°êµ¬ ìˆì–´?"
       },
       {
           "role": "assistant",
           "content": "Transformerì˜ í•œê³„ë¥¼ ê°œì„ í•œ ì£¼ìš” í›„ì† ì—°êµ¬ë“¤ì…ë‹ˆë‹¤...",
           "tool_choice": "search_paper"
       }
   ]
   ```

### ì»¨í…ìŠ¤íŠ¸ ìœ ì§€ ë¶„ì„

**í„´ 1 â†’ í„´ 2**:
- ëª…ì‹œì  ì°¸ì¡°: "ì´ ë…¼ë¬¸" â†’ "Attention Is All You Need"
- LLMì´ ì´ì „ ë‹µë³€(Transformer ìš”ì•½)ì„ ì°¸ì¡°í•˜ì—¬ í•œê³„ì  ì„¤ëª…

**í„´ 2 â†’ í„´ 3**:
- ì•”ë¬µì  ì°¸ì¡°: "ê°œì„ í•œ" â†’ ì´ì „ ëŒ€í™”ì˜ "í•œê³„ì "
- LLMì´ ëŒ€í™” íë¦„(ìš”ì•½ â†’ í•œê³„ì  â†’ ê°œì„ )ì„ ì´í•´
- í•œê³„ì ì—ì„œ ì–¸ê¸‰ëœ "Longformer, Reformer"ë¥¼ ê¸°ì–µí•˜ê³  ê²€ìƒ‰

**ì»¨í…ìŠ¤íŠ¸ ì¼ê´€ì„±**:
- 3í„´ ëª¨ë‘ "Transformer ë…¼ë¬¸"ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì—°ê²°
- ê° í„´ì´ ì´ì „ ë‹µë³€ì„ ê¸°ë°˜ìœ¼ë¡œ ì‹¬í™”
- ì‚¬ìš©ìê°€ ì£¼ì œë¥¼ ë°˜ë³µ ëª…ì‹œí•˜ì§€ ì•Šì•„ë„ ì´í•´

---

## ğŸ” í•µì‹¬ í¬ì¸íŠ¸

### 1. ë§¥ë½ ì°¸ì¡° í‚¤ì›Œë“œ ê¸°ë°˜ ë©€í‹°í„´ ê°ì§€

**10ê°€ì§€ í‚¤ì›Œë“œ**:
```python
["ê´€ë ¨", "ê·¸ê±°", "ì´ê±°", "ì €ê±°", "í•´ë‹¹", "ë°©ê¸ˆ", "ìœ„", "ì•ì„œ", "ì´ì „", "ê·¸"]
```

**ì™œ ì¤‘ìš”í•œê°€?**
- ìë™ ë©€í‹°í„´ ëª¨ë“œ ì „í™˜
- íŒ¨í„´ ë§¤ì¹­ ê±´ë„ˆë›°ê³  LLM ë¼ìš°íŒ… ì§í–‰
- ì»¨í…ìŠ¤íŠ¸ë¥¼ ê³ ë ¤í•œ ë„êµ¬ ì„ íƒ

**ì œí•œ ì‚¬í•­**:
- í‚¤ì›Œë“œê°€ ì—†ìœ¼ë©´ ë©€í‹°í„´ ê°ì§€ ë¶ˆê°€
- ì˜ˆ: "í•œê³„ì ì€ ë­ì•¼?" (ë§¥ë½ í‚¤ì›Œë“œ ì—†ìŒ) â†’ ì¼ë°˜ ì²˜ë¦¬

### 2. ì„¸ì…˜ ê¸°ë°˜ ëŒ€í™” ê´€ë¦¬

**ì„¸ì…˜ ID**:
- UUID ê¸°ë°˜ 8ìë¦¬ ê³ ìœ  ID
- ì±„íŒ…ë³„ ë…ë¦½ì ì¸ messages ë¦¬ìŠ¤íŠ¸

**ì¥ì **:
- ì—¬ëŸ¬ ì±„íŒ… ë™ì‹œ ê´€ë¦¬ ê°€ëŠ¥
- ì±„íŒ… ì „í™˜ ì‹œ ì»¨í…ìŠ¤íŠ¸ ë¶„ë¦¬
- ì±„íŒ…ë³„ ë‚œì´ë„ ë…ë¦½ ê´€ë¦¬

**ì œí•œ**:
- ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥ (ì˜êµ¬ ì €ì¥ ì•„ë‹˜)
- íƒ­ ë‹«ìœ¼ë©´ ì„¸ì…˜ ì‚­ì œ

### 3. LLMì´ ì „ì²´ ëŒ€í™” íˆìŠ¤í† ë¦¬ ì°¸ì¡°

**í”„ë¡¬í”„íŠ¸ êµ¬ì„±**:
```python
full_messages = state["messages"] + [HumanMessage(content=question)]
response = llm_client.llm.invoke(full_messages)
```

**LLM ë¶„ì„ ëŠ¥ë ¥**:
- ì´ì „ ëŒ€í™”ì˜ ë§¥ë½ ì´í•´
- ì°¸ì¡° ëŒ€ìƒ íŒŒì•… ("ê·¸ê±°", "ì´ ë…¼ë¬¸")
- ëŒ€í™” íë¦„ íŒŒì•… (ì£¼ì œ ì—°ì†ì„±)

**ì™œ íš¨ê³¼ì ì¸ê°€?**
- GPT-5, Solar-pro2 ëª¨ë‘ ê°•ë ¥í•œ ì»¨í…ìŠ¤íŠ¸ ì´í•´ ëŠ¥ë ¥
- ë³„ë„ì˜ ì»¨í…ìŠ¤íŠ¸ íŒŒì‹± ë¡œì§ ë¶ˆí•„ìš”
- ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” íë¦„ ìœ ì§€

### 4. ë©€í‹°í„´ vs ë‹¤ì¤‘ ìš”ì²­ êµ¬ë¶„

**ë©€í‹°í„´**: ì´ì „ ëŒ€í™” ì°¸ì¡°, LLM ë¼ìš°íŒ…
- "ê·¸ ë…¼ë¬¸ ìì„¸íˆ ì•Œë ¤ì¤˜"
- "ì´ì „ì— ë§í•œ ê±° ì„¤ëª…í•´ì¤˜"

**ë‹¤ì¤‘ ìš”ì²­**: ëª…í™•í•œ ì‘ì—… ì²´ì¸, íŒ¨í„´ ë§¤ì¹­
- "ê·¸ ë…¼ë¬¸ ì €ì¥í•´ì¤˜" (ì €ì¥ í‚¤ì›Œë“œ)
- "ê·¸ ë…¼ë¬¸ ìš”ì•½í•´ì¤˜" (ìš”ì•½ í‚¤ì›Œë“œ)

**êµ¬ë¶„ ë¡œì§**:
```python
skip_pattern_matching = (
    has_contextual_ref and
    len(messages) > 1 and
    not has_multi_request_indicator  # ë‹¤ì¤‘ ìš”ì²­ ì•„ë‹˜
)
```

### 5. ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš° ì œí•œ ì—†ìŒ (í˜„ì¬)

**í˜„ì¬ êµ¬í˜„**:
- ëª¨ë“  messagesë¥¼ LLMì— ì „ë‹¬
- ëŒ€í™”ê°€ ì•„ë¬´ë¦¬ ê¸¸ì–´ë„ ì „ì²´ ì°¸ì¡°

**ì¥ì **:
- ì™„ì „í•œ ì»¨í…ìŠ¤íŠ¸ ìœ ì§€
- ë¨¼ ê³¼ê±° ëŒ€í™”ë„ ì°¸ì¡° ê°€ëŠ¥

**ë‹¨ì **:
- ëŒ€í™”ê°€ ê¸¸ì–´ì§€ë©´ í† í° í•œê³„ ë„ë‹¬
- GPT-5: 128K, Solar-pro2: 32K

**í–¥í›„ ê°œì„ **:
- ìµœê·¼ Ní„´ë§Œ ìœ ì§€ (ìŠ¬ë¼ì´ë”© ìœˆë„ìš°)
- ì˜¤ë˜ëœ ëŒ€í™” ìš”ì•½
- í† í° ì¹´ìš´íŒ… ë° ê²½ê³ 

---

## ğŸ“š ì°¸ê³  ì •ë³´

### ì£¼ìš” íŒŒì¼ ë° ìœ„ì¹˜

- **ì„¸ì…˜ ê´€ë¦¬**: `ui/components/chat_manager.py`
- **ë©€í‹°í„´ ê°ì§€**: `src/agent/nodes.py:48-73` > `router_node()`
- **ìƒíƒœ ì •ì˜**: `src/agent/state.py` > `AgentState`
- **UI ì´ˆê¸°í™”**: `ui/app.py:73-99` > `initialize_agent()`
- **ëª¨ë¸ ì„¤ì •**: `configs/model_config.yaml`

### ê´€ë ¨ ê¸°ìˆ  ìŠ¤íƒ

- **ì„¸ì…˜ ê´€ë¦¬**:
  - Streamlit session_state (ì¸ë©”ëª¨ë¦¬ ì €ì¥ì†Œ)
  - UUID (ê³ ìœ  ID ìƒì„±)
- **LLM**:
  - Solar-pro2 (easy ëª¨ë“œ)
  - GPT-5 (hard ëª¨ë“œ)
- **LangChain**:
  - `HumanMessage`, `AIMessage`
  - `llm.invoke()` with messages

### ë§¥ë½ ì°¸ì¡° í‚¤ì›Œë“œ ìƒì„¸

| í‚¤ì›Œë“œ | ì‚¬ìš© ì˜ˆì‹œ | ì°¸ì¡° ëŒ€ìƒ |
|--------|-----------|----------|
| **ê·¸ê±°** | "ê·¸ê±° ìì„¸íˆ ì•Œë ¤ì¤˜" | ì´ì „ ë‹µë³€ ì „ì²´ |
| **ì´ê±°** | "ì´ê±° ë­ì•¼?" | ì´ì „ì— ì–¸ê¸‰ëœ ê²ƒ |
| **ì €ê±°** | "ì €ê±° ì„¤ëª…í•´ì¤˜" | ì´ì „ ë‹µë³€ì˜ íŠ¹ì • ë¶€ë¶„ |
| **ê´€ë ¨** | "ê´€ë ¨ ë…¼ë¬¸ ì°¾ì•„ì¤˜" | ì´ì „ ëŒ€í™” ì£¼ì œ |
| **í•´ë‹¹** | "í•´ë‹¹ ë‚´ìš© ìš”ì•½í•´ì¤˜" | ì´ì „ ë‹µë³€ |
| **ë°©ê¸ˆ** | "ë°©ê¸ˆ ë§í•œ ê±° ì €ì¥í•´ì¤˜" | ë°”ë¡œ ì´ì „ ë‹µë³€ |
| **ìœ„** | "ìœ„ì— ë§í•œ ë…¼ë¬¸" | ì´ì „ ëŒ€í™” |
| **ì•ì„œ** | "ì•ì„œ ì„¤ëª…í•œ ë‚´ìš©" | ê³¼ê±° ë‹µë³€ |
| **ì´ì „** | "ì´ì „ì— ì°¾ì€ ë…¼ë¬¸" | ê³¼ê±° ê²€ìƒ‰ ê²°ê³¼ |
| **ê·¸** | "ê·¸ ë…¼ë¬¸ ìš”ì•½í•´ì¤˜" | ì´ì „ì— ì–¸ê¸‰ëœ ë…¼ë¬¸ |

### ì„¸ì…˜ ê´€ë¦¬ API

| ë©”ì„œë“œ | íŒŒì¼ | ì„¤ëª… |
|--------|------|------|
| `initialize_chat_sessions()` | chat_manager.py:24 | ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™” |
| `create_new_chat(difficulty)` | chat_manager.py:47 | ìƒˆ ì±„íŒ… ìƒì„± |
| `switch_chat(chat_id)` | chat_manager.py:102 | ì±„íŒ… ì „í™˜ |
| `delete_chat(chat_id)` | chat_manager.py:116 | ì±„íŒ… ì‚­ì œ |
| `get_current_messages()` | chat_manager.py:136 | í˜„ì¬ ë©”ì‹œì§€ ì¡°íšŒ |
| `get_current_difficulty()` | chat_manager.py:152 | í˜„ì¬ ë‚œì´ë„ ì¡°íšŒ |
| `add_message_to_current_chat()` | chat_manager.py:168 | ë©”ì‹œì§€ ì¶”ê°€ |
| `update_chat_title()` | chat_manager.py:77 | ì œëª© ì—…ë°ì´íŠ¸ |
| `export_chat(chat_id)` | chat_manager.py:219 | ëŒ€í™” ë‚´ë³´ë‚´ê¸° |
| `get_chat_list()` | chat_manager.py:194 | ì±„íŒ… ëª©ë¡ ì¡°íšŒ |

### LLM ëª¨ë¸ ì„¤ì •

**easy ëª¨ë“œ** (`configs/model_config.yaml:107-112`):
```yaml
- condition:
    difficulty: easy
    language: ko
  model:
    provider: solar
    name: solar-pro2
```

**hard ëª¨ë“œ** (`configs/model_config.yaml:114-118`):
```yaml
- condition:
    difficulty: hard
  model:
    provider: openai
    name: gpt-5
```

### ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

| í•­ëª© | ê°’ | ì„¤ëª… |
|------|------|------|
| **ì„¸ì…˜ ì €ì¥ì†Œ** | ì¸ë©”ëª¨ë¦¬ | Streamlit session_state |
| **ì„¸ì…˜ ì§€ì† ì‹œê°„** | íƒ­ ì—´ë¦¼ ë™ì•ˆ | ë¸Œë¼ìš°ì € íƒ­ ìœ ì§€ í•„ìš” |
| **ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš°** | ë¬´ì œí•œ (í˜„ì¬) | ëª¨ë“  messages ì „ë‹¬ |
| **í† í° ì œí•œ** | GPT-5: 128K, Solar: 32K | ê¸´ ëŒ€í™” ì‹œ í•œê³„ ë„ë‹¬ ê°€ëŠ¥ |
| **ë©”ëª¨ë¦¬ ì‚¬ìš©** | 10í„´: ~20KB | ì±„íŒ…ë‹¹ ë©”ëª¨ë¦¬ ë¶€ë‹´ ì ìŒ |

### ì œì•½ ì‚¬í•­

1. **ì˜êµ¬ ì €ì¥ ì—†ìŒ**: íƒ­ ë‹«ìœ¼ë©´ ëŒ€í™” ì‚­ì œ (DB ì €ì¥ ë¯¸êµ¬í˜„)
2. **í† í° í•œê³„**: ë§¤ìš° ê¸´ ëŒ€í™”ëŠ” í† í° ì œí•œ ë„ë‹¬ ê°€ëŠ¥
3. **ë§¥ë½ í‚¤ì›Œë“œ ì˜ì¡´**: í‚¤ì›Œë“œ ì—†ìœ¼ë©´ ë©€í‹°í„´ ê°ì§€ ì‹¤íŒ¨
4. **íƒ­ ê°„ ê³µìœ  ë¶ˆê°€**: ë¸Œë¼ìš°ì € íƒ­ë§ˆë‹¤ ë…ë¦½ ì„¸ì…˜
5. **ì„œë²„ ì¬ì‹œì‘ ì‹œ ì‚­ì œ**: ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”

### ê°œì„  ë°©í–¥

1. **DB ì €ì¥**: PostgreSQLì— ëŒ€í™” íˆìŠ¤í† ë¦¬ ì˜êµ¬ ì €ì¥
2. **ì»¨í…ìŠ¤íŠ¸ ì••ì¶•**: ìŠ¬ë¼ì´ë”© ìœˆë„ìš° + ìš”ì•½
3. **í† í° ëª¨ë‹ˆí„°ë§**: í† í° ê°œìˆ˜ ì¶”ì  ë° ê²½ê³ 
4. **ì„¸ì…˜ ê³µìœ **: ë¡œê·¸ì¸ ê¸°ë°˜ ì„¸ì…˜ ë™ê¸°í™”
5. **ë§¥ë½ ì´í•´ ê°œì„ **: í‚¤ì›Œë“œ ì™¸ì—ë„ ì˜ë¯¸ ê¸°ë°˜ ê°ì§€
6. **ëŒ€í™” ë‚´ë³´ë‚´ê¸° ìë™í™”**: ì£¼ê¸°ì  ìë™ ì €ì¥

---

**ì‘ì„±ì¼**: 2025-11-07
**ë²„ì „**: 1.0
