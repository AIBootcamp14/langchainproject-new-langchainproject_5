# 담당역할: 임예슬 - 프롬프트 엔지니어링

## 문서 정보
- **작성자**: 최현화[팀장]

## 담당자 정보
- **이름**: 임예슬
- **역할**: 프롬프트 엔지니어링 전담
- **참여 기간**: 전체 기간
- **핵심 역할**: AI Agent 도구 라우팅 프롬프트, 도구별 프롬프트, 평가 프롬프트, 질문 생성 프롬프트

---

## 📌 문서 목적

이 문서는 **프롬프트 엔지니어링에만 집중**합니다.

### 구현 완료된 기능 (다른 담당자)
- ✅ **Streamlit UI** - 최현화 ([담당역할_01-3_최현화_Streamlit_UI_구현.md](담당역할_01-3_최현화_Streamlit_UI_구현.md))
- ✅ **웹 검색 도구** - 최현화
- ✅ **파일 다운로드 기능** - 최현화
- ✅ **LangGraph 노드** - 최현화 & 임예슬 ([담당역할_06_통합_LangGraph_스트리밍.md](담당역할_06_통합_LangGraph_스트리밍.md))

### 임예슬 담당 - 프롬프트 엔지니어링
- ⭐ **AI Agent 도구 라우팅 프롬프트** (최우선순위)
- 도구별 프롬프트 (일반 답변, 웹 검색, 논문 검색, 용어집, 요약, 파일 저장)
- 평가 프롬프트 (LLM-as-a-Judge)
- 질문 생성 프롬프트
- JSON 프롬프트 파일 작성 (prompts/ 폴더)

### 최현화 담당 - 프롬프트 로더 적용
- ✅ **Prompt Loader 초기 구현 완료** (`src/prompts/loader.py`)
- ⭐ **기존 코드에 Prompt JSON 파일 적용** (우선순위 높음)
  - router_node에 JSON 프롬프트 적용
  - 6개 도구 노드에 JSON 프롬프트 적용
  - 하드코딩된 프롬프트 제거

---

## 1. 프롬프트 엔지니어링 개요

### 1.1 프로젝트에서 프롬프트의 역할

**프롬프트가 사용되는 위치:**
1. **도구 라우팅** (`src/agent/nodes.py:router_node`) - 가장 중요!
2. **도구별 시스템 프롬프트** (각 도구 노드)
3. **평가 프롬프트** (`src/evaluation/evaluator.py`)
4. **질문 생성 프롬프트** (자동 질문 생성)

### 1.2 멘토님 인사이트 반영

**멘토링(2025-10-30)에서 강조된 프롬프트 전략:**

1. **도구 설명 상세화**
   - 각 도구의 역할과 사용 시나리오를 명확하게 기재
   - 키워드 리스트 제공

2. **Few-shot 예시**
   - 각 도구별 2-3개의 대표 예시 제공
   - LLM이 패턴을 학습하도록 지원

3. **시나리오 템플릿**
   - 예상되는 질문 패턴을 미리 정의
   - 조건문 명확화 ("만약 ~이면 A 도구 사용")

4. **구조화된 출력**
   - JSON 형식으로 일관된 응답 요청
   - 파싱 오류 최소화

5. **재라우팅 및 Fallback**
   - 잘못된 도구 선택 시 다시 라우팅
   - 하지만 **프롬프팅을 잘해서 처음부터 정확한 도구 선택이 더 중요**

---

## 2. AI Agent 도구 라우팅 프롬프트 ⭐⭐⭐

### 2.1 라우팅 프롬프트의 중요성

**AI Agent의 핵심은 도구 라우팅입니다!**

- 사용자 질문을 정확하게 분석하여 6개 도구 중 가장 적절한 도구 선택
- **라우팅 정확도 = Agent 성능**
- 잘못된 도구 선택 시 답변 품질 저하

### 2.2 6개 도구 목록

1. **general** - 일반 답변 (비교, 설명, 개념 질문)
2. **search_paper** - 논문 데이터베이스 검색 (특정 논문)
3. **web_search** - 웹 검색 (최신 정보, 트렌드)
4. **glossary** - 용어집 (단일 용어 정의만)
5. **summarize** - 논문 요약
6. **save_file** - 파일 저장

### 2.3 라우팅 프롬프트 (상세 버전)

**파일 경로**: `src/prompts/routing_prompts.json`

**현재 위치**: `src/agent/nodes.py:router_node` (하드코딩됨)

**개선된 라우팅 프롬프트:**

```
당신은 사용자 질문을 분석하여 가장 적절한 도구를 선택하는 전문가입니다.

[도구 목록 및 사용 시나리오]

1. **search_paper** (논문 데이터베이스 검색)
   - 사용 시기: 특정 논문 내용, 연구 방법, 알고리즘 검색
   - 키워드: "논문", "연구", "방법", "알고리즘", "찾아줘", "검색", "데이터베이스"
   - 예시:
     * "RAG에 대한 논문 찾아줘"
     * "Transformer 연구 방법 알려줘"
     * "BERT 논문 검색"
   - ❌ 최신 정보는 web_search 사용

2. **web_search** (웹 검색)
   - 사용 시기: 최신 정보, 뉴스, 트렌드, 실시간 검색
   - 키워드: "최신", "2024년", "2025년", "뉴스", "트렌드", "최근"
   - 예시:
     * "최신 AI 뉴스"
     * "2024년 논문 트렌드"
     * "최근 Transformer 발전"
   - ❌ 특정 논문은 search_paper 사용

3. **glossary** (용어집 - 단일 용어 정의만)
   - 사용 시기: 하나의 전문 용어 정의와 설명
   - 키워드: "뭐야", "무엇", "정의", "설명해줘", "의미"
   - 예시:
     * "BERT가 뭐야?"
     * "Attention 설명해줘"
     * "RAG의 정의는?"
   - ❌ 비교 질문은 general 사용 ("A와 B의 차이")
   - ❌ 두 개 이상 용어는 general 사용

4. **summarize** (논문 요약)
   - 사용 시기: 논문 전체 또는 특정 섹션 요약
   - 키워드: "요약", "핵심", "간단히", "정리", "요약해줘"
   - 예시:
     * "이 논문 요약해줘"
     * "Attention Is All You Need 핵심 내용"
     * "논문 간단히 정리해줘"

5. **save_file** (파일 저장)
   - 사용 시기: 대화 내용이나 결과를 파일로 저장
   - 키워드: "저장", "다운로드", "파일", "내보내기"
   - 예시:
     * "파일로 저장해줘"
     * "대화 내용 다운로드"
     * "결과 저장"

6. **general** (일반 답변 - 기본 도구)
   - 사용 시기:
     * 비교 질문 ("A와 B의 차이")
     * 개념 설명 ("어떻게 작동해?")
     * 인사, 감사 ("안녕", "고마워")
     * 위의 특수 도구에 해당하지 않는 모든 경우
   - 키워드: "차이", "비교", "vs", "구별", "설명", "어떻게"
   - 예시:
     * "BERT와 GPT의 차이는?"
     * "Transformer가 RNN보다 나은 이유는?"
     * "안녕하세요"

[중요한 규칙]
- **비교 질문** ("차이", "vs", "비교", "구별") → general
- **두 개 이상의 용어** → general (glossary는 단일 용어만!)
- **최신 정보** ("최신", "2024년", "최근") → web_search
- **특정 논문** ("논문 찾아줘", "논문 검색") → search_paper
- **단일 용어 정의** ("~가 뭐야", "~의 정의") → glossary
- **요약** ("요약해줘", "핵심 내용") → summarize
- **파일 저장** ("저장", "다운로드") → save_file

[선택 규칙]
- 위 6개 도구 중 **하나만** 선택
- 도구 이름만 반환 (예: search_paper)
- 키워드와 사용 시나리오를 기준으로 판단
- 애매한 경우 general 선택

[사용자 질문]
{question}

[선택한 도구]
하나의 도구 이름만 반환하세요:
```

### 2.4 Few-shot 예시 추가

**Few-shot 예시는 라우팅 정확도를 크게 향상시킵니다!**

**JSON 형식 (src/prompts/routing_prompts.json에 저장):**

```json
{
  "routing_prompt": "위의 라우팅 프롬프트 전문",
  "few_shot_examples": [
    {
      "question": "BERT가 뭐야?",
      "tool": "glossary",
      "reason": "단일 용어(BERT) 정의 질문"
    },
    {
      "question": "RAG 논문 찾아줘",
      "tool": "search_paper",
      "reason": "특정 논문 검색"
    },
    {
      "question": "최신 AI 뉴스",
      "tool": "web_search",
      "reason": "최신 정보 검색"
    },
    {
      "question": "이 논문 요약해줘",
      "tool": "summarize",
      "reason": "논문 요약 요청"
    },
    {
      "question": "대화 내용 저장해줘",
      "tool": "save_file",
      "reason": "파일 저장 요청"
    },
    {
      "question": "BERT와 GPT의 차이는?",
      "tool": "general",
      "reason": "비교 질문 (두 개 용어)"
    },
    {
      "question": "Transformer 논문 찾아줘",
      "tool": "search_paper",
      "reason": "특정 논문 검색"
    },
    {
      "question": "Attention이 뭐야?",
      "tool": "glossary",
      "reason": "단일 용어(Attention) 정의 질문"
    },
    {
      "question": "2024년 최신 연구 동향",
      "tool": "web_search",
      "reason": "최신 정보 + 연도 키워드"
    },
    {
      "question": "Transformer가 RNN보다 나은 이유는?",
      "tool": "general",
      "reason": "비교 및 설명 질문"
    }
  ]
}
```

**Few-shot 프롬프트 적용 방법:**

**필요 라이브러리**:
- `langchain.prompts.FewShotPromptTemplate`
- `langchain.prompts.PromptTemplate`
- `json`

**구현 단계**:

| 단계 | 작업 | 설명 |
|-----|------|------|
| 1 | JSON 파일 로드 | routing_prompts.json에서 few_shot_examples 로드 |
| 2 | 예시 템플릿 정의 | PromptTemplate with input_variables: question, tool, reason |
| 3 | Few-shot 프롬프트 생성 | FewShotPromptTemplate 생성 (examples, example_prompt, prefix, suffix) |

**FewShotPromptTemplate 파라미터**:

| 파라미터 | 값 | 설명 |
|---------|---|------|
| examples | few_shot_examples[:5] | 상위 5개 예시 사용 |
| example_prompt | PromptTemplate 인스턴스 | 예시 형식 템플릿 |
| prefix | routing_data["routing_prompt"] | 라우팅 프롬프트 전체 텍스트 |
| suffix | "질문: {question}\n도구:" | 사용자 질문 후 도구 선택 요청 |
| input_variables | ["question"] | 입력 변수 |

### 2.5 재라우팅 및 Fallback 처리

**잘못된 도구 선택 시 재시도 로직:**

**함수명**: `route_with_fallback`

**역할**: 재라우팅 및 Fallback 지원 라우팅 함수

**파라미터**:

| 파라미터 | 타입 | 설명 |
|---------|------|------|
| state | AgentState | 에이전트 상태 (question, retry_count 포함) |
| exp_manager | ExperimentManager | 실험 관리 인스턴스 (로깅용) |

**반환값**: `str` - 선택된 도구 이름

**처리 흐름**:

| 단계 | 작업 | 설명 |
|-----|------|------|
| 1 | 상태 추출 | question 및 retry_count 가져오기 |
| 2 | 유효 도구 목록 정의 | ["search_paper", "web_search", "glossary", "summarize", "save_file", "general"] |
| 3 | LLM 호출 | LLMClient로 라우팅 프롬프트 실행 |
| 4 | 응답 파싱 | 첫 번째 단어만 추출 (도구 이름) |
| 5 | 유효성 검증 | tool_choice가 valid_tools에 있는지 확인 |
| 6 | 재시도 로직 | retry_count < 2이면 재귀 호출 |
| 7 | Fallback 처리 | 재시도 초과 시 "general" 반환 |
| 8 | 오류 처리 | Exception 발생 시 "general" 반환 (Fallback) |

**로깅**:
- 잘못된 도구 선택 시: "잘못된 도구 선택: {tool_choice}"
- Fallback 실행 시: "Fallback: general 도구 사용"
- 오류 발생 시: "라우팅 실패: {e}"

---

## 3. 도구별 프롬프트

### 3.1 일반 답변 프롬프트

**파일 경로**: `src/tools/general_answer.py` (lines 37-50)

**현재 구현**: 난이도별 시스템 프롬프트 하드코딩

**개선된 프롬프트 (JSON 형식):**

```json
{
  "general_answer_prompts": {
    "easy": {
      "system_prompt": "당신은 친절한 AI 어시스턴트입니다.\n초심자도 이해할 수 있도록 쉽고 명확하게 답변해주세요.\n\n답변 규칙:\n- 전문 용어는 최소화하고 일상적인 언어를 사용하세요\n- 복잡한 개념은 간단한 비유로 설명하세요 (예: '마치 ~처럼')\n- 친근하고 이해하기 쉬운 톤을 유지하세요\n- 핵심 아이디어 3가지 이내로 요약하세요",
      "examples": [
        {
          "question": "Attention이 뭐야?",
          "answer": "Attention은 마치 여러 단어 중에서 중요한 단어에 집중하는 것과 같아요. 예를 들어 '나는 사과를 먹었다'라는 문장에서 '사과'와 '먹었다'가 중요하죠. AI도 이런 식으로 중요한 정보에 집중해요!"
        }
      ]
    },
    "hard": {
      "system_prompt": "당신은 전문적인 AI 어시스턴트입니다.\n기술적인 세부사항을 포함하여 정확하고 전문적으로 답변해주세요.\n\n답변 규칙:\n- 기술 용어와 전문 개념을 자유롭게 사용하세요\n- 깊이 있는 설명과 상세한 정보를 제공하세요\n- 알고리즘의 시간/공간 복잡도를 분석하세요\n- 관련 논문과의 비교를 포함하세요\n- 전문가 수준의 정확성을 유지하세요",
      "examples": [
        {
          "question": "Attention 메커니즘의 시간 복잡도는?",
          "answer": "Self-Attention의 시간 복잡도는 O(n²d)입니다. 여기서 n은 시퀀스 길이, d는 임베딩 차원입니다. Query, Key, Value 행렬 계산이 O(nd²), Attention Score 계산이 O(n²d)이므로 전체 복잡도는 시퀀스 길이에 제곱으로 증가합니다. 이는 긴 시퀀스 처리 시 병목이 되며, Linformer, Performer 등의 효율적인 변형이 제안되었습니다."
        }
      ]
    }
  }
}
```

### 3.2 웹 검색 프롬프트

**파일 경로**: `src/tools/web_search.py` (lines 119-147)

**개선된 프롬프트:**

```json
{
  "web_search_prompts": {
    "easy": {
      "system_prompt": "당신은 최신 논문 정보를 쉽게 설명하는 전문가입니다.\n초심자도 이해할 수 있도록 검색 결과를 정리해주세요.\n\n답변 규칙:\n- 핵심 내용을 간단히 요약하세요\n- 쉬운 언어를 사용하세요\n- 중요한 정보만 선별하세요\n- 친근하고 이해하기 쉬운 톤을 유지하세요\n- 각 출처의 URL을 반드시 포함하세요",
      "user_prompt_template": "[웹 검색 결과]\n{formatted_results}\n\n[질문]\n{question}\n\n위 검색 결과를 바탕으로 질문에 답변해주세요.\n**중요**: 각 논문이나 정보 출처의 URL을 반드시 포함하세요.\n예시 형식:\n- 논문 제목 ([링크](URL))\n또는\n🔗 출처: [제목](URL)"
    },
    "hard": {
      "system_prompt": "당신은 논문 분석 전문가입니다.\n검색 결과를 전문적으로 정리해주세요.\n\n답변 규칙:\n- 기술적 세부사항을 포함하세요\n- 최신 연구 동향을 분석하세요\n- 관련 논문들을 비교하세요\n- 전문가 수준의 정확성을 유지하세요\n- 각 출처의 URL을 반드시 포함하세요",
      "user_prompt_template": "[웹 검색 결과]\n{formatted_results}\n\n[질문]\n{question}\n\n위 검색 결과를 바탕으로 질문에 답변해주세요.\n**중요**: 각 논문이나 정보 출처의 URL을 반드시 포함하세요.\n예시 형식:\n- 논문 제목 ([링크](URL))\n또는\n🔗 출처: [제목](URL)"
    }
  }
}
```

### 3.3 논문 요약 프롬프트

**파일 경로**: `src/tools/summarize.py` (lines 58-63, 157-168)

**개선된 프롬프트:**

```json
{
  "summarize_prompts": {
    "title_extraction": {
      "template": "다음 질문에서 요약하려는 논문의 제목을 추출하세요.\n논문 제목만 정확히 반환하세요. 다른 설명은 불필요합니다.\n\n질문: {question}\n\n논문 제목:"
    },
    "easy": {
      "system_prompt": "당신은 논문을 쉽게 설명하는 AI 어시스턴트입니다.\n초심자도 이해할 수 있도록 다음 논문을 요약해주세요:\n\n답변 규칙:\n- 핵심 내용을 간단하고 명확하게 설명\n- 전문 용어는 쉬운 말로 풀어서 설명\n- 3-5개의 주요 포인트로 정리\n- 실생활 비유 사용",
      "summary_template": "{system_prompt}\n\n논문 정보:\n- 제목: {title}\n- 저자: {authors}\n- 발행일: {publish_date}\n- 초록: {abstract}\n\n논문 내용:\n{combined_text}\n\n위 논문의 방법론 부분을 중심으로 요약해주세요.\n요약:"
    },
    "hard": {
      "system_prompt": "당신은 전문적인 논문 분석 AI 어시스턴트입니다.\n다음 논문을 전문적으로 요약해주세요:\n\n답변 규칙:\n- 연구 목적, 방법론, 주요 결과, 결론을 포함\n- 기술적 세부사항과 핵심 기여도 강조\n- 학술적 관점에서 종합적으로 분석\n- 알고리즘의 시간/공간 복잡도 언급",
      "summary_template": "{system_prompt}\n\n논문 정보:\n- 제목: {title}\n- 저자: {authors}\n- 발행일: {publish_date}\n- 초록: {abstract}\n\n논문 내용:\n{combined_text}\n\n위 논문의 방법론 부분을 중심으로 요약해주세요.\n요약:"
    }
  }
}
```

### 3.4 용어집 프롬프트

**파일 경로**: `src/tools/glossary.py`

**용어집 프롬프트 (난이도별):**

```json
{
  "glossary_prompts": {
    "easy": {
      "system_prompt": "당신은 AI 용어를 쉽게 설명하는 친절한 선생님입니다.\n초심자도 이해할 수 있도록 용어를 설명해주세요.\n\n답변 규칙:\n- 전문 용어는 쉬운 말로 풀어서 설명하세요\n- 실생활 비유를 사용하세요 (예: '마치 ~처럼')\n- 핵심만 간단히 설명하세요\n- 친근하고 이해하기 쉬운 톤을 유지하세요"
    },
    "hard": {
      "system_prompt": "당신은 AI 용어를 전문적으로 설명하는 전문가입니다.\n기술적인 세부사항을 포함하여 정확하게 설명해주세요.\n\n답변 규칙:\n- 기술 용어와 전문 개념을 자유롭게 사용하세요\n- 수식이나 알고리즘을 포함하세요\n- 관련 논문이나 연구를 언급하세요\n- 전문가 수준의 정확성을 유지하세요"
    }
  }
}
```

### 3.5 논문 검색 프롬프트

**파일 경로**: `src/tools/search_paper.py`

**논문 검색 프롬프트 (난이도별):**

```json
{
  "search_paper_prompts": {
    "easy": {
      "system_prompt": "당신은 논문을 쉽게 설명하는 전문가입니다.\n검색된 논문을 초심자도 이해할 수 있도록 정리해주세요.\n\n답변 규칙:\n- 핵심 내용을 간단히 요약\n- 전문 용어는 쉬운 말로 설명\n- 논문 제목, 저자, 발행일 명시\n- 친근하고 이해하기 쉬운 톤 유지"
    },
    "hard": {
      "system_prompt": "당신은 논문 분석 전문가입니다.\n검색된 논문을 전문적으로 정리해주세요.\n\n답변 규칙:\n- 연구 목적과 방법론 분석\n- 기술적 세부사항 포함\n- 핵심 기여도와 한계점 명시\n- 관련 연구와 비교\n- 논문 제목, 저자, 발행일 명시"
    }
  }
}
```

---

## 4. 평가 프롬프트 (LLM-as-a-Judge)

### 4.1 답변 품질 평가 프롬프트

**파일 경로**: `src/evaluation/evaluator.py`

**목적**: 챗봇의 답변 품질을 자동으로 평가

**평가 항목:**
1. **정확도** (0-10점): 논문 내용과 일치하는지
2. **관련성** (0-10점): 질문과 답변이 관련있는지
3. **난이도 적합성** (0-10점): Easy/Hard 모드에 맞는지
4. **출처 명시** (0-10점): 논문 제목, 저자 명시 여부

**평가 프롬프트:**

```json
{
  "evaluation_prompt": {
    "template": "다음 AI 챗봇의 답변을 평가해주세요.\n\n[사용자 질문]\n{question}\n\n[AI 답변]\n{answer}\n\n[참고 문서]\n{reference_docs}\n\n[난이도 모드]\n{difficulty}\n\n[평가 기준]\n1. 정확도 (0-10점): 참고 문서의 내용과 일치하는가?\n2. 관련성 (0-10점): 질문과 답변이 관련있는가?\n3. 난이도 적합성 (0-10점): 난이도 모드에 맞는 답변인가?\n   - Easy: 쉬운 용어, 비유 사용, 간단 요약\n   - Hard: 기술 용어, 수식, 복잡도, 논문 비교\n4. 출처 명시 (0-10점): 논문 제목, 저자를 명시했는가?\n\nJSON 형식으로만 반환하세요:\n{\n    \"accuracy_score\": <점수>,\n    \"relevance_score\": <점수>,\n    \"difficulty_score\": <점수>,\n    \"citation_score\": <점수>,\n    \"total_score\": <총점>,\n    \"comment\": \"<평가 코멘트>\"\n}",
    "input_variables": ["question", "answer", "reference_docs", "difficulty"]
  }
}
```

**구현 설명:**

**필요 라이브러리**:
- `langchain_openai.ChatOpenAI`
- `langchain.prompts.PromptTemplate`
- `json`

**클래스: `AnswerEvaluator`**

**역할**: LLM-as-a-Judge 방식으로 답변 품질 평가

**`__init__` 메서드**:

| 초기화 항목 | 설정 |
|-----------|------|
| LLM | ChatOpenAI(model="gpt-5", temperature=0) |
| 프롬프트 로드 | evaluation_prompts.json 파일 로드 |
| PromptTemplate | template 및 input_variables 설정 |

**`evaluate` 메서드**:

**파라미터**:

| 파라미터 | 타입 | 설명 |
|---------|------|------|
| question | str | 사용자 질문 |
| answer | str | AI 답변 |
| reference_docs | str | 참고 문서 |
| difficulty | str | 난이도 (easy/hard) |

**반환값**: `dict` - 평가 결과 딕셔너리 (accuracy_score, relevance_score, difficulty_score, citation_score, total_score, comment)

**처리 흐름**:

| 단계 | 작업 | 설명 |
|-----|------|------|
| 1 | 프롬프트 포맷팅 | prompt_template.format()으로 입력값 삽입 |
| 2 | LLM 호출 | self.llm.invoke(prompt) |
| 3 | JSON 파싱 | response.content를 json.loads()로 파싱 |
| 4 | 오류 처리 | JSONDecodeError 발생 시 기본값 반환 (모든 점수 0) |

---

## 5. 질문 생성 프롬프트

### 5.1 자동 질문 생성 (Golden Dataset)

**목적**: 테스트용 질문 자동 생성

**파일 경로**: `src/prompts/question_generation_prompts.json`

**질문 생성 프롬프트:**

```json
{
  "question_generation_prompt": {
    "template": "다음 논문을 기반으로 테스트용 질문을 생성해주세요.\n\n[논문 정보]\n제목: {title}\n저자: {authors}\n초록: {abstract}\n\n[생성 규칙]\n- 각 난이도(Easy/Hard)별로 5개씩 총 10개 질문 생성\n- 각 도구(search_paper, web_search, glossary, summarize, general)를 다양하게 사용하는 질문 포함\n- Easy 질문: 초심자용 (\"~가 뭐야?\", \"간단히 설명해줘\")\n- Hard 질문: 전문가용 (\"시간 복잡도는?\", \"알고리즘 비교\")\n\nJSON 형식으로 반환:\n{\n  \"questions\": [\n    {\n      \"question\": \"질문 내용\",\n      \"difficulty\": \"easy\",\n      \"expected_tool\": \"search_paper\",\n      \"expected_answer_keywords\": [\"키워드1\", \"키워드2\"]\n    }\n  ]\n}",
    "input_variables": ["title", "authors", "abstract"]
  }
}
```

### 5.2 Golden Dataset 예시

**파일 경로**: `src/prompts/golden_dataset.json`

```json
{
  "golden_dataset": [
    {
      "question": "BERT가 뭐야?",
      "difficulty": "easy",
      "expected_tool": "glossary",
      "expected_answer_keywords": ["언어 모델", "양방향", "사전 학습"]
    },
    {
      "question": "RAG 논문 찾아줘",
      "difficulty": "easy",
      "expected_tool": "search_paper",
      "expected_answer_keywords": ["Retrieval", "Generation", "논문"]
    },
    {
      "question": "2024년 최신 Transformer 연구",
      "difficulty": "hard",
      "expected_tool": "web_search",
      "expected_answer_keywords": ["2024", "Transformer", "최신"]
    },
    {
      "question": "Attention Is All You Need 요약해줘",
      "difficulty": "easy",
      "expected_tool": "summarize",
      "expected_answer_keywords": ["Transformer", "Attention", "요약"]
    },
    {
      "question": "BERT와 GPT의 차이는?",
      "difficulty": "hard",
      "expected_tool": "general",
      "expected_answer_keywords": ["BERT", "GPT", "차이", "비교"]
    },
    {
      "question": "Self-Attention의 시간 복잡도는?",
      "difficulty": "hard",
      "expected_tool": "general",
      "expected_answer_keywords": ["O(n²)", "복잡도", "시퀀스"]
    },
    {
      "question": "Transformer가 RNN보다 나은 이유는?",
      "difficulty": "hard",
      "expected_tool": "general",
      "expected_answer_keywords": ["병렬화", "long-range", "의존성"]
    },
    {
      "question": "대화 내용 저장해줘",
      "difficulty": "easy",
      "expected_tool": "save_file",
      "expected_answer_keywords": ["저장", "파일"]
    },
    {
      "question": "BLEU Score가 뭐야?",
      "difficulty": "easy",
      "expected_tool": "glossary",
      "expected_answer_keywords": ["평가 지표", "번역", "유사도"]
    },
    {
      "question": "GPT-5 논문 검색",
      "difficulty": "hard",
      "expected_tool": "search_paper",
      "expected_answer_keywords": ["GPT-5", "논문"]
    }
  ]
}
```

---

## 6. 프롬프트 파일 매핑

### 6.1 현재 프롬프트 하드코딩 위치

| 파일 경로 | 줄 번호 | 프롬프트 종류 | JSON 파일 위치 |
|----------|--------|--------------|--------------|
| `src/agent/nodes.py` | 44-81 | 라우팅 프롬프트 | `prompts/routing_prompts.json` |
| `src/tools/general_answer.py` | 37-50 | Easy/Hard 시스템 프롬프트 | `prompts/tool_prompts.json` (general_answer) |
| `src/tools/web_search.py` | 119-147 | Easy/Hard 시스템 프롬프트 | `prompts/tool_prompts.json` (web_search) |
| `src/tools/summarize.py` | 58-63 | 논문 제목 추출 프롬프트 | `prompts/tool_prompts.json` (summarize.title_extraction) |
| `src/tools/summarize.py` | 157-168 | Easy/Hard 요약 프롬프트 | `prompts/tool_prompts.json` (summarize) |

### 6.2 JSON 프롬프트 파일 구조

```
prompts/                           # 프롬프트 데이터 (프로젝트 최상위)
├── routing_prompts.json          # 라우팅 프롬프트 + Few-shot 예시
├── tool_prompts.json              # 6개 도구별 프롬프트
├── evaluation_prompts.json        # 평가 프롬프트
├── question_generation_prompts.json  # 질문 생성 프롬프트
└── golden_dataset.json            # Golden Dataset (테스트용 질문)

src/prompts/                       # 프롬프트 로더 코드
├── __init__.py                    # 모듈 초기화 및 Export
├── loader.py                      # JSON 파일 로더 유틸리티
└── README.md                      # 사용 가이드
```

**설계 원칙**: 데이터(`prompts/`)와 코드(`src/prompts/`) 분리
- `prompts/`: JSON 프롬프트 파일 (데이터)
- `src/prompts/`: Python 로더 유틸리티 (코드)

**Prompt Loader 사용법**:

**필요 라이브러리**: `src.prompts` (get_routing_prompt, get_tool_prompt 함수)

**사용 예시**:

| 함수 | 사용법 | 반환값 |
|-----|--------|--------|
| get_routing_prompt() | 라우팅 프롬프트 로드 | str - 라우팅 프롬프트 텍스트 |
| get_tool_prompt("general_answer", "easy") | 도구별 프롬프트 로드 | str - 시스템 프롬프트 텍스트 |
| get_tool_prompt("web_search", "hard") | 웹 검색 Hard 모드 프롬프트 | str - 시스템 프롬프트 텍스트 |

---

## 7. 구현 우선순위

### Phase 1: 라우팅 프롬프트 개선 (최우선)
1. `src/prompts/routing_prompts.json` 파일 생성
2. 상세 라우팅 프롬프트 작성 (6개 도구 시나리오)
3. Few-shot 예시 10개 작성
4. `src/agent/nodes.py:router_node` 수정 (JSON 프롬프트 로드)

### Phase 2: 도구별 프롬프트 JSON화
1. `src/prompts/tool_prompts.json` 파일 생성
2. 6개 도구별 난이도 프롬프트 작성
3. 각 도구 파일 수정 (JSON 프롬프트 로드)

### Phase 3: 평가 프롬프트 구현
1. `src/prompts/evaluation_prompts.json` 파일 생성
2. `src/evaluation/evaluator.py` 구현
3. 평가 결과 DB 저장 로직 추가

### Phase 4: 질문 생성 및 Golden Dataset
1. `src/prompts/question_generation_prompts.json` 파일 생성
2. `src/prompts/golden_dataset.json` 파일 생성 (10개 질문)
3. 테스트 스크립트 작성

---

## 8. ExperimentManager 프롬프트 로깅

### 프롬프트 저장 방법

**함수**: ExperimentManager 메서드 사용

**저장 메서드**:

| 메서드 | 파라미터 | 설명 |
|-------|---------|------|
| save_system_prompt(content, metadata) | content: str<br>metadata: dict | 시스템 프롬프트 저장 |
| save_user_prompt(content, metadata) | content: str<br>metadata: dict | 사용자 프롬프트 저장 |

**도구 노드에서 프롬프트 저장 패턴**:

| 단계 | 작업 | 메서드 호출 |
|-----|------|------------|
| 1 | 시스템 프롬프트 저장 | exp_manager.save_system_prompt(system_content, metadata={"tool": "tool_name", "difficulty": difficulty}) |
| 2 | 사용자 프롬프트 저장 | exp_manager.save_user_prompt(user_prompt, metadata={"question": question}) |

**저장 위치**: `experiments/YYYYMMDD/YYYYMMDD_HHMMSS_session_XXX/prompts/`

### 프롬프트 로그 위치

```
experiments/
└── 20251103/
    └── 20251103_103015_session_001/
        ├── prompts/
        │   ├── system_prompt.txt     # 시스템 프롬프트
        │   ├── user_prompt.txt       # 사용자 프롬프트
        │   └── prompts.json          # 전체 프롬프트 메타데이터
```

---

## 9. 개발 일정

### Phase 1: 라우팅 프롬프트 (1일) ⭐ 최우선
- 라우팅 프롬프트 JSON 파일 생성
- Few-shot 예시 10개 작성
- router_node 수정

### Phase 2: 도구별 프롬프트 (1일)
- 도구 프롬프트 JSON 파일 생성
- 6개 도구 파일 수정

### Phase 3: 평가 프롬프트 (1일)
- 평가 프롬프트 JSON 파일 생성
- evaluator.py 구현

### Phase 4: Golden Dataset (1일)
- 질문 생성 프롬프트 작성
- Golden Dataset 10개 질문 작성
- 테스트 스크립트

---

## 10. Feature 브랜치

**프롬프트 엔지니어링 구현 (임예슬)**

### 권장 브랜치 전략

팀원이 `feature/prompt` 브랜치를 생성했다면, **해당 브랜치에서 모든 프롬프트 작업을 진행해도 무방합니다.**

```bash
# feature/prompt 브랜치로 전환
git checkout feature/prompt

# 작업 진행 (프롬프트 JSON 수정, 로더 코드 수정 등)
# ...

# 커밋 및 푸시
git add .
git commit -m "feat: 라우팅 프롬프트 개선"
git push origin feature/prompt
```

**브랜치 전환이 어려운 경우**:
- `feature/prompt` 브랜치 하나에서 모든 작업 진행
- 커밋 메시지로 작업 구분 (예: "feat: 라우팅 프롬프트 개선", "feat: 평가 프롬프트 추가")

### 세부 브랜치 (선택 사항)

브랜치 관리가 익숙해지면 아래처럼 세부 브랜치를 생성할 수도 있습니다:
- `feature/routing-prompts` - 라우팅 프롬프트
- `feature/tool-prompts` - 도구별 프롬프트
- `feature/evaluation-prompts` - 평가 프롬프트
- `feature/golden-dataset` - Golden Dataset

**중요**: Git 초보인 경우 `feature/prompt` 하나만 사용하는 것을 강력히 권장합니다!

---

## 11. 참고 PRD 문서

### 필수 참고 문서
1. [15_프롬프트_엔지니어링.md](../PRD/15_프롬프트_엔지니어링.md) - 프롬프트 전략
2. [12_AI_Agent_설계.md](../PRD/12_AI_Agent_설계.md) - AI Agent 설계
3. [05_로깅_시스템.md](../PRD/05_로깅_시스템.md) - Logger 사용법
4. [06_실험_추적_관리.md](../PRD/06_실험_추적_관리.md) - ExperimentManager

### 참고 문서
- [담당역할_06_통합_LangGraph_스트리밍.md](담당역할_06_통합_LangGraph_스트리밍.md) - LangGraph 노드 구현
- [docs/minutes/20251030/20251030_멘토링.md](../../minutes/20251030/20251030_멘토링.md) - 멘토 인사이트 (lines 417-553)

---

## 12. 참고 자료

- Langchain Prompts: https://python.langchain.com/docs/modules/model_io/prompts/
- Few-Shot Prompting: https://python.langchain.com/docs/modules/model_io/prompts/few_shot_examples
- Prompt Engineering Guide: https://www.promptingguide.ai/
- LLM-as-a-Judge: https://python.langchain.com/docs/guides/evaluation/

---

## 13. 중요 사항

1. **라우팅 프롬프트가 최우선**
   - AI Agent의 성능은 라우팅 정확도에 달려있음
   - Few-shot 예시 필수

2. **JSON 형식 사용**
   - 프롬프트 관리 및 버전 관리 용이
   - 파싱 오류 최소화

3. **ExperimentManager 사용**
   - 모든 프롬프트 저장 및 로깅
   - 실험 추적 관리

4. **Golden Dataset 구축**
   - 테스트용 질문 10개 이상
   - 라우팅 정확도 검증

---
