##### ë…¼ë¬¸ ê²€ìƒ‰ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph MainFlow["ğŸ“‹ RAG ë…¼ë¬¸ ê²€ìƒ‰ ë„êµ¬ ì „ì²´ íë¦„"]
        direction TB

        subgraph Input["ğŸ”¸ ì…ë ¥ & ë¼ìš°íŒ…"]
            direction LR
            Start([â–¶ï¸ ì‚¬ìš©ì ì§ˆë¬¸]) --> KeywordCheck{ì‹œê°„ í‚¤ì›Œë“œ<br/>ê²€ì¶œ?}
            KeywordCheck -->|ìµœì‹ /ìµœê·¼ ìˆìŒ| SkipRAG[âŒ RAG ê±´ë„ˆëœ€<br/>â†’ Web ê²€ìƒ‰]
            KeywordCheck -->|ì‹œê°„ í‚¤ì›Œë“œ ì—†ìŒ| PatternMatch[íŒ¨í„´ ë§¤ì¹­<br/>ë…¼ë¬¸+ì°¾]
            PatternMatch --> ToolSelect[ğŸ”§ search_paper<br/>ë„êµ¬ ì„ íƒ]
        end

        subgraph Search["ğŸ”¹ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰"]
            direction LR
            VectorSearch[ë²¡í„° ê²€ìƒ‰ 70%<br/>paper_chunks<br/>MultiQuery] --> Merge[ì ìˆ˜ ë³‘í•©<br/>ê°€ì¤‘ì¹˜ ì ìš©]
            KeywordSearch[í‚¤ì›Œë“œ ê²€ìƒ‰ 30%<br/>papers í…Œì´ë¸”<br/>Full-Text Search] --> Merge
            Merge --> TopK[Top-5 ë…¼ë¬¸<br/>ì„ ì •]
        end

        subgraph Generation["ğŸ”º ë‹µë³€ ìƒì„±"]
            direction LR
            PromptLoad[ë‚œì´ë„ë³„<br/>í”„ë¡¬í”„íŠ¸ ë¡œë“œ<br/>2ê°œ ìˆ˜ì¤€] --> LLMCall[LLM í˜¸ì¶œ<br/>OpenAI/Solar]
            LLMCall --> FinalAnswer[âœ… ìµœì¢… ë‹µë³€<br/>+ ë…¼ë¬¸ ë©”íƒ€ë°ì´í„°]
        end

        subgraph Fallback["ğŸ”¶ Fallback ì²˜ë¦¬"]
            direction LR
            CheckResult{ê²€ìƒ‰<br/>ì„±ê³µ?<br/>ìœ ì‚¬ë„ â‰¤ 0.5}
            CheckResult -->|ì‹¤íŒ¨| WebSearch[Web ë…¼ë¬¸ ê²€ìƒ‰<br/>web_search]
            WebSearch --> CheckWeb{ì„±ê³µ?}
            CheckWeb -->|ì‹¤íŒ¨| GeneralAnswer[ì¼ë°˜ ë‹µë³€<br/>general]
            CheckWeb -->|ì„±ê³µ| End2([âœ… ì™„ë£Œ])
            GeneralAnswer --> End3([âœ… ì™„ë£Œ])
        end

        %% ë‹¨ê³„ ê°„ ì—°ê²°
        Input --> Search
        Search --> CheckResult
        CheckResult -->|ì„±ê³µ| Generation
        Generation --> End1([âœ… ì™„ë£Œ])
        CheckResult -->|ì‹¤íŒ¨ ê°ì§€| Fallback
    end

    %% ë©”ì¸ ì›Œí¬í”Œë¡œìš° ë°°ê²½
    style MainFlow fill:#fffde7,stroke:#f9a825,stroke-width:4px,color:#000

    %% Subgraph ìŠ¤íƒ€ì¼
    style Input fill:#e0f7fa,stroke:#006064,stroke-width:3px,color:#000
    style Search fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000
    style Generation fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px,color:#000
    style Fallback fill:#fff3e0,stroke:#e65100,stroke-width:3px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì…ë ¥ - ì²­ë¡ ê³„ì—´)
    style Start fill:#4db6ac,stroke:#00695c,stroke-width:3px,color:#000
    style KeywordCheck fill:#ce93d8,stroke:#7b1fa2,stroke-width:2px,color:#000
    style SkipRAG fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style PatternMatch fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000
    style ToolSelect fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ê²€ìƒ‰ - ë³´ë¼ ê³„ì—´)
    style VectorSearch fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style KeywordSearch fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style Merge fill:#ce93d8,stroke:#6a1b9a,stroke-width:2px,color:#000
    style TopK fill:#ce93d8,stroke:#6a1b9a,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ìƒì„± - ë…¹ìƒ‰ ê³„ì—´)
    style PromptLoad fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style LLMCall fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style FinalAnswer fill:#66bb6a,stroke:#1b5e20,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (Fallback - ì£¼í™© ê³„ì—´)
    style CheckResult fill:#ce93d8,stroke:#7b1fa2,stroke-width:2px,color:#000
    style WebSearch fill:#ffb74d,stroke:#e65100,stroke-width:2px,color:#000
    style CheckWeb fill:#ce93d8,stroke:#7b1fa2,stroke-width:2px,color:#000
    style GeneralAnswer fill:#ffb74d,stroke:#e65100,stroke-width:2px,color:#000

    %% ì¢…ë£Œ ë…¸ë“œ
    style End1 fill:#66bb6a,stroke:#2e7d32,stroke-width:3px,color:#000
    style End2 fill:#66bb6a,stroke:#2e7d32,stroke-width:3px,color:#000
    style End3 fill:#66bb6a,stroke:#2e7d32,stroke-width:3px,color:#000

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ë‹¨ê³„ ê°„ - íšŒìƒ‰)
    linkStyle 0,1,2,3 stroke:#006064,stroke-width:2px
    linkStyle 4,5,6 stroke:#7b1fa2,stroke-width:2px
    linkStyle 7,8,9 stroke:#2e7d32,stroke-width:2px
    linkStyle 10,11,12,13,14 stroke:#e65100,stroke-width:2px
    linkStyle 15,16,17,18 stroke:#616161,stroke-width:3px
```