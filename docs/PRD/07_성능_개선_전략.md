# 07. 성능 개선 전략

## 문서 정보
- **작성일**: 2025-10-30
- **프로젝트명**: 논문 리뷰 챗봇 (AI Agent + RAG)
- **팀명**: 연결의 민족

---

## 1. 캐싱 전략

### 1.1 LLM 응답 캐싱

```python
from functools import lru_cache

@lru_cache(maxsize=100)
def cached_llm_call(prompt_hash):
    """LLM 응답 캐싱 (동일 질문에 대한 중복 호출 방지)"""
    return llm.invoke(prompt)
```

### 1.2 Vector DB 검색 캐싱

```python
@lru_cache(maxsize=50)
def cached_similarity_search(query_hash, k):
    """검색 결과 캐싱"""
    return vectorstore.similarity_search(query, k=k)
```

---

## 2. 비동기 처리

### 2.1 비동기 Agent 실행

```python
import asyncio

async def async_agent_invoke(question, difficulty):
    """비동기 Agent 실행"""
    result = await agent_executor.ainvoke({
        "question": question,
        "difficulty": difficulty
    })
    return result
```

### 2.2 배치 임베딩

```python
# 배치로 임베딩 생성 (한 번에 여러 문서 처리)
embeddings.embed_documents(texts, batch_size=100)
```

---

## 3. 데이터베이스 최적화

### 3.1 인덱스 활용

```sql
-- 자주 조회하는 컬럼에 인덱스 생성
CREATE INDEX idx_papers_title ON papers USING GIN (to_tsvector('english', title));
CREATE INDEX idx_papers_category ON papers(category);
```

### 3.2 Connection Pooling

```python
from psycopg2 import pool

connection_pool = pool.SimpleConnectionPool(
    minconn=1,
    maxconn=10,
    **db_config
)
```

---

## 4. 참고 자료

- Langchain Performance: https://python.langchain.com/docs/guides/performance
- PostgreSQL Tuning: https://www.postgresql.org/docs/current/performance-tips.html
