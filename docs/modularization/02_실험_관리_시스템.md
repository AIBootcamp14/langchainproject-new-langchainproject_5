# 02. ì‹¤í—˜ ê´€ë¦¬ ì‹œìŠ¤í…œ (ExperimentManager)

## ğŸ“‹ ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì¼**: 2025-11-03
- **ì‹œìŠ¤í…œëª…**: ì‹¤í—˜ ê´€ë¦¬ ì‹œìŠ¤í…œ
- **êµ¬í˜„ íŒŒì¼**: `src/utils/experiment_manager.py`
- **ìš°ì„ ìˆœìœ„**: â­â­â­ (ìµœìš°ì„  - ëª¨ë“  ì‹¤í—˜ì˜ ê¸°ë°˜)
- **ì°¸ê³  ë¬¸ì„œ**: [PRD/06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md](../PRD/06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md)

---

## ğŸ“Œ ì‹œìŠ¤í…œ ê°œìš”

### ëª©ì  ë° ë°°ê²½

ì‹¤í—˜ ê´€ë¦¬ ì‹œìŠ¤í…œì€ **ëª¨ë“  ì±—ë´‡ ì‹¤í–‰ì„ ì²´ê³„ì ìœ¼ë¡œ ì¶”ì í•˜ê³  ê´€ë¦¬í•˜ëŠ” í•µì‹¬ ì‹œìŠ¤í…œ**ìœ¼ë¡œ, `src/utils/experiment_manager.py`ì— `ExperimentManager` í´ë˜ìŠ¤ë¡œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤. ë³¸ ì‹œìŠ¤í…œì€ Session ID ìë™ ë¶€ì—¬, í´ë” êµ¬ì¡° ìë™ ìƒì„±, Logger í†µí•©, ë©”íƒ€ë°ì´í„° ê´€ë¦¬ ë“±ì„ í†µí•©ì ìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤.

### ì£¼ìš” ì—­í• 

1. **Session ID ìë™ ë¶€ì—¬**: ë‹¹ì¼ ê¸°ì¤€ ìˆœì°¨ì  ID ìƒì„± (session_001, 002...)
2. **í´ë” êµ¬ì¡° ìë™ ìƒì„±**: 7ê°œ ì„œë¸Œ í´ë” ìë™ ìƒì„± (tools, database, prompts, ui, outputs, evaluation, debug)
3. **Logger í†µí•©**: ë©”ì¸ Logger ë° ë„êµ¬ë³„ Logger ìë™ ìƒì„±
4. **ë©”íƒ€ë°ì´í„° ê´€ë¦¬**: `metadata.json`ìœ¼ë¡œ ì‹¤í—˜ ì •ë³´ ì¶”ì 
5. **DB ì¿¼ë¦¬ ê¸°ë¡**: SQL ì¿¼ë¦¬ ë° pgvector ê²€ìƒ‰ ê¸°ë¡
6. **í”„ë¡¬í”„íŠ¸ ì €ì¥**: ì‹œìŠ¤í…œ/ì‚¬ìš©ì/ìµœì¢… í”„ë¡¬í”„íŠ¸ ì €ì¥
7. **í‰ê°€ ì§€í‘œ ì €ì¥**: RAG, Agent, ë¹„ìš©, ì‘ë‹µ ì‹œê°„ ë“± í‰ê°€ ë°ì´í„° ì €ì¥

### ì˜ì¡´ ê´€ê³„

```
ExperimentManager (ì‹¤í—˜ ê´€ë¦¬)
  â†“
â”œâ”€â”€ Logger (ë¡œê¹…)
â”œâ”€â”€ DB Queries (ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë¡)
â”œâ”€â”€ Prompts (í”„ë¡¬í”„íŠ¸ ì €ì¥)
â”œâ”€â”€ UI Events (UI ì¸í„°ë™ì…˜)
â”œâ”€â”€ Outputs (ê²°ê³¼ë¬¼ ì €ì¥)
â””â”€â”€ Evaluation (í‰ê°€ ì§€í‘œ)
```

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì‹¤í—˜ í´ë” ìƒì„± íë¦„

```mermaid
graph TB
    subgraph Init["ğŸ”¸ ì´ˆê¸°í™” & í´ë” ìƒì„±"]
        direction LR
        A[ì±—ë´‡ ì‹¤í–‰<br/>ì‹œì‘] --> B[ë‚ ì§œ/ì‹œê°„ ìƒì„±<br/>Session ID ë¶€ì—¬]
        B --> C[í´ë” ìƒì„±<br/>ë‚ ì§œ_ì‹œê°„_session_XXX]
        C --> D[ì„œë¸Œ í´ë” 7ê°œ ìƒì„±<br/>tools, database, prompts, ui, outputs, evaluation, debug]
        D --> E[ğŸ’¾ metadata.json<br/>Logger ì´ˆê¸°í™”]
    end

    subgraph Execute["ğŸ”¹ ì±—ë´‡ ì‹¤í–‰ & ê¸°ë¡"]
        direction LR
        F[ì‚¬ìš©ì ì§ˆë¬¸<br/>ë‚œì´ë„ ì„ íƒ] --> G[AI Agent<br/>ë„êµ¬ ì„ íƒ]
        G --> H[ë„êµ¬ ì‹¤í–‰<br/>RAG/ì›¹ê²€ìƒ‰/ìš©ì–´ì§‘...]
        H --> I[ê° í´ë”ì— ê¸°ë¡<br/>ë¡œê·¸, ì¿¼ë¦¬, í”„ë¡¬í”„íŠ¸, UI]
        I --> J[í‰ê°€ ì§€í‘œ ìˆ˜ì§‘<br/>Recall, ë¹„ìš©, ì‘ë‹µì‹œê°„]
    end

    subgraph Finish["ğŸ”º ì¢…ë£Œ & ì €ì¥"]
        direction LR
        K[ìµœì¢… ë‹µë³€ ìƒì„±] --> L[ğŸ’¾ outputs/<br/>response.txt ì €ì¥]
        L --> M[metadata.json<br/>ì—…ë°ì´íŠ¸]
        M --> N[Logger ì¢…ë£Œ<br/>ì‹¤í—˜ ì™„ë£Œ]
    end

    Init --> Execute
    Execute --> Finish

    %% Subgraph ìŠ¤íƒ€ì¼
    style Init fill:#e1f5ff,stroke:#01579b,stroke-width:3px,color:#000
    style Execute fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000
    style Finish fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì´ˆê¸°í™” - íŒŒë‘ ê³„ì—´)
    style A fill:#90caf9,stroke:#1976d2,color:#000
    style B fill:#81d4fa,stroke:#0288d1,color:#000
    style C fill:#64b5f6,stroke:#1976d2,color:#000
    style D fill:#42a5f5,stroke:#1565c0,color:#000
    style E fill:#42a5f5,stroke:#1565c0,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì‹¤í–‰ - ë³´ë¼ ê³„ì—´)
    style F fill:#ce93d8,stroke:#7b1fa2,color:#000
    style G fill:#ba68c8,stroke:#7b1fa2,color:#fff
    style H fill:#ab47bc,stroke:#4a148c,color:#fff
    style I fill:#9c27b0,stroke:#4a148c,color:#fff
    style J fill:#9c27b0,stroke:#4a148c,color:#fff

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì¢…ë£Œ - ë…¹ìƒ‰ ê³„ì—´)
    style K fill:#a5d6a7,stroke:#388e3c,color:#000
    style L fill:#81c784,stroke:#2e7d32,color:#000
    style M fill:#66bb6a,stroke:#2e7d32,color:#fff
    style N fill:#66bb6a,stroke:#2e7d32,color:#fff
```

**ì‹¤í—˜ í´ë” ìƒì„± íë¦„ ì„¤ëª…:**
- **ì´ˆê¸°í™” ë‹¨ê³„**: ì±—ë´‡ ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ Session ID ë¶€ì—¬ (session_001, 002...) â†’ í´ë” ë° ì„œë¸Œ í´ë” 7ê°œ ìƒì„± â†’ metadata.jsonê³¼ Logger ì´ˆê¸°í™”
- **ì‹¤í–‰ ë‹¨ê³„**: ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥ ë° ë‚œì´ë„ ì„ íƒ â†’ AI Agentê°€ ì ì ˆí•œ ë„êµ¬ ì„ íƒ (RAG, ì›¹ê²€ìƒ‰, ìš©ì–´ì§‘ ë“±) â†’ ì‹¤í–‰ ê³¼ì •ì„ ê° í´ë”ì— ê¸°ë¡ (ë„êµ¬ ë¡œê·¸, DB ì¿¼ë¦¬, í”„ë¡¬í”„íŠ¸, UI ì¸í„°ë™ì…˜) â†’ í‰ê°€ ì§€í‘œ ìˆ˜ì§‘ (Recall@K, ë¹„ìš©, ì‘ë‹µì‹œê°„)
- **ì¢…ë£Œ ë‹¨ê³„**: ìµœì¢… ë‹µë³€ ìƒì„± â†’ outputs/response.txt ì €ì¥ â†’ metadata.json ì—…ë°ì´íŠ¸ â†’ Logger ì¢…ë£Œ ë° ì‹¤í—˜ ì™„ë£Œ

---

## ğŸ“ ì‹¤í—˜ í´ë” êµ¬ì¡°

### í•„ìˆ˜ ë””ë ‰í† ë¦¬ êµ¬ì¡°

ëª¨ë“  ì±—ë´‡ ì‹¤í–‰ ê²°ê³¼ëŠ” `experiments/ë‚ ì§œ/ë‚ ì§œ_ì‹œê°„_session_XXX/` êµ¬ì¡°ë¡œ ì €ì¥ë©ë‹ˆë‹¤:

```
experiments/
â””â”€â”€ 20251103/                                # ë‚ ì§œ (YYYYMMDD)
    â””â”€â”€ 20251103_103015_session_001/         # ì‹œê°„_session_ID
        â”‚
        â”œâ”€â”€ metadata.json                    # â­ ì „ì²´ ì‹¤í—˜ ë©”íƒ€ë°ì´í„°
        â”œâ”€â”€ chatbot.log                      # ë©”ì¸ ì‹¤í–‰ ë¡œê·¸
        â”œâ”€â”€ config.yaml                      # ì „ì²´ ì„¤ì •
        â”‚
        â”œâ”€â”€ tools/                           # ğŸ”§ ë„êµ¬ ì‹¤í–‰ ë¡œê·¸
        â”‚   â”œâ”€â”€ rag_paper.log                # ë…¼ë¬¸ ê²€ìƒ‰ ë¡œê·¸
        â”‚   â”œâ”€â”€ rag_glossary.log             # ìš©ì–´ì§‘ ê²€ìƒ‰ ë¡œê·¸
        â”‚   â”œâ”€â”€ web_search.log               # ì›¹ ê²€ìƒ‰ ë¡œê·¸
        â”‚   â”œâ”€â”€ summary_paper.log            # ë…¼ë¬¸ ìš”ì•½ ë¡œê·¸
        â”‚   â”œâ”€â”€ file_save.log                # íŒŒì¼ ì €ì¥ ë¡œê·¸
        â”‚   â””â”€â”€ general.log                  # ì¼ë°˜ ë‹µë³€ ë¡œê·¸
        â”‚
        â”œâ”€â”€ database/                        # ğŸ—„ï¸ DB ê´€ë ¨ ê¸°ë¡
        â”‚   â”œâ”€â”€ queries.sql                  # ì‹¤í–‰ëœ SQL ì¿¼ë¦¬ ëª¨ìŒ
        â”‚   â”œâ”€â”€ pgvector_searches.json       # pgvector ê²€ìƒ‰ ê¸°ë¡
        â”‚   â”œâ”€â”€ search_results.json          # DB ê²€ìƒ‰ ê²°ê³¼
        â”‚   â””â”€â”€ db_performance.json          # ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ ë“±
        â”‚
        â”œâ”€â”€ prompts/                         # ğŸ’¬ í”„ë¡¬í”„íŠ¸ ê¸°ë¡
        â”‚   â”œâ”€â”€ system_prompt.txt            # ì‚¬ìš©ëœ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
        â”‚   â”œâ”€â”€ user_prompt.txt              # ì‚¬ìš©ì ì§ˆë¬¸ + ì»¨í…ìŠ¤íŠ¸
        â”‚   â”œâ”€â”€ final_prompt.txt             # LLMì— ì „ë‹¬ëœ ìµœì¢… í”„ë¡¬í”„íŠ¸
        â”‚   â””â”€â”€ prompt_template.yaml         # í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì •ë³´
        â”‚
        â”œâ”€â”€ ui/                              # ğŸ–¥ï¸ UI ê´€ë ¨ ê¸°ë¡
        â”‚   â”œâ”€â”€ streamlit_session.json       # Streamlit ì„¸ì…˜ ìƒíƒœ
        â”‚   â”œâ”€â”€ user_interactions.log        # ì‚¬ìš©ì ì¸í„°ë™ì…˜ ë¡œê·¸
        â”‚   â””â”€â”€ ui_events.json               # UI ì´ë²¤íŠ¸ ê¸°ë¡
        â”‚
        â”œâ”€â”€ outputs/                         # ğŸ“„ ìƒì„±ëœ ê²°ê³¼ë¬¼
        â”‚   â”œâ”€â”€ response.txt                 # ìµœì¢… ë‹µë³€
        â”‚   â”œâ”€â”€ summary.md                   # ìš”ì•½ë³¸ (ìˆì„ ê²½ìš°)
        â”‚   â””â”€â”€ saved_file.txt               # ì‚¬ìš©ìê°€ ì €ì¥ ìš”ì²­í•œ íŒŒì¼
        â”‚
        â”œâ”€â”€ evaluation/                      # ğŸ“Š í‰ê°€ ì§€í‘œ
        â”‚   â”œâ”€â”€ rag_metrics.json             # RAG í‰ê°€ ì§€í‘œ
        â”‚   â”œâ”€â”€ agent_accuracy.json          # Agent ì •í™•ë„
        â”‚   â”œâ”€â”€ latency_report.json          # ì‘ë‹µ ì‹œê°„ ë¶„ì„
        â”‚   â”œâ”€â”€ cost_analysis.json           # ë¹„ìš© ë¶„ì„
        â”‚   â””â”€â”€ test_results.json            # í…ŒìŠ¤íŠ¸ ê²°ê³¼
        â”‚
        â””â”€â”€ debug/                           # ğŸ› ë””ë²„ê·¸ ì •ë³´ (ì„ íƒ)
            â”œâ”€â”€ agent_trace.json             # Agent ì‹¤í–‰ ì¶”ì 
            â”œâ”€â”€ llm_tokens.json              # í† í° ì‚¬ìš©ëŸ‰
            â””â”€â”€ error_trace.log              # ì—ëŸ¬ ë°œìƒ ì‹œ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤
```

### metadata.json êµ¬ì¡°

ê° ì‹¤í—˜ì˜ í•µì‹¬ ì •ë³´ë¥¼ í•œ ê³³ì— ìš”ì•½í•©ë‹ˆë‹¤:

```json
{
  "session_id": "001",
  "start_time": "2025-11-03T10:30:15",
  "end_time": "2025-11-03T10:32:45",
  "difficulty": "easy",
  "tool_used": "rag_paper",
  "user_query": "RAGì— ëŒ€í•´ ì•Œë ¤ì¤˜",
  "success": true,
  "response_time_ms": 2500,
  "response_length": 450,
  "model": "gpt-4",
  "temperature": 0.7,
  "tokens_used": {
    "prompt": 1200,
    "completion": 800,
    "total": 2000
  },
  "db_queries_count": 4,
  "db_total_time_ms": 120
}
```

---

## ğŸ”§ ExperimentManager í´ë˜ìŠ¤ êµ¬ì¡°

### ì£¼ìš” ë©”ì„œë“œ ë¶„ë¥˜

#### 1. ë„êµ¬ (Tools) ê´€ë ¨

| ë©”ì„œë“œ | ì„¤ëª… | ì €ì¥ ìœ„ì¹˜ |
|--------|------|-----------|
| `get_tool_logger(tool_name)` | ë„êµ¬ë³„ ë…ë¦½ Logger ìƒì„± | `tools/{tool_name}.log` |

#### 2. ë°ì´í„°ë² ì´ìŠ¤ (Database) ê´€ë ¨

| ë©”ì„œë“œ | ì„¤ëª… | ì €ì¥ ìœ„ì¹˜ |
|--------|------|-----------|
| `log_sql_query(query, description, tool, execution_time_ms)` | SQL ì¿¼ë¦¬ ê¸°ë¡ | `database/queries.sql` |
| `log_pgvector_search(search_info)` | pgvector ê²€ìƒ‰ ê¸°ë¡ | `database/pgvector_searches.json` |
| `save_search_results(tool, results)` | DB ê²€ìƒ‰ ê²°ê³¼ ì €ì¥ | `database/search_results.json` |

#### 3. í”„ë¡¬í”„íŠ¸ (Prompts) ê´€ë ¨

| ë©”ì„œë“œ | ì„¤ëª… | ì €ì¥ ìœ„ì¹˜ |
|--------|------|-----------|
| `save_system_prompt(system_prompt, metadata)` | ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì €ì¥ | `prompts/system_prompt.txt` |
| `save_user_prompt(user_prompt, metadata)` | ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ ì €ì¥ | `prompts/user_prompt.txt` |
| `save_final_prompt(final_prompt)` | ìµœì¢… í”„ë¡¬í”„íŠ¸ ì €ì¥ | `prompts/final_prompt.txt` |
| `save_prompt_template(template_info)` | í…œí”Œë¦¿ ì •ë³´ ì €ì¥ | `prompts/prompt_template.yaml` |

#### 4. UI ê´€ë ¨

| ë©”ì„œë“œ | ì„¤ëª… | ì €ì¥ ìœ„ì¹˜ |
|--------|------|-----------|
| `log_ui_interaction(message)` | UI ì¸í„°ë™ì…˜ ë¡œê·¸ | `ui/user_interactions.log` |
| `log_ui_event(event_data)` | UI ì´ë²¤íŠ¸ ê¸°ë¡ | `ui/ui_events.json` |
| `save_streamlit_session(session_data)` | Streamlit ì„¸ì…˜ ì €ì¥ | `ui/streamlit_session.json` |

#### 5. í‰ê°€ (Evaluation) ê´€ë ¨

| ë©”ì„œë“œ | ì„¤ëª… | ì €ì¥ ìœ„ì¹˜ |
|--------|------|-----------|
| `save_rag_metrics(metrics)` | RAG í‰ê°€ ì§€í‘œ ì €ì¥ | `evaluation/rag_metrics.json` |
| `save_agent_accuracy(accuracy_data)` | Agent ì •í™•ë„ ì €ì¥ | `evaluation/agent_accuracy.json` |
| `save_latency_report(latency_data)` | ì‘ë‹µ ì‹œê°„ ë¶„ì„ ì €ì¥ | `evaluation/latency_report.json` |
| `save_cost_analysis(cost_data)` | ë¹„ìš© ë¶„ì„ ì €ì¥ | `evaluation/cost_analysis.json` |

#### 6. ê²°ê³¼ë¬¼ (Outputs) ê´€ë ¨

| ë©”ì„œë“œ | ì„¤ëª… | ì €ì¥ ìœ„ì¹˜ |
|--------|------|-----------|
| `save_output(filename, content)` | ê²°ê³¼ë¬¼ ì €ì¥ | `outputs/{filename}` |
| `update_metadata(**kwargs)` | metadata.json ì—…ë°ì´íŠ¸ | `metadata.json` |

---

## ğŸ“‹ Session ID ìë™ ë¶€ì—¬ ê·œì¹™

### ìë™ ìƒì„± ë°©ì‹

ExperimentManagerëŠ” ì±—ë´‡ ì‹¤í–‰ ì‹œë§ˆë‹¤ **Session IDë¥¼ ìë™ìœ¼ë¡œ ë¶€ì—¬**í•©ë‹ˆë‹¤:

- **í˜•ì‹**: `session_001`, `session_002`, `session_003` ...
- **ë¶€ì—¬ ë°©ì‹**: ë‹¹ì¼ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ìˆœì°¨ì ìœ¼ë¡œ ì¦ê°€
- **ì‹œì‘ ë²ˆí˜¸**: ë§¤ì¼ `001`ë¶€í„° ì‹œì‘
- **ì¤‘ë³µ ë°©ì§€**: ë‹¹ì¼ í´ë”ë¥¼ ìŠ¤ìº”í•˜ì—¬ ê°€ì¥ í° ë²ˆí˜¸ + 1 ë¶€ì—¬

### ì˜ˆì‹œ

```
experiments/20251103/
â”œâ”€â”€ 20251103_103015_session_001/   # ì˜¤ëŠ˜ ì²« ë²ˆì§¸ ì‹¤í–‰
â”œâ”€â”€ 20251103_110234_session_002/   # ì˜¤ëŠ˜ ë‘ ë²ˆì§¸ ì‹¤í–‰
â””â”€â”€ 20251103_143520_session_003/   # ì˜¤ëŠ˜ ì„¸ ë²ˆì§¸ ì‹¤í–‰

experiments/20251104/
â””â”€â”€ 20251104_090012_session_001/   # ë‹¤ìŒ ë‚ , ë‹¤ì‹œ 001ë¶€í„° ì‹œì‘
```

### êµ¬í˜„ ë¡œì§

ExperimentManager í´ë˜ìŠ¤ê°€ ìë™ìœ¼ë¡œ:
1. ë‹¹ì¼ í´ë” (`experiments/20251103/`) ìŠ¤ìº”
2. ê¸°ì¡´ session í´ë” í™•ì¸ (ì •ê·œì‹ìœ¼ë¡œ `session_XXX` íŒ¨í„´ ê²€ìƒ‰)
3. ê°€ì¥ í° ë²ˆí˜¸ ì¶”ì¶œ
4. ë‹¤ìŒ ë²ˆí˜¸ (max + 1) ë¶€ì—¬

---

## ğŸ”— í†µí•© ì‹œìŠ¤í…œ

### Logger í†µí•©

ExperimentManagerëŠ” Loggerë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤:

**ë©”ì¸ Logger:**
- ê²½ë¡œ: `experiments/ë‚ ì§œ/ë‚ ì§œ_ì‹œê°„_session_XXX/chatbot.log`
- ì ‘ê·¼: `exp.logger.write("ë©”ì‹œì§€")`
- ìë™ ì´ˆê¸°í™”/ì¢…ë£Œ: with ë¬¸ ì‚¬ìš© ì‹œ

**ë„êµ¬ë³„ Logger:**
```python
# ê° ë„êµ¬ëŠ” ë…ë¦½ ë¡œê·¸ íŒŒì¼ ì‚¬ìš©
rag_logger = exp.get_tool_logger('rag_paper')     # tools/rag_paper.log
web_logger = exp.get_tool_logger('web_search')    # tools/web_search.log
glossary_logger = exp.get_tool_logger('glossary') # tools/glossary.log
```

### AI Agent í†µí•©

AI Agentì˜ ëª¨ë“  ë…¸ë“œëŠ” ExperimentManagerë¥¼ í†µí•´ ì‹¤í–‰ ê³¼ì •ì„ ê¸°ë¡í•©ë‹ˆë‹¤:

- **Router ë…¸ë“œ**: ë„êµ¬ ì„ íƒ ë¡œê·¸
- **Tool ë…¸ë“œ**: ê° ë„êµ¬ì˜ ì‹¤í–‰ ë¡œê·¸ (ë„êµ¬ë³„ Logger ì‚¬ìš©)
- **DB ì¿¼ë¦¬**: SQL ë° pgvector ê²€ìƒ‰ ê¸°ë¡
- **í”„ë¡¬í”„íŠ¸**: ì‹œìŠ¤í…œ/ì‚¬ìš©ì/ìµœì¢… í”„ë¡¬í”„íŠ¸ ì €ì¥
- **í‰ê°€ ì§€í‘œ**: RAG, Agent, ë¹„ìš©, ì‘ë‹µ ì‹œê°„ ì €ì¥

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. with ë¬¸ ì‚¬ìš© í•„ìˆ˜

ExperimentManagerëŠ” **ë°˜ë“œì‹œ with ë¬¸ìœ¼ë¡œ ì‚¬ìš©**í•´ì•¼ í•©ë‹ˆë‹¤:

- âŒ **ì˜ëª»ëœ ì‚¬ìš©**:
  ```python
  exp = ExperimentManager()
  exp.logger.write("ë©”ì‹œì§€")
  # close() ëˆ„ë½ â†’ ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜
  ```

- âœ… **ì˜¬ë°”ë¥¸ ì‚¬ìš©**:
  ```python
  with ExperimentManager() as exp:
      exp.logger.write("ë©”ì‹œì§€")
  # ìë™ìœ¼ë¡œ close() ë° metadata.json ì—…ë°ì´íŠ¸
  ```

### 2. ë„êµ¬ë³„ Logger ì¢…ë£Œ

ë„êµ¬ë³„ LoggerëŠ” ì‚¬ìš© í›„ **ë°˜ë“œì‹œ close()** í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤:

```python
tool_logger = exp.get_tool_logger('rag_paper')
tool_logger.write("ê²€ìƒ‰ ì™„ë£Œ")
tool_logger.close()  # í•„ìˆ˜!
```

### 3. metadata.json ì—…ë°ì´íŠ¸ íƒ€ì´ë°

`metadata.json`ì€ `update_metadata()` í˜¸ì¶œ ì‹œ ì¦‰ì‹œ ì €ì¥ë©ë‹ˆë‹¤:

```python
# ì‹¤í—˜ ì‹œì‘ ì‹œ
exp.update_metadata(user_query="RAGë€?", difficulty="easy")

# ì‹¤í—˜ ì¢…ë£Œ ì‹œ
exp.update_metadata(success=True, tool_used="rag_paper", response_time_ms=2500)
```

### 4. í´ë” ìë™ ìƒì„±

ExperimentManagerëŠ” 7ê°œ ì„œë¸Œ í´ë”ë¥¼ **ìë™ìœ¼ë¡œ ìƒì„±**í•˜ì§€ë§Œ, ì‚¬ìš©ìê°€ ì„ì˜ë¡œ ì‚­ì œí•˜ë©´ ì—ëŸ¬ ë°œìƒ:

- ìë™ ìƒì„± í´ë”: `tools/`, `database/`, `prompts/`, `ui/`, `outputs/`, `evaluation/`, `debug/`
- ì‚­ì œ ê¸ˆì§€: ì‹¤í–‰ ì¤‘ í´ë” ì‚­ì œ ì‹œ íŒŒì¼ ì €ì¥ ì‹¤íŒ¨

---

## ğŸ“Š ì‹¤í—˜ ê²€ìƒ‰ ë° ë¶„ì„

### ë©”íƒ€ë°ì´í„° ê¸°ë°˜ ê²€ìƒ‰

`metadata.json`ì„ í™œìš©í•˜ì—¬ ì‹¤í—˜ì„ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

**ê²€ìƒ‰ ì¡°ê±´ ì˜ˆì‹œ:**
- ë‚œì´ë„ë³„: `difficulty == "easy"`
- ë„êµ¬ë³„: `tool_used == "rag_paper"`
- ë‚ ì§œë³„: `experiments/20251103/` í´ë” íƒìƒ‰
- ì‘ë‹µ ì‹œê°„: `response_time_ms < 3000`
- ì„±ê³µ/ì‹¤íŒ¨: `success == true`

### í‰ê°€ ì§€í‘œ ì§‘ê³„

ì—¬ëŸ¬ ì‹¤í—˜ì˜ í‰ê°€ ì§€í‘œë¥¼ ì§‘ê³„í•˜ì—¬ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

**ì§‘ê³„ ëŒ€ìƒ:**
- RAG í‰ê°€: `evaluation/rag_metrics.json` (Recall@K, Precision, Faithfulness)
- Agent ì •í™•ë„: `evaluation/agent_accuracy.json` (ë„êµ¬ ì„ íƒ ì •í™•ë„)
- ì‘ë‹µ ì‹œê°„: `evaluation/latency_report.json` (p50/p95/p99)
- ë¹„ìš©: `evaluation/cost_analysis.json` (í† í° ì‚¬ìš©ëŸ‰, USD/KRW)

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- **[01_ë¡œê¹…_ì‹œìŠ¤í…œ.md](./01_ë¡œê¹…_ì‹œìŠ¤í…œ.md)** - Logger í´ë˜ìŠ¤ ìƒì„¸
- **[03_AI_Agent_ì‹œìŠ¤í…œ.md](./03_AI_Agent_ì‹œìŠ¤í…œ.md)** - Agentì—ì„œ ExperimentManager ì‚¬ìš©
- **[PRD/06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md](../PRD/06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md)** - ì‹¤í—˜ ì¶”ì  ê´€ë¦¬ ì „ì²´ ëª…ì„¸
- **[PRD/09_í‰ê°€_ê¸°ì¤€.md](../PRD/09_í‰ê°€_ê¸°ì¤€.md)** - RAG, Agent, DB í‰ê°€ ì§€í‘œ

---

## ğŸ“ ìš”ì•½

### êµ¬í˜„ëœ í•µì‹¬ ê¸°ëŠ¥

1. âœ… Session ID ìë™ ë¶€ì—¬ (ë‹¹ì¼ ê¸°ì¤€ ìˆœì°¨ ì¦ê°€)
2. âœ… 7ê°œ ì„œë¸Œ í´ë” ìë™ ìƒì„± (tools, database, prompts, ui, outputs, evaluation, debug)
3. âœ… Logger ìë™ í†µí•© (ë©”ì¸ + ë„êµ¬ë³„)
4. âœ… metadata.json ìë™ ê´€ë¦¬
5. âœ… DB ì¿¼ë¦¬ ê¸°ë¡ (SQL, pgvector)
6. âœ… í”„ë¡¬í”„íŠ¸ ì €ì¥ (ì‹œìŠ¤í…œ, ì‚¬ìš©ì, ìµœì¢…)
7. âœ… í‰ê°€ ì§€í‘œ ì €ì¥ (RAG, Agent, ë¹„ìš©, ì‘ë‹µì‹œê°„)
8. âœ… with ë¬¸ ì§€ì› (ìë™ ë¦¬ì†ŒìŠ¤ ì •ë¦¬)

### ì €ì¥ë˜ëŠ” íŒŒì¼ êµ¬ì¡°

**í•„ìˆ˜ íŒŒì¼:**
- `chatbot.log` - ë©”ì¸ ì‹¤í–‰ ë¡œê·¸
- `metadata.json` - ì‹¤í—˜ ë©”íƒ€ë°ì´í„°
- `config.yaml` - ì „ì²´ ì„¤ì •

**ì„œë¸Œ í´ë”ë³„ íŒŒì¼:**
- `tools/*.log` - ë„êµ¬ë³„ ì‹¤í–‰ ë¡œê·¸
- `database/*.{sql,json}` - DB ì¿¼ë¦¬ ë° ê²€ìƒ‰ ê¸°ë¡
- `prompts/*.{txt,yaml}` - í”„ë¡¬í”„íŠ¸ ì €ì¥
- `ui/*.{log,json}` - UI ì¸í„°ë™ì…˜ ê¸°ë¡
- `outputs/*` - ìµœì¢… ë‹µë³€ ë° ê²°ê³¼ë¬¼
- `evaluation/*.json` - í‰ê°€ ì§€í‘œ
- `debug/*.{json,log}` - ë””ë²„ê·¸ ì •ë³´ (ì„ íƒ)

### í†µí•© ì‹œìŠ¤í…œ

- **Logger ì‹œìŠ¤í…œ**: ìë™ ìƒì„± ë° ê´€ë¦¬
- **AI Agent**: ëª¨ë“  ë…¸ë“œì—ì„œ ì‹¤í—˜ ê¸°ë¡
- **RAG ì‹œìŠ¤í…œ**: DB ì¿¼ë¦¬ ë° ê²€ìƒ‰ ê²°ê³¼ ì €ì¥
- **LLM Client**: í† í° ì‚¬ìš©ëŸ‰ ë° ë¹„ìš© ì¶”ì 
- **UI (Streamlit)**: ì‚¬ìš©ì ì¸í„°ë™ì…˜ ê¸°ë¡

### ì‚¬ìš© íŒ¨í„´

```python
# ê¸°ë³¸ ì‚¬ìš©
with ExperimentManager() as exp:
    exp.logger.write("ì‹¤í—˜ ì‹œì‘")
    exp.update_metadata(user_query="RAGë€?")

    # ë„êµ¬ë³„ Logger
    tool_logger = exp.get_tool_logger('rag_paper')
    tool_logger.write("ê²€ìƒ‰ ì™„ë£Œ")
    tool_logger.close()

    # ê²°ê³¼ ì €ì¥
    exp.save_output('response.txt', answer)
    exp.update_metadata(success=True)
```
