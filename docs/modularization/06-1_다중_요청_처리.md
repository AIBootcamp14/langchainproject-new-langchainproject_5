# 06-1. ë‹¤ì¤‘ ìš”ì²­ ì²˜ë¦¬ ìƒì„¸

## ğŸ“‹ ë¬¸ì„œ ì •ë³´
- **ìµœì´ˆ ì‘ì„±ì¼**: 2025-11-04
- **ìµœê·¼ ì—…ë°ì´íŠ¸**: 2025-11-05
- **ì‹œìŠ¤í…œëª…**: ë‹¤ì¤‘ ìš”ì²­ ì²˜ë¦¬ ì‹œìŠ¤í…œ
- **êµ¬í˜„ íŒŒì¼**: `src/agent/nodes.py`, `src/agent/graph.py`
- **ìš°ì„ ìˆœìœ„**: â­â­ (ì¤‘ìš”)
- **ì‘ì„±ì**: ìµœí˜„í™”[íŒ€ì¥]
- **ìƒìœ„ ë¬¸ì„œ**: [06_AI_Agent_ì‹œìŠ¤í…œ.md](./06_AI_Agent_ì‹œìŠ¤í…œ.md)

---

## ğŸ“Œ ê°œìš”

ë‹¤ì¤‘ ìš”ì²­ ì²˜ë¦¬ ì‹œìŠ¤í…œì€ **"ë…¼ë¬¸ ì°¾ì•„ì„œ ìš”ì•½í•´ì¤˜"ì™€ ê°™ì€ ë³µí•© ìš”ì²­ì„ ìë™ìœ¼ë¡œ ê°ì§€í•˜ì—¬ ì—¬ëŸ¬ ë„êµ¬ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ì‹œìŠ¤í…œ**ì…ë‹ˆë‹¤. 2025-11-04ì— ê¸°ë³¸ êµ¬í˜„ì´ ì™„ë£Œë˜ì–´ í‚¤ì›Œë“œ ê¸°ë°˜ íŒ¨í„´ ë§¤ì¹­ìœ¼ë¡œ ë‹¤ì¤‘ ë„êµ¬ íŒŒì´í”„ë¼ì¸ì„ ì„¤ì •í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìœ¼ë©°, 2025-11-05ì— ìˆœì°¨ ì‹¤í–‰ ë©”ì»¤ë‹ˆì¦˜ì´ ì™„ì „íˆ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ”´ ê°œì„  ì „ ë¬¸ì œì 

### ë¬¸ì œ ìƒí™©

**í˜„ìƒ**:
- ë³µí•© ìš”ì²­ ì‹œ ì²« ë²ˆì§¸ ë„êµ¬ë§Œ ì‹¤í–‰
- ë‘ ë²ˆì§¸ ì‘ì—…ì€ ë¬´ì‹œë¨

**ì˜ˆì‹œ**:
```
ì‚¬ìš©ì: "Transformer ë…¼ë¬¸ ì°¾ì•„ì„œ ìš”ì•½í•´ì¤˜"
   â†“
Router: "search_paper" ì„ íƒ
   â†“
Agent: ë…¼ë¬¸ ê²€ìƒ‰ë§Œ ì‹¤í–‰ âŒ
   â†“
ê²°ê³¼: "Attention is All You Need ë…¼ë¬¸ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤."
(ìš”ì•½ì€ ì‹¤í–‰ ì•ˆ ë¨)
```

**ë¬¸ì œì **:
- ì‚¬ìš©ìê°€ ë‘ ë²ˆ ì§ˆë¬¸í•´ì•¼ í•¨
- "ë…¼ë¬¸ ì°¾ì•„ì¤˜" â†’ "ê·¸ê±° ìš”ì•½í•´ì¤˜" (2ë‹¨ê³„)
- ì‚¬ìš©ì ê²½í—˜ ì €í•˜

---

## âœ… ê°œì„  í›„ êµ¬ì¡°

### ë‹¤ì¤‘ ìš”ì²­ ê°ì§€ ë¡œì§

**êµ¬í˜„ ìœ„ì¹˜**: `src/agent/nodes.py:48-96`

```python
def router_node(state: AgentState, exp_manager=None):
    """
    ë¼ìš°í„° ë…¸ë“œ: ì§ˆë¬¸ì„ ë¶„ì„í•˜ì—¬ ì ì ˆí•œ ë„êµ¬ ì„ íƒ
    + ë‹¤ì¤‘ ìš”ì²­ ê°ì§€
    """
    question = state["question"]

    # -------------- ë‹¤ì¤‘ ìš”ì²­ ê°ì§€ (í‚¤ì›Œë“œ ê¸°ë°˜) -------------- #
    multi_request_patterns = {
        ("ì°¾", "ìš”ì•½"): ["search_paper", "summarize"],
        ("ê²€ìƒ‰", "ìš”ì•½"): ["search_paper", "summarize"],
        ("ì°¾", "ì •ë¦¬"): ["search_paper", "summarize", "general"],
        ("ë…¼ë¬¸", "ìš”ì•½"): ["search_paper", "summarize"],
        ("ê²€ìƒ‰", "ì„¤ëª…"): ["search_paper", "general"]
    }

    # íŒ¨í„´ í™•ì¸
    for keywords, tools in multi_request_patterns.items():
        if all(kw in question for kw in keywords):
            if exp_manager:
                exp_manager.logger.write(f"ë‹¤ì¤‘ ìš”ì²­ ê°ì§€: {keywords} â†’ {tools}")

            # tool_pipeline ì„¤ì • (ìˆœì°¨ ì‹¤í–‰ ë„êµ¬ ëª©ë¡)
            state["tool_pipeline"] = tools
            state["tool_choice"] = tools[0]  # ì²« ë²ˆì§¸ ë„êµ¬ë¶€í„° ì‹œì‘

            return state

    # -------------- ë‹¨ì¼ ìš”ì²­ ì²˜ë¦¬ (ê¸°ì¡´ ë¡œì§) -------------- #
    # ... (LLM ë¼ìš°íŒ… ë¡œì§)

    state["tool_choice"] = tool_choice
    state["tool_pipeline"] = [tool_choice]  # ë‹¨ì¼ ë„êµ¬ë„ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ê´€ë¦¬

    return state
```

---

## ğŸ”„ ë™ì‘ íë¦„

### ë‹¤ì¤‘ ìš”ì²­ ì²˜ë¦¬ ì˜ˆì‹œ (ì™„ì „ êµ¬í˜„)

```
ì‚¬ìš©ì: "Transformer ë…¼ë¬¸ ì°¾ì•„ì„œ ìš”ì•½í•´ì¤˜"
   â†“
1ë‹¨ê³„: Router ë…¸ë“œ - í‚¤ì›Œë“œ ê°ì§€
   - "ì°¾" âœ…
   - "ìš”ì•½" âœ…
   - íŒ¨í„´ ë§¤ì¹­: ("ì°¾", "ìš”ì•½") â†’ ["search_paper", "summarize"]
   â†“
2ë‹¨ê³„: tool_pipeline ì„¤ì •
   state["tool_pipeline"] = ["search_paper", "summarize"]
   state["tool_choice"] = "search_paper"  # ì²« ë²ˆì§¸ ë„êµ¬
   state["pipeline_index"] = 1            # ë‹¤ìŒ ì‹¤í–‰í•  ì¸ë±ìŠ¤
   â†“
3ë‹¨ê³„: search_paper ë„êµ¬ ì‹¤í–‰
   - ë…¼ë¬¸ ê²€ìƒ‰
   - ê²°ê³¼: "Attention is All You Need ë…¼ë¬¸"
   â†“
4ë‹¨ê³„: check_pipeline_or_fallback() ì¡°ê±´ í™•ì¸
   - pipeline_index (1) < len(tool_pipeline) (2) âœ…
   - ë‹¤ìŒ ë„êµ¬ ì¡´ì¬ â†’ "continue" ë°˜í™˜
   â†“
5ë‹¨ê³„: pipeline_router ë…¸ë“œ ì‹¤í–‰
   - next_tool = tool_pipeline[1] = "summarize"
   - state["tool_choice"] = "summarize"
   - state["pipeline_index"] = 2
   â†“
6ë‹¨ê³„: summarize ë„êµ¬ ì‹¤í–‰
   - ê²€ìƒ‰ëœ ë…¼ë¬¸ ìš”ì•½
   - ê²°ê³¼: "ë…¼ë¬¸ ìš”ì•½ ë‚´ìš©..."
   â†“
7ë‹¨ê³„: check_pipeline_or_fallback() ì¡°ê±´ í™•ì¸
   - pipeline_index (2) < len(tool_pipeline) (2) âŒ
   - ëª¨ë“  ë„êµ¬ ì™„ë£Œ â†’ "end" ë°˜í™˜
   â†“
ìµœì¢… ë‹µë³€: "Attention is All You Need ë…¼ë¬¸ì„ ì°¾ì•˜ê³ , ìš”ì•½ ë‚´ìš©ì€..."
```

---

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### 1. í‚¤ì›Œë“œ ê¸°ë°˜ íŒ¨í„´ ë§¤ì¹­

**ì§€ì›í•˜ëŠ” íŒ¨í„´**:

| í‚¤ì›Œë“œ ì¡°í•© | ì‹¤í–‰ ë„êµ¬ íŒŒì´í”„ë¼ì¸ | ì„¤ëª… |
|------------|---------------------|------|
| ("ì°¾", "ìš”ì•½") | ["search_paper", "summarize"] | ë…¼ë¬¸ ê²€ìƒ‰ í›„ ìš”ì•½ |
| ("ê²€ìƒ‰", "ìš”ì•½") | ["search_paper", "summarize"] | ë…¼ë¬¸ ê²€ìƒ‰ í›„ ìš”ì•½ |
| ("ì°¾", "ì •ë¦¬") | ["search_paper", "summarize", "general"] | ê²€ìƒ‰ â†’ ìš”ì•½ â†’ ì¼ë°˜ ë‹µë³€ |
| ("ë…¼ë¬¸", "ìš”ì•½") | ["search_paper", "summarize"] | ë…¼ë¬¸ ê²€ìƒ‰ í›„ ìš”ì•½ |
| ("ê²€ìƒ‰", "ì„¤ëª…") | ["search_paper", "general"] | ê²€ìƒ‰ í›„ ì¼ë°˜ ë‹µë³€ |

**íŒ¨í„´ ì¶”ê°€ ë°©ë²•**:
```python
multi_request_patterns = {
    # ... ê¸°ì¡´ íŒ¨í„´
    ("ìš©ì–´", "ì˜ˆì‹œ"): ["glossary", "general"],  # ìš©ì–´ ì •ì˜ â†’ ì˜ˆì‹œ ì„¤ëª…
    ("ë…¼ë¬¸", "ë¹„êµ"): ["search_paper", "general"]  # ë…¼ë¬¸ ê²€ìƒ‰ â†’ ë¹„êµ ë¶„ì„
}
```

### 2. tool_pipeline ì„¤ì •

**AgentStateì— ì¶”ê°€ëœ í•„ë“œ**:
```python
class AgentState(TypedDict):
    # ... ê¸°ì¡´ í•„ë“œ
    tool_pipeline: List[str]  # ìˆœì°¨ ì‹¤í–‰ ë„êµ¬ ëª©ë¡
    pipeline_index: int       # í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ë„êµ¬ ì¸ë±ìŠ¤
```

**ì˜ˆì‹œ**:
```python
state = {
    "question": "Transformer ë…¼ë¬¸ ì°¾ì•„ì„œ ìš”ì•½í•´ì¤˜",
    "difficulty": "easy",
    "tool_pipeline": ["search_paper", "summarize"],
    "tool_choice": "search_paper",  # ì²« ë²ˆì§¸ ë„êµ¬
    "pipeline_index": 1              # ë‹¤ìŒ ì‹¤í–‰í•  ì¸ë±ìŠ¤
}
```

### 3. ìˆœì°¨ ì‹¤í–‰ ë©”ì»¤ë‹ˆì¦˜ (2025-11-05 êµ¬í˜„)

**êµ¬í˜„ ìœ„ì¹˜**: `src/agent/graph.py:30-87`

**í•µì‹¬ í•¨ìˆ˜**:

#### 3-1. should_continue_pipeline()
```python
def should_continue_pipeline(state: AgentState) -> str:
    """tool_pipelineì— ë‚¨ì€ ë„êµ¬ê°€ ìˆëŠ”ì§€ í™•ì¸"""
    tool_pipeline = state.get("tool_pipeline", [])
    pipeline_index = state.get("pipeline_index", 0)

    if not tool_pipeline:
        return "end"

    if pipeline_index < len(tool_pipeline):
        return "continue"  # ë‹¤ìŒ ë„êµ¬ ì¡´ì¬

    return "end"  # ëª¨ë“  ë„êµ¬ ì™„ë£Œ
```

#### 3-2. route_next_pipeline_tool()
```python
def route_next_pipeline_tool(state: AgentState) -> str:
    """tool_pipelineì—ì„œ ë‹¤ìŒ ì‹¤í–‰í•  ë„êµ¬ ì„ íƒ"""
    tool_pipeline = state.get("tool_pipeline", [])
    pipeline_index = state.get("pipeline_index", 0)

    if pipeline_index < len(tool_pipeline):
        next_tool = tool_pipeline[pipeline_index]
        state["tool_choice"] = next_tool
        state["pipeline_index"] = pipeline_index + 1
        return next_tool

    return "general"
```

#### 3-3. pipeline_router ë…¸ë“œ
```python
def pipeline_router(state: AgentState, exp_manager=None):
    """Pipelineì—ì„œ ë‹¤ìŒ ë„êµ¬ ì„ íƒ"""
    tool_pipeline = state.get("tool_pipeline", [])
    pipeline_index = state.get("pipeline_index", 0)

    if exp_manager:
        exp_manager.logger.write(f"Pipeline ì§„í–‰: {pipeline_index}/{len(tool_pipeline)}")

    route_next_pipeline_tool(state)

    if exp_manager:
        exp_manager.logger.write(f"ë‹¤ìŒ ë„êµ¬ ì‹¤í–‰: {state['tool_choice']}")

    return state
```

#### 3-4. check_pipeline_or_fallback()
```python
def check_pipeline_or_fallback(state: AgentState) -> str:
    """ë„êµ¬ ì‹¤í–‰ í›„ Pipeline ê³„ì† ë˜ëŠ” Fallback ì²´í¬"""
    tool_pipeline = state.get("tool_pipeline", [])
    pipeline_index = state.get("pipeline_index", 0)

    # Pipelineì´ ì„¤ì •ë˜ì–´ ìˆê³  ë‚¨ì€ ë„êµ¬ê°€ ìˆìœ¼ë©´
    if tool_pipeline and pipeline_index < len(tool_pipeline):
        return should_continue_pipeline(state)

    # Pipeline ì—†ê±°ë‚˜ ì™„ë£Œë˜ë©´ Fallback ì²´í¬
    return should_fallback(state)
```

**ê·¸ë˜í”„ ì—£ì§€ ì„¤ì •**:
```python
# ê° ë„êµ¬ ì‹¤í–‰ í›„ ì¡°ê±´ë¶€ ë¶„ê¸°
for tool_name in ["glossary", "search_paper", "web_search", "summarize", "text2sql", "save_file"]:
    workflow.add_conditional_edges(
        tool_name,
        check_pipeline_or_fallback,
        {
            "continue": "pipeline_router",      # Pipeline ê³„ì† â†’ ë‹¤ìŒ ë„êµ¬
            "end": END,                         # ì„±ê³µ â†’ ì¢…ë£Œ
            "retry": "fallback_router",         # ì‹¤íŒ¨ â†’ Fallback Router
            "final_fallback": "final_fallback"  # ìµœëŒ€ ì¬ì‹œë„ ì´ˆê³¼
        }
    )

# pipeline_router â†’ ë‹¤ìŒ ë„êµ¬ë¡œ ë¼ìš°íŒ…
workflow.add_conditional_edges(
    "pipeline_router",
    route_to_tool,  # tool_choiceì— ë”°ë¼ ë¼ìš°íŒ…
    {
        "general": "general",
        "glossary": "glossary",
        "search_paper": "search_paper",
        "web_search": "web_search",
        "summarize": "summarize",
        "text2sql": "text2sql",
        "save_file": "save_file"
    }
)
```

### 4. ë¡œê¹…

**ë‹¤ì¤‘ ìš”ì²­ ê°ì§€ ì‹œ ë¡œê·¸**:
```
ë¼ìš°í„° ë…¸ë“œ ì‹¤í–‰: Transformer ë…¼ë¬¸ ì°¾ì•„ì„œ ìš”ì•½í•´ì¤˜
ë‹¤ì¤‘ ìš”ì²­ ê°ì§€: ('ì°¾', 'ìš”ì•½') â†’ ['search_paper', 'summarize']
ìˆœì°¨ ì‹¤í–‰ ë„êµ¬: search_paper â†’ summarize
```

**Pipeline ì§„í–‰ ë¡œê·¸**:
```
Pipeline ì§„í–‰: 1/2
ë‹¤ìŒ ë„êµ¬ ì‹¤í–‰: summarize
```

---

## ğŸ“Š í˜„ì¬ êµ¬í˜„ ìƒíƒœ

### âœ… ì™„ë£Œëœ ê¸°ëŠ¥ (2025-11-05 ê¸°ì¤€)

1. **í‚¤ì›Œë“œ ê¸°ë°˜ íŒ¨í„´ ë§¤ì¹­**: 5ê°€ì§€ íŒ¨í„´ ì§€ì›
2. **tool_pipeline ì„¤ì •**: AgentStateì— ë„êµ¬ ëª©ë¡ ë° pipeline_index ì €ì¥
3. **ìˆœì°¨ ì‹¤í–‰ ë©”ì»¤ë‹ˆì¦˜**: graph ìˆ˜ì • ì™„ë£Œ, ëª¨ë“  ë„êµ¬ ìˆœì°¨ ì‹¤í–‰
   - `should_continue_pipeline()`: ë‚¨ì€ ë„êµ¬ í™•ì¸
   - `route_next_pipeline_tool()`: ë‹¤ìŒ ë„êµ¬ ì„ íƒ
   - `pipeline_router` ë…¸ë“œ: íŒŒì´í”„ë¼ì¸ ê´€ë¦¬
   - `check_pipeline_or_fallback()`: ì¡°ê±´ë¶€ ë¶„ê¸°
4. **ë¡œê¹…**: ë‹¤ì¤‘ ìš”ì²­ ê°ì§€ ë° íŒŒì´í”„ë¼ì¸ ì§„í–‰ ìƒí™© ê¸°ë¡

### ğŸ”„ ì‹¤í–‰ íë¦„ (ì™„ì „ êµ¬í˜„)

```python
# src/agent/graph.py
# 1. ë„êµ¬ ì‹¤í–‰ í›„ ì¡°ê±´ í™•ì¸
workflow.add_conditional_edges(
    tool_name,
    check_pipeline_or_fallback,
    {
        "continue": "pipeline_router",   # ë‹¤ìŒ ë„êµ¬ ì¡´ì¬ â†’ pipeline_router
        "end": END,                      # ì™„ë£Œ â†’ ì¢…ë£Œ
        "retry": "fallback_router"       # ì‹¤íŒ¨ â†’ Fallback
    }
)

# 2. pipeline_routerì—ì„œ ë‹¤ìŒ ë„êµ¬ ì„ íƒ
workflow.add_conditional_edges(
    "pipeline_router",
    route_to_tool,  # tool_choiceì— ë”°ë¼ ë‹¤ìŒ ë„êµ¬ë¡œ ë¼ìš°íŒ…
    {
        "search_paper": "search_paper",
        "summarize": "summarize",
        # ... ê¸°íƒ€ ë„êµ¬
    }
)

# 3. ë‹¤ìŒ ë„êµ¬ ì‹¤í–‰ â†’ 1ë‹¨ê³„ ë°˜ë³µ
```

---

## ğŸ¯ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ë…¼ë¬¸ ê²€ìƒ‰ + ìš”ì•½ (ì™„ì „ êµ¬í˜„)

**ì§ˆë¬¸**:
```
"BERT ë…¼ë¬¸ ì°¾ì•„ì„œ ìš”ì•½í•´ì¤˜"
```

**ì²˜ë¦¬ íë¦„**:
```
1. í‚¤ì›Œë“œ ê°ì§€: ("ì°¾", "ìš”ì•½")
2. tool_pipeline: ["search_paper", "summarize"]
3. search_paper ì‹¤í–‰ â†’ "BERT ë…¼ë¬¸ ë°œê²¬"
4. check_pipeline_or_fallback: "continue" â†’ pipeline_router
5. summarize ì‹¤í–‰ â†’ "BERT ë…¼ë¬¸ ìš”ì•½"
6. check_pipeline_or_fallback: "end" â†’ END
7. ìµœì¢… ë‹µë³€: "BERT ë…¼ë¬¸ì„ ì°¾ì•˜ê³ , ìš”ì•½ì€..."
```

### ì˜ˆì‹œ 2: ë…¼ë¬¸ ê²€ìƒ‰ + ì •ë¦¬ (ì™„ì „ êµ¬í˜„)

**ì§ˆë¬¸**:
```
"GPT ë…¼ë¬¸ ì°¾ì•„ì„œ ì •ë¦¬í•´ì¤˜"
```

**ì²˜ë¦¬ íë¦„**:
```
1. í‚¤ì›Œë“œ ê°ì§€: ("ì°¾", "ì •ë¦¬")
2. tool_pipeline: ["search_paper", "summarize", "general"]
3. search_paper ì‹¤í–‰ â†’ "GPT ë…¼ë¬¸ ë°œê²¬"
4. check_pipeline_or_fallback: "continue" â†’ pipeline_router
5. summarize ì‹¤í–‰ â†’ "GPT ë…¼ë¬¸ ìš”ì•½"
6. check_pipeline_or_fallback: "continue" â†’ pipeline_router
7. general ì‹¤í–‰ â†’ "ìš”ì•½ ë‚´ìš©ì„ ì‰½ê²Œ ì„¤ëª…"
8. check_pipeline_or_fallback: "end" â†’ END
9. ìµœì¢… ë‹µë³€: "GPT ë…¼ë¬¸ì„ ì°¾ì•„ì„œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤..."
```

### ì˜ˆì‹œ 3: ìš©ì–´ ê²€ìƒ‰ + ì˜ˆì‹œ (íŒ¨í„´ ì¶”ê°€ í•„ìš”)

**ì§ˆë¬¸ (í–¥í›„ íŒ¨í„´ ì¶”ê°€ ì‹œ)**:
```
"Attentionì´ ë­”ì§€ ì°¾ì•„ì„œ ì˜ˆì‹œ ë“¤ì–´ì¤˜"
```

**ì²˜ë¦¬ íë¦„ (íŒ¨í„´ ì¶”ê°€ í›„ ë™ì‘ ì˜ˆìƒ)**:
```
1. í‚¤ì›Œë“œ ê°ì§€: ("ì°¾", "ì˜ˆì‹œ")
2. tool_pipeline: ["glossary", "general"]
3. glossary ì‹¤í–‰ â†’ "Attention ì •ì˜"
4. check_pipeline_or_fallback: "continue" â†’ pipeline_router
5. general ì‹¤í–‰ â†’ "ì‹¤ìƒí™œ ì˜ˆì‹œ ì„¤ëª…"
6. check_pipeline_or_fallback: "end" â†’ END
7. ìµœì¢… ë‹µë³€: "Attentionì€... ì˜ˆë¥¼ ë“¤ë©´..."
```

---

## âš ï¸ ì œì•½ì‚¬í•­ ë° í–¥í›„ ê°œì„ 

### 1. í‚¤ì›Œë“œ ê¸°ë°˜ í•œê³„

**í˜„ì¬ ì œì•½**:
- ì •í™•í•œ í‚¤ì›Œë“œê°€ ì—†ìœ¼ë©´ ê°ì§€ ë¶ˆê°€
- "ë…¼ë¬¸ì„ ì°¾ì€ í›„ ìš”ì•½" â†’ ê°ì§€ ì•ˆ ë¨ ("ì°¾ì•„ì„œ" í•„ìš”)
- 5ê°œ íŒ¨í„´ë§Œ ì§€ì›

**í•´ê²° ë°©ì•ˆ (í–¥í›„)**:
- LLM ê¸°ë°˜ ì˜ë„ ë¶„ì„
- "ë…¼ë¬¸ ê²€ìƒ‰ + ìš”ì•½ ìš”ì²­" ìë™ íŒŒì•…
- ë” ìœ ì—°í•œ íŒ¨í„´ ì¸ì‹

### 2. ë„êµ¬ ê°„ ë°ì´í„° ì „ë‹¬ ìµœì í™” (í–¥í›„)

**í˜„ì¬ ìƒíƒœ**:
- ê° ë„êµ¬ê°€ state ì „ì²´ë¥¼ ê³µìœ 
- final_answerê°€ ë‹¤ìŒ ë„êµ¬ë¡œ ì „ë‹¬ë¨

**ê°œì„  ë°©ì•ˆ**:
```python
# íŠ¹ì • ë°ì´í„°ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì „ë‹¬
state["search_result"] = {
    "paper_id": "12345",
    "title": "Attention is All You Need",
    "content": "..."
}

# summarize ë„êµ¬ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ ì°¸ì¡°
paper_id = state.get("search_result", {}).get("paper_id")
```

### 3. Fallback Chain í†µí•©

**í˜„ì¬ ìƒíƒœ**:
- Pipeline ì‹¤í–‰ ì¤‘ ë„êµ¬ ì‹¤íŒ¨ ì‹œ Fallback Chain ì‘ë™
- ì‹¤íŒ¨í•œ ë„êµ¬ë¥¼ ë‹¤ë¥¸ ë„êµ¬ë¡œ ëŒ€ì²´

**í–¥í›„ ê°œì„ **:
- Pipeline ë‚´ì—ì„œ ì‹¤íŒ¨í•œ ë„êµ¬ë§Œ Fallback
- ì„±ê³µí•œ ë„êµ¬ ê²°ê³¼ëŠ” ìœ ì§€í•˜ê³  ì´ì–´ì„œ ì‹¤í–‰

---

## ğŸ“‹ í–¥í›„ ê°œì„  ê³„íš

### âœ… Phase 1: í‚¤ì›Œë“œ ê¸°ë°˜ íŒ¨í„´ ë§¤ì¹­ (ì™„ë£Œ)
- 5ê°€ì§€ íŒ¨í„´ ì§€ì›
- tool_pipeline ì„¤ì •

### âœ… Phase 2: ìˆœì°¨ ì‹¤í–‰ ë©”ì»¤ë‹ˆì¦˜ (ì™„ë£Œ - 2025-11-05)
- `should_continue_pipeline()` êµ¬í˜„
- `pipeline_router` ë…¸ë“œ ì¶”ê°€
- ì¡°ê±´ë¶€ ì—£ì§€ ì„¤ì •
- ëª¨ë“  ë„êµ¬ ìˆœì°¨ ì‹¤í–‰

### Phase 3: LLM ê¸°ë°˜ ì˜ë„ ë¶„ì„ (ìš°ì„ ìˆœìœ„: ë†’ìŒ)

**í˜„ì¬ (í‚¤ì›Œë“œ ê¸°ë°˜)**:
```python
if all(kw in question for kw in keywords):
    # íŒ¨í„´ ë§¤ì¹­
```

**í–¥í›„ (LLM ê¸°ë°˜)**:
```python
# LLMì—ê²Œ ì˜ë„ ë¶„ì„ ìš”ì²­
intent_prompt = """
ì§ˆë¬¸: {question}

ì´ ì§ˆë¬¸ì´ ì—¬ëŸ¬ ì‘ì—…ì„ ìš”êµ¬í•˜ëŠ”ì§€ ë¶„ì„í•˜ì„¸ìš”:
- ë‹¨ì¼ ì‘ì—…: í•˜ë‚˜ì˜ ë„êµ¬ë§Œ í•„ìš”
- ë‹¤ì¤‘ ì‘ì—…: ì—¬ëŸ¬ ë„êµ¬ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ í•„ìš”

í•„ìš”í•œ ë„êµ¬ ëª©ë¡ì„ ìˆœì„œëŒ€ë¡œ ë°˜í™˜í•˜ì„¸ìš”.
"""

tools = llm.invoke(intent_prompt).content  # ["search_paper", "summarize"]
```

**ì¥ì **:
- ë” ìœ ì—°í•œ íŒ¨í„´ ì¸ì‹
- "ë…¼ë¬¸ì„ ì°¾ì€ í›„ ìš”ì•½í•´ì¤˜" ê°™ì€ ë³€í˜• í‘œí˜„ ì§€ì›
- ìƒˆë¡œìš´ íŒ¨í„´ ìë™ ê°ì§€

### Phase 4: ë„êµ¬ ì²´ì´ë‹ ìµœì í™” (ìš°ì„ ìˆœìœ„: ì¤‘ê°„)

**ìŠ¤ë§ˆíŠ¸ íŒŒì´í”„ë¼ì¸**:
- ë„êµ¬ ì‹¤í–‰ ê²°ê³¼ì— ë”°ë¼ ë‹¤ìŒ ë„êµ¬ ë™ì  ë³€ê²½
- ì˜ˆ: search_paper ì‹¤íŒ¨ ì‹œ web_searchë¡œ ìë™ ì „í™˜ (í˜„ì¬ëŠ” Fallback Chainì´ ì²˜ë¦¬)

**ë„êµ¬ ê°„ ë°ì´í„° ì „ë‹¬ ìµœì í™”**:
- ëª…ì‹œì ì¸ ë°ì´í„° ì „ë‹¬ êµ¬ì¡°
- ê° ë„êµ¬ì˜ ì…ì¶œë ¥ ëª…í™•í™”

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- **[06_AI_Agent_ì‹œìŠ¤í…œ.md](./06_AI_Agent_ì‹œìŠ¤í…œ.md)** - ìƒìœ„ ë¬¸ì„œ
- **[09_ë„êµ¬_ì‹œìŠ¤í…œ.md](./09_ë„êµ¬_ì‹œìŠ¤í…œ.md)** - ë„êµ¬ ì‹œìŠ¤í…œ ì „ì²´
- **[09-1_ë„êµ¬_ìë™ì „í™˜_ê¸°ëŠ¥.md](./09-1_ë„êµ¬_ìë™ì „í™˜_ê¸°ëŠ¥.md)** - Fallback Chain
- **[docs/issues/06_Session_010_ì‹¤í—˜_ë¶„ì„_ê¸°ë°˜_ì‹œìŠ¤í…œ_ê°œì„ .md](../issues/06_Session_010_ì‹¤í—˜_ë¶„ì„_ê¸°ë°˜_ì‹œìŠ¤í…œ_ê°œì„ .md)** - ê°œì„  ì´ìŠˆ

---

## ğŸ“ ìš”ì•½

### í•µì‹¬ ê°œì„ ì‚¬í•­ (2025-11-05 ê¸°ì¤€)

1. âœ… **ë‹¤ì¤‘ ìš”ì²­ ê°ì§€**: í‚¤ì›Œë“œ ê¸°ë°˜ íŒ¨í„´ ë§¤ì¹­ (5ê°€ì§€ íŒ¨í„´)
2. âœ… **tool_pipeline ì„¤ì •**: ìˆœì°¨ ì‹¤í–‰ ë„êµ¬ ëª©ë¡ ì €ì¥
3. âœ… **ìˆœì°¨ ì‹¤í–‰ ë©”ì»¤ë‹ˆì¦˜**: graph ìˆ˜ì • ì™„ë£Œ, ëª¨ë“  ë„êµ¬ ìˆœì°¨ ì‹¤í–‰
4. âœ… **pipeline_router ë…¸ë“œ**: ë‹¤ìŒ ë„êµ¬ ìë™ ì„ íƒ ë° ì‹¤í–‰
5. âœ… **ë¡œê¹…**: ë‹¤ì¤‘ ìš”ì²­ ê°ì§€ ë° íŒŒì´í”„ë¼ì¸ ì§„í–‰ ê¸°ë¡

### í˜„ì¬ ì§€ì› íŒ¨í„´

```python
multi_request_patterns = {
    ("ì°¾", "ìš”ì•½"): ["search_paper", "summarize"],
    ("ê²€ìƒ‰", "ìš”ì•½"): ["search_paper", "summarize"],
    ("ì°¾", "ì •ë¦¬"): ["search_paper", "summarize", "general"],
    ("ë…¼ë¬¸", "ìš”ì•½"): ["search_paper", "summarize"],
    ("ê²€ìƒ‰", "ì„¤ëª…"): ["search_paper", "general"]
}
```

### ì‚¬ìš© ë°©ë²•

```python
# ë‹¤ì¤‘ ìš”ì²­ì´ ìë™ìœ¼ë¡œ ê°ì§€ë˜ê³  ìˆœì°¨ ì‹¤í–‰ë¨
ì‚¬ìš©ì: "Transformer ë…¼ë¬¸ ì°¾ì•„ì„œ ìš”ì•½í•´ì¤˜"

# Router ë…¸ë“œì—ì„œ ìë™ ì²˜ë¦¬
state["tool_pipeline"] = ["search_paper", "summarize"]
state["tool_choice"] = "search_paper"
state["pipeline_index"] = 1

# ìˆœì°¨ ì‹¤í–‰ (ì™„ì „ êµ¬í˜„)
# 1. search_paper ì‹¤í–‰
# 2. check_pipeline_or_fallback â†’ "continue"
# 3. pipeline_router â†’ "summarize" ì„ íƒ
# 4. summarize ì‹¤í–‰
# 5. check_pipeline_or_fallback â†’ "end"
# 6. ìµœì¢… ë‹µë³€ ë°˜í™˜
```

### ì‹¤í–‰ íë¦„ ë„ì‹

```
Router â†’ Tool 1 â†’ check_pipeline_or_fallback
                    â†“ (continue)
              pipeline_router â†’ Tool 2 â†’ check_pipeline_or_fallback
                                           â†“ (end)
                                          END
```

### ì£¼ì˜ì‚¬í•­

1. **í‚¤ì›Œë“œ ì •í™•íˆ ì…ë ¥**: "ì°¾ì•„ì„œ", "ìš”ì•½í•´ì¤˜" (í‚¤ì›Œë“œ í•„ìˆ˜)
2. **íŒ¨í„´ ì œí•œ**: í˜„ì¬ 5ê°œ íŒ¨í„´ë§Œ ì§€ì›
3. **í–¥í›„ ê°œì„  ì˜ˆì •**: LLM ê¸°ë°˜ ì˜ë„ ë¶„ì„ (ë” ìœ ì—°í•œ íŒ¨í„´ ì¸ì‹)
