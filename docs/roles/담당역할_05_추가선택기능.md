# ì¶”ê°€ ì„ íƒ ê¸°ëŠ¥ (ë¨¼ì € ê°œë°œ ì™„ë£Œí•œ íŒ€ì›ì´ ì„ íƒ)

## ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì¼**: 2025-10-30
- **ì‘ì„±ì**: ìµœí˜„í™”[íŒ€ì¥]
- **ëª©ì **: í•µì‹¬ ê¸°ëŠ¥ ê°œë°œì„ ë¨¼ì € ì™„ë£Œí•œ íŒ€ì›ì´ ì¶”ê°€ë¡œ ì„ íƒí•˜ì—¬ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ ëª©ë¡
- **ìš°ì„ ìˆœìœ„**: ì„ íƒ ì‚¬í•­ (ì‹œê°„ì´ ìˆì„ ê²½ìš°)

---

## ê°œìš”

í•µì‹¬ ê¸°ëŠ¥(AI Agent, RAG, ìš©ì–´ì§‘, ì›¹ ê²€ìƒ‰, íŒŒì¼ ì €ì¥, UI)ì„ ë¨¼ì € ì™„ë£Œí•œ íŒ€ì›ì´ ì•„ë˜ ê¸°ëŠ¥ ì¤‘ ì„ íƒí•˜ì—¬ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì„ íƒ ê¸°ì¤€:**
1. í”„ë¡œì íŠ¸ì— ê°€ì‚°ì ì„ ì¤„ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥
2. êµ¬í˜„ ë‚œì´ë„ì™€ ì‹œê°„ì„ ê³ ë ¤
3. íŒ€ì›ì˜ ê´€ì‹¬ì‚¬ ë° ê°•ì 

---

## ì¶”ê°€ ê¸°ëŠ¥ ì„ íƒ í”„ë¡œì„¸ìŠ¤

```mermaid
graph TB
    subgraph Check["ğŸ”¸ í•µì‹¬ ê¸°ëŠ¥ í™•ì¸"]
        direction LR
        A[AI Agent<br/>ì™„ë£Œ?] --> B[RAG ì‹œìŠ¤í…œ<br/>ì™„ë£Œ?]
        B --> C[ìš©ì–´ì§‘<br/>ì™„ë£Œ?]
        C --> D[ì›¹ ê²€ìƒ‰<br/>ì™„ë£Œ?]
        D --> E[íŒŒì¼ ì €ì¥<br/>ì™„ë£Œ?]
        E --> F[UI<br/>ì™„ë£Œ?]
    end

    subgraph Select["ğŸ”¹ ì¶”ê°€ ê¸°ëŠ¥ ì„ íƒ"]
        direction LR
        G[ìš°ì„ ìˆœìœ„<br/>í™•ì¸] --> H[ì†Œìš” ì‹œê°„<br/>í‰ê°€]
        H --> I[ê¸°ìˆ  ìŠ¤íƒ<br/>ê²€í† ]
        I --> J[ê¸°ëŠ¥<br/>ì„ íƒ]
    end

    subgraph Implement["ğŸ”º êµ¬í˜„ ë° í†µí•©"]
        direction LR
        K[ë„êµ¬<br/>êµ¬í˜„] --> L[AI Agent<br/>í†µí•©]
        L --> M[í…ŒìŠ¤íŠ¸<br/>ê²€ì¦]
        M --> N[âœ… ì™„ë£Œ]
    end

    Check --> Select
    Select --> Implement

    %% Subgraph ìŠ¤íƒ€ì¼ (Material Design)
    style Check fill:#e1f5ff,stroke:#01579b,stroke-width:3px,color:#000
    style Select fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000
    style Implement fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (í•µì‹¬ ê¸°ëŠ¥ í™•ì¸ - íŒŒë‘ ê³„ì—´)
    style A fill:#90caf9,stroke:#1976d2,color:#000
    style B fill:#81d4fa,stroke:#0288d1,color:#000
    style C fill:#64b5f6,stroke:#1976d2,color:#000
    style D fill:#42a5f5,stroke:#1565c0,color:#000
    style E fill:#29b6f6,stroke:#0277bd,color:#000
    style F fill:#03a9f4,stroke:#01579b,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì¶”ê°€ ê¸°ëŠ¥ ì„ íƒ - ë³´ë¼ ê³„ì—´)
    style G fill:#ce93d8,stroke:#7b1fa2,color:#000
    style H fill:#ba68c8,stroke:#7b1fa2,color:#fff
    style I fill:#ab47bc,stroke:#4a148c,color:#fff
    style J fill:#9c27b0,stroke:#4a148c,color:#fff

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (êµ¬í˜„ ë° í†µí•© - ë…¹ìƒ‰ ê³„ì—´)
    style K fill:#a5d6a7,stroke:#388e3c,color:#000
    style L fill:#81c784,stroke:#2e7d32,color:#000
    style M fill:#66bb6a,stroke:#2e7d32,color:#000
    style N fill:#4caf50,stroke:#1b5e20,color:#fff
```

---

## ì„ íƒ ê¸°ëŠ¥ 1: Text-to-SQL ë„êµ¬ (â­â­â­ ê°€ì‚°ì )

### ê¸°ëŠ¥ ì„¤ëª…
ìì—°ì–´ ì§ˆë¬¸ì„ SQL ì¿¼ë¦¬ë¡œ ë³€í™˜í•˜ì—¬ ë…¼ë¬¸ í†µê³„ ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ë„êµ¬

### ì‚¬ìš© ì‹œì 
- "2024ë…„ì— ë°œí‘œëœ ë…¼ë¬¸ ê°œìˆ˜ëŠ”?"
- "ê°€ì¥ ë§ì´ ì¸ìš©ëœ ë…¼ë¬¸ Top 5ëŠ”?"
- "ì €ìë³„ ë…¼ë¬¸ ìˆ˜ ì•Œë ¤ì¤˜"
- "ì¹´í…Œê³ ë¦¬ë³„ ë…¼ë¬¸ ë¶„í¬ëŠ”?"

### Langchain êµ¬í˜„

#### 1. SQLDatabaseChain ì‚¬ìš©

**íŒŒì¼ ê²½ë¡œ**: `src/tools/text2sql.py`

**êµ¬í˜„ ë°©ë²•**:
1. SQLDatabase.from_uri()ë¡œ PostgreSQL ì—°ê²°
2. SQLDatabaseChain ìƒì„±
   - LLM: ChatOpenAI (model: gpt-5, temperature: 0)
   - db: SQLDatabase ì¸ìŠ¤í„´ìŠ¤
   - verbose: True
3. `query_paper_statistics` í•¨ìˆ˜ë¥¼ @tool ë°ì½”ë ˆì´í„°ë¡œ ì •ì˜
   - ì¸ì: question (ìì—°ì–´ ì§ˆë¬¸)
   - sql_chain.run()ìœ¼ë¡œ SQL ìƒì„± ë° ì‹¤í–‰
   - ê²°ê³¼ë¥¼ Markdown í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…í•˜ì—¬ ë°˜í™˜

#### 2. ì»¤ìŠ¤í…€ SQL ìƒì„± (ê³ ê¸‰)

**êµ¬í˜„ ë°©ë²•**:
1. SQL_GENERATION_PROMPT ì •ì˜
   - ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì •ë³´ í¬í•¨
   - ì§ˆë¬¸ì„ SQL ì¿¼ë¦¬ë¡œ ë³€í™˜í•˜ëŠ” í”„ë¡¬í”„íŠ¸
2. `custom_sql_query` í•¨ìˆ˜ë¥¼ @tool ë°ì½”ë ˆì´í„°ë¡œ ì •ì˜
   - LLMìœ¼ë¡œ SQL ì¿¼ë¦¬ ìƒì„±
   - psycopg2ë¡œ PostgreSQL ì—°ê²°
   - ìƒì„±ëœ SQL ì¿¼ë¦¬ ì‹¤í–‰
   - ê²°ê³¼ í¬ë§·íŒ… (SQLê³¼ ê²°ê³¼ í¬í•¨)
   - ì˜¤ë¥˜ ì²˜ë¦¬ (try-except-finally)

### êµ¬í˜„í•´ì•¼ í•  ê¸°ëŠ¥
1. SQLDatabaseChain ì„¤ì •
2. DB ìŠ¤í‚¤ë§ˆ ì •ë³´ í”„ë¡¬í”„íŠ¸ì— í¬í•¨
3. SQL ì¿¼ë¦¬ ìƒì„±
4. ì¿¼ë¦¬ ì‹¤í–‰ ë° ê²°ê³¼ í¬ë§·íŒ…
5. ì˜¤ë¥˜ ì²˜ë¦¬ (ì˜ëª»ëœ SQL ìƒì„± ì‹œ)

### ì‚¬ìš©í•˜ëŠ” DB
- **PostgreSQL**: `papers`, `glossary` í…Œì´ë¸”

### ì˜ˆìƒ ì†Œìš” ì‹œê°„
**2-3ì¼**

### êµ¬í˜„ ì„¤ëª…

**í•„ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬**:
- `langchain.tools.tool` (@tool ë°ì½”ë ˆì´í„°)
- `langchain_openai.ChatOpenAI`
- `langchain_community.utilities.SQLDatabase`
- `langchain.chains.SQLDatabaseChain`
- `psycopg2`

---

#### ë°©ë²• 1: SQLDatabaseChain ì‚¬ìš© (ê¶Œì¥)

**ì´ˆê¸°í™” ë‹¨ê³„**:

| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|-----|------|------|
| 1 | PostgreSQL ì—°ê²° | SQLDatabase.from_uri("postgresql://...") |
| 2 | LLM ì´ˆê¸°í™” | ChatOpenAI(model="gpt-5", temperature=0) |
| 3 | SQLDatabaseChain ìƒì„± | from_llm(llm, db, verbose=True) |

**ë„êµ¬: `query_paper_statistics`**

| í•­ëª© | ì„¤ëª… |
|-----|------|
| ë°ì½”ë ˆì´í„° | @tool |
| íŒŒë¼ë¯¸í„° | question (str) - ìì—°ì–´ ì§ˆë¬¸ |
| ë°˜í™˜ê°’ | str - ì¿¼ë¦¬ ê²°ê³¼ (Markdown í˜•ì‹) |
| ë™ì‘ | sql_chain.run(question)ìœ¼ë¡œ SQL ìƒì„± ë° ì‹¤í–‰ |
| ì˜¤ë¥˜ ì²˜ë¦¬ | try-exceptë¡œ ì˜¤ë¥˜ ë©”ì‹œì§€ ë°˜í™˜ |

**ì²˜ë¦¬ íë¦„**:
1. ìì—°ì–´ ì§ˆë¬¸ ìˆ˜ì‹ 
2. SQLDatabaseChain.run()ìœ¼ë¡œ SQL ìë™ ìƒì„± ë° ì‹¤í–‰
3. ê²°ê³¼ë¥¼ Markdown í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…
4. ì˜¤ë¥˜ ë°œìƒ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€ ë°˜í™˜

---

#### ë°©ë²• 2: ì»¤ìŠ¤í…€ SQL ìƒì„± (ê³ ê¸‰)

**SQL ìƒì„± í”„ë¡¬í”„íŠ¸ êµ¬ì¡°**:

| í•­ëª© | ë‚´ìš© |
|-----|------|
| ëª©ì  | ìì—°ì–´ ì§ˆë¬¸ì„ SQL ì¿¼ë¦¬ë¡œ ë³€í™˜ |
| DB ìŠ¤í‚¤ë§ˆ ì •ë³´ | papers, glossary í…Œì´ë¸” êµ¬ì¡° í¬í•¨ |
| ì…ë ¥ ë³€ìˆ˜ | {question} |
| ì¶œë ¥ í˜•ì‹ | ë‹¨ì¼ SQL SELECT ì¿¼ë¦¬ |

**ë„êµ¬: `custom_sql_query`**

| í•­ëª© | ì„¤ëª… |
|-----|------|
| ë°ì½”ë ˆì´í„° | @tool |
| íŒŒë¼ë¯¸í„° | question (str) - ìì—°ì–´ ì§ˆë¬¸ |
| ë°˜í™˜ê°’ | str - ì¿¼ë¦¬ ê²°ê³¼ (SQL + ê²°ê³¼ í…Œì´ë¸”) |

**ì²˜ë¦¬ íë¦„**:

| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|-----|------|------|
| 1 | SQL ì¿¼ë¦¬ ìƒì„± | LLM.invoke()ë¡œ SQL_GENERATION_PROMPT ì‹¤í–‰ |
| 2 | ë§ˆí¬ë‹¤ìš´ ë¸”ë¡ ì œê±° | ì½”ë“œ ë¸”ë¡ êµ¬ë¬¸ ì œê±° (```sql``` ì œê±°) |
| 3 | DB ì—°ê²° | psycopg2.connect() |
| 4 | ì¿¼ë¦¬ ì‹¤í–‰ | cursor.execute(sql_query) |
| 5 | ê²°ê³¼ ì¡°íšŒ | cursor.fetchall() |
| 6 | ì»¬ëŸ¼ëª… ì¶”ì¶œ | cursor.descriptionì—ì„œ ì»¬ëŸ¼ëª… ê°€ì ¸ì˜¤ê¸° |
| 7 | ê²°ê³¼ í¬ë§·íŒ… | Markdown í…Œì´ë¸” í˜•ì‹ìœ¼ë¡œ ë³€í™˜ |
| 8 | ì—°ê²° ì¢…ë£Œ | cursor.close(), conn.close() |
| 9 | ì˜¤ë¥˜ ì²˜ë¦¬ | SQL ì˜¤ë¥˜ ë°œìƒ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€ + ìƒì„±ëœ SQL ë°˜í™˜ |

**ì¶œë ¥ í˜•ì‹**:
- ì‹¤í–‰ëœ SQL ì¿¼ë¦¬ (ì½”ë“œ ë¸”ë¡)
- ê²°ê³¼ í…Œì´ë¸” (Markdown í…Œì´ë¸”)
- ì˜¤ë¥˜ ë°œìƒ ì‹œ: ì˜¤ë¥˜ ë©”ì‹œì§€ + ìƒì„±ëœ SQL

### ì°¸ê³  ìë£Œ
- Langchain SQL Database: https://python.langchain.com/docs/integrations/tools/sql_database
- SQLDatabaseChain: https://python.langchain.com/docs/use_cases/sql/

---

## ì„ íƒ ê¸°ëŠ¥ 2: ì„±ëŠ¥ í‰ê°€ ì‹œìŠ¤í…œ (â­â­ ê°€ì‚°ì )

### ê¸°ëŠ¥ ì„¤ëª…
ì±—ë´‡ì˜ ë‹µë³€ í’ˆì§ˆì„ ìë™ìœ¼ë¡œ í‰ê°€í•˜ëŠ” ì‹œìŠ¤í…œ

### í‰ê°€ í•­ëª©
1. **ë‹µë³€ ì •í™•ë„**: ë…¼ë¬¸ ë‚´ìš©ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€
2. **ê´€ë ¨ì„±**: ì§ˆë¬¸ê³¼ ë‹µë³€ì´ ê´€ë ¨ìˆëŠ”ì§€
3. **ë‚œì´ë„ ì í•©ì„±**: Easy/Hard ëª¨ë“œì— ë§ëŠ” ë‹µë³€ì¸ì§€
4. **ì¶œì²˜ ëª…ì‹œ**: ë…¼ë¬¸ ì œëª©, ì €ìë¥¼ ëª…ì‹œí–ˆëŠ”ì§€

### Langchain êµ¬í˜„

#### 1. LLM-as-a-Judge í‰ê°€

**íŒŒì¼ ê²½ë¡œ**: `src/evaluation/evaluator.py`

**êµ¬í˜„ ë°©ë²•**:
1. EVALUATION_PROMPT ì •ì˜ (PromptTemplate)
   - í‰ê°€ ê¸°ì¤€: ì •í™•ë„, ê´€ë ¨ì„±, ë‚œì´ë„ ì í•©ì„±, ì¶œì²˜ ëª…ì‹œ (ê° 0-10ì )
   - JSON í˜•ì‹ìœ¼ë¡œ í‰ê°€ ê²°ê³¼ ë°˜í™˜
2. `AnswerEvaluator` í´ë˜ìŠ¤ ì •ì˜
   - ChatOpenAI ì´ˆê¸°í™” (model: gpt-5, temperature: 0)
3. `evaluate` ë©”ì„œë“œ êµ¬í˜„
   - í”„ë¡¬í”„íŠ¸ í¬ë§·íŒ… (question, answer, reference_docs, difficulty)
   - LLM í˜¸ì¶œí•˜ì—¬ í‰ê°€ ìˆ˜í–‰
   - ê²°ê³¼ë¥¼ JSONìœ¼ë¡œ íŒŒì‹±í•˜ì—¬ ë°˜í™˜

#### 2. í‰ê°€ ê²°ê³¼ ì €ì¥

**êµ¬í˜„ ë°©ë²•**:
1. `save_evaluation_results` í•¨ìˆ˜ ì •ì˜
2. PostgreSQL ì—°ê²°
3. evaluation_results í…Œì´ë¸” ìƒì„±
   - eval_id, question, answer, accuracy_score, relevance_score, difficulty_score, citation_score, total_score, comment, created_at
4. í‰ê°€ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ìˆœíšŒí•˜ë©° INSERT
5. ì»¤ë°‹ ë° ì—°ê²° ì¢…ë£Œ

### êµ¬í˜„í•´ì•¼ í•  ê¸°ëŠ¥
1. LLM-as-a-Judge í”„ë¡¬í”„íŠ¸ ì„¤ê³„
2. í‰ê°€ ê²°ê³¼ JSON íŒŒì‹±
3. PostgreSQL í‰ê°€ ê²°ê³¼ í…Œì´ë¸” ìƒì„±
4. í‰ê°€ ê²°ê³¼ ì €ì¥ ë° ì¡°íšŒ
5. Streamlit UIì— í‰ê°€ ê²°ê³¼ í‘œì‹œ

### ì˜ˆìƒ ì†Œìš” ì‹œê°„
**2-3ì¼**

### êµ¬í˜„ ì„¤ëª…

**í•„ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬**:
- `langchain_openai.ChatOpenAI`
- `langchain.prompts.PromptTemplate`
- `json`
- `psycopg2`

---

#### í‰ê°€ í”„ë¡¬í”„íŠ¸ êµ¬ì¡°

**EVALUATION_PROMPT_TEMPLATE**:

| í•­ëª© | ë‚´ìš© |
|-----|------|
| ì…ë ¥ ë³€ìˆ˜ | question, answer, reference_docs, difficulty |
| í‰ê°€ í•­ëª© | ì •í™•ë„, ê´€ë ¨ì„±, ë‚œì´ë„ ì í•©ì„±, ì¶œì²˜ ëª…ì‹œ (ê° 0-10ì ) |
| ì¶œë ¥ í˜•ì‹ | JSON (accuracy_score, relevance_score, difficulty_score, citation_score, total_score, comment) |

**PromptTemplate ìƒì„±**:
- template: EVALUATION_PROMPT_TEMPLATE
- input_variables: ["question", "answer", "reference_docs", "difficulty"]

---

#### í´ë˜ìŠ¤: `AnswerEvaluator`

**ì—­í• **: LLM-as-a-Judge ë°©ì‹ìœ¼ë¡œ ë‹µë³€ í’ˆì§ˆ í‰ê°€

**`__init__` ë©”ì„œë“œ**:

| ì´ˆê¸°í™” í•­ëª© | ì„¤ì • |
|-----------|------|
| LLM | ChatOpenAI(model="gpt-5", temperature=0) |

**`evaluate` ë©”ì„œë“œ**:

**íŒŒë¼ë¯¸í„°**:

| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì„¤ëª… |
|---------|------|------|
| question | str | ì‚¬ìš©ì ì§ˆë¬¸ |
| answer | str | AI ë‹µë³€ |
| reference_docs | str | ì°¸ê³  ë¬¸ì„œ |
| difficulty | str | ë‚œì´ë„ (easy/hard) |

**ë°˜í™˜ê°’**: `dict` - í‰ê°€ ê²°ê³¼ ë”•ì…”ë„ˆë¦¬

**ì²˜ë¦¬ íë¦„**:

| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|-----|------|------|
| 1 | í”„ë¡¬í”„íŠ¸ í¬ë§·íŒ… | EVALUATION_PROMPT.format()ìœ¼ë¡œ ì…ë ¥ê°’ ì‚½ì… |
| 2 | LLM í˜¸ì¶œ | self.llm.invoke(prompt) |
| 3 | JSON íŒŒì‹± | response.contentë¥¼ json.loads()ë¡œ íŒŒì‹± |
| 4 | ì˜¤ë¥˜ ì²˜ë¦¬ | JSONDecodeError ë°œìƒ ì‹œ ê¸°ë³¸ê°’ ë°˜í™˜ (ëª¨ë“  ì ìˆ˜ 0) |

---

#### í•¨ìˆ˜: `save_evaluation_results`

**ì—­í• **: í‰ê°€ ê²°ê³¼ë¥¼ PostgreSQLì— ì €ì¥

**íŒŒë¼ë¯¸í„°**:

| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì„¤ëª… |
|---------|------|------|
| evaluation_results | List[dict] | í‰ê°€ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ |

**ì²˜ë¦¬ íë¦„**:

| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|-----|------|------|
| 1 | DB ì—°ê²° | psycopg2.connect() |
| 2 | í…Œì´ë¸” ìƒì„± | evaluation_results í…Œì´ë¸” (CREATE TABLE IF NOT EXISTS) |
| 3 | ë°ì´í„° ì‚½ì… | í‰ê°€ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ ìˆœíšŒí•˜ë©° INSERT |
| 4 | ì»¤ë°‹ | conn.commit() |
| 5 | ì—°ê²° ì¢…ë£Œ | cursor.close(), conn.close() |

**í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ (evaluation_results)**:

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|-----|------|------|
| eval_id | SERIAL PRIMARY KEY | í‰ê°€ ID (ìë™ ì¦ê°€) |
| question | TEXT NOT NULL | ì‚¬ìš©ì ì§ˆë¬¸ |
| answer | TEXT NOT NULL | AI ë‹µë³€ |
| accuracy_score | INT | ì •í™•ë„ ì ìˆ˜ (0-10) |
| relevance_score | INT | ê´€ë ¨ì„± ì ìˆ˜ (0-10) |
| difficulty_score | INT | ë‚œì´ë„ ì í•©ì„± ì ìˆ˜ (0-10) |
| citation_score | INT | ì¶œì²˜ ëª…ì‹œ ì ìˆ˜ (0-10) |
| total_score | INT | ì´ì  |
| comment | TEXT | í‰ê°€ ì½”ë©˜íŠ¸ |
| created_at | TIMESTAMP | ìƒì„± ì‹œê°„ (ê¸°ë³¸ê°’: CURRENT_TIMESTAMP) |

---

#### ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ ì˜ˆì‹œ

**ì‹¤í–‰ ìˆœì„œ**:
1. ExperimentManager ì´ˆê¸°í™” (with ë¬¸)
2. AnswerEvaluator ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
3. evaluate() ë©”ì„œë“œë¡œ ë‹µë³€ í‰ê°€
4. í‰ê°€ ê²°ê³¼ë¥¼ ë¡œê·¸ì— ê¸°ë¡
5. save_evaluation_results()ë¡œ DB ì €ì¥

### ì°¸ê³  ìë£Œ
- LangChain Evaluation: https://python.langchain.com/docs/guides/evaluation/

---

## ì„ íƒ ê¸°ëŠ¥ 3: Reranking (ê²€ìƒ‰ ìµœì í™”) (â­â­)

### ê¸°ëŠ¥ ì„¤ëª…
RAG ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì¬ìˆœìœ„í™”í•˜ì—¬ ë” ê´€ë ¨ì„± ë†’ì€ ë¬¸ì„œë¥¼ ìƒìœ„ì— ë°°ì¹˜

### Langchain êµ¬í˜„

#### 1. Cohere Rerank ì‚¬ìš©

**íŒŒì¼ ê²½ë¡œ**: `src/rag/reranking.py`

**êµ¬í˜„ ë°©ë²•**:
1. `create_rerank_retriever` í•¨ìˆ˜ ì •ì˜
   - ì¸ì: base_retriever
2. CohereRerank ì••ì¶•ê¸° ìƒì„±
   - model: "rerank-english-v2.0"
   - API í‚¤ë¥¼ í™˜ê²½ë³€ìˆ˜ì—ì„œ ë¡œë“œ
3. ContextualCompressionRetriever ìƒì„±
   - base_compressor: CohereRerank
   - base_retriever: ì „ë‹¬ë°›ì€ Retriever
4. ì‚¬ìš© ì˜ˆì‹œ
   - PGVectorë¡œ VectorStore ìƒì„±
   - base_retriever ìƒì„± (k=20)
   - create_rerank_retriever()ë¡œ Reranking ì ìš©
   - ìƒìœ„ 20ê°œ ì¤‘ ì¬ìˆœìœ„í™”í•˜ì—¬ ìƒìœ„ 5ê°œ ë°˜í™˜

#### 2. LLMChainExtractor (ì»¤ìŠ¤í…€)

**êµ¬í˜„ ë°©ë²•**:
1. `create_llm_extractor_retriever` í•¨ìˆ˜ ì •ì˜
   - ì¸ì: base_retriever, llm
2. LLMChainExtractor ìƒì„±
   - LLMì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ì„œ ì••ì¶•
3. ContextualCompressionRetriever ìƒì„±
   - base_compressor: LLMChainExtractor
   - base_retriever: ì „ë‹¬ë°›ì€ Retriever
4. ë°˜í™˜

### êµ¬í˜„í•´ì•¼ í•  ê¸°ëŠ¥
1. Cohere API í‚¤ ì„¤ì •
2. ContextualCompressionRetriever êµ¬í˜„
3. RAG ê²€ìƒ‰ ë„êµ¬ì— Reranking ì ìš©
4. ì„±ëŠ¥ ë¹„êµ (Before/After)

### ì˜ˆìƒ ì†Œìš” ì‹œê°„
**1-2ì¼**

### ì°¸ê³  ìë£Œ
- ContextualCompressionRetriever: https://python.langchain.com/docs/modules/data_connection/retrievers/contextual_compression/

---

## ì„ íƒ ê¸°ëŠ¥ 4: ë…¼ë¬¸ ë¹„êµ ë„êµ¬ (â­)

### ê¸°ëŠ¥ ì„¤ëª…
ì—¬ëŸ¬ ë…¼ë¬¸ì˜ ì°¨ì´ì ì„ ë¹„êµí•˜ì—¬ í‘œë¡œ ì •ë¦¬

### ì‚¬ìš© ì‹œì 
- "BERTì™€ GPT ë¹„êµí•´ì¤˜"
- "Transformerì™€ RNNì˜ ì°¨ì´ëŠ”?"

### Langchain êµ¬í˜„

**íŒŒì¼ ê²½ë¡œ**: `src/tools/paper_comparison.py`

**êµ¬í˜„ ë°©ë²•**:
1. `compare_papers` í•¨ìˆ˜ë¥¼ @tool ë°ì½”ë ˆì´í„°ë¡œ ì •ì˜
   - ì¸ì: paper1_title, paper2_title
2. RAG Retrieverë¡œ ë‘ ë…¼ë¬¸ ê²€ìƒ‰
   - paper1_docs = rag_retriever.retrieve(paper1_title)
   - paper2_docs = rag_retriever.retrieve(paper2_title)
3. ë¹„êµ í”„ë¡¬í”„íŠ¸ êµ¬ì„±
   - ë‘ ë…¼ë¬¸ì˜ ì œëª©ê³¼ ë‚´ìš© í¬í•¨
   - ë¹„êµ í•­ëª©: ì£¼ìš” ê¸°ì—¬, ëª¨ë¸ êµ¬ì¡°, ì¥ì , ë‹¨ì , ì„±ëŠ¥
   - Markdown í‘œ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥ ìš”ì²­
4. LLM í˜¸ì¶œí•˜ì—¬ ë¹„êµ ê²°ê³¼ ìƒì„±
5. ê²°ê³¼ ë°˜í™˜

### ì˜ˆìƒ ì†Œìš” ì‹œê°„
**1ì¼**

---

## ì„ íƒ ê¸°ëŠ¥ 5: ëŒ€í™” ì´ë ¥ ì‹œê°í™” (â­)

### ê¸°ëŠ¥ ì„¤ëª…
ì‚¬ìš©ì ì§ˆë¬¸ íŒ¨í„´, ìì£¼ ì‚¬ìš©ë˜ëŠ” ë„êµ¬ ë“±ì„ ì‹œê°í™”

### Streamlit êµ¬í˜„

**íŒŒì¼ ê²½ë¡œ**: `ui/analytics.py`

**êµ¬í˜„ ë°©ë²•**:
1. `show_analytics` í•¨ìˆ˜ ì •ì˜
2. Streamlit í—¤ë” í‘œì‹œ ("ëŒ€í™” ì´ë ¥ ë¶„ì„")
3. PostgreSQL ì—°ê²°
4. ë„êµ¬ ì‚¬ìš© í†µê³„ ì¡°íšŒ
   - query_logs í…Œì´ë¸”ì—ì„œ tool_usedë³„ COUNT
   - pandas.read_sql()ë¡œ DataFrame ìƒì„±
   - plotly.express.bar()ë¡œ ë§‰ëŒ€ ê·¸ë˜í”„ ìƒì„±
   - st.plotly_chart()ë¡œ í‘œì‹œ
5. ë‚œì´ë„ë³„ ì§ˆë¬¸ ë¶„í¬ ì¡°íšŒ
   - query_logs í…Œì´ë¸”ì—ì„œ difficulty_modeë³„ COUNT
   - pandas.read_sql()ë¡œ DataFrame ìƒì„±
   - plotly.express.pie()ë¡œ íŒŒì´ ì°¨íŠ¸ ìƒì„±
   - st.plotly_chart()ë¡œ í‘œì‹œ
6. ì—°ê²° ì¢…ë£Œ

### ì˜ˆìƒ ì†Œìš” ì‹œê°„
**1ì¼**

---

## ì„ íƒ ê¸°ëŠ¥ 6: ë©€í‹°ëª¨ë‹¬ ì§€ì› (ì´ë¯¸ì§€ ë…¼ë¬¸) (â­â­â­)

### ê¸°ëŠ¥ ì„¤ëª…
ë…¼ë¬¸ ë‚´ ê·¸ë˜í”„, í‘œ, ìˆ˜ì‹ ì´ë¯¸ì§€ë¥¼ GPT-5 Visionìœ¼ë¡œ ë¶„ì„

### Langchain êµ¬í˜„

**êµ¬í˜„ ë°©ë²•**:
1. ChatOpenAI ì´ˆê¸°í™”
   - model: "gpt-5-vision-preview"
2. `analyze_paper_image` í•¨ìˆ˜ ì •ì˜
   - ì¸ì: image_path, question
3. ì´ë¯¸ì§€ ë¡œë“œ ë° Base64 ì¸ì½”ë”©
   - íŒŒì¼ì„ ì½ì–´ì„œ base64ë¡œ ì¸ì½”ë”©
4. HumanMessage ìƒì„±
   - contentì— textì™€ image_url í¬í•¨
   - text: ì§ˆë¬¸
   - image_url: Base64 ì¸ì½”ë”©ëœ ì´ë¯¸ì§€
5. GPT-5 Vision í˜¸ì¶œ
   - llm_vision.invoke([message])
6. ì‘ë‹µ ë‚´ìš© ë°˜í™˜

### ì˜ˆìƒ ì†Œìš” ì‹œê°„
**2-3ì¼**

---

## ìš°ì„ ìˆœìœ„ ì¶”ì²œ

### High Priority (ê°€ì‚°ì  í¬ê³  êµ¬í˜„ ê°€ëŠ¥)
1. **Text-to-SQL** (â­â­â­) - 2-3ì¼
2. **ì„±ëŠ¥ í‰ê°€ ì‹œìŠ¤í…œ** (â­â­) - 2-3ì¼

### Medium Priority (êµ¬í˜„ ê°„ë‹¨)
3. **Reranking** (â­â­) - 1-2ì¼
4. **ë…¼ë¬¸ ë¹„êµ ë„êµ¬** (â­) - 1ì¼
5. **ëŒ€í™” ì´ë ¥ ì‹œê°í™”** (â­) - 1ì¼

### Low Priority (ì‹œê°„ ë§ì´ ì†Œìš”)
6. **ë©€í‹°ëª¨ë‹¬ ì§€ì›** (â­â­â­) - 2-3ì¼

---

## ì„ íƒ ê°€ì´ë“œ

### ì‹œê°„ì´ 2ì¼ ë‚¨ì•˜ë‹¤ë©´
â†’ **Text-to-SQL** ë˜ëŠ” **ì„±ëŠ¥ í‰ê°€ ì‹œìŠ¤í…œ**

### ì‹œê°„ì´ 1ì¼ ë‚¨ì•˜ë‹¤ë©´
â†’ **Reranking** ë˜ëŠ” **ë…¼ë¬¸ ë¹„êµ ë„êµ¬**

### ì‹œê°„ì´ ì—¬ìœ  ìˆë‹¤ë©´
â†’ **ë©€í‹°ëª¨ë‹¬ ì§€ì›**

---

## ì°¸ê³  ì‚¬í•­

- ì„ íƒ ê¸°ëŠ¥ì€ **í•„ìˆ˜ê°€ ì•„ë‹™ë‹ˆë‹¤**
- í•µì‹¬ ê¸°ëŠ¥ì„ ë¨¼ì € ì™„ì„±í•œ í›„ ì‹œê°„ì´ ë‚¨ì„ ë•Œë§Œ êµ¬í˜„
- íŒ€ì›ë“¤ê³¼ ìƒì˜í•˜ì—¬ ì—­í•  ë¶„ë°°
- êµ¬í˜„ ì‹œ **Feature ë¸Œëœì¹˜ ìƒì„±** í•„ìˆ˜

---

## ë¡œê¹… ë° ì‹¤í—˜ ì¶”ì  ê´€ë¦¬

### ExperimentManager ì‚¬ìš©

**ì¤‘ìš”**: ëª¨ë“  ì¶”ê°€ ê¸°ëŠ¥ ê°œë°œì€ ExperimentManager í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

**íŒŒì¼ ê²½ë¡œ**: `src/utils/experiment_manager.py`

**ì‚¬ìš© ë°©ë²•**:
1. ExperimentManager ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (with ë¬¸ ì‚¬ìš©)
   - Session ID ìë™ ë¶€ì—¬ ë° í´ë” êµ¬ì¡° ìë™ ìƒì„±
   ```python
   from src.utils.experiment_manager import ExperimentManager

   # ExperimentManager ì´ˆê¸°í™” (with ë¬¸)
   with ExperimentManager() as exp:
       # ìë™ìœ¼ë¡œ ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰:
       # 1. experiments/20251031/20251031_103015_session_001/ ìƒì„±
       # 2. Session ID ìë™ ë¶€ì—¬ (session_001, 002...)
       # 3. chatbot.log íŒŒì¼ ìƒì„±
       # 4. 7ê°œ ì„œë¸Œ í´ë” ìƒì„± (tools/, database/, prompts/, ui/, outputs/, evaluation/, debug/)
       # 5. metadata.json ì´ˆê¸°í™”
       # 6. Logger ì´ˆê¸°í™”

       # ì¶”ê°€ ê¸°ëŠ¥ ë¡œê·¸ ì‘ì„±
       exp.logger.write("Text-to-SQL ë„êµ¬ ì‹¤í–‰")

       # ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—… ë¡œê·¸
       exp.db_logger.write("SQL ì¿¼ë¦¬ ìƒì„± ë° ì‹¤í–‰")

       # í‰ê°€ ê²°ê³¼ ì €ì¥
       exp.save_evaluation_metrics(evaluation_results)

       # ì‹¤í—˜ ì¢…ë£Œ (ìë™ìœ¼ë¡œ logger.close() í˜¸ì¶œ)
   ```

2. ì„¸ì…˜ í´ë” êµ¬ì¡°
   ```
   experiments/
   â””â”€â”€ 20251031/
       â”œâ”€â”€ 20251031_103015_session_001/
       â”‚   â”œâ”€â”€ chatbot.log          # ì±—ë´‡ ì‹¤í–‰ ë¡œê·¸
       â”‚   â”œâ”€â”€ metadata.json        # ì„¸ì…˜ ë©”íƒ€ë°ì´í„°
       â”‚   â”œâ”€â”€ tools/               # ë„êµ¬ ì‹¤í–‰ ë¡œê·¸
       â”‚   â”‚   â””â”€â”€ tool_execution.log
       â”‚   â”œâ”€â”€ database/            # DB ì¿¼ë¦¬ ë¡œê·¸
       â”‚   â”‚   â””â”€â”€ database.log
       â”‚   â”œâ”€â”€ prompts/             # í”„ë¡¬í”„íŠ¸ ì €ì¥
       â”‚   â”œâ”€â”€ ui/                  # UI ìŠ¤í¬ë¦°ìƒ·
       â”‚   â”œâ”€â”€ outputs/             # ìµœì¢… ê²°ê³¼ë¬¼ ì €ì¥
       â”‚   â”œâ”€â”€ evaluation/          # í‰ê°€ ì§€í‘œ
       â”‚   â”‚   â””â”€â”€ evaluation_results.json
       â”‚   â””â”€â”€ debug/               # ë””ë²„ê·¸ ë¡œê·¸
       â””â”€â”€ 20251031_103520_session_002/
           â””â”€â”€ ...
   ```

3. ì¶”ê°€ ê¸°ëŠ¥ë³„ ë¡œê¹…
   - Text-to-SQL: `exp.db_logger.write("SQL ì¿¼ë¦¬ ì‹¤í–‰")`
   - ì„±ëŠ¥ í‰ê°€: `exp.save_evaluation_metrics(results)`
   - Reranking: `exp.tool_logger.write("Reranking ì ìš©")`

4. ì¶”ê°€ ê¸°ëŠ¥
   - SQL ì¿¼ë¦¬ ì €ì¥: `exp.db_logger.write(f"SQL: {sql_query}")`
   - í‰ê°€ ê²°ê³¼ ì €ì¥: `exp.save_output(evaluation_results, "evaluation")`
   - ë¹„êµ ê²°ê³¼ ì €ì¥: `exp.save_output(comparison_result, "paper_comparison")`

### ì‹¤í—˜ í´ë” êµ¬ì¡°

ìƒì„¸ ë‚´ìš©ì€ [ì‹¤í—˜_í´ë”_êµ¬ì¡°.md](../rules/ì‹¤í—˜_í´ë”_êµ¬ì¡°.md) ì°¸ì¡°

---

## ì°¸ê³  PRD ë¬¸ì„œ

ê°œë°œ ì‹œ ë°˜ë“œì‹œ ì°¸ê³ í•´ì•¼ í•  PRD ë¬¸ì„œ ëª©ë¡:

### í•„ìˆ˜ ì°¸ê³  ë¬¸ì„œ
1. [01_í”„ë¡œì íŠ¸_ê°œìš”.md](../PRD/01_í”„ë¡œì íŠ¸_ê°œìš”.md) - í”„ë¡œì íŠ¸ ì „ì²´ ê°œìš”
2. [02_í”„ë¡œì íŠ¸_êµ¬ì¡°.md](../PRD/02_í”„ë¡œì íŠ¸_êµ¬ì¡°.md) - í´ë” êµ¬ì¡°
3. [05_ë¡œê¹…_ì‹œìŠ¤í…œ.md](../PRD/05_ë¡œê¹…_ì‹œìŠ¤í…œ.md) â­ - Logger ì‚¬ìš©ë²•
4. [06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md](../PRD/06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md) â­ - ExperimentManager ë° Session í´ë” êµ¬ì¡°
5. [10_ê¸°ìˆ _ìš”êµ¬ì‚¬í•­.md](../PRD/10_ê¸°ìˆ _ìš”êµ¬ì‚¬í•­.md) - ê¸°ìˆ  ìŠ¤íƒ
6. [11_ë°ì´í„°ë² ì´ìŠ¤_ì„¤ê³„.md](../PRD/11_ë°ì´í„°ë² ì´ìŠ¤_ì„¤ê³„.md) - DB ìŠ¤í‚¤ë§ˆ (Text-to-SQLìš©)

### ì°¸ê³  ë¬¸ì„œ
- [03_ë¸Œëœì¹˜_ì „ëµ.md](../PRD/03_ë¸Œëœì¹˜_ì „ëµ.md) - Feature ë¸Œëœì¹˜
- [04_ì¼ì •_ê´€ë¦¬.md](../PRD/04_ì¼ì •_ê´€ë¦¬.md) - ê°œë°œ ì¼ì •
- [ë‹´ë‹¹ì—­í• _01-1_ìµœí˜„í™”_ì‹¤í—˜_ê´€ë¦¬_ì‹œìŠ¤í…œ.md](ë‹´ë‹¹ì—­í• _01-1_ìµœí˜„í™”_ì‹¤í—˜_ê´€ë¦¬_ì‹œìŠ¤í…œ.md) - ExperimentManager í´ë˜ìŠ¤ ìƒì„¸ êµ¬í˜„
- [ë‹´ë‹¹ì—­í• _01-2_ìµœí˜„í™”_ë¡œê¹…_ëª¨ë‹ˆí„°ë§.md](ë‹´ë‹¹ì—­í• _01-2_ìµœí˜„í™”_ë¡œê¹…_ëª¨ë‹ˆí„°ë§.md) - ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ
- [ì‹¤í—˜_í´ë”_êµ¬ì¡°.md](../rules/ì‹¤í—˜_í´ë”_êµ¬ì¡°.md) - ì‹¤í—˜ í´ë” êµ¬ì¡° ìµœì¢…ì•ˆ

---
