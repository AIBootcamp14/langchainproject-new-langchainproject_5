# 06. ì‹¤í—˜ ì¶”ì  ê´€ë¦¬

## ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì¼**: 2025-10-30
- **í”„ë¡œì íŠ¸ëª…**: ë…¼ë¬¸ ë¦¬ë·° ì±—ë´‡ (AI Agent + RAG)
- **íŒ€ëª…**: ì—°ê²°ì˜ ë¯¼ì¡±
- **ì‘ì„±ì**: ìµœí˜„í™”[íŒ€ì¥]

---

## 1. ì‹¤í—˜ í´ë” êµ¬ì¡°

### 1.1 ì‹¤í—˜ í´ë” ìƒì„± íë¦„

```mermaid
graph TB
    subgraph Init["ğŸ”¸ ì´ˆê¸°í™” & í´ë” ìƒì„±"]
        direction LR
        A[ì±—ë´‡ ì‹¤í–‰<br/>ì‹œì‘] --> B[ë‚ ì§œ/ì‹œê°„ ìƒì„±<br/>Session ID ë¶€ì—¬]
        B --> C[í´ë” ìƒì„±<br/>ë‚ ì§œ_ì‹œê°„_session_XXX]
        C --> D[ì„œë¸Œ í´ë” 6ê°œ ìƒì„±<br/>tools, database, prompts, ui, outputs, evaluation]
        D --> E[ğŸ’¾ metadata.json<br/>Logger ì´ˆê¸°í™”]
    end

    subgraph Execute["ğŸ”¹ ì±—ë´‡ ì‹¤í–‰ & ê¸°ë¡"]
        direction LR
        F[ì‚¬ìš©ì ì§ˆë¬¸<br/>ë‚œì´ë„ ì„ íƒ] --> G[AI Agent<br/>ë„êµ¬ ì„ íƒ]
        G --> H[ë„êµ¬ ì‹¤í–‰<br/>RAG/ì›¹ê²€ìƒ‰/ìš©ì–´ì§‘...]
        H --> I[ê° í´ë”ì— ê¸°ë¡<br/>ë¡œê·¸, ì¿¼ë¦¬, í”„ë¡¬í”„íŠ¸, UI]
        I --> J[í‰ê°€ ì§€í‘œ ìˆ˜ì§‘<br/>Recall, ë¹„ìš©, ì‘ë‹µì‹œê°„]
    end

    subgraph Finish["ğŸ”º ì¢…ë£Œ & ì €ì¥"]
        direction LR
        K[ìµœì¢… ë‹µë³€ ìƒì„±] --> L[ğŸ’¾ outputs/<br/>response.txt ì €ì¥]
        L --> M[metadata.json<br/>ì—…ë°ì´íŠ¸]
        M --> N[Logger ì¢…ë£Œ<br/>ì‹¤í—˜ ì™„ë£Œ]
    end

    Init --> Execute
    Execute --> Finish

    %% Subgraph ìŠ¤íƒ€ì¼
    style Init fill:#e1f5ff,stroke:#01579b,stroke-width:3px,color:#000
    style Execute fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000
    style Finish fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì´ˆê¸°í™” - íŒŒë‘ ê³„ì—´)
    style A fill:#90caf9,stroke:#1976d2,color:#000
    style B fill:#81d4fa,stroke:#0288d1,color:#000
    style C fill:#64b5f6,stroke:#1976d2,color:#000
    style D fill:#42a5f5,stroke:#1565c0,color:#000
    style E fill:#42a5f5,stroke:#1565c0,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì‹¤í–‰ - ë³´ë¼ ê³„ì—´)
    style F fill:#ce93d8,stroke:#7b1fa2,color:#000
    style G fill:#ba68c8,stroke:#7b1fa2,color:#fff
    style H fill:#ab47bc,stroke:#4a148c,color:#fff
    style I fill:#9c27b0,stroke:#4a148c,color:#fff
    style J fill:#9c27b0,stroke:#4a148c,color:#fff

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì¢…ë£Œ - ë…¹ìƒ‰ ê³„ì—´)
    style K fill:#a5d6a7,stroke:#388e3c,color:#000
    style L fill:#81c784,stroke:#2e7d32,color:#000
    style M fill:#66bb6a,stroke:#2e7d32,color:#fff
    style N fill:#66bb6a,stroke:#2e7d32,color:#fff
```

**ì‹¤í—˜ í´ë” ìƒì„± íë¦„ ì„¤ëª…:**
- **ì´ˆê¸°í™” ë‹¨ê³„**: ì±—ë´‡ ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ Session ID ë¶€ì—¬ (session_001, 002...) â†’ í´ë” ë° ì„œë¸Œ í´ë” 6ê°œ ìƒì„± â†’ metadata.jsonê³¼ Logger ì´ˆê¸°í™”
- **ì‹¤í–‰ ë‹¨ê³„**: ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥ ë° ë‚œì´ë„ ì„ íƒ â†’ AI Agentê°€ ì ì ˆí•œ ë„êµ¬ ì„ íƒ (RAG, ì›¹ê²€ìƒ‰, ìš©ì–´ì§‘ ë“±) â†’ ì‹¤í–‰ ê³¼ì •ì„ ê° í´ë”ì— ê¸°ë¡ (ë„êµ¬ ë¡œê·¸, DB ì¿¼ë¦¬, í”„ë¡¬í”„íŠ¸, UI ì¸í„°ë™ì…˜) â†’ í‰ê°€ ì§€í‘œ ìˆ˜ì§‘ (Recall@K, ë¹„ìš©, ì‘ë‹µì‹œê°„)
- **ì¢…ë£Œ ë‹¨ê³„**: ìµœì¢… ë‹µë³€ ìƒì„± â†’ outputs/response.txt ì €ì¥ â†’ metadata.json ì—…ë°ì´íŠ¸ â†’ Logger ì¢…ë£Œ ë° ì‹¤í—˜ ì™„ë£Œ

### 1.2 í•„ìˆ˜ í´ë” êµ¬ì¡°

ëª¨ë“  ì±—ë´‡ ì‹¤í–‰ ê²°ê³¼ëŠ” `experiments/ë‚ ì§œ/ë‚ ì§œ_ì‹œê°„_session_XXX/` êµ¬ì¡°ë¡œ ì €ì¥:

```
experiments/
â””â”€â”€ 20251031/                                # ë‚ ì§œ (YYYYMMDD)
    â””â”€â”€ 20251031_103015_session_001/         # ì‹œê°„_session_ID
        â”‚
        â”œâ”€â”€ metadata.json                    # â­ ì „ì²´ ì‹¤í—˜ ë©”íƒ€ë°ì´í„°
        â”œâ”€â”€ chatbot.log                      # ë©”ì¸ ì‹¤í–‰ ë¡œê·¸
        â”œâ”€â”€ config.yaml                      # ì „ì²´ ì„¤ì •
        â”‚
        â”œâ”€â”€ tools/                           # ğŸ”§ ë„êµ¬ ì‹¤í–‰ ë¡œê·¸
        â”‚   â”œâ”€â”€ rag_paper.log                # ë…¼ë¬¸ ê²€ìƒ‰ ë¡œê·¸
        â”‚   â”œâ”€â”€ rag_glossary.log             # ìš©ì–´ì§‘ ê²€ìƒ‰ ë¡œê·¸
        â”‚   â”œâ”€â”€ web_search.log               # ì›¹ ê²€ìƒ‰ ë¡œê·¸
        â”‚   â”œâ”€â”€ summary_paper.log            # ë…¼ë¬¸ ìš”ì•½ ë¡œê·¸
        â”‚   â”œâ”€â”€ file_save.log                # íŒŒì¼ ì €ì¥ ë¡œê·¸
        â”‚   â””â”€â”€ general.log                  # ì¼ë°˜ ë‹µë³€ ë¡œê·¸
        â”‚
        â”œâ”€â”€ database/                        # ğŸ—„ï¸ DB ê´€ë ¨ ê¸°ë¡
        â”‚   â”œâ”€â”€ queries.sql                  # ì‹¤í–‰ëœ SQL ì¿¼ë¦¬ ëª¨ìŒ
        â”‚   â”œâ”€â”€ pgvector_searches.json       # pgvector ê²€ìƒ‰ ê¸°ë¡
        â”‚   â”œâ”€â”€ search_results.json          # DB ê²€ìƒ‰ ê²°ê³¼
        â”‚   â””â”€â”€ db_performance.json          # ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ ë“±
        â”‚
        â”œâ”€â”€ prompts/                         # ğŸ’¬ í”„ë¡¬í”„íŠ¸ ê¸°ë¡
        â”‚   â”œâ”€â”€ system_prompt.txt            # ì‚¬ìš©ëœ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
        â”‚   â”œâ”€â”€ user_prompt.txt              # ì‚¬ìš©ì ì§ˆë¬¸ + ì»¨í…ìŠ¤íŠ¸
        â”‚   â”œâ”€â”€ final_prompt.txt             # LLMì— ì „ë‹¬ëœ ìµœì¢… í”„ë¡¬í”„íŠ¸
        â”‚   â””â”€â”€ prompt_template.yaml         # í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì •ë³´
        â”‚
        â”œâ”€â”€ ui/                              # ğŸ–¥ï¸ UI ê´€ë ¨ ê¸°ë¡
        â”‚   â”œâ”€â”€ streamlit_session.json       # Streamlit ì„¸ì…˜ ìƒíƒœ
        â”‚   â”œâ”€â”€ user_interactions.log        # ì‚¬ìš©ì ì¸í„°ë™ì…˜ ë¡œê·¸
        â”‚   â””â”€â”€ ui_events.json               # UI ì´ë²¤íŠ¸ ê¸°ë¡
        â”‚
        â”œâ”€â”€ outputs/                         # ğŸ“„ ìƒì„±ëœ ê²°ê³¼ë¬¼
        â”‚   â”œâ”€â”€ response.txt                 # ìµœì¢… ë‹µë³€
        â”‚   â”œâ”€â”€ summary.md                   # ìš”ì•½ë³¸ (ìˆì„ ê²½ìš°)
        â”‚   â””â”€â”€ saved_file.txt               # ì‚¬ìš©ìê°€ ì €ì¥ ìš”ì²­í•œ íŒŒì¼
        â”‚
        â”œâ”€â”€ evaluation/                      # ğŸ“Š í‰ê°€ ì§€í‘œ
        â”‚   â”œâ”€â”€ rag_metrics.json             # RAG í‰ê°€ ì§€í‘œ
        â”‚   â”œâ”€â”€ agent_accuracy.json          # Agent ì •í™•ë„
        â”‚   â”œâ”€â”€ latency_report.json          # ì‘ë‹µ ì‹œê°„ ë¶„ì„
        â”‚   â”œâ”€â”€ cost_analysis.json           # ë¹„ìš© ë¶„ì„
        â”‚   â””â”€â”€ test_results.json            # í…ŒìŠ¤íŠ¸ ê²°ê³¼
        â”‚
        â””â”€â”€ debug/                           # ğŸ› ë””ë²„ê·¸ ì •ë³´ (ì„ íƒ)
            â”œâ”€â”€ agent_trace.json             # Agent ì‹¤í–‰ ì¶”ì 
            â”œâ”€â”€ llm_tokens.json              # í† í° ì‚¬ìš©ëŸ‰
            â””â”€â”€ error_trace.log              # ì—ëŸ¬ ë°œìƒ ì‹œ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤
```

### 1.3 metadata.json (í•µì‹¬ ë©”íƒ€ë°ì´í„°)

ê° ì‹¤í—˜ì˜ í•µì‹¬ ì •ë³´ë¥¼ í•œ ê³³ì— ìš”ì•½:

```json
{
  "session_id": "001",
  "start_time": "2025-10-31T10:30:15",
  "end_time": "2025-10-31T10:32:45",
  "difficulty": "easy",
  "tool_used": "rag_paper",
  "user_query": "RAGì— ëŒ€í•´ ì•Œë ¤ì¤˜",
  "success": true,
  "response_time_ms": 2500,
  "response_length": 450,
  "model": "gpt-5",
  "temperature": 0.7,
  "tokens_used": {
    "prompt": 1200,
    "completion": 800,
    "total": 2000
  },
  "db_queries_count": 4,
  "db_total_time_ms": 120
}
```

---

## 2. Session ID ìë™ ë¶€ì—¬ ê·œì¹™

### 2.1 ìë™ ìƒì„± ë°©ì‹

ì±—ë´‡ ì‹¤í–‰ ì‹œë§ˆë‹¤ **Session IDê°€ ìë™ìœ¼ë¡œ ë¶€ì—¬**ë©ë‹ˆë‹¤:

- **í˜•ì‹**: `session_001`, `session_002`, `session_003` ...
- **ë¶€ì—¬ ë°©ì‹**: ë‹¹ì¼ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ìˆœì°¨ì ìœ¼ë¡œ ì¦ê°€
- **ì‹œì‘ ë²ˆí˜¸**: ë§¤ì¼ `001`ë¶€í„° ì‹œì‘

### 2.2 ì˜ˆì‹œ

```
experiments/20251031/
â”œâ”€â”€ 20251031_103015_session_001/   # ì˜¤ëŠ˜ ì²« ë²ˆì§¸ ì‹¤í–‰
â”œâ”€â”€ 20251031_110234_session_002/   # ì˜¤ëŠ˜ ë‘ ë²ˆì§¸ ì‹¤í–‰
â””â”€â”€ 20251031_143520_session_003/   # ì˜¤ëŠ˜ ì„¸ ë²ˆì§¸ ì‹¤í–‰

experiments/20251101/
â””â”€â”€ 20251101_090012_session_001/   # ë‹¤ìŒ ë‚ , ë‹¤ì‹œ 001ë¶€í„° ì‹œì‘
```

### 2.3 ì¤‘ë³µ ë°©ì§€

ExperimentManager í´ë˜ìŠ¤ê°€ ìë™ìœ¼ë¡œ:
1. ë‹¹ì¼ í´ë”(`experiments/20251031/`) ìŠ¤ìº”
2. ê¸°ì¡´ session í´ë” í™•ì¸
3. ê°€ì¥ í° ë²ˆí˜¸ + 1ë¡œ ìƒˆ session ID ë¶€ì—¬

---

## 3. ExperimentManager ì‚¬ìš©ë²•

### 3.1 ê¸°ë³¸ ì‚¬ìš© (ìë™ í´ë” ìƒì„±)

**ì‚¬ìš© ë°©ë²•**: with ë¬¸ìœ¼ë¡œ ExperimentManagerë¥¼ ì´ˆê¸°í™”í•˜ì—¬ ìë™ìœ¼ë¡œ ì‹¤í—˜ í´ë” ìƒì„± ë° ì¢…ë£Œ ì²˜ë¦¬

| ë‹¨ê³„ | ë™ì‘ | ì„¤ëª… |
|------|------|------|
| 1. ì´ˆê¸°í™” | with ExperimentManager() as exp | Context managerë¡œ ìë™ ì´ˆê¸°í™” |
| 2. í´ë” ìƒì„± | ìë™ | experiments/ë‚ ì§œ/ë‚ ì§œ_ì‹œê°„_session_XXX/ ìƒì„± |
| 3. ì„œë¸Œ í´ë” ìƒì„± | ìë™ | tools, database, prompts, ui, outputs, evaluation ìƒì„± |
| 4. ë©”íƒ€ë°ì´í„° ì´ˆê¸°í™” | ìë™ | metadata.json íŒŒì¼ ìƒì„± |
| 5. Logger ì´ˆê¸°í™” | ìë™ | ë©”ì¸ Logger ìƒì„± |
| 6. ë¡œê·¸ ê¸°ë¡ | exp.logger.write("ë©”ì‹œì§€") | ë©”ì¸ ë¡œê·¸ì— ê¸°ë¡ |
| 7. ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸ | exp.update_metadata(user_query, difficulty) | ì‹¤í—˜ ì •ë³´ ì—…ë°ì´íŠ¸ |
| 8. ì¢…ë£Œ | ìë™ (with ë¸”ë¡ ì¢…ë£Œ ì‹œ) | Logger ì¢…ë£Œ ë° ë¦¬ì†ŒìŠ¤ ì •ë¦¬ |

**ì£¼ìš” ë©”ì„œë“œ:**

| ë©”ì„œë“œ | íŒŒë¼ë¯¸í„° | ì„¤ëª… |
|--------|----------|------|
| `ExperimentManager()` | ì—†ìŒ | ExperimentManager ì¸ìŠ¤í„´ìŠ¤ ìƒì„± |
| `logger.write(message)` | message: str | ë©”ì¸ ë¡œê·¸ì— ë©”ì‹œì§€ ê¸°ë¡ |
| `update_metadata(**kwargs)` | user_query, difficulty ë“± | metadata.json ì—…ë°ì´íŠ¸ |

### 3.2 ë„êµ¬ë³„ Logger ì‚¬ìš©

**ì‚¬ìš© ë°©ë²•**: ê° ë„êµ¬ë³„ë¡œ ë…ë¦½ì ì¸ Loggerë¥¼ ìƒì„±í•˜ì—¬ tools/ í´ë”ì— ê°œë³„ ë¡œê·¸ íŒŒì¼ ìƒì„±

| ë©”ì„œë“œ | íŒŒë¼ë¯¸í„° | ì„¤ëª… |
|--------|----------|------|
| `get_tool_logger(tool_name)` | tool_name: str | ë„êµ¬ë³„ ë…ë¦½ Logger ìƒì„± |
| `tool_logger.write(message)` | message: str | í•´ë‹¹ ë„êµ¬ ë¡œê·¸ íŒŒì¼ì— ê¸°ë¡ |
| `tool_logger.close()` | ì—†ìŒ | Logger ì¢…ë£Œ ë° íŒŒì¼ ë‹«ê¸° |

**ì§€ì›ë˜ëŠ” ë„êµ¬ ì´ë¦„:**

| ë„êµ¬ ì´ë¦„ | ë¡œê·¸ íŒŒì¼ | ì„¤ëª… |
|-----------|----------|------|
| `rag_paper` | tools/rag_paper.log | ë…¼ë¬¸ ê²€ìƒ‰ ë¡œê·¸ |
| `rag_glossary` | tools/rag_glossary.log | ìš©ì–´ì§‘ ê²€ìƒ‰ ë¡œê·¸ |
| `web_search` | tools/web_search.log | ì›¹ ê²€ìƒ‰ ë¡œê·¸ |
| `summary_paper` | tools/summary_paper.log | ë…¼ë¬¸ ìš”ì•½ ë¡œê·¸ |
| `file_save` | tools/file_save.log | íŒŒì¼ ì €ì¥ ë¡œê·¸ |
| `general` | tools/general.log | ì¼ë°˜ ë‹µë³€ ë¡œê·¸ |

### 3.3 DB ì¿¼ë¦¬ ê¸°ë¡

**ì‚¬ìš© ë°©ë²•**: DB ê´€ë ¨ ì‘ì—…ì„ database/ í´ë”ì— ê¸°ë¡

| ë©”ì„œë“œ | íŒŒë¼ë¯¸í„° | ì„¤ëª… |
|--------|----------|------|
| `log_sql_query()` | query, description, tool, execution_time_ms | SQL ì¿¼ë¦¬ ì‹¤í–‰ ê¸°ë¡ (database/queries.sqlì— ì¶”ê°€) |
| `log_pgvector_search()` | search_info (dict) | pgvector ê²€ìƒ‰ ê¸°ë¡ (database/pgvector_searches.jsonì— ì¶”ê°€) |
| `save_search_results()` | tool_name, results (dict) | DB ê²€ìƒ‰ ê²°ê³¼ ì €ì¥ (database/search_results.jsonì— ì €ì¥) |

**log_sql_query íŒŒë¼ë¯¸í„°:**

| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì„¤ëª… |
|---------|------|------|
| query | str | ì‹¤í–‰ëœ SQL ì¿¼ë¦¬ë¬¸ |
| description | str | ì¿¼ë¦¬ ì„¤ëª… (ì˜ˆ: "ë…¼ë¬¸ ë©”íƒ€ë°ì´í„° ì¡°íšŒ") |
| tool | str | ì‹¤í–‰í•œ ë„êµ¬ ì´ë¦„ |
| execution_time_ms | int | ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ (ë°€ë¦¬ì´ˆ) |

**log_pgvector_search íŒŒë¼ë¯¸í„° (dict):**

| í‚¤ | íƒ€ì… | ì„¤ëª… |
|----|------|------|
| tool | str | ë„êµ¬ ì´ë¦„ |
| collection | str | ì»¬ë ‰ì…˜ ì´ë¦„ (ì˜ˆ: "paper_chunks") |
| query_text | str | ê²€ìƒ‰ ì§ˆë¬¸ |
| top_k | int | ë°˜í™˜ ë¬¸ì„œ ìˆ˜ |
| execution_time_ms | int | ê²€ìƒ‰ ì‹¤í–‰ ì‹œê°„ |

### 3.4 í”„ë¡¬í”„íŠ¸ ì €ì¥

**ì‚¬ìš© ë°©ë²•**: í”„ë¡¬í”„íŠ¸ ê´€ë ¨ ì •ë³´ë¥¼ prompts/ í´ë”ì— ì €ì¥

| ë©”ì„œë“œ | íŒŒë¼ë¯¸í„° | ì €ì¥ íŒŒì¼ | ì„¤ëª… |
|--------|----------|-----------|------|
| `save_system_prompt()` | system_prompt, metadata | prompts/system_prompt.txt | ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì €ì¥ |
| `save_user_prompt()` | user_prompt, metadata | prompts/user_prompt.txt | ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ ì €ì¥ (ì§ˆë¬¸ + ì»¨í…ìŠ¤íŠ¸) |
| `save_final_prompt()` | final_prompt | prompts/final_prompt.txt | LLMì— ì „ë‹¬ëœ ìµœì¢… í”„ë¡¬í”„íŠ¸ ì €ì¥ |
| `save_prompt_template()` | template_info (dict) | prompts/prompt_template.yaml | í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì •ë³´ ì €ì¥ |

**ë©”íƒ€ë°ì´í„° ì˜ˆì‹œ:**

| ë©”ì„œë“œ | ë©”íƒ€ë°ì´í„° ì˜ˆì‹œ |
|--------|----------------|
| save_system_prompt | {"ë‚œì´ë„": "easy", "í…œí”Œë¦¿": "EASY_SYSTEM_PROMPT"} |
| save_user_prompt | {"ê²€ìƒ‰ ê²°ê³¼ ìˆ˜": 5} |
| save_prompt_template | {"difficulty": "easy", "llm_config": {"model": "solar-pro2", "temperature": 0.7}} |

### 3.5 UI ì¸í„°ë™ì…˜ ê¸°ë¡

**ì‚¬ìš© ë°©ë²•**: Streamlit UI ì¸í„°ë™ì…˜ì„ ui/ í´ë”ì— ê¸°ë¡

| ë©”ì„œë“œ | íŒŒë¼ë¯¸í„° | ì €ì¥ íŒŒì¼ | ì„¤ëª… |
|--------|----------|-----------|------|
| `log_ui_interaction()` | message: str | ui/user_interactions.log | ì‚¬ìš©ì ì¸í„°ë™ì…˜ ë¡œê·¸ ê¸°ë¡ |
| `log_ui_event()` | event_info (dict) | ui/ui_events.json | UI ì´ë²¤íŠ¸ ê¸°ë¡ |
| `save_streamlit_session()` | session_info (dict) | ui/streamlit_session.json | Streamlit ì„¸ì…˜ ìƒíƒœ ì €ì¥ |

**ì¸í„°ë™ì…˜ ë¡œê·¸ ì˜ˆì‹œ:**

| ë¡œê·¸ ë©”ì‹œì§€ | ì˜ë¯¸ |
|------------|------|
| "í˜ì´ì§€ ì ‘ì†" | ì‚¬ìš©ìê°€ ì±—ë´‡ í˜ì´ì§€ ì ‘ì† |
| "ë‚œì´ë„ ì„ íƒ: easy" | ë‚œì´ë„ ì„ íƒ ìœ„ì ¯ ë³€ê²½ |
| "ì§ˆë¬¸ ì…ë ¥: RAGì— ëŒ€í•´ ì•Œë ¤ì¤˜" | ì§ˆë¬¸ ì…ë ¥ ì™„ë£Œ |

**UI ì´ë²¤íŠ¸ ì •ë³´ (dict):**

| í‚¤ | íƒ€ì… | ì„¤ëª… |
|----|------|------|
| event_type | str | ì´ë²¤íŠ¸ íƒ€ì… (ì˜ˆ: "difficulty_changed") |
| old_value | any | ë³€ê²½ ì „ ê°’ |
| new_value | any | ë³€ê²½ í›„ ê°’ |

**Streamlit ì„¸ì…˜ ì •ë³´ (dict):**

| í‚¤ | íƒ€ì… | ì„¤ëª… |
|----|------|------|
| session_id | str | Streamlit ì„¸ì…˜ ID |
| messages | list | ëŒ€í™” ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬ |

### 3.6 í‰ê°€ ì§€í‘œ ì €ì¥

**ì‚¬ìš© ë°©ë²•**: í‰ê°€ ì§€í‘œë¥¼ evaluation/ í´ë”ì— JSON í˜•ì‹ìœ¼ë¡œ ì €ì¥

| ë©”ì„œë“œ | íŒŒë¼ë¯¸í„° | ì €ì¥ íŒŒì¼ | ì„¤ëª… |
|--------|----------|-----------|------|
| `save_rag_metrics()` | metrics (dict) | evaluation/rag_metrics.json | RAG í‰ê°€ ì§€í‘œ ì €ì¥ |
| `save_agent_accuracy()` | accuracy (dict) | evaluation/agent_accuracy.json | Agent ì •í™•ë„ ì €ì¥ |
| `save_latency_report()` | latency (dict) | evaluation/latency_report.json | ì‘ë‹µ ì‹œê°„ ë¶„ì„ ì €ì¥ |
| `save_cost_analysis()` | cost (dict) | evaluation/cost_analysis.json | ë¹„ìš© ë¶„ì„ ì €ì¥ |

**RAG í‰ê°€ ì§€í‘œ (dict) ì˜ˆì‹œ:**

| í‚¤ | ì„¤ëª… |
|----|------|
| retrieval_metrics | ê²€ìƒ‰ ì§€í‘œ (Recall@K ë“±) |
| generation_metrics | ìƒì„± ì§€í‘œ (Faithfulness ë“±) |

**Agent ì •í™•ë„ (dict) ì˜ˆì‹œ:**

| í‚¤ | ì„¤ëª… |
|----|------|
| routing_decision | ë¼ìš°íŒ… ê²°ì • ì •í™•ë„ (predicted_tool, correct) |

**ì‘ë‹µ ì‹œê°„ ë¶„ì„ (dict) ì˜ˆì‹œ:**

| í‚¤ | ì„¤ëª… |
|----|------|
| total_latency | ì „ì²´ ì‘ë‹µ ì‹œê°„ (total_time_ms, status) |

**ë¹„ìš© ë¶„ì„ (dict) ì˜ˆì‹œ:**

| í‚¤ | ì„¤ëª… |
|----|------|
| llm_usage | LLM ì‚¬ìš©ëŸ‰ (total_tokens) |
| cost_breakdown_krw | ë¹„ìš© ìƒì„¸ (total_cost) |

### 3.7 ê²°ê³¼ë¬¼ ì €ì¥

**ì‚¬ìš© ë°©ë²•**: ìµœì¢… ë‹µë³€ ë° ìƒì„± ê²°ê³¼ë¬¼ì„ outputs/ í´ë”ì— ì €ì¥

| ë©”ì„œë“œ | íŒŒë¼ë¯¸í„° | ì„¤ëª… |
|--------|----------|------|
| `save_output()` | filename, content | outputs/ í´ë”ì— íŒŒì¼ ì €ì¥ |

**ì£¼ìš” ê²°ê³¼ë¬¼:**

| íŒŒì¼ëª… | ë‚´ìš© | ìƒì„± ì‹œì  |
|--------|------|----------|
| response.txt | ìµœì¢… ë‹µë³€ | í•­ìƒ ìƒì„± |
| summary.md | ë…¼ë¬¸ ìš”ì•½ë³¸ | ìš”ì•½ ë„êµ¬ ì‚¬ìš© ì‹œ |
| saved_file.txt | ì‚¬ìš©ì ì €ì¥ ìš”ì²­ íŒŒì¼ | íŒŒì¼ ì €ì¥ ë„êµ¬ ì‚¬ìš© ì‹œ |

---

## 4. ì €ì¥ë˜ëŠ” íŒŒì¼ ë° í´ë”

### 4.1 ìµœìƒìœ„ í•„ìˆ˜ íŒŒì¼

| íŒŒì¼ëª… | ì„¤ëª… | ìƒì„± ë°©ë²• |
|--------|------|----------|
| **metadata.json** | ì‹¤í—˜ í•µì‹¬ ì •ë³´ ìš”ì•½ | `exp.update_metadata()` |
| **chatbot.log** | ë©”ì¸ ì‹¤í–‰ ë¡œê·¸ | `exp.logger.write()` |
| **config.yaml** | ì „ì²´ ì„¤ì • ì •ë³´ | `exp.save_config()` |

### 4.2 tools/ í´ë” (ë„êµ¬ë³„ ë¡œê·¸)

| íŒŒì¼ëª… | ì„¤ëª… | ìƒì„± ì‹œì  |
|--------|------|----------|
| `rag_paper.log` | ë…¼ë¬¸ ê²€ìƒ‰ ë¡œê·¸ | rag_paper ë„êµ¬ ì‹¤í–‰ ì‹œ |
| `rag_glossary.log` | ìš©ì–´ì§‘ ê²€ìƒ‰ ë¡œê·¸ | rag_glossary ë„êµ¬ ì‹¤í–‰ ì‹œ |
| `web_search.log` | ì›¹ ê²€ìƒ‰ ë¡œê·¸ | web_search ë„êµ¬ ì‹¤í–‰ ì‹œ |
| `summary_paper.log` | ë…¼ë¬¸ ìš”ì•½ ë¡œê·¸ | summary_paper ë„êµ¬ ì‹¤í–‰ ì‹œ |
| `file_save.log` | íŒŒì¼ ì €ì¥ ë¡œê·¸ | file_save ë„êµ¬ ì‹¤í–‰ ì‹œ |
| `general.log` | ì¼ë°˜ ë‹µë³€ ë¡œê·¸ | general ë„êµ¬ ì‹¤í–‰ ì‹œ |

**íŠ¹ì§•**: ì‹¤í–‰ëœ ë„êµ¬ë§Œ ë¡œê·¸ íŒŒì¼ ìƒì„± (ë¹ˆ íŒŒì¼ ì—†ìŒ)

### 4.3 database/ í´ë” (DB ê´€ë ¨)

| íŒŒì¼ëª… | ì„¤ëª… | ë‚´ìš© |
|--------|------|------|
| `queries.sql` | ì‹¤í–‰ëœ SQL ì¿¼ë¦¬ ëª¨ìŒ | ì‹œê°„ìˆœ SQL ì¿¼ë¦¬ + ì„¤ëª… |
| `pgvector_searches.json` | pgvector ê²€ìƒ‰ ê¸°ë¡ | ì„ë² ë”©, ê²€ìƒ‰ íƒ€ì…, ê²°ê³¼ ìˆ˜ ë“± |
| `search_results.json` | DB ê²€ìƒ‰ ê²°ê³¼ | ë…¼ë¬¸/ìš©ì–´ ìƒì„¸ ì •ë³´ |
| `db_performance.json` | ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ ë“± | ì¿¼ë¦¬ë³„ ì„±ëŠ¥ ë¶„ì„ |

### 4.4 prompts/ í´ë” (í”„ë¡¬í”„íŠ¸)

| íŒŒì¼ëª… | ì„¤ëª… | ë‚´ìš© |
|--------|------|------|
| `system_prompt.txt` | ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ | Easy/Hard ë‚œì´ë„ë³„ í”„ë¡¬í”„íŠ¸ |
| `user_prompt.txt` | ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ | ì§ˆë¬¸ + ê²€ìƒ‰ëœ ì»¨í…ìŠ¤íŠ¸ |
| `final_prompt.txt` | ìµœì¢… í”„ë¡¬í”„íŠ¸ | LLMì— ì „ë‹¬ëœ ì „ì²´ í”„ë¡¬í”„íŠ¸ |
| `prompt_template.yaml` | í…œí”Œë¦¿ ì •ë³´ | LLM ì„¤ì •, í† í° ìˆ˜ ë“± |

### 4.5 ui/ í´ë” (Streamlit UI)

| íŒŒì¼ëª… | ì„¤ëª… | ë‚´ìš© |
|--------|------|------|
| `streamlit_session.json` | ì„¸ì…˜ ìƒíƒœ | ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬, ìœ„ì ¯ ìƒíƒœ |
| `user_interactions.log` | ì¸í„°ë™ì…˜ ë¡œê·¸ | í´ë¦­, ì…ë ¥ ë“± ì‚¬ìš©ì í–‰ë™ |
| `ui_events.json` | UI ì´ë²¤íŠ¸ | ì´ë²¤íŠ¸ íƒ€ì„ë¼ì¸ |

### 4.6 outputs/ í´ë” (ê²°ê³¼ë¬¼)

| íŒŒì¼ëª… | ì„¤ëª… | ìƒì„± ì‹œì  |
|--------|------|----------|
| `response.txt` | ìµœì¢… ë‹µë³€ | í•­ìƒ ìƒì„± |
| `summary.md` | ë…¼ë¬¸ ìš”ì•½ë³¸ | ìš”ì•½ ë„êµ¬ ì‚¬ìš© ì‹œ |
| `saved_file.txt` | ì €ì¥ ìš”ì²­ íŒŒì¼ | íŒŒì¼ ì €ì¥ ë„êµ¬ ì‚¬ìš© ì‹œ |

### 4.7 evaluation/ í´ë” (í‰ê°€ ì§€í‘œ)

| íŒŒì¼ëª… | ì„¤ëª… | ì£¼ìš” ì§€í‘œ |
|--------|------|----------|
| `rag_metrics.json` | RAG í‰ê°€ | Recall@K, Precision, Faithfulness |
| `agent_accuracy.json` | Agent ì •í™•ë„ | ë„êµ¬ ì„ íƒ ì •í™•ë„, ì‹¤í–‰ íë¦„ |
| `latency_report.json` | ì‘ë‹µ ì‹œê°„ | p50/p95/p99, ë³‘ëª© ë¶„ì„ |
| `cost_analysis.json` | ë¹„ìš© ë¶„ì„ | í† í° ì‚¬ìš©ëŸ‰, USD/KRW ë¹„ìš© |
| `test_results.json` | í…ŒìŠ¤íŠ¸ ê²°ê³¼ | ì‹œë‚˜ë¦¬ì˜¤ë³„ ì„±ê³µ/ì‹¤íŒ¨ |

### 4.8 debug/ í´ë” (ì„ íƒ ì‚¬í•­)

| íŒŒì¼ëª… | ì„¤ëª… | ìƒì„± ì‹œì  |
|--------|------|----------|
| `agent_trace.json` | Agent ì‹¤í–‰ ì¶”ì  | ë””ë²„ê¹… í•„ìš” ì‹œ |
| `llm_tokens.json` | í† í° ì‚¬ìš©ëŸ‰ | ë¹„ìš© ìƒì„¸ ë¶„ì„ ì‹œ |
| `error_trace.log` | ì—ëŸ¬ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ | ì—ëŸ¬ ë°œìƒ ì‹œ |

---

## 5. ì‹¤í—˜ ê²€ìƒ‰ ë° ë¶„ì„

### 5.1 ë©”íƒ€ë°ì´í„° ê¸°ë°˜ ê²€ìƒ‰

**ê²€ìƒ‰ ê¸°ëŠ¥**: `scripts/find_experiments.py` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ metadata.json ê¸°ë°˜ìœ¼ë¡œ ì‹¤í—˜ ê²€ìƒ‰

**ê²€ìƒ‰ í•¨ìˆ˜**: `find_experiments(**kwargs)`

| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì„¤ëª… | ì˜ˆì‹œ |
|---------|------|------|------|
| difficulty | str | ë‚œì´ë„ ê¸°ì¤€ ê²€ìƒ‰ | "easy", "hard" |
| tool | str | ì‚¬ìš©ëœ ë„êµ¬ ê¸°ì¤€ ê²€ìƒ‰ | "rag_paper", "web_search" |
| date | str | ë‚ ì§œ ê¸°ì¤€ ê²€ìƒ‰ | "20251031" |
| min_response_time | int | ìµœì†Œ ì‘ë‹µ ì‹œê°„ (ë°€ë¦¬ì´ˆ) | 5000 |
| max_response_time | int | ìµœëŒ€ ì‘ë‹µ ì‹œê°„ (ë°€ë¦¬ì´ˆ) | 3000 |

**ê²€ìƒ‰ ì˜ˆì‹œ:**

| ê²€ìƒ‰ ì¡°ê±´ | ì„¤ëª… |
|----------|------|
| difficulty="easy" | ë‚œì´ë„ easyë¡œ ì„¤ì •ëœ ì‹¤í—˜ ê²€ìƒ‰ |
| tool="rag_paper" | rag_paper ë„êµ¬ë¥¼ ì‚¬ìš©í•œ ì‹¤í—˜ ê²€ìƒ‰ |
| date="20251031" | 2025ë…„ 10ì›” 31ì¼ ì‹¤í—˜ ê²€ìƒ‰ |
| max_response_time=3000 | ì‘ë‹µ ì‹œê°„ 3ì´ˆ ì´í•˜ ì‹¤í—˜ ê²€ìƒ‰ |
| min_response_time=5000 | ì‘ë‹µ ì‹œê°„ 5ì´ˆ ì´ìƒ ì‹¤í—˜ ê²€ìƒ‰ |

**ë³µí•© ì¡°ê±´ ê²€ìƒ‰**: ì—¬ëŸ¬ íŒŒë¼ë¯¸í„°ë¥¼ ì¡°í•©í•˜ì—¬ í•„í„°ë§ ê°€ëŠ¥

| ì¡°ê±´ ì¡°í•© | ì„¤ëª… |
|----------|------|
| difficulty="easy", tool="rag_paper" | easy ë‚œì´ë„ + rag_paper ë„êµ¬ |
| difficulty="easy", min_response_time=2000, max_response_time=5000 | easy ë‚œì´ë„ + ì‘ë‹µ ì‹œê°„ 2~5ì´ˆ |

### 5.2 í‰ê°€ ì§€í‘œ ì§‘ê³„

**ì§‘ê³„ í•¨ìˆ˜**: `aggregate_metrics(date: str)`

**ë™ì‘ ë°©ì‹:**

| ë‹¨ê³„ | ë™ì‘ | ì„¤ëª… |
|------|------|------|
| 1 | í´ë” ìŠ¤ìº” | experiments/{date}/ ë‚´ ëª¨ë“  session í´ë” íƒìƒ‰ |
| 2 | ì§€í‘œ íŒŒì¼ ì½ê¸° | ê° sessionì˜ evaluation/rag_metrics.json ì½ê¸° |
| 3 | ë°ì´í„° ìˆ˜ì§‘ | ëª¨ë“  ì§€í‘œë¥¼ ë¦¬ìŠ¤íŠ¸ì— ìˆ˜ì§‘ |
| 4 | í‰ê·  ê³„ì‚° | Recall@5, Faithfulness ë“± í‰ê·  ê³„ì‚° |
| 5 | ê²°ê³¼ ë°˜í™˜ | ì´ ì„¸ì…˜ ìˆ˜, í‰ê·  ì§€í‘œ ë°˜í™˜ |

**ë°˜í™˜ ì •ë³´:**

| í‚¤ | ì„¤ëª… |
|----|------|
| total_sessions | ì´ ì‹¤í—˜ ì„¸ì…˜ ê°œìˆ˜ |
| avg_recall_at_5 | Recall@5 í‰ê·  (ê²€ìƒ‰ ì„±ëŠ¥) |
| avg_faithfulness | Faithfulness í‰ê·  (ë‹µë³€ ì¶©ì‹¤ë„) |

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- íŠ¹ì • ë‚ ì§œì˜ ì „ì²´ ì‹¤í—˜ ì„±ëŠ¥ ë¶„ì„
- ì—¬ëŸ¬ ë‚ ì§œ ê°„ ì„±ëŠ¥ ë¹„êµ
- í‰ê°€ ì§€í‘œ íŠ¸ë Œë“œ ë¶„ì„

---

## 6. ì°¸ê³  ë¬¸ì„œ

- [ì‹¤í—˜_í´ë”_êµ¬ì¡°_ìµœì¢…ì•ˆ.md](../references/ì‹¤í—˜_í´ë”_êµ¬ì¡°_ìµœì¢…ì•ˆ.md) - ì „ì²´ í´ë” êµ¬ì¡° ìƒì„¸ ê°€ì´ë“œ
- [05_ë¡œê¹…_ì‹œìŠ¤í…œ.md](05_ë¡œê¹…_ì‹œìŠ¤í…œ.md) - Logger í´ë˜ìŠ¤ ì‚¬ìš©ë²•
- [09_í‰ê°€_ê¸°ì¤€.md](09_í‰ê°€_ê¸°ì¤€.md) - RAG, Agent, DB í‰ê°€ ì§€í‘œ
- [ë‹´ë‹¹ì—­í• _06_ë¡œê¹…_ëª¨ë‹ˆí„°ë§.md](../roles/ë‹´ë‹¹ì—­í• _06_ë¡œê¹…_ëª¨ë‹ˆí„°ë§.md) - ExperimentManager êµ¬í˜„ ë‹´ë‹¹
