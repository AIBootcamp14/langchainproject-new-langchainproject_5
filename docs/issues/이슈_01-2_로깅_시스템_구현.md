## 제목 : 로깅 시스템 구현 (Logger 클래스 + 표준 출력 리디렉션)

---

## 📋 작업 개요
**작업 주제:** Logger 클래스 기반 통합 로깅 시스템 개발
**담당자:** @최현화
**마감일:** 10/30 18:00

## 📅 기간
- 시작일: 2025-10-28
- 종료일: 2025-10-30

---

## 📌 이슈 목적

프로젝트 전체에서 사용할 통합 로깅 시스템을 구현합니다. 타임스탬프 자동 추가, 파일/콘솔 동시 출력, 표준 출력 리디렉션, tqdm 진행률 표시 통합 기능을 제공하는 Logger 클래스를 개발하여 모든 팀원이 일관된 방식으로 로그를 기록할 수 있도록 합니다.

**핵심 목표:**
- Logger 클래스 구현 (타임스탬프, 파일/콘솔 출력)
- 표준 출력/에러 리디렉션 기능
- tqdm 진행률 표시 통합
- 에러 메시지 색상 구분
- 모든 팀원이 사용 가능한 간단한 API

**중요성:**
- **최우선 작업**: 모든 팀원이 Logger를 사용하므로 가장 먼저 구현 필요
- **의존성**: AI Agent, RAG, UI, 데이터 수집 등 모든 모듈이 Logger에 의존
- **품질**: 프로젝트 전체 로그 품질 및 디버깅 효율성 결정

---

## ✅ 작업 항목 체크리스트

### Phase 1: Logger 클래스 기본 구현 (1일)
- [ ] Logger 클래스 파일 생성 (`src/utils/logger.py`)
- [ ] `__init__()` 메서드 구현
  - [ ] log_path 파라미터 처리 (pathlib.Path 사용)
  - [ ] print_also 파라미터 처리 (콘솔 출력 여부)
  - [ ] 로그 폴더 자동 생성 (parents=True, exist_ok=True)
  - [ ] 로그 파일 열기 (UTF-8 인코딩)
  - [ ] stdout/stderr 백업 변수 초기화
- [ ] `write()` 메서드 구현
  - [ ] 빈 메시지 무시 로직
  - [ ] 타임스탬프 자동 추가 (YYYY-MM-DD HH:MM:SS 형식)
  - [ ] 파일에 기록 (flush 포함)
  - [ ] 콘솔 출력 옵션 처리
  - [ ] print_error 파라미터로 에러 메시지 빨간색 표시
- [ ] `flush()` 메서드 구현
  - [ ] 로그 파일 버퍼 즉시 플러시
- [ ] `close()` 메서드 구현
  - [ ] 로그 파일 안전하게 닫기
  - [ ] 중복 close 방지 로직
- [ ] `__del__()` 소멸자 구현
  - [ ] 객체 소멸 시 자동으로 close() 호출

### Phase 2: 고급 기능 구현 (1일)
- [ ] 표준 출력 리디렉션 기능
  - [ ] `start_redirect()` 메서드 구현
    - [ ] sys.stdout, sys.stderr 백업
    - [ ] Logger 인스턴스로 리디렉션
  - [ ] `stop_redirect()` 메서드 구현
    - [ ] 백업된 stdout/stderr 복원
- [ ] tqdm 진행률 표시 통합
  - [ ] `tqdm_redirect()` 메서드 구현
    - [ ] tqdm import 시도 및 예외 처리
    - [ ] Logger와 호환되는 tqdm 객체 반환
- [ ] 에러 메시지 색상 처리
  - [ ] ANSI 색상 코드 적용 (\033[91m = 빨간색)
  - [ ] print_error=True 시 빨간색으로 표시
- [ ] 메시지 포맷팅 개선
  - [ ] 줄바꿈 처리
  - [ ] 긴 메시지 자동 래핑 (선택사항)

### Phase 3: 테스트 및 문서화 (0.5일)
- [ ] 단위 테스트 작성 (`tests/test_logger.py`)
  - [ ] test_logger_write: 기본 로그 기록 테스트
  - [ ] test_logger_timestamp: 타임스탬프 형식 검증
  - [ ] test_logger_file_creation: 로그 파일 생성 확인
  - [ ] test_logger_console_output: 콘솔 출력 테스트
  - [ ] test_logger_redirect: stdout 리디렉션 테스트
  - [ ] test_logger_tqdm: tqdm 통합 테스트
  - [ ] test_logger_error_color: 에러 색상 표시 테스트
  - [ ] test_logger_close: close() 메서드 테스트
- [ ] 통합 테스트
  - [ ] 실제 사용 시나리오 테스트
  - [ ] 여러 Logger 인스턴스 동시 사용 테스트
  - [ ] 파일 핸들 누수 확인
- [ ] 사용 예시 문서 작성
  - [ ] 기본 사용법 예시 코드
  - [ ] 표준 출력 리디렉션 예시
  - [ ] tqdm 통합 예시
  - [ ] 주의사항 및 모범 사례

### Phase 4: 배포 및 팀 공유 (0.5일)
- [ ] 코드 리뷰 및 수정
  - [ ] 코드 주석 완성도 확인
  - [ ] PEP 8 스타일 가이드 준수 확인
  - [ ] 타입 힌팅 추가 (typing 모듈)
- [ ] 사용법 공유
  - [ ] 팀원들에게 Logger 사용법 전달
  - [ ] 예시 코드 공유
  - [ ] 질문 답변 및 피드백 수렴
- [ ] 다른 모듈과의 통합 확인
  - [ ] ExperimentManager에서 Logger 사용 확인
  - [ ] AI Agent 모듈에서 Logger 사용 확인
  - [ ] RAG 모듈에서 Logger 사용 확인

---

## 📦 설치/실행 명령어 예시

```bash
# 가상환경 활성화
source .venv/bin/activate

# 필요한 패키지 설치 (기본 패키지에 포함)
pip install pathlib

# Logger 단독 테스트
python src/utils/logger.py

# 사용 예시 실행
python examples/logger_example.py

# 단위 테스트 실행
pytest tests/test_logger.py -v

# 테스트 커버리지 확인
pytest tests/test_logger.py --cov=src.utils.logger --cov-report=html
```

---

## 💡 사용 예시

### 1. 기본 사용

```python
from src.utils.logger import Logger

# Logger 인스턴스 생성
logger = Logger(
    log_path="experiments/20251030/test.log",
    print_also=True  # 콘솔에도 출력
)

# 로그 기록
logger.write("실험 시작")
logger.write("데이터 로드 중...")
logger.write("모델 학습 완료")

# 에러 로그 (빨간색)
logger.write("경고: 메모리 부족", print_error=True)

# 로그 파일 닫기
logger.close()
```

### 2. with 문 사용 (권장)

```python
from src.utils.logger import Logger

with Logger("experiments/20251030/test.log") as logger:
    logger.write("with 문 시작")
    logger.write("자동으로 close() 호출됨")
    # with 블록 종료 시 자동으로 close()
```

### 3. 표준 출력 리디렉션

```python
from src.utils.logger import Logger

logger = Logger("experiments/20251030/test.log")

# 표준 출력 리디렉션 시작
logger.start_redirect()

# 이제 모든 print()가 로그 파일에 기록됨
print("이 메시지는 로그 파일에 저장됩니다")
print("print() 대신 logger.write() 사용 권장")

# 리디렉션 중지
logger.stop_redirect()

logger.close()
```

### 4. tqdm 진행률 표시

```python
from src.utils.logger import Logger

logger = Logger("experiments/20251030/test.log")

# tqdm 통합
from tqdm import tqdm
import time

for i in tqdm(range(100), file=logger.log_file):
    time.sleep(0.01)  # 작업 시뮬레이션
    if i % 20 == 0:
        logger.write(f"진행률: {i}%")

logger.close()
```

---

### ⚡️ 참고

**중요 사항:**
1. **최우선 작업**: 모든 팀원이 의존하므로 가장 먼저 완료 필요
2. **print() 금지**: 프로젝트 전체에서 print() 대신 logger.write() 사용 필수
3. **타임스탬프**: 모든 로그에 자동으로 타임스탬프 추가됨
4. **UTF-8 인코딩**: 한글 로그 지원을 위해 UTF-8 인코딩 필수
5. **파일 핸들 관리**: 반드시 close() 호출 또는 with 문 사용

**로그 파일 경로 규칙:**
```
experiments/날짜/날짜_시간_실험명/실험명.log
예시: experiments/20251030/20251030_143025_rag_test/experiment.log
```

**에러 처리:**
- 로그 파일 생성 실패 시 에러 메시지 출력 후 콘솔만 사용
- 디스크 용량 부족 시 경고 메시지
- 권한 문제 발생 시 대체 경로 제시

**성능 고려사항:**
- 로그 메시지마다 즉시 flush (데이터 손실 방지)
- 대용량 로그 시 파일 크기 제한 고려 (향후 RotatingFileHandler 추가 가능)
- 멀티스레드 환경에서는 Lock 추가 필요 (향후 개선)

**주의:**
- Logger 인스턴스는 파일당 하나만 생성 권장
- 여러 모듈에서 같은 파일에 로그 시 Lock 필요
- with 문 사용 권장 (자동 close)
- start_redirect() 사용 시 반드시 stop_redirect() 호출

---

### 유용한 링크

**필수 참고 PRD 문서:**
- [docs/PRD/01_프로젝트_개요.md](../PRD/01_프로젝트_개요.md) - 프로젝트 전체 개요
- [docs/PRD/02_프로젝트_구조.md](../PRD/02_프로젝트_구조.md) - 폴더 구조 (src/utils/)
- [docs/PRD/05_로깅_시스템.md](../PRD/05_로깅_시스템.md) ⭐⭐⭐ - Logger 클래스 전체 명세
- [docs/PRD/06_실험_추적_관리.md](../PRD/06_실험_추적_관리.md) ⭐ - 실험 폴더 구조 및 로그 파일 위치

**필수 참고 역할 문서:**
- [docs/roles/담당역할_01-2_최현화_로깅_모니터링.md](../roles/담당역할_01-2_최현화_로깅_모니터링.md) ⭐⭐⭐ - Logger 클래스 전체 구현 코드 및 사용 예시

**참고 PRD 문서:**
- [docs/PRD/03_브랜치_전략.md](../PRD/03_브랜치_전략.md) - Feature 브랜치 전략
- [docs/PRD/04_일정_관리.md](../PRD/04_일정_관리.md) - 개발 일정 및 마일스톤
- [docs/PRD/10_기술_요구사항.md](../PRD/10_기술_요구사항.md) - 기술 스택

**외부 링크:**
- [Python Logging HOWTO](https://docs.python.org/3/howto/logging.html)
- [Python pathlib 문서](https://docs.python.org/3/library/pathlib.html)
- [tqdm 문서](https://tqdm.github.io/)
- [ANSI 색상 코드](https://en.wikipedia.org/wiki/ANSI_escape_code#Colors)

## 🔖 추천 라벨

`feature` `utils` `logging` `critical` `high` `priority-1`

---
