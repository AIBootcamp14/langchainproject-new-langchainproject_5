#### ë©€í‹°í„´ ëŒ€í™” ì‹œìŠ¤í…œ (Multi-turn Conversation)

ì‚¬ìš©ìê°€ **"ê´€ë ¨ ë…¼ë¬¸ ì°¾ì•„ì¤˜"**, **"ê·¸ê±° ìš”ì•½í•´ì¤˜"**ì²˜ëŸ¼ **ëŒ€ëª…ì‚¬ë‚˜ ë§¥ë½ ì°¸ì¡° í‘œí˜„**ì„ ì‚¬ìš©í•  ë•Œ, ì‹œìŠ¤í…œì´ ì´ì „ ëŒ€í™” ë‚´ìš©ì„ ìë™ìœ¼ë¡œ íŒŒì•…í•˜ì—¬ ì •í™•í•œ ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤. **ë§¥ë½ ì°¸ì¡° ì§ˆë¬¸ ì„±ê³µë¥ ì„ 30%ì—ì„œ 95%ë¡œ í–¥ìƒ**ì‹œí‚¨ í•µì‹¬ ê¸°ëŠ¥ì…ë‹ˆë‹¤.

<details>
<summary><strong>ë©€í‹°í„´ ëŒ€í™” ì‹œìŠ¤í…œ ìƒì„¸ ë³´ê¸°</strong></summary>

#### ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph wrapper["ğŸ“‹ ë©€í‹°í„´ ëŒ€í™” ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜"]
        direction TB

        subgraph stage1["ğŸ”¸ 1ë‹¨ê³„: ëŒ€í™” íˆìŠ¤í† ë¦¬ ìˆ˜ì§‘"]
            direction LR
            A1["Streamlit<br/>Session State"]
            A2["get_current_messages()"]
            A3["messages ë¦¬ìŠ¤íŠ¸<br/>BaseMessage[]"]

            A1 -->|"st.session_state.messages"| A2
            A2 -->|"ë³€í™˜"| A3
        end

        subgraph stage2["ğŸ”¹ 2ë‹¨ê³„: ë§¥ë½ ì°¸ì¡° ê°ì§€"]
            direction LR
            B1["ì‚¬ìš©ì ì§ˆë¬¸<br/>ë¶„ì„"]
            B2["ë§¥ë½ í‚¤ì›Œë“œ<br/>ê°ì§€"]
            B3["ë¼ìš°íŒ…<br/>ì „ëµ ì„ íƒ"]

            B1 -->|"ê´€ë ¨, ê·¸ê±°, ì´ê±°..."| B2
            B2 -->|"has_contextual_ref"| B3
        end

        subgraph stage3["ğŸ”º 3ë‹¨ê³„: ì§ˆë¬¸ ì¬ì‘ì„±"]
            direction LR
            C1["Router Node<br/>LLM ë¶„ì„"]
            C2["query í•„ë“œ<br/>ì¶”ì¶œ"]
            C3["refined_query<br/>ì €ì¥"]

            C1 -->|"ë§¥ë½ ê³ ë ¤"| C2
            C2 -->|"JSON/Regex"| C3
        end

        subgraph stage4["ğŸ”» 4ë‹¨ê³„: ë„êµ¬ ì‹¤í–‰"]
            direction LR
            D1["refined_query<br/>ìš°ì„  ì‚¬ìš©"]
            D2["Multi-Query<br/>ê²€ìƒ‰"]
            D3["ì •í™•í•œ<br/>ê²°ê³¼ ë°˜í™˜"]

            D1 -->|"ëª…í™•í•œ ì¿¼ë¦¬"| D2
            D2 -->|"ì—¬ëŸ¬ ë³€í˜•"| D3
        end

        subgraph stage5["ğŸ”¶ 5ë‹¨ê³„: ì‘ë‹µ ì €ì¥"]
            direction LR
            E1["ëŒ€í™” ë©”ëª¨ë¦¬<br/>ì—…ë°ì´íŠ¸"]
            E2["Session State<br/>ì¶”ê°€"]
            E3["íŒŒì¼ ì €ì¥<br/>(ì„ íƒ)"]

            E1 -->|"add_message()"| E2
            E2 -->|"conversations/"| E3
        end

        stage1 -.->|"messages"| stage2
        stage2 -.->|"ì „ëµ"| stage3
        stage3 -.->|"refined_query"| stage4
        stage4 -.->|"ì‘ë‹µ"| stage5
    end

    style wrapper fill:#fffde7,stroke:#f9a825,stroke-width:4px,color:#000
    style stage1 fill:#e0f7fa,stroke:#006064,stroke-width:3px,color:#000
    style stage2 fill:#e1f5ff,stroke:#01579b,stroke-width:3px,color:#000
    style stage3 fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000
    style stage4 fill:#fff3e0,stroke:#e65100,stroke-width:3px,color:#000
    style stage5 fill:#ffebee,stroke:#c62828,stroke-width:3px,color:#000

    style A1 fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000
    style A2 fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000
    style A3 fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000

    style B1 fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style B2 fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style B3 fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000

    style C1 fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style C2 fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style C3 fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000

    style D1 fill:#ffcc80,stroke:#f57c00,stroke-width:2px,color:#000
    style D2 fill:#ffcc80,stroke:#f57c00,stroke-width:2px,color:#000
    style D3 fill:#ffcc80,stroke:#f57c00,stroke-width:2px,color:#000

    style E1 fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style E2 fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style E3 fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000

    linkStyle 0,1 stroke:#006064,stroke-width:2px
    linkStyle 2,3 stroke:#1976d2,stroke-width:2px
    linkStyle 4,5 stroke:#7b1fa2,stroke-width:2px
    linkStyle 6,7 stroke:#f57c00,stroke-width:2px
    linkStyle 8,9 stroke:#c62828,stroke-width:2px
    linkStyle 10,11,12,13 stroke:#616161,stroke-width:3px
```

#### ê°œìš”

ì‚¬ìš©ìê°€ **"ê´€ë ¨ ë…¼ë¬¸ ì°¾ì•„ì¤˜"**, **"ê·¸ê±° ìš”ì•½í•´ì¤˜"** ê°™ì€ **ëŒ€ëª…ì‚¬ë‚˜ ë§¥ë½ ì°¸ì¡° í‘œí˜„**ì„ ì‚¬ìš©í•  ë•Œ, ì´ì „ ëŒ€í™” ë‚´ìš©ì„ ìë™ìœ¼ë¡œ íŒŒì•…í•˜ì—¬ ì •í™•í•œ ë‹µë³€ì„ ì œê³µí•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.