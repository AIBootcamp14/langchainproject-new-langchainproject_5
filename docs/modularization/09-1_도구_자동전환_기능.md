# 06-1. ë„êµ¬ ìë™ì „í™˜ ë° Fallback Chain ì‹œìŠ¤í…œ

## ğŸ“‹ ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì¼**: 2025-11-04
- **ì‘ì„±ì**: ìµœí˜„í™”[íŒ€ì¥]
- **ì‹œìŠ¤í…œëª…**: Fallback Chain ë©”ì»¤ë‹ˆì¦˜
- **êµ¬í˜„ íŒŒì¼**: `src/agent/` (graph.py, nodes.py, failure_detector.py ë“±)
- **ìš°ì„ ìˆœìœ„**: â­â­â­ (ë†’ìŒ - ì‹œìŠ¤í…œ ì•ˆì •ì„±)
- **ì°¸ê³  ë¬¸ì„œ**: [09_ë„êµ¬_ì‹œìŠ¤í…œ.md](./09_ë„êµ¬_ì‹œìŠ¤í…œ.md), [03_AI_Agent_ì‹œìŠ¤í…œ.md](./03_AI_Agent_ì‹œìŠ¤í…œ.md)

---

## ğŸ“Œ ì‹œìŠ¤í…œ ê°œìš”

### ëª©ì  ë° ë°°ê²½

Fallback Chain ì‹œìŠ¤í…œì€ **AI Agentê°€ ë„êµ¬ ì‹¤í–‰ ì‹¤íŒ¨ ì‹œ ìë™ìœ¼ë¡œ ë‹¤ìŒ ìš°ì„ ìˆœìœ„ ë„êµ¬ë¡œ ì „í™˜**í•˜ì—¬ ì‚¬ìš©ì ì§ˆë¬¸ì— í•­ìƒ ì ì ˆí•œ ë‹µë³€ì„ ì œê³µí•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.

### í•µì‹¬ ê¸°ëŠ¥

1. **ë„êµ¬ ì‹¤í–‰ ì‹¤íŒ¨ ê°ì§€**: ë„êµ¬ ì‹¤í–‰ ê²°ê³¼ì—ì„œ ì‹¤íŒ¨ íŒ¨í„´ ìë™ ê°ì§€
2. **ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜**: 7ê°€ì§€ ì§ˆë¬¸ ìœ í˜•ìœ¼ë¡œ ìë™ ë¶„ë¥˜ (LLM ê¸°ë°˜)
3. **ìš°ì„ ìˆœìœ„ ê¸°ë°˜ Fallback**: ì§ˆë¬¸ ìœ í˜•ë³„ ë„êµ¬ ìš°ì„ ìˆœìœ„ ì²´ì¸ ì‹¤í–‰
4. **Router ê²€ì¦**: LLMì´ Routerì˜ ë„êµ¬ ì„ íƒì„ ê²€ì¦í•˜ì—¬ ì •í™•ë„ í–¥ìƒ
5. **ìµœì¢… Fallback**: ëª¨ë“  ë„êµ¬ ì‹¤íŒ¨ ì‹œ general ë„êµ¬ ê°•ì œ ì‹¤í–‰

### ë„ì… ë°°ê²½

**ê¸°ì¡´ ì‹œìŠ¤í…œì˜ ë¬¸ì œì :**
- Routerê°€ í•œ ë²ˆ ë„êµ¬ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ë„êµ¬ë§Œ ì‹¤í–‰í•˜ê³  ë°”ë¡œ ì¢…ë£Œ
- ë„êµ¬ ì‹¤í–‰ ì‹¤íŒ¨ ì‹œ ë‹¤ë¥¸ ë„êµ¬ë¡œ ìë™ ì „í™˜ë˜ì§€ ì•ŠìŒ
- ì‚¬ìš©ì ì§ˆë¬¸ì— ì ì ˆí•œ ë‹µë³€ì„ ì œê³µí•˜ì§€ ëª»í•˜ëŠ” ê²½ìš° ë°œìƒ

**í•´ê²° ë°©ì•ˆ:**
- ë„êµ¬ ì‹¤í–‰ ì‹¤íŒ¨ ê°ì§€ ë° ìë™ ì¬ë¼ìš°íŒ…
- ì§ˆë¬¸ ìœ í˜•ë³„ ë„êµ¬ ìš°ì„ ìˆœìœ„ ì„¤ì •
- Router ì„ íƒ ê²€ì¦ ë…¸ë“œ ì¶”ê°€
- Fallback Chain ë©”ì»¤ë‹ˆì¦˜ êµ¬í˜„

---

## ğŸš¨ ê¸°ì¡´ ì‹œìŠ¤í…œì˜ ë¬¸ì œì 

### ë¬¸ì œ 1: ë„êµ¬ ê°„ ìë™ ì „í™˜ ì—†ìŒ

```
ì‹œë‚˜ë¦¬ì˜¤:
ì‚¬ìš©ì: "ìµœì‹  Diffusion Model ë…¼ë¬¸ ì°¾ì•„ì¤˜"
    â†“
Router: search_paper ì„ íƒ
    â†“
search_paper: DBì— ê´€ë ¨ ë…¼ë¬¸ ì—†ìŒ
    â†’ "ê´€ë ¨ ë…¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤." ë°˜í™˜
    â†“
END (ì¢…ë£Œ) âŒ
    â†“
âŒ web_searchë¡œ ìë™ ì „í™˜ ì•ˆ ë¨
âŒ generalë¡œ Fallback ì•ˆ ë¨
```

**ì½”ë“œ ìœ„ì¹˜**: `src/agent/graph.py:266-267`
```python
# ê¸°ì¡´ ì½”ë“œ (Fallback Chain ë¹„í™œì„±í™” ì‹œ)
for node in ["general", "save_file", "search_paper", "web_search", "glossary", "summarize", "text2sql"]:
    workflow.add_edge(node, END)  # ëª¨ë“  ë„êµ¬ ì‹¤í–‰ í›„ ë°”ë¡œ END
```

### ë¬¸ì œ 2: ë„êµ¬ ì„ íƒ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ì—†ìŒ

```
ì‹œë‚˜ë¦¬ì˜¤:
ì‚¬ìš©ì: "Attention ë©”ì»¤ë‹ˆì¦˜ ì„¤ëª…í•´ì¤˜"
    â†“
Router: ì‹¤ìˆ˜ë¡œ save_file ì„ íƒ (ì˜ëª»ëœ íŒë‹¨)
    â†“
save_file: íŒŒì¼ ê²½ë¡œ ì—†ìŒ â†’ ì˜¤ë¥˜
    â†“
END (ì¢…ë£Œ) âŒ
    â†“
âŒ ë„êµ¬ ì¬ì„ íƒ ì•ˆ ë¨
âŒ glossaryë‚˜ generalë¡œ ìë™ ì „í™˜ ì•ˆ ë¨
```

### ë¬¸ì œ 3: Fallback Chain ë¶€ì¬

```
ì´ìƒì ì¸ Fallback Chain:
glossary ê²€ìƒ‰ â†’ ì‹¤íŒ¨
    â†“
search_paper ê²€ìƒ‰ â†’ ì‹¤íŒ¨
    â†“
web_search ê²€ìƒ‰ â†’ ì‹¤íŒ¨
    â†“
general ë‹µë³€ (ìµœì¢… Fallback)

ê¸°ì¡´ êµ¬í˜„:
ì„ íƒëœ ë„êµ¬ 1ê°œë§Œ ì‹¤í–‰ â†’ END
```

---

## âœ¨ í•´ê²° ë°©ì•ˆ

### 1. ë„êµ¬ ì‹¤í–‰ ì‹¤íŒ¨ ê°ì§€

**FailureDetector í´ë˜ìŠ¤** (`src/agent/failure_detector.py`)
- ë„êµ¬ ì‹¤í–‰ ê²°ê³¼ì—ì„œ ì‹¤íŒ¨ íŒ¨í„´ ë§¤ì¹­
- 11ê°œ ì‹¤íŒ¨ íŒ¨í„´ + 7ê°œ ì •ê·œì‹ íŒ¨í„´ ì§€ì›
- `is_tool_failed(result: str) -> (bool, str)` í•¨ìˆ˜ ì œê³µ

**ì‹¤íŒ¨ íŒ¨í„´ ì˜ˆì‹œ:**
- "ê´€ë ¨ ìš©ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
- "ê´€ë ¨ ë…¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
- "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤"
- "íŒŒì¼ ê²½ë¡œë¥¼ ì§€ì •í•´ì£¼ì„¸ìš”"
- "SQL ì¿¼ë¦¬ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤"
- "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤"

### 2. ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜

**QuestionClassifier í´ë˜ìŠ¤** (`src/agent/question_classifier.py`)
- LLM ê¸°ë°˜ ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜ (7ê°€ì§€)
- ë¶„ë¥˜ ê²°ê³¼ ìºì‹± (ë™ì¼ ì§ˆë¬¸ ì¬ë¶„ë¥˜ ë°©ì§€)
- Solar Pro2 ì‚¬ìš© (ë¹ ë¥´ê³  ì €ë ´)

**7ê°€ì§€ ì§ˆë¬¸ ìœ í˜•:**
1. **term_definition**: AI/ML ìš©ì–´ ì •ì˜ ì§ˆë¬¸
2. **paper_search**: íŠ¹ì • ë…¼ë¬¸ ê²€ìƒ‰ ì§ˆë¬¸
3. **latest_research**: ìµœì‹  ì—°êµ¬ ë™í–¥ ì§ˆë¬¸
4. **paper_summary**: ë…¼ë¬¸ ìš”ì•½ ìš”ì²­
5. **statistics**: ë…¼ë¬¸ í†µê³„ ì •ë³´ ì§ˆë¬¸
6. **file_save**: íŒŒì¼ ì €ì¥ ìš”ì²­
7. **general_question**: ì¼ë°˜ ì§ˆë¬¸

### 3. ë„êµ¬ ìš°ì„ ìˆœìœ„ ì²´ì¸

**ì„¤ì • íŒŒì¼** (`configs/model_config.yaml`)
```yaml
fallback_chain:
  priorities:
    term_definition:
      - glossary
      - general
    paper_search:
      - search_paper
      - web_search
      - general
    latest_research:
      - web_search
      - search_paper
      - general
    paper_summary:
      - summarize
      - search_paper
      - general
    statistics:
      - text2sql
      - general
    general_question:
      - general
    file_save:
      - save_file
```

### 4. Router ê²€ì¦ ë©”ì»¤ë‹ˆì¦˜

**validate_tool_choice_node** (`src/agent/nodes.py:205-312`)
- LLMì´ Routerì˜ ë„êµ¬ ì„ íƒì„ ê²€ì¦
- "yes" / "no" ì‘ë‹µìœ¼ë¡œ ì ì ˆì„± íŒë‹¨
- ê²€ì¦ ì‹¤íŒ¨ ì‹œ ì¬ë¼ìš°íŒ… (ìµœëŒ€ 2íšŒ)
- ê²€ì¦ ì¬ì‹œë„ ì´ˆê³¼ ì‹œ general ê°•ì œ ì‹¤í–‰

### 5. Fallback Router ë…¸ë“œ

**fallback_router_node** (`src/agent/nodes.py:120-200`)
- ë„êµ¬ ì‹¤í–‰ ì‹¤íŒ¨ ì‹œ ë‹¤ìŒ ìš°ì„ ìˆœìœ„ ë„êµ¬ ì„ íƒ
- ì‹¤íŒ¨í•œ ë„êµ¬ ëª©ë¡ ê´€ë¦¬ (`state["failed_tools"]`)
- ì¬ì‹œë„ íšŸìˆ˜ ì¶”ì  (`state["retry_count"]`)
- ìµœëŒ€ ì¬ì‹œë„ ì´ˆê³¼ ì‹œ general ê°•ì œ ì‹¤í–‰

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### Fallback Chain ì‹¤í–‰ íë¦„

```mermaid
graph TB
    Start([ì‚¬ìš©ì ì§ˆë¬¸]) --> ClassifyQ{ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜<br/>QuestionClassifier}
    ClassifyQ --> LoadChain[ìš°ì„ ìˆœìœ„ ì²´ì¸ ë¡œë“œ<br/>config_loader.py]
    LoadChain --> Router{Router ë…¸ë“œ<br/>ë„êµ¬ ì„ íƒ}

    Router --> Validate{Router ê²€ì¦<br/>validation_enabled?}
    Validate -->|ê²€ì¦ ë¹„í™œì„±í™”| Tool1[ë„êµ¬ 1 ì‹¤í–‰]
    Validate -->|ê²€ì¦ í™œì„±í™”| ValidateNode{validate_tool_choice_node<br/>LLM ê²€ì¦}

    ValidateNode -->|ì ì ˆí•¨| Tool1
    ValidateNode -->|ë¶€ì ì ˆí•¨| CheckRetry1{ê²€ì¦ ì¬ì‹œë„<br/>< max_validation?}
    CheckRetry1 -->|Yes| Router
    CheckRetry1 -->|No| ForcedGeneral[general ê°•ì œ ì‹¤í–‰]

    Tool1 --> FailureCheck1{ì‹¤íŒ¨ ê°ì§€<br/>FailureDetector}
    FailureCheck1 -->|ì„±ê³µ| End([ë‹µë³€ ë°˜í™˜])
    FailureCheck1 -->|ì‹¤íŒ¨| CheckRetry2{ì¬ì‹œë„ íšŸìˆ˜<br/>< max_retries?}

    CheckRetry2 -->|Yes| FallbackRouter[Fallback Router<br/>ë‹¤ìŒ ë„êµ¬ ì„ íƒ]
    CheckRetry2 -->|No| FinalFallback[final_fallback_node<br/>general ê°•ì œ ì‹¤í–‰]

    FallbackRouter --> Tool2[ë„êµ¬ 2 ì‹¤í–‰]
    Tool2 --> FailureCheck2{ì‹¤íŒ¨ ê°ì§€}
    FailureCheck2 -->|ì„±ê³µ| End
    FailureCheck2 -->|ì‹¤íŒ¨| CheckRetry3{ì¬ì‹œë„ íšŸìˆ˜<br/>< max_retries?}

    CheckRetry3 -->|Yes| FallbackRouter
    CheckRetry3 -->|No| FinalFallback

    FinalFallback --> End
    ForcedGeneral --> End

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼
    style Start fill:#81d4fa,stroke:#0288d1,stroke-width:2px,color:#000
    style End fill:#a5d6a7,stroke:#388e3c,stroke-width:2px,color:#000
    style ClassifyQ fill:#ce93d8,stroke:#7b1fa2,stroke-width:2px,color:#000
    style Router fill:#ce93d8,stroke:#7b1fa2,stroke-width:2px,color:#000
    style Validate fill:#ffb74d,stroke:#f57c00,stroke-width:2px,color:#000
    style ValidateNode fill:#ffb74d,stroke:#f57c00,stroke-width:2px,color:#000
    style Tool1 fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style Tool2 fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style FailureCheck1 fill:#ef5350,stroke:#c62828,stroke-width:2px,color:#fff
    style FailureCheck2 fill:#ef5350,stroke:#c62828,stroke-width:2px,color:#fff
    style FallbackRouter fill:#ba68c8,stroke:#7b1fa2,stroke-width:2px,color:#fff
    style FinalFallback fill:#ff7043,stroke:#d84315,stroke-width:2px,color:#fff
    style ForcedGeneral fill:#ff7043,stroke:#d84315,stroke-width:2px,color:#fff
```

### ìƒíƒœ ê´€ë¦¬ (AgentState)

**Fallback Chain ê´€ë ¨ ìƒíƒœ í•„ë“œ** (`src/agent/state.py`)
```python
class AgentState(TypedDict, total=False):
    # ê¸°ì¡´ í•„ë“œ
    question: str
    difficulty: str
    tool_choice: str
    final_answer: str

    # Fallback Chain í•„ë“œ
    retry_count: int                  # í˜„ì¬ ì¬ì‹œë„ íšŸìˆ˜
    failed_tools: List[str]           # ì‹¤íŒ¨í•œ ë„êµ¬ ë¦¬ìŠ¤íŠ¸
    question_type: str                # ì§ˆë¬¸ ìœ í˜•
    fallback_chain: List[str]         # ë„êµ¬ ìš°ì„ ìˆœìœ„ ë¦¬ìŠ¤íŠ¸
    validation_failed: bool           # Router ê²€ì¦ ì‹¤íŒ¨ ì—¬ë¶€
    tool_status: str                  # ë„êµ¬ ì‹¤í–‰ ìƒíƒœ (success/failed/error)
    tool_timeline: List[Dict[str, Any]]  # ë„êµ¬ ì‹¤í–‰ íƒ€ì„ë¼ì¸
    max_retries: int                  # ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜
    validation_enabled: bool          # Router ê²€ì¦ í™œì„±í™” ì—¬ë¶€
    validation_retries: int           # ê²€ì¦ ì¬ì‹œë„ íšŸìˆ˜
    max_validation: int               # ìµœëŒ€ ê²€ì¦ ì¬ì‹œë„ íšŸìˆ˜
```

---

## ğŸ“‚ êµ¬í˜„ íŒŒì¼ êµ¬ì¡°

### 1. í•µì‹¬ ëª¨ë“ˆ

| íŒŒì¼ | ì„¤ëª… | ì£¼ìš” í´ë˜ìŠ¤/í•¨ìˆ˜ |
|------|------|------------------|
| **src/agent/graph.py** | LangGraph ê·¸ë˜í”„ ì¬êµ¬ì„± | `create_agent_graph()`, `should_fallback()`, `should_validate()`, `initialize_fallback_state()` |
| **src/agent/nodes.py** | Fallback ë…¸ë“œ êµ¬í˜„ | `fallback_router_node()`, `validate_tool_choice_node()`, `final_fallback_node()` |
| **src/agent/failure_detector.py** | ì‹¤íŒ¨ íŒ¨í„´ ê°ì§€ | `FailureDetector`, `is_tool_failed()` |
| **src/agent/question_classifier.py** | ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜ | `QuestionClassifier`, `classify_question()` |
| **src/agent/config_loader.py** | Fallback ì„¤ì • ë¡œë” | `load_fallback_config()`, `get_priority_chain()`, `is_fallback_enabled()` |
| **src/agent/tool_wrapper.py** | ë„êµ¬ ë˜í¼ (ìë™ ìƒíƒœ ì„¤ì •) | `wrap_tool_node()` |
| **src/agent/state.py** | Agent ìƒíƒœ ì •ì˜ | `AgentState` (11ê°œ Fallback í•„ë“œ ì¶”ê°€) |

### 2. ì„¤ì • íŒŒì¼

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| **configs/model_config.yaml** | Fallback Chain ì„¤ì • (ìš°ì„ ìˆœìœ„, ì¬ì‹œë„ íšŸìˆ˜ ë“±) |

---

## ğŸ”§ ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### 1. FailureDetector (ì‹¤íŒ¨ ê°ì§€)

**íŒŒì¼**: `src/agent/failure_detector.py`

```python
class FailureDetector:
    """ë„êµ¬ ì‹¤í–‰ ì‹¤íŒ¨ ê°ì§€ í´ë˜ìŠ¤"""

    # ì‹¤íŒ¨ íŒ¨í„´ (11ê°œ)
    FAILURE_PATTERNS = [
        "ê´€ë ¨ ìš©ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
        "ê´€ë ¨ ë…¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
        "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤",
        "ì›¹ ê²€ìƒ‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤",
        "íŒŒì¼ ê²½ë¡œë¥¼ ì§€ì •í•´ì£¼ì„¸ìš”",
        "SQL ì¿¼ë¦¬ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤",
        "ìš”ì•½í•  ë…¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
        "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",
        "ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤",
        "ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤",
        "ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"
    ]

    # ì •ê·œì‹ íŒ¨í„´ (7ê°œ)
    FAILURE_REGEX = [
        r"ì˜¤ë¥˜.*ë°œìƒ",
        r"ì‹¤íŒ¨.*í–ˆìŠµë‹ˆë‹¤",
        r"ì°¾ì„ ìˆ˜ ì—†",
        r"ì¡´ì¬í•˜ì§€ ì•Š",
        r"ì²˜ë¦¬.*ë¶ˆê°€",
        r"ì§€ì›.*ì•Š",
        r"ì ‘ê·¼.*ê±°ë¶€"
    ]

    def is_failed(self, result: str) -> Tuple[bool, str]:
        """
        ë„êµ¬ ì‹¤í–‰ ê²°ê³¼ì—ì„œ ì‹¤íŒ¨ ì—¬ë¶€ íŒë‹¨

        Returns:
            (is_failed, failure_reason)
        """
        # íŒ¨í„´ ë§¤ì¹­ ë¡œì§
        # ...
```

**ì‚¬ìš© ìœ„ì¹˜**: `src/agent/tool_wrapper.py:56`

### 2. QuestionClassifier (ì§ˆë¬¸ ë¶„ë¥˜)

**íŒŒì¼**: `src/agent/question_classifier.py`

```python
class QuestionClassifier:
    """ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜ í´ë˜ìŠ¤"""

    QUESTION_TYPES = {
        "term_definition": "AI/ML ìš©ì–´ì˜ ì •ì˜ë¥¼ ë¬»ëŠ” ì§ˆë¬¸",
        "paper_search": "íŠ¹ì • ë…¼ë¬¸ì„ ê²€ìƒ‰í•˜ê±°ë‚˜ ì°¾ëŠ” ì§ˆë¬¸",
        "latest_research": "ìµœì‹  ì—°êµ¬ ë™í–¥ì´ë‚˜ ìµœê·¼ ë…¼ë¬¸ì„ ë¬»ëŠ” ì§ˆë¬¸",
        "paper_summary": "ë…¼ë¬¸ì˜ ìš”ì•½ì„ ìš”ì²­í•˜ëŠ” ì§ˆë¬¸",
        "statistics": "ë…¼ë¬¸ ê°œìˆ˜, ì €ì, ì—°ë„ ë“± í†µê³„ ì •ë³´ë¥¼ ë¬»ëŠ” ì§ˆë¬¸",
        "file_save": "ë‹µë³€ì„ íŒŒì¼ë¡œ ì €ì¥í•´ë‹¬ë¼ëŠ” ìš”ì²­",
        "general_question": "ìœ„ ì¹´í…Œê³ ë¦¬ì— ì†í•˜ì§€ ì•ŠëŠ” ì¼ë°˜ì ì¸ ì§ˆë¬¸"
    }

    def classify(self, question: str, difficulty: str = "easy") -> str:
        """
        ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜ (LLM ê¸°ë°˜)

        Returns:
            question_type (7ê°€ì§€ ì¤‘ í•˜ë‚˜)
        """
        # LLM í˜¸ì¶œ ë° ë¶„ë¥˜ ë¡œì§
        # ê²°ê³¼ ìºì‹±
        # ...
```

**ì‚¬ìš© ìœ„ì¹˜**: `src/agent/graph.py:302`

### 3. Config Loader (ì„¤ì • ë¡œë”)

**íŒŒì¼**: `src/agent/config_loader.py`

```python
def load_fallback_config(force_reload: bool = False) -> Dict[str, Any]:
    """
    Fallback Chain ì„¤ì • ë¡œë“œ

    Returns:
        {
            "enabled": True,
            "max_retries": 3,
            "validation_enabled": True,
            "validation_retries": 2,
            "priorities": {
                "term_definition": ["glossary", "general"],
                "paper_search": ["search_paper", "web_search", "general"],
                # ...
            }
        }
    """
    # configs/model_config.yaml ì½ê¸°
    # ì„¤ì • ê²€ì¦ ë° ìºì‹±
    # ...

def get_priority_chain(question_type: str) -> List[str]:
    """ì§ˆë¬¸ ìœ í˜•ì— ëŒ€í•œ ë„êµ¬ ìš°ì„ ìˆœìœ„ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜"""
    # ...

def is_fallback_enabled() -> bool:
    """Fallback Chain í™œì„±í™” ì—¬ë¶€ ë°˜í™˜"""
    # ...
```

**ì‚¬ìš© ìœ„ì¹˜**: `src/agent/graph.py:137`, `src/agent/nodes.py:15`

### 4. Fallback Router Node

**íŒŒì¼**: `src/agent/nodes.py:120-200`

```python
def fallback_router_node(state: AgentState, exp_manager=None):
    """
    Fallback Router ë…¸ë“œ: ë„êµ¬ ì‹¤í–‰ ì‹¤íŒ¨ ì‹œ ë‹¤ìŒ ìš°ì„ ìˆœìœ„ ë„êµ¬ ì„ íƒ

    ì²˜ë¦¬ ë¡œì§:
    1. ì‹¤íŒ¨í•œ ë„êµ¬ë¥¼ state["failed_tools"]ì— ì¶”ê°€
    2. state["retry_count"] ì¦ê°€
    3. max_retries ì´ˆê³¼ í™•ì¸
       - ì´ˆê³¼ ì‹œ: general ê°•ì œ ì„ íƒ
       - ë¯¸ì´ˆê³¼: fallback_chainì—ì„œ ë‹¤ìŒ ë„êµ¬ ì„ íƒ
    4. ëª¨ë“  ë„êµ¬ ì‹œë„ ì™„ë£Œ ì‹œ general ì„ íƒ
    5. íƒ€ì„ë¼ì¸ ê¸°ë¡
    """
    # í˜„ì¬ ìƒíƒœ ì •ë³´ ì¶”ì¶œ
    question = state["question"]
    failed_tool = state.get("tool_choice", "unknown")
    retry_count = state.get("retry_count", 0)
    max_retries = state.get("max_retries", 3)
    fallback_chain = state.get("fallback_chain", [])
    failed_tools = state.get("failed_tools", [])

    # ì‹¤íŒ¨í•œ ë„êµ¬ ê¸°ë¡
    if failed_tool not in failed_tools:
        failed_tools.append(failed_tool)
        state["failed_tools"] = failed_tools

    # ì¬ì‹œë„ íšŸìˆ˜ ì¦ê°€
    retry_count += 1
    state["retry_count"] = retry_count

    # ìµœëŒ€ ì¬ì‹œë„ ì´ˆê³¼ í™•ì¸
    if retry_count > max_retries:
        state["tool_choice"] = "general"
        return state

    # Fallback Chainì—ì„œ ë‹¤ìŒ ë„êµ¬ ì„ íƒ
    next_tool = None
    for tool in fallback_chain:
        if tool not in failed_tools:
            next_tool = tool
            break

    # ëª¨ë“  ë„êµ¬ ì‹œë„ ì™„ë£Œ
    if next_tool is None:
        next_tool = "general"

    state["tool_choice"] = next_tool

    # íƒ€ì„ë¼ì¸ ê¸°ë¡
    # ...

    return state
```

### 5. Router ê²€ì¦ Node

**íŒŒì¼**: `src/agent/nodes.py:205-312`

```python
def validate_tool_choice_node(state: AgentState, exp_manager=None):
    """
    Router ê²€ì¦ ë…¸ë“œ: Routerê°€ ì„ íƒí•œ ë„êµ¬ê°€ ì ì ˆí•œì§€ LLMìœ¼ë¡œ ê²€ì¦

    ì²˜ë¦¬ ë¡œì§:
    1. ë„êµ¬ ì„¤ëª… ì¡°íšŒ
    2. LLMì—ê²Œ ê²€ì¦ ìš”ì²­ (yes/no)
    3. ê²€ì¦ ê²°ê³¼ íŒŒì‹±
    4. ê²€ì¦ ì‹¤íŒ¨ ì‹œ:
       - validation_retries ì¦ê°€
       - max_validation ì´ˆê³¼ í™•ì¸
       - ì´ˆê³¼: general ê°•ì œ ì„ íƒ
       - ë¯¸ì´ˆê³¼: ì¬ë¼ìš°íŒ…
    """
    # ìƒíƒœ ì •ë³´ ì¶”ì¶œ
    question = state["question"]
    tool_choice = state.get("tool_choice", "general")
    validation_retries = state.get("validation_retries", 0)
    max_validation = state.get("max_validation", 2)

    # ë„êµ¬ ì„¤ëª…
    TOOL_DESCRIPTIONS = {
        "general": "ì¼ë°˜ ì§ˆë¬¸ì— LLM ì§€ì‹ìœ¼ë¡œ ë‹µë³€",
        "glossary": "AI/ML ìš©ì–´ ì •ì˜ ê²€ìƒ‰",
        "search_paper": "ë…¼ë¬¸ DBì—ì„œ RAG ê²€ìƒ‰",
        "web_search": "ì›¹ì—ì„œ ìµœì‹  ë…¼ë¬¸ ê²€ìƒ‰",
        "summarize": "ë…¼ë¬¸ ìš”ì•½ ìƒì„±",
        "text2sql": "ë…¼ë¬¸ í†µê³„ ì •ë³´ SQL ì¡°íšŒ",
        "save_file": "ë‹µë³€ì„ íŒŒì¼ë¡œ ì €ì¥"
    }

    tool_desc = TOOL_DESCRIPTIONS.get(tool_choice, "ì•Œ ìˆ˜ ì—†ëŠ” ë„êµ¬")

    # ê²€ì¦ í”„ë¡¬í”„íŠ¸ ìƒì„±
    validation_prompt = f"""ì§ˆë¬¸: {question}

ì„ íƒëœ ë„êµ¬: {tool_choice}
ë„êµ¬ ì„¤ëª…: {tool_desc}

ì´ ë„êµ¬ ì„ íƒì´ ì§ˆë¬¸ì— ì ì ˆí•œê°€ìš”?

- yes: ì ì ˆí•¨ (ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ˆë¬¸ì— ë‹µë³€ ê°€ëŠ¥)
- no: ë¶€ì ì ˆí•¨ (ë‹¤ë¥¸ ë„êµ¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨)

ë‹µë³€ (yes/no):"""

    # LLM í˜¸ì¶œ ë° ê²€ì¦
    # ...

    # ê²€ì¦ ê²°ê³¼ ì²˜ë¦¬
    if is_valid:
        state["validation_failed"] = False
    else:
        validation_retries += 1
        state["validation_retries"] = validation_retries

        if validation_retries > max_validation:
            state["tool_choice"] = "general"
            state["validation_failed"] = False
        else:
            state["validation_failed"] = True

    return state
```

### 6. Tool Wrapper (ìë™ ìƒíƒœ ì„¤ì •)

**íŒŒì¼**: `src/agent/tool_wrapper.py`

```python
def wrap_tool_node(tool_node_func: Callable, tool_name: str) -> Callable:
    """
    ë„êµ¬ ë…¸ë“œë¥¼ ë˜í•‘í•˜ì—¬ tool_status ìë™ ì„¤ì •

    ì²˜ë¦¬ ë¡œì§:
    1. íƒ€ì„ë¼ì¸ ê¸°ë¡ (ì‹¤í–‰ ì „)
    2. ì›ë³¸ ë„êµ¬ ì‹¤í–‰
    3. ì‹¤í–‰ ê²°ê³¼ í™•ì¸ (FailureDetector)
    4. tool_status ì„¤ì • (success/failed/error)
    5. íƒ€ì„ë¼ì¸ ê¸°ë¡ (ì‹¤í–‰ í›„)
    """
    def wrapped_tool_node(state: AgentState, exp_manager=None) -> AgentState:
        # íƒ€ì„ë¼ì¸ ê¸°ë¡ (ì‹¤í–‰ ì „)
        timeline = state.get("tool_timeline", [])
        timeline.append({
            "timestamp": datetime.now().isoformat(),
            "event": "tool_start",
            "tool": tool_name,
            "retry_count": state.get("retry_count", 0)
        })
        state["tool_timeline"] = timeline

        # ì›ë³¸ ë„êµ¬ ì‹¤í–‰
        try:
            state = tool_node_func(state, exp_manager)

            # ì‹¤í–‰ ê²°ê³¼ í™•ì¸
            final_answer = state.get("final_answer", "")
            is_failed, failure_reason = is_tool_failed(final_answer)

            if is_failed:
                state["tool_status"] = "failed"
            else:
                state["tool_status"] = "success"

        except Exception as e:
            state["tool_status"] = "error"
            state["final_answer"] = f"ë„êµ¬ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {str(e)}"

        # íƒ€ì„ë¼ì¸ ê¸°ë¡ (ì‹¤í–‰ í›„)
        # ...

        return state

    return wrapped_tool_node
```

**ì‚¬ìš© ìœ„ì¹˜**: `src/agent/graph.py:158-164`

---

## âš™ï¸ ì„¤ì • ë°©ë²•

### configs/model_config.yaml ì„¤ì •

**íŒŒì¼ ìœ„ì¹˜**: `configs/model_config.yaml`

```yaml
# ==================== Fallback Chain ì„¤ì • ==================== #
fallback_chain:
  # Fallback Chain í™œì„±í™” ì—¬ë¶€
  enabled: true

  # ë„êµ¬ ì‹¤í–‰ ì‹¤íŒ¨ ì‹œ ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ (1-5 ê¶Œì¥)
  max_retries: 3

  # Router ì„ íƒ ê²€ì¦ í™œì„±í™” ì—¬ë¶€
  validation_enabled: true

  # Router ê²€ì¦ ì‹¤íŒ¨ ì‹œ ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ (1-3 ê¶Œì¥)
  validation_retries: 2

  # ì§ˆë¬¸ ìœ í˜•ë³„ ë„êµ¬ ìš°ì„ ìˆœìœ„
  priorities:
    # ìš©ì–´ ì •ì˜ ì§ˆë¬¸
    term_definition:
      - glossary      # 1ìˆœìœ„: ìš©ì–´ì§‘ ê²€ìƒ‰
      - general       # 2ìˆœìœ„: ì¼ë°˜ ë‹µë³€ (ìµœì¢… Fallback)

    # ë…¼ë¬¸ ê²€ìƒ‰ ì§ˆë¬¸
    paper_search:
      - search_paper  # 1ìˆœìœ„: DB ê²€ìƒ‰
      - web_search    # 2ìˆœìœ„: ì›¹ ê²€ìƒ‰
      - general       # 3ìˆœìœ„: ì¼ë°˜ ë‹µë³€

    # ìµœì‹  ì—°êµ¬ ë™í–¥
    latest_research:
      - web_search    # 1ìˆœìœ„: ì›¹ ê²€ìƒ‰
      - search_paper  # 2ìˆœìœ„: DB ê²€ìƒ‰
      - general       # 3ìˆœìœ„: ì¼ë°˜ ë‹µë³€

    # ë…¼ë¬¸ ìš”ì•½ ìš”ì²­
    paper_summary:
      - summarize     # 1ìˆœìœ„: ìš”ì•½ ë„êµ¬
      - search_paper  # 2ìˆœìœ„: DB ê²€ìƒ‰ í›„ LLM ìš”ì•½
      - general       # 3ìˆœìœ„: ì¼ë°˜ ë‹µë³€

    # í†µê³„ ì •ë³´ ì§ˆë¬¸
    statistics:
      - text2sql      # 1ìˆœìœ„: SQL ì¿¼ë¦¬
      - general       # 2ìˆœìœ„: ì¼ë°˜ ë‹µë³€

    # ì¼ë°˜ ì§ˆë¬¸
    general_question:
      - general       # ë°”ë¡œ ì¼ë°˜ ë‹µë³€

    # íŒŒì¼ ì €ì¥ ìš”ì²­
    file_save:
      - save_file     # íŒŒì¼ ì €ì¥ë§Œ
```

### ì„¤ì • ë³€ê²½ ë°©ë²•

**1. Fallback Chain ë¹„í™œì„±í™”:**
```yaml
fallback_chain:
  enabled: false  # ê¸°ì¡´ ë™ì‘ (ë„êµ¬ 1ê°œë§Œ ì‹¤í–‰)
```

**2. ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ë³€ê²½:**
```yaml
fallback_chain:
  max_retries: 5  # ìµœëŒ€ 5íšŒê¹Œì§€ ì¬ì‹œë„ (ê¸°ë³¸ê°’: 3)
```

**3. Router ê²€ì¦ ë¹„í™œì„±í™”:**
```yaml
fallback_chain:
  validation_enabled: false  # Router ê²€ì¦ ìƒëµ
```

**4. ë„êµ¬ ìš°ì„ ìˆœìœ„ ì»¤ìŠ¤í„°ë§ˆì´ì§•:**
```yaml
fallback_chain:
  priorities:
    paper_search:
      - web_search     # 1ìˆœìœ„: ì›¹ ê²€ìƒ‰ (ë³€ê²½)
      - search_paper   # 2ìˆœìœ„: DB ê²€ìƒ‰
      - glossary       # 3ìˆœìœ„: ìš©ì–´ì§‘ (ì¶”ê°€)
      - general        # 4ìˆœìœ„: ì¼ë°˜ ë‹µë³€
```

**ì£¼ì˜ì‚¬í•­:**
- ëª¨ë“  ìš°ì„ ìˆœìœ„ ë¦¬ìŠ¤íŠ¸ëŠ” ë§ˆì§€ë§‰ì— `general` í¬í•¨ ê¶Œì¥
- `general` ë„êµ¬ëŠ” í•­ìƒ ì„±ê³µí•˜ë¯€ë¡œ ìµœì¢… Fallback ì—­í• 
- ìš°ì„ ìˆœìœ„ ë¦¬ìŠ¤íŠ¸ëŠ” ìµœëŒ€ 3-4ê°œ ê¶Œì¥ (ë¹„ìš© ë° ì‘ë‹µ ì‹œê°„ ê³ ë ¤)

---

## ğŸ” ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: glossary ì‹¤íŒ¨ â†’ general Fallback

**ì‹œë‚˜ë¦¬ì˜¤**: ìš©ì–´ì§‘ì— ì—†ëŠ” ìš©ì–´ ì§ˆë¬¸

```
ì‚¬ìš©ì: "mlì´ ë­ì•¼?"
    â†“
Step 1. QuestionClassifier
    - ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜: "term_definition"
    - ìš°ì„ ìˆœìœ„ ì²´ì¸ ë¡œë“œ: ["glossary", "general"]
    â†“
Step 2. Router ë…¸ë“œ
    - ë„êµ¬ ì„ íƒ: "glossary"
    â†“
Step 3. Glossary ë„êµ¬ ì‹¤í–‰
    - glossary í…Œì´ë¸” ê²€ìƒ‰
    - ê²°ê³¼ ì—†ìŒ: "ê´€ë ¨ ìš©ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    - state["tool_status"] = "failed"  (tool_wrapper.py:60)
    â†“
Step 4. should_fallback() í•¨ìˆ˜ (graph.py:63)
    - tool_status == "failed" â†’ "retry" ë°˜í™˜
    â†“
Step 5. Fallback Router (nodes.py:120)
    - state["failed_tools"].append("glossary")
    - state["retry_count"] = 1
    - fallback_chain = ["glossary", "general"]
    - ë‹¤ìŒ ë„êµ¬: "general"
    - state["tool_choice"] = "general"
    â†“
Step 6. General ë„êµ¬ ì‹¤í–‰
    - LLM ìì²´ ì§€ì‹ìœ¼ë¡œ ë‹µë³€
    - "MLì€ Machine Learningì˜ ì•½ìë¡œ..."
    - state["tool_status"] = "success"
    â†“
Step 7. should_fallback() í•¨ìˆ˜
    - tool_status == "success" â†’ "end" ë°˜í™˜
    â†“
END (ì„±ê³µ) âœ…
```

**ë¡œê·¸ ì¶œë ¥:**
```
[Fallback Router ì‹¤í–‰]
ì‹¤íŒ¨í•œ ë„êµ¬: glossary
ì¬ì‹œë„ íšŸìˆ˜: 1/3
ë‹¤ìŒ ë„êµ¬ ì„ íƒ: general
Fallback Chain: glossary â†’ general
```

### ì˜ˆì‹œ 2: search_paper ì‹¤íŒ¨ â†’ web_search â†’ ì„±ê³µ

**ì‹œë‚˜ë¦¬ì˜¤**: ë¡œì»¬ DBì— ì—†ëŠ” ìµœì‹  ë…¼ë¬¸ ì§ˆë¬¸

```
ì‚¬ìš©ì: "ìµœì‹  Diffusion Model ë…¼ë¬¸ ì°¾ì•„ì¤˜"
    â†“
Step 1. QuestionClassifier
    - ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜: "latest_research"
    - ìš°ì„ ìˆœìœ„ ì²´ì¸ ë¡œë“œ: ["web_search", "search_paper", "general"]
    â†“
Step 2. Router ë…¸ë“œ
    - ë„êµ¬ ì„ íƒ: "web_search" (ìµœì‹  ì •ë³´ í•„ìš”)
    â†“
Step 3. Web Search ë„êµ¬ ì‹¤í–‰
    - Tavily API ê²€ìƒ‰
    - arXiv ë…¼ë¬¸ ë°œê²¬:
      * "Diffusion Models Beat GANs on Image Synthesis" (2021)
      * "High-Resolution Image Synthesis with Latent Diffusion Models" (2022)
    - arXiv ë…¼ë¬¸ ìë™ ë‹¤ìš´ë¡œë“œ ë° DB ì €ì¥
    - state["tool_status"] = "success"
    â†“
Step 4. should_fallback() í•¨ìˆ˜
    - tool_status == "success" â†’ "end" ë°˜í™˜
    â†“
END (ì„±ê³µ) âœ…
```

**ë‹µë³€ ì˜ˆì‹œ:**
```
ìµœì‹  Diffusion Model ë…¼ë¬¸ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤:

1. **Diffusion Models Beat GANs on Image Synthesis** (2021)
   - ì €ì: Prafulla Dhariwal, Alex Nichol
   - ì£¼ìš” ë‚´ìš©: Diffusion ëª¨ë¸ì´ ì´ë¯¸ì§€ ìƒì„±ì—ì„œ GANì„ ëŠ¥ê°€í•¨ì„ ì…ì¦
   - ë§í¬: https://arxiv.org/abs/2105.05233

2. **High-Resolution Image Synthesis with Latent Diffusion Models** (2022)
   - ì €ì: Robin Rombach, et al.
   - ì£¼ìš” ë‚´ìš©: Latent Spaceì—ì„œ Diffusion ìˆ˜í–‰ìœ¼ë¡œ ê³ í•´ìƒë„ ìƒì„±
   - ë§í¬: https://arxiv.org/abs/2112.10752

ë…¼ë¬¸ì´ ìë™ìœ¼ë¡œ DBì— ì €ì¥ë˜ì–´, í–¥í›„ "Diffusion Model ì„¤ëª…í•´ì¤˜" ì§ˆë¬¸ ì‹œ RAG ê²€ìƒ‰ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.
```

### ì˜ˆì‹œ 3: Router ê²€ì¦ ì‹¤íŒ¨ â†’ ì¬ë¼ìš°íŒ…

**ì‹œë‚˜ë¦¬ì˜¤**: Routerì˜ ì˜ëª»ëœ ë„êµ¬ ì„ íƒ

```
ì‚¬ìš©ì: "Attention ë©”ì»¤ë‹ˆì¦˜ ì„¤ëª…í•´ì¤˜"
    â†“
Step 1. QuestionClassifier
    - ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜: "term_definition"
    - ìš°ì„ ìˆœìœ„ ì²´ì¸ ë¡œë“œ: ["glossary", "general"]
    â†“
Step 2. Router ë…¸ë“œ
    - ë„êµ¬ ì„ íƒ: "save_file" (ì˜ëª»ëœ íŒë‹¨)
    â†“
Step 3. Validator ë…¸ë“œ (nodes.py:205)
    - validation_enabled == true
    - LLM ê²€ì¦ í”„ë¡¬í”„íŠ¸:
      """
      ì§ˆë¬¸: Attention ë©”ì»¤ë‹ˆì¦˜ ì„¤ëª…í•´ì¤˜
      ì„ íƒëœ ë„êµ¬: save_file
      ë„êµ¬ ì„¤ëª…: ë‹µë³€ì„ íŒŒì¼ë¡œ ì €ì¥

      ì´ ë„êµ¬ ì„ íƒì´ ì§ˆë¬¸ì— ì ì ˆí•œê°€ìš”? (yes/no)
      """
    - LLM ì‘ë‹µ: "no" (ë¶€ì ì ˆí•¨)
    - state["validation_failed"] = True
    - state["validation_retries"] = 1
    â†“
Step 4. should_validate() í•¨ìˆ˜ (graph.py:92)
    - validation_failed == True â†’ "re_route" ë°˜í™˜
    â†“
Step 5. Router ì¬ì‹¤í–‰
    - ì§ˆë¬¸ ì¬ë¶„ì„
    - ë„êµ¬ ì„ íƒ: "glossary" (ì˜¬ë°”ë¥¸ ì„ íƒ)
    â†“
Step 6. Validator ë…¸ë“œ
    - LLM ê²€ì¦ í”„ë¡¬í”„íŠ¸:
      """
      ì§ˆë¬¸: Attention ë©”ì»¤ë‹ˆì¦˜ ì„¤ëª…í•´ì¤˜
      ì„ íƒëœ ë„êµ¬: glossary
      ë„êµ¬ ì„¤ëª…: AI/ML ìš©ì–´ ì •ì˜ ê²€ìƒ‰

      ì´ ë„êµ¬ ì„ íƒì´ ì§ˆë¬¸ì— ì ì ˆí•œê°€ìš”? (yes/no)
      """
    - LLM ì‘ë‹µ: "yes" (ì ì ˆí•¨)
    - state["validation_failed"] = False
    â†“
Step 7. Glossary ë„êµ¬ ì‹¤í–‰
    - ìš©ì–´ ì •ì˜ ê²€ìƒ‰
    - "Attentionì€ ì…ë ¥ ë°ì´í„°ì˜ íŠ¹ì • ë¶€ë¶„ì— ì§‘ì¤‘í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜..."
    - state["tool_status"] = "success"
    â†“
END (ì„±ê³µ) âœ…
```

**ë¡œê·¸ ì¶œë ¥:**
```
[Router ê²€ì¦ ì‹œì‘]
ì„ íƒëœ ë„êµ¬: save_file
ë„êµ¬ ì„¤ëª…: ë‹µë³€ì„ íŒŒì¼ë¡œ ì €ì¥
ê²€ì¦ ê²°ê³¼: ë¶€ì ì ˆí•¨ (FAIL)
ì¬ë¼ìš°íŒ… ì§„í–‰ (ì¬ì‹œë„ 1/2)

[Router ì¬ì‹¤í–‰]
ì„ íƒëœ ë„êµ¬: glossary
ë„êµ¬ ì„¤ëª…: AI/ML ìš©ì–´ ì •ì˜ ê²€ìƒ‰
ê²€ì¦ ê²°ê³¼: ì ì ˆí•¨ (PASS)
```

### ì˜ˆì‹œ 4: ëª¨ë“  ë„êµ¬ ì‹¤íŒ¨ â†’ ìµœì¢… Fallback

**ì‹œë‚˜ë¦¬ì˜¤**: ëª¨ë“  ë„êµ¬ê°€ ì‹¤íŒ¨í•˜ëŠ” ì˜ˆì™¸ ìƒí™©

```
ì‚¬ìš©ì: "XYZ ë…¼ë¬¸ ì°¾ì•„ì¤˜" (ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë…¼ë¬¸)
    â†“
Step 1. QuestionClassifier
    - ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜: "paper_search"
    - ìš°ì„ ìˆœìœ„ ì²´ì¸ ë¡œë“œ: ["search_paper", "web_search", "general"]
    â†“
Step 2. Router â†’ search_paper ì‹¤í–‰
    - ê²°ê³¼ ì—†ìŒ: "ê´€ë ¨ ë…¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    - state["tool_status"] = "failed"
    â†“
Step 3. Fallback Router â†’ web_search ì‹¤í–‰
    - ì›¹ ê²€ìƒ‰ ì‹¤íŒ¨: "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤."
    - state["tool_status"] = "failed"
    - state["retry_count"] = 2
    â†“
Step 4. Fallback Router â†’ general ì‹¤í–‰
    - LLM ì§ì ‘ ë‹µë³€
    - "ì£„ì†¡í•©ë‹ˆë‹¤. 'XYZ ë…¼ë¬¸'ì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤..."
    - state["tool_status"] = "success"
    â†“
END (ì„±ê³µ) âœ…
```

**ë‹µë³€ ì˜ˆì‹œ:**
```
ì£„ì†¡í•©ë‹ˆë‹¤. "XYZ ë…¼ë¬¸"ì— ëŒ€í•œ ì •ë³´ë¥¼ ë…¼ë¬¸ DBì™€ ì›¹ ê²€ìƒ‰ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•´ì£¼ì„¸ìš”:
1. ë…¼ë¬¸ ì œëª©ì´ ì •í™•í•œê°€ìš”?
2. ì €ì ì´ë¦„ì´ë‚˜ ë°œí–‰ ì—°ë„ë¥¼ í•¨ê»˜ ì•Œë ¤ì£¼ì‹œë©´ ë” ì •í™•í•œ ê²€ìƒ‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
3. ë‹¤ë¥¸ í‚¤ì›Œë“œë‚˜ ê´€ë ¨ ì£¼ì œë¥¼ ê²€ìƒ‰í•´ë³´ì‹œê² ì–´ìš”?

ì˜ˆì‹œ:
- "Transformer ë…¼ë¬¸ ì°¾ì•„ì¤˜"
- "BERT ê´€ë ¨ ë…¼ë¬¸ ê²€ìƒ‰í•´ì¤˜"
- "2024ë…„ ìµœì‹  LLM ë…¼ë¬¸ì€?"
```

### ì˜ˆì‹œ 5: ìµœëŒ€ ì¬ì‹œë„ ì´ˆê³¼ â†’ general ê°•ì œ ì‹¤í–‰

**ì‹œë‚˜ë¦¬ì˜¤**: ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ (max_retries=3)

```
ì‚¬ìš©ì: "ABC ë…¼ë¬¸ ìš”ì•½í•´ì¤˜" (ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë…¼ë¬¸)
    â†“
Step 1. QuestionClassifier
    - ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜: "paper_summary"
    - ìš°ì„ ìˆœìœ„ ì²´ì¸ ë¡œë“œ: ["summarize", "search_paper", "general"]
    â†“
Step 2. Router â†’ summarize ì‹¤í–‰
    - ê²°ê³¼: "ìš”ì•½í•  ë…¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    - state["tool_status"] = "failed"
    - state["retry_count"] = 1
    â†“
Step 3. Fallback Router â†’ search_paper ì‹¤í–‰
    - ê²°ê³¼: "ê´€ë ¨ ë…¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    - state["tool_status"] = "failed"
    - state["retry_count"] = 2
    â†“
Step 4. Fallback Router â†’ general ì‹¤í–‰
    - ê²°ê³¼: "ë…¼ë¬¸ ì œëª©ì„ í™•ì¸í•´ì£¼ì„¸ìš”..."
    - state["tool_status"] = "success"
    â†“
END (ì„±ê³µ) âœ…
```

**ë¡œê·¸ ì¶œë ¥:**
```
[Fallback Router ì‹¤í–‰]
ì‹¤íŒ¨í•œ ë„êµ¬: summarize
ì¬ì‹œë„ íšŸìˆ˜: 1/3
ë‹¤ìŒ ë„êµ¬ ì„ íƒ: search_paper
Fallback Chain: summarize â†’ search_paper â†’ general

[Fallback Router ì‹¤í–‰]
ì‹¤íŒ¨í•œ ë„êµ¬: search_paper
ì¬ì‹œë„ íšŸìˆ˜: 2/3
ë‹¤ìŒ ë„êµ¬ ì„ íƒ: general
Fallback Chain: summarize â†’ search_paper â†’ general

[General ë„êµ¬ ì‹¤í–‰]
ë„êµ¬ ì‹¤í–‰ ì„±ê³µ: general
```

---

## ğŸ“Š ì‹¤í–‰ íë¦„

### Fallback Chain í™œì„±í™” ëª¨ë“œ

**LangGraph ì¡°ê±´ë¶€ ì—£ì§€ êµ¬ì¡°** (`src/agent/graph.py:200-245`)

```python
# Router â†’ Validator
workflow.add_conditional_edges(
    "router",
    should_validate,
    {
        "skip_validation": route_to_tool,  # ê²€ì¦ ê±´ë„ˆë›°ê³  ë°”ë¡œ ë„êµ¬ ì‹¤í–‰
        "re_route": "router",               # ê²€ì¦ ì‹¤íŒ¨ â†’ ì¬ë¼ìš°íŒ…
        "proceed": route_to_tool            # ê²€ì¦ í†µê³¼ â†’ ë„êµ¬ ì‹¤í–‰
    }
)

# ê° ë„êµ¬ â†’ Fallback ì²´í¬
for tool_name in ["glossary", "search_paper", "web_search", "summarize", "text2sql", "save_file"]:
    workflow.add_conditional_edges(
        tool_name,
        should_fallback,
        {
            "end": END,                         # ì„±ê³µ â†’ ì¢…ë£Œ
            "retry": "fallback_router",         # ì‹¤íŒ¨ â†’ Fallback Router
            "final_fallback": "final_fallback"  # ìµœëŒ€ ì¬ì‹œë„ ì´ˆê³¼ â†’ ìµœì¢… Fallback
        }
    )

# Fallback Router â†’ ë‹¤ìŒ ë„êµ¬
workflow.add_conditional_edges(
    "fallback_router",
    route_to_tool,
    {
        "general": "general",
        "glossary": "glossary",
        "search_paper": "search_paper",
        "web_search": "web_search",
        "summarize": "summarize",
        "text2sql": "text2sql",
        "save_file": "save_file"
    }
)

# general ë„êµ¬ëŠ” í•­ìƒ ì¢…ë£Œ (ìµœì¢… Fallback)
workflow.add_edge("general", END)

# final_fallback ë…¸ë“œë„ ì¢…ë£Œ
workflow.add_edge("final_fallback", END)
```

### Fallback Chain ë¹„í™œì„±í™” ëª¨ë“œ

**ê¸°ì¡´ ë™ì‘ ìœ ì§€** (`src/agent/graph.py:248-267`)

```python
# ë¼ìš°í„°ì—ì„œ ì„ íƒëœ ë„êµ¬ë¡œ ë¶„ê¸°
workflow.add_conditional_edges(
    "router",
    route_to_tool,
    {
        "general": "general",
        "save_file": "save_file",
        "search_paper": "search_paper",
        "web_search": "web_search",
        "glossary": "glossary",
        "summarize": "summarize",
        "text2sql": "text2sql"
    }
)

# ëª¨ë“  ë„êµ¬ ë…¸ë“œì—ì„œ ì¢…ë£Œ
for node in ["general", "save_file", "search_paper", "web_search", "glossary", "summarize", "text2sql"]:
    workflow.add_edge(node, END)
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ë¹„ìš© ì¦ê°€ ì£¼ì˜

**Fallback Chainì€ ë„êµ¬ ì¬ì‹¤í–‰ìœ¼ë¡œ LLM í˜¸ì¶œ ì¦ê°€**

**ì˜ˆìƒ ë¹„ìš©:**
- Router ê²€ì¦: LLM í˜¸ì¶œ 1íšŒ ì¶”ê°€ ($0.001)
- ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜: LLM í˜¸ì¶œ 1íšŒ ($0.001)
- Fallback 1íšŒ: ë„êµ¬ ì¬ì‹¤í–‰ ($0.003~$0.015)
- ìµœëŒ€ ì¬ì‹œë„ 3íšŒ: ìµœëŒ€ $0.05

**ë¹„ìš© ì ˆê° ì „ëµ:**
- `max_retries`ë¥¼ 3 ì´í•˜ë¡œ ì„¤ì •
- `validation_enabled=false`ë¡œ Router ê²€ì¦ ìƒëµ
- ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜ ê²°ê³¼ ìºì‹± (ì´ë¯¸ êµ¬í˜„ë¨)

### 2. ë¬´í•œ ë£¨í”„ ë°©ì§€

**`max_retries` í•„ìˆ˜ ì„¤ì •**

```yaml
fallback_chain:
  max_retries: 3  # ë°˜ë“œì‹œ ì„¤ì • (ê¸°ë³¸ê°’: 3)
  validation_retries: 2  # Router ê²€ì¦ ì¬ì‹œë„ (ê¸°ë³¸ê°’: 2)
```

**ë¬´í•œ ë£¨í”„ ë°œìƒ ì‹œë‚˜ë¦¬ì˜¤:**
- `max_retries`ê°€ ì—†ìœ¼ë©´ ë„êµ¬ ì‹¤íŒ¨ ì‹œ ë¬´í•œ ì¬ì‹œë„
- `validation_retries`ê°€ ì—†ìœ¼ë©´ ê²€ì¦ ì‹¤íŒ¨ ì‹œ ë¬´í•œ ì¬ë¼ìš°íŒ…

**ê°•ì œ ì¢…ë£Œ ë©”ì»¤ë‹ˆì¦˜:**
- `retry_count > max_retries` â†’ general ê°•ì œ ì‹¤í–‰
- `validation_retries > max_validation` â†’ general ê°•ì œ ì‹¤í–‰

### 3. ë¡œê¹… í•„ìˆ˜

**Fallback ì´ë²¤íŠ¸ëŠ” ëª¨ë‘ ë¡œê·¸ ê¸°ë¡**

```python
# src/agent/nodes.py:141-144
if exp_manager:
    exp_manager.logger.write("=" * 60)
    exp_manager.logger.write("Fallback Router ì‹¤í–‰")
    exp_manager.logger.write(f"ì‹¤íŒ¨í•œ ë„êµ¬: {failed_tool}")
    exp_manager.logger.write(f"ì¬ì‹œë„ íšŸìˆ˜: {retry_count}/{max_retries}")
```

**ë¡œê·¸ íŒŒì¼ ìœ„ì¹˜:**
```
experiments/20251104/20251104_143022_session_001/
â”œâ”€â”€ agent.log                   # Agent ì „ì²´ ë¡œê·¸
â”œâ”€â”€ fallback_router.log         # Fallback Router ë¡œê·¸
â”œâ”€â”€ validator.log               # Router ê²€ì¦ ë¡œê·¸
â””â”€â”€ metadata.json               # íƒ€ì„ë¼ì¸ í¬í•¨
```

**metadata.json íƒ€ì„ë¼ì¸ ì˜ˆì‹œ:**
```json
{
  "tool_timeline": [
    {
      "timestamp": "2025-11-04T14:30:22.123456",
      "event": "tool_start",
      "tool": "glossary",
      "retry_count": 0
    },
    {
      "timestamp": "2025-11-04T14:30:23.456789",
      "event": "tool_end",
      "tool": "glossary",
      "status": "failed",
      "retry_count": 0
    },
    {
      "timestamp": "2025-11-04T14:30:23.500000",
      "event": "fallback",
      "from_tool": "glossary",
      "to_tool": "general",
      "retry_count": 1
    },
    {
      "timestamp": "2025-11-04T14:30:24.000000",
      "event": "tool_start",
      "tool": "general",
      "retry_count": 1
    },
    {
      "timestamp": "2025-11-04T14:30:25.500000",
      "event": "tool_end",
      "tool": "general",
      "status": "success",
      "retry_count": 1
    }
  ]
}
```

### 4. ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜ ì •í™•ë„

**ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜ ì‹¤íŒ¨ ì‹œ ë¹„íš¨ìœ¨ì ì¸ Fallback Chain**

**ì˜ˆì‹œ:**
```
ì§ˆë¬¸: "ìµœì‹  LLM ë…¼ë¬¸ ì°¾ì•„ì¤˜"
    â†“
ì˜ëª»ëœ ë¶„ë¥˜: "term_definition"
    â†’ ìš°ì„ ìˆœìœ„ ì²´ì¸: ["glossary", "general"]
    â†’ glossary ì‹¤í–‰ â†’ ì‹¤íŒ¨ â†’ general ì‹¤í–‰
    â†“
ì˜¬ë°”ë¥¸ ë¶„ë¥˜: "latest_research"
    â†’ ìš°ì„ ìˆœìœ„ ì²´ì¸: ["web_search", "search_paper", "general"]
    â†’ web_search ì‹¤í–‰ â†’ ì„±ê³µ (1ë²ˆ ë§Œì— ì¢…ë£Œ)
```

**ê°œì„  ë°©ë²•:**
- QuestionClassifier í”„ë¡¬í”„íŠ¸ ê°œì„  (Few-shot ì˜ˆì‹œ ì¶”ê°€)
- ë¶„ë¥˜ ê²°ê³¼ ë¡œê·¸ ë¶„ì„ ë° ì •ê¸° ê°œì„ 
- ë¶„ë¥˜ ìºì‹œ ì£¼ê¸°ì  ì´ˆê¸°í™” (`clear_classification_cache()`)

### 5. ì¼ë°˜ ë‹µë³€ ë„êµ¬ëŠ” í•­ìƒ ìµœì¢… Fallback

**ëª¨ë“  ìš°ì„ ìˆœìœ„ ë¦¬ìŠ¤íŠ¸ ëì— `general` í¬í•¨ í•„ìˆ˜**

```yaml
fallback_chain:
  priorities:
    term_definition:
      - glossary
      - general  # í•„ìˆ˜

    paper_search:
      - search_paper
      - web_search
      - general  # í•„ìˆ˜
```

**ì´ìœ :**
- `general` ë„êµ¬ëŠ” í•­ìƒ ì„±ê³µ (LLM ì§ì ‘ í˜¸ì¶œ)
- ìµœì¢… Fallback ì—­í•  (ëª¨ë“  ë„êµ¬ ì‹¤íŒ¨ ì‹œì—ë„ ë‹µë³€ ì œê³µ)
- `general` ì—†ì´ ëª¨ë“  ë„êµ¬ ì‹¤íŒ¨ ì‹œ `final_fallback_node` ì‹¤í–‰

### 6. ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

**Fallback Chain ê¸¸ì´: ìµœëŒ€ 3-4ê°œ ë„êµ¬ ê¶Œì¥**

```yaml
# ê¶Œì¥ (ì§§ì€ ì²´ì¸)
priorities:
  term_definition:
    - glossary
    - general

# ë¹„ê¶Œì¥ (ê¸´ ì²´ì¸)
priorities:
  term_definition:
    - glossary
    - search_paper
    - web_search
    - summarize
    - text2sql
    - general
```

**ì´ìœ :**
- ê¸´ ì²´ì¸: ì‘ë‹µ ì‹œê°„ ì¦ê°€ (3ì´ˆ â†’ 15ì´ˆ)
- ê¸´ ì²´ì¸: ë¹„ìš© ì¦ê°€ (LLM í˜¸ì¶œ íšŸìˆ˜ ì¦ê°€)
- ëŒ€ë¶€ë¶„ì˜ ê²½ìš° 2-3ê°œ ë„êµ¬ë¡œ ì¶©ë¶„

### 7. Router ê²€ì¦ í™œì„±í™” ì‹œ ì£¼ì˜

**validation_enabled=true ì‹œ LLM í˜¸ì¶œ 1íšŒ ì¶”ê°€**

```yaml
fallback_chain:
  validation_enabled: true  # Router ê²€ì¦ í™œì„±í™”
  validation_retries: 2     # ìµœëŒ€ ê²€ì¦ ì¬ì‹œë„ íšŸìˆ˜
```

**ë¹„ìš©:**
- Router ê²€ì¦ 1íšŒ: $0.001
- ê²€ì¦ ì‹¤íŒ¨ ì‹œ ì¬ë¼ìš°íŒ…: Router ì¬ì‹¤í–‰ ($0.001)
- ìµœëŒ€ 2íšŒ ì¬ë¼ìš°íŒ…: $0.003

**ê¶Œì¥ ì‚¬í•­:**
- ê°„ë‹¨í•œ ì§ˆë¬¸ ("ì•ˆë…•í•˜ì„¸ìš”")ì€ ê²€ì¦ ìƒëµ ê³ ë ¤
- Router ì •í™•ë„ê°€ ì¶©ë¶„íˆ ë†’ìœ¼ë©´ `validation_enabled=false` ì„¤ì •

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

### í•„ìˆ˜ ì°¸ê³  ë¬¸ì„œ

- **[09_ë„êµ¬_ì‹œìŠ¤í…œ.md](./09_ë„êµ¬_ì‹œìŠ¤í…œ.md)** - 7ê°€ì§€ ë„êµ¬ ìƒì„¸ ì„¤ëª…
- **[03_AI_Agent_ì‹œìŠ¤í…œ.md](./03_AI_Agent_ì‹œìŠ¤í…œ.md)** - Agent ì•„í‚¤í…ì²˜
- **[04_LLM_í´ë¼ì´ì–¸íŠ¸.md](./04_LLM_í´ë¼ì´ì–¸íŠ¸.md)** - LLM í˜¸ì¶œ ë°©ë²•
- **[02_ì‹¤í—˜_ê´€ë¦¬_ì‹œìŠ¤í…œ.md](./02_ì‹¤í—˜_ê´€ë¦¬_ì‹œìŠ¤í…œ.md)** - ExperimentManager ë¡œê¹…

### ì°¸ê³  ì½”ë“œ

- `src/agent/graph.py` - LangGraph ê·¸ë˜í”„ ì¬êµ¬ì„±
- `src/agent/nodes.py` - Fallback ë…¸ë“œ êµ¬í˜„
- `src/agent/failure_detector.py` - ì‹¤íŒ¨ íŒ¨í„´ ê°ì§€
- `src/agent/question_classifier.py` - ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜
- `src/agent/config_loader.py` - Fallback ì„¤ì • ë¡œë”
- `src/agent/tool_wrapper.py` - ë„êµ¬ ë˜í¼
- `configs/model_config.yaml` - Fallback Chain ì„¤ì •

### ì™¸ë¶€ ë§í¬

- [LangGraph ê³µì‹ ë¬¸ì„œ](https://langchain-ai.github.io/langgraph/)
- [LangGraph Conditional Edges](https://langchain-ai.github.io/langgraph/how-tos/branching/)
- [PyYAML ë¬¸ì„œ](https://pyyaml.org/wiki/PyYAMLDocumentation)

---

## ğŸ“ ìš”ì•½

### êµ¬í˜„ëœ í•µì‹¬ ê¸°ëŠ¥

1. âœ… ë„êµ¬ ì‹¤í–‰ ì‹¤íŒ¨ ìë™ ê°ì§€ (FailureDetector)
2. âœ… ì§ˆë¬¸ ìœ í˜• ìë™ ë¶„ë¥˜ (QuestionClassifier, 7ê°€ì§€ ìœ í˜•)
3. âœ… ì§ˆë¬¸ ìœ í˜•ë³„ ë„êµ¬ ìš°ì„ ìˆœìœ„ ì„¤ì • (configs/model_config.yaml)
4. âœ… Router ì„ íƒ ê²€ì¦ (validate_tool_choice_node)
5. âœ… Fallback Router ìë™ ì „í™˜ (fallback_router_node)
6. âœ… ìµœì¢… Fallback ê°•ì œ ì‹¤í–‰ (final_fallback_node)
7. âœ… ë„êµ¬ ì‹¤í–‰ ìƒíƒœ ìë™ ì¶”ì  (tool_wrapper)
8. âœ… ë„êµ¬ ì‹¤í–‰ íƒ€ì„ë¼ì¸ ê¸°ë¡ (metadata.json)
9. âœ… Fallback Chain í™œì„±í™”/ë¹„í™œì„±í™” ì§€ì›

### ê¸°ëŒ€ íš¨ê³¼

**1. ì‚¬ìš©ì ê²½í—˜ ê°œì„ **
- ë„êµ¬ ì„ íƒ ì‹¤íŒ¨ ì‹œì—ë„ ì ì ˆí•œ ë‹µë³€ ì œê³µ
- ì§ˆë¬¸ ì˜ë„ì— ë§ëŠ” ìµœì ì˜ ë„êµ¬ ìë™ ì„ íƒ

**2. ì‹œìŠ¤í…œ ì•ˆì •ì„± í–¥ìƒ**
- ë‹¨ì¼ ë„êµ¬ ì‹¤íŒ¨ë¡œ ì¸í•œ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ë°©ì§€
- ë‹¤ì–‘í•œ ë„êµ¬ë¥¼ í™œìš©í•œ ê°•ê±´í•œ ë‹µë³€ ìƒì„±

**3. ê°œë°œ íš¨ìœ¨ì„± ì¦ëŒ€**
- Fallback ë¡œê·¸ë¡œ ë„êµ¬ ì„ íƒ íŒ¨í„´ ë¶„ì„ ê°€ëŠ¥
- Router ì„±ëŠ¥ ê°œì„  í¬ì¸íŠ¸ íŒŒì•…

**4. ë¹„ìš© ìµœì í™”**
- ì‹¤íŒ¨ ì‹œì—ë§Œ Fallback ì‹¤í–‰ (ë¶ˆí•„ìš”í•œ LLM í˜¸ì¶œ ìµœì†Œí™”)
- ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì œí•œìœ¼ë¡œ ë¹„ìš© í†µì œ

### ì‚¬ìš© íŒ¨í„´

**Agentì—ì„œ ìë™ ì‹¤í–‰:**
```python
# ui/components/chat_interface.py
state = {
    "question": "Transformer ë…¼ë¬¸ ì„¤ëª…í•´ì¤˜",
    "difficulty": "easy",
    "messages": []
}

# Fallback Chain ìƒíƒœ ì´ˆê¸°í™”
state = initialize_fallback_state(state, exp_manager)

# Agent ì‹¤í–‰ (Fallback Chain ìë™ ì ìš©)
result = agent.invoke(state)

# result:
# {
#     "question": "Transformer ë…¼ë¬¸ ì„¤ëª…í•´ì¤˜",
#     "tool_choice": "search_paper",  # ìµœì¢… ì„ íƒëœ ë„êµ¬
#     "final_answer": "TransformerëŠ”...",
#     "retry_count": 0,  # ì¬ì‹œë„ ì—†ì´ ì„±ê³µ
#     "failed_tools": [],  # ì‹¤íŒ¨í•œ ë„êµ¬ ì—†ìŒ
#     "question_type": "paper_search",
#     "fallback_chain": ["search_paper", "web_search", "general"],
#     "tool_status": "success",
#     "tool_timeline": [...]  # ì‹¤í–‰ íƒ€ì„ë¼ì¸
# }
```

### ëª¨ë²” ì‚¬ë¡€

1. **Fallback Chain í™œì„±í™”**: `configs/model_config.yaml`ì—ì„œ `enabled: true` ì„¤ì •
2. **ìµœëŒ€ ì¬ì‹œë„ ì œí•œ**: `max_retries: 3` ê¶Œì¥ (ë¹„ìš© ë° ì‘ë‹µ ì‹œê°„ ê³ ë ¤)
3. **Router ê²€ì¦ í™œì„±í™”**: `validation_enabled: true` ê¶Œì¥ (Router ì •í™•ë„ í–¥ìƒ)
4. **ìš°ì„ ìˆœìœ„ ì²´ì¸ ìµœì í™”**: ì§ˆë¬¸ ìœ í˜•ë³„ 2-3ê°œ ë„êµ¬ ê¶Œì¥
5. **ë¡œê·¸ ë¶„ì„**: Fallback ì´ë²¤íŠ¸ ë¡œê·¸ë¡œ ë„êµ¬ ì„ íƒ íŒ¨í„´ ë¶„ì„
6. **ì •ê¸° ê°œì„ **: QuestionClassifier í”„ë¡¬í”„íŠ¸ ì •ê¸° ê°œì„ 

---

## ì‘ì„±ì

- **ìµœí˜„í™”[íŒ€ì¥]** (Fallback Chain ì‹œìŠ¤í…œ ì„¤ê³„ ë° êµ¬í˜„)
