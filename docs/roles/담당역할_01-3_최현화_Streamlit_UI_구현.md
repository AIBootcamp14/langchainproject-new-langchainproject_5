# ë‹´ë‹¹ì—­í• : ìµœí˜„í™” - Streamlit UI êµ¬í˜„

## ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì**: ìµœí˜„í™”[íŒ€ì¥]

## ë‹´ë‹¹ì ì •ë³´
- **ì´ë¦„**: ìµœí˜„í™”
- **ì—­í• **: Streamlit UI êµ¬í˜„
- **ì°¸ì—¬ ê¸°ê°„**: ì „ì²´ ê¸°ê°„
- **í•µì‹¬ ì—­í• **: Streamlit ê¸°ë°˜ ì±„íŒ… UI, ë‹¤ì¤‘ ì„¸ì…˜ ê´€ë¦¬, LocalStorage ì˜ì†ì„±

---

## êµ¬í˜„ ì™„ë£Œëœ UI ëª¨ë“ˆ

### 1. Streamlit ê¸°ë³¸ UI (`ui/app.py`)
- í˜ì´ì§€ ì„¤ì • (page_title, page_icon, layout)
- ë©”ì¸ í—¤ë” ë° ìº¡ì…˜
- Agent ë° ExperimentManager ì´ˆê¸°í™”
- API í‚¤ ê²€ì¦ (OpenAI, PostgreSQL)
- ë¹ˆ í´ë” ìë™ ì •ë¦¬ ê¸°ëŠ¥
- ì±„íŒ… ì„¸ì…˜ ì´ˆê¸°í™”
- ì‚¬ì´ë“œë°” ë° ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ ë Œë”ë§

### 2. ì‚¬ì´ë“œë°” ì»´í¬ë„ŒíŠ¸ (`ui/components/sidebar.py`)
- **ë‹¤í¬ ëª¨ë“œ í† ê¸€**: CSS ê¸°ë°˜ ë‹¤í¬/ë¼ì´íŠ¸ í…Œë§ˆ ì „í™˜
- **ë‚œì´ë„ ì„¤ëª… ë° ì„ íƒ**: Expanderë¡œ ë‚œì´ë„ ì„¤ëª…, ë¼ë””ì˜¤ ë²„íŠ¼ìœ¼ë¡œ ì„ íƒ
- **ìƒˆ ì±„íŒ… ë²„íŠ¼**: ì„ íƒëœ ë‚œì´ë„ë¡œ ìƒˆ ì±„íŒ… ìƒì„±
- **ì±„íŒ… ëª©ë¡**: ChatGPT ìŠ¤íƒ€ì¼ ë‚ ì§œë³„ ê·¸ë£¹í™” ("ì˜¤ëŠ˜", "ì–´ì œ", "ì§€ë‚œ 7ì¼", "ê·¸ ì´ì „")
- **ì±„íŒ… ì „í™˜/ì‚­ì œ**: í´ë¦­ìœ¼ë¡œ ì±„íŒ… ì „í™˜, ì‚­ì œ ë²„íŠ¼
- **ê°œë³„ ì±„íŒ… ì €ì¥**: ê° ì±„íŒ…ë³„ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ (ë§ˆí¬ë‹¤ìš´ í˜•ì‹)
- **LocalStorage ê´€ë¦¬**: ìˆ˜ë™ ì €ì¥, ì´ˆê¸°í™” ë²„íŠ¼
- **ì‹œìŠ¤í…œ ì •ë³´ í‘œì‹œ**: í”„ë¡œì íŠ¸ ì •ë³´ ìº¡ì…˜

### 3. ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ (`ui/components/chat_interface.py`)
- **ì±„íŒ… íˆìŠ¤í† ë¦¬ í‘œì‹œ**: ì €ì¥ëœ ë©”ì‹œì§€ ë Œë”ë§
- **ë„êµ¬ ì„ íƒ ì •ë³´ í‘œì‹œ**: Agentê°€ ì„ íƒí•œ ë„êµ¬ ë°°ì§€ í‘œì‹œ
- **ë‹µë³€ ë³µì‚¬ ë²„íŠ¼**: JavaScript ê¸°ë°˜ í´ë¦½ë³´ë“œ ë³µì‚¬
- **ì°¸ê³  ë…¼ë¬¸ ì¶œì²˜ í‘œì‹œ**: Expanderë¡œ ì¶œì²˜ ì •ë³´ í‘œì‹œ
- **StreamlitCallbackHandler ì—°ë™**: Agent ì²˜ë¦¬ ê³¼ì • í‘œì‹œ
- **ì „ì²´ ëŒ€í™” ë³µì‚¬/ì €ì¥**: ì „ì²´ ëŒ€í™” ë‚´ì—­ ë³µì‚¬ ë° ë‹¤ìš´ë¡œë“œ
- **ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹…**: UI ì—ëŸ¬ ë¡œê·¸ íŒŒì¼ ì €ì¥
- **ìš©ì–´ ìë™ ì¶”ì¶œ**: AI/ML ìš©ì–´ ìë™ ì¶”ì¶œ ë° DB ì €ì¥

### 4. ì±„íŒ… ì„¸ì…˜ ê´€ë¦¬ (`ui/components/chat_manager.py`)
- **ë‹¤ì¤‘ ì±„íŒ… ì„¸ì…˜ ì§€ì›**: ì—¬ëŸ¬ ì±„íŒ… ë™ì‹œ ê´€ë¦¬
- **ì±„íŒ… ìƒì„±/ì‚­ì œ/ì „í™˜**: UUID ê¸°ë°˜ ì±„íŒ… ID
- **ì±„íŒ… ì œëª© ìë™ ìƒì„±**: ì²« ë²ˆì§¸ ë©”ì‹œì§€ë¡œ ì œëª© ìë™ ì„¤ì • (50ì ì œí•œ)
- **ë‚ ì§œë³„ ê·¸ë£¹í™”**: ì±„íŒ… ëª©ë¡ì„ ë‚ ì§œë³„ë¡œ ë¶„ë¥˜
- **ì±„íŒ… ë‚´ë³´ë‚´ê¸°**: ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì „ì²´ ëŒ€í™” ë‚´ì—­ ë³€í™˜

### 5. LocalStorage ì˜ì†ì„± (`ui/components/storage.py`)
- **ë¸Œë¼ìš°ì € ì €ì¥ì†Œ í™œìš©**: JavaScript LocalStorage API
- **ìë™ ì €ì¥/ë¡œë“œ**: ì±„íŒ… ë°ì´í„° JSON ì§ë ¬í™”
- **ì„¸ì…˜ ìƒíƒœ ë³µì›**: í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œì—ë„ ì±„íŒ… ìœ ì§€
- **ì €ì¥ì†Œ ì´ˆê¸°í™”**: ëª¨ë“  ì±„íŒ… ë°ì´í„° ì‚­ì œ ê¸°ëŠ¥
- **ì €ì¥ì†Œ ì •ë³´ í‘œì‹œ**: ì´ ì±„íŒ… ìˆ˜, ìë™ ì €ì¥ ìƒíƒœ

### 6. íŒŒì¼ ë‹¤ìš´ë¡œë“œ (`ui/components/file_download.py`)
- **ê°œë³„ ë‹µë³€ ë‹¤ìš´ë¡œë“œ**: íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ íŒŒì¼ëª…
- **ì „ì²´ ëŒ€í™” ë‹¤ìš´ë¡œë“œ**: ë§ˆí¬ë‹¤ìš´ í˜•ì‹
- **ë‹¤ìš´ë¡œë“œ ì˜µì…˜**: íŒŒì¼ëª… ì§€ì •, í˜•ì‹ ì„ íƒ (txt/md), ë©”íƒ€ë°ì´í„° í¬í•¨ ì—¬ë¶€

---

## UI ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

### 1. Streamlit UI ì›Œí¬í”Œë¡œìš°

```mermaid
graph TB
    A[ì‚¬ìš©ì ì ‘ì†] --> B[ì‚¬ì´ë“œë°”<br/>ë‚œì´ë„ ì„ íƒ]
    B --> C{Easy or Hard?}
    C -->|Easy| D1[Easy ëª¨ë“œ]
    C -->|Hard| D2[Hard ëª¨ë“œ]

    D1 --> E[ì±„íŒ… ì…ë ¥ì°½]
    D2 --> E

    E --> F[ì§ˆë¬¸ ì…ë ¥]
    F --> G[Agent<br/>ì‹¤í–‰]

    G --> H{ë„êµ¬ ì„ íƒ}
    H -->|RAG| I1[ë…¼ë¬¸ ê²€ìƒ‰]
    H -->|Web| I2[ì›¹ ê²€ìƒ‰]
    H -->|Glossary| I3[ìš©ì–´ ì„¤ëª…]
    H -->|Summarize| I4[ë…¼ë¬¸ ìš”ì•½]

    I1 --> J[ë‹µë³€ ìƒì„±]
    I2 --> J
    I3 --> J
    I4 --> J

    J --> K[ì±„íŒ… í™”ë©´<br/>ë‹µë³€ í‘œì‹œ]
    K --> L{ê³„ì† ì§ˆë¬¸?}
    L -->|Yes| E
    L -->|No| M[âœ… ì¢…ë£Œ]

    style A fill:#81c784,stroke:#388e3c,color:#000
    style B fill:#90caf9,stroke:#1976d2,color:#000
    style C fill:#ba68c8,stroke:#7b1fa2
    style G fill:#ba68c8,stroke:#7b1fa2,color:#000
    style J fill:#a5d6a7,stroke:#388e3c,color:#000
    style K fill:#66bb6a,stroke:#2e7d32,color:#000
```

### 2. ë‹¤ì¤‘ ì±„íŒ… ì„¸ì…˜ êµ¬ì¡°

```mermaid
graph LR
    A[st.session_state] --> B[chats]
    B --> C1[chat_001]
    B --> C2[chat_002]
    B --> C3[chat_003]

    C1 --> D1[messages]
    C1 --> D2[difficulty: easy]
    C1 --> D3[created_at]
    C1 --> D4[title]

    C2 --> E1[messages]
    C2 --> E2[difficulty: hard]
    C2 --> E3[created_at]
    C2 --> E4[title]

    style A fill:#90caf9,stroke:#1976d2,color:#000
    style B fill:#ba68c8,stroke:#7b1fa2,color:#000
    style C1 fill:#ce93d8,stroke:#7b1fa2,color:#000
    style C2 fill:#ce93d8,stroke:#7b1fa2,color:#000
```

---

## êµ¬í˜„ ì½”ë“œ ì˜ˆì œ

### 1. ë©”ì¸ UI êµ¬ì¡° (ui/app.py)

**í•„ìˆ˜ ì„í¬íŠ¸ ëª¨ë“ˆ:**

| ëª¨ë“ˆ | ìš©ë„ |
|------|------|
| `streamlit` | Streamlit í”„ë ˆì„ì›Œí¬ |
| `create_agent_graph` | Agent ê·¸ë˜í”„ ìƒì„± |
| `ExperimentManager` | ì‹¤í—˜ ê´€ë¦¬ ì‹œìŠ¤í…œ |
| `render_sidebar` | ì‚¬ì´ë“œë°” ë Œë”ë§ |
| `display_chat_history`, `render_chat_input` | ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ |
| `initialize_chat_sessions` | ì±„íŒ… ì„¸ì…˜ ì´ˆê¸°í™” |

**í˜ì´ì§€ ì„¤ì • (`st.set_page_config`):**

| ì„¤ì • | ê°’ | ì„¤ëª… |
|------|-----|------|
| `page_title` | "ë…¼ë¬¸ ë¦¬ë·° ì±—ë´‡" | ë¸Œë¼ìš°ì € íƒ­ ì œëª© |
| `page_icon` | "ğŸ“š" | íŒŒë¹„ì½˜ |
| `layout` | "wide" | ì™€ì´ë“œ ë ˆì´ì•„ì›ƒ |
| `initial_sidebar_state` | "expanded" | ì‚¬ì´ë“œë°” ê¸°ë³¸ í™•ì¥ |

**Agent ì´ˆê¸°í™” (`initialize_agent`):**

| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|------|------|------|
| 1 | `@st.cache_resource` ë°ì½”ë ˆì´í„° ì ìš© | ë¦¬ì†ŒìŠ¤ ìºì‹± |
| 2 | `ExperimentManager()` ìƒì„± | ì‹¤í—˜ ê´€ë¦¬ì ì¸ìŠ¤í„´ìŠ¤ |
| 3 | `create_agent_graph(exp_manager)` í˜¸ì¶œ | Agent ì‹¤í–‰ê¸° ìƒì„± |
| 4 | `(agent_executor, exp_manager)` ë°˜í™˜ | ë‘ ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜ |

**ë©”ì¸ ì‹¤í–‰ íë¦„:**

| ìˆœì„œ | ì‘ì—… | í•¨ìˆ˜/ë©”ì„œë“œ |
|------|------|-------------|
| 1 | Agent ë° ê´€ë¦¬ì ì´ˆê¸°í™” | `initialize_agent()` |
| 2 | ë©”ì¸ í—¤ë” í‘œì‹œ | `st.title()`, `st.caption()` |
| 3 | ì±„íŒ… ì„¸ì…˜ ì´ˆê¸°í™” | `initialize_chat_sessions()` |
| 4 | ì‚¬ì´ë“œë°” ë Œë”ë§ | `render_sidebar(exp_manager)` |
| 5 | ì±„íŒ… íˆìŠ¤í† ë¦¬ í‘œì‹œ | `display_chat_history()` |
| 6 | ì±„íŒ… ì…ë ¥ ë Œë”ë§ | `render_chat_input(agent_executor, difficulty, exp_manager)` |

### 2. ë‹¤ì¤‘ ì±„íŒ… ì„¸ì…˜ ê´€ë¦¬ (ui/components/chat_manager.py)

**í•„ìˆ˜ ì„í¬íŠ¸:**

| ëª¨ë“ˆ | ìš©ë„ |
|------|------|
| `streamlit` | ì„¸ì…˜ ìƒíƒœ ê´€ë¦¬ |
| `uuid` | ê³ ìœ  ID ìƒì„± |
| `datetime` | íƒ€ì„ìŠ¤íƒ¬í”„ ìƒì„± |

**í•¨ìˆ˜ 1: `initialize_chat_sessions()`**

| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|------|------|------|
| 1 | `chats` í‚¤ í™•ì¸ | `st.session_state`ì— ì—†ìœ¼ë©´ ë¹ˆ ë”•ì…”ë„ˆë¦¬ ìƒì„± |
| 2 | `current_chat_id` í‚¤ í™•ì¸ | ì—†ìœ¼ë©´ `None`ìœ¼ë¡œ ì´ˆê¸°í™” |

**í•¨ìˆ˜ 2: `create_new_chat(difficulty: str) -> str`**

| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì„¤ëª… |
|----------|------|------|
| `difficulty` | `str` | ë‚œì´ë„ ("easy" ë˜ëŠ” "hard") |

| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|------|------|------|
| 1 | UUID ìƒì„± | `uuid.uuid4()[:8]`ë¡œ 8ì ID ìƒì„± |
| 2 | íƒ€ì„ìŠ¤íƒ¬í”„ ìƒì„± | `"%Y-%m-%d %H:%M:%S"` í˜•ì‹ |
| 3 | ì±„íŒ… ë°ì´í„° ìƒì„± | `messages=[]`, `difficulty`, `created_at`, `title="ìƒˆ ì±„íŒ…"` |
| 4 | ì„¸ì…˜ ìƒíƒœì— ì €ì¥ | `st.session_state.chats[chat_id]`ì— ë”•ì…”ë„ˆë¦¬ ì €ì¥ |
| 5 | í˜„ì¬ ì±„íŒ… ID ì„¤ì • | `current_chat_id = chat_id` |
| 6 | ID ë°˜í™˜ | ìƒì„±ëœ `chat_id` ë°˜í™˜ |

**í•¨ìˆ˜ 3: `switch_chat(chat_id: str)`**

| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|------|------|------|
| 1 | ID ì¡´ì¬ í™•ì¸ | `chat_id in st.session_state.chats` ê²€ì‚¬ |
| 2 | í˜„ì¬ ì±„íŒ… ì „í™˜ | `current_chat_id = chat_id` |

**í•¨ìˆ˜ 4: `delete_chat(chat_id: str)`**

| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|------|------|------|
| 1 | ID ì¡´ì¬ í™•ì¸ | `chat_id in st.session_state.chats` ê²€ì‚¬ |
| 2 | ì±„íŒ… ì‚­ì œ | `del st.session_state.chats[chat_id]` |

### 3. LocalStorage ì˜ì†ì„± (ui/components/storage.py)

**í•„ìˆ˜ ì„í¬íŠ¸:**

| ëª¨ë“ˆ | ìš©ë„ |
|------|------|
| `streamlit` | ì„¸ì…˜ ìƒíƒœ ì ‘ê·¼ |
| `streamlit.components.v1` | HTML/JS ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ |
| `json` | JSON ì§ë ¬í™” |

**í•¨ìˆ˜ 1: `save_chats_to_local_storage()`**

| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|------|------|------|
| 1 | JSON ì§ë ¬í™” | `json.dumps(st.session_state.chats)` |
| 2 | JavaScript ìŠ¤í¬ë¦½íŠ¸ ìƒì„± | `localStorage.setItem('langchain_chats', ...)` |
| 3 | í˜„ì¬ ì±„íŒ… ID ì €ì¥ | `localStorage.setItem('langchain_current_chat_id', ...)` |
| 4 | HTML ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ | `components.html(save_script, height=0)` |

**ì €ì¥ ë°ì´í„°:**

| í‚¤ | ê°’ | ì„¤ëª… |
|-----|-----|------|
| `langchain_chats` | JSON ë¬¸ìì—´ | ëª¨ë“  ì±„íŒ… ì„¸ì…˜ ë°ì´í„° |
| `langchain_current_chat_id` | ë¬¸ìì—´ | í˜„ì¬ í™œì„± ì±„íŒ… ID |

**í•¨ìˆ˜ 2: `clear_local_storage()`**

| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|------|------|------|
| 1 | JavaScript ìŠ¤í¬ë¦½íŠ¸ ìƒì„± | `localStorage.removeItem(...)` í˜¸ì¶œ |
| 2 | ì±„íŒ… ë°ì´í„° ì‚­ì œ | `langchain_chats` í‚¤ ì œê±° |
| 3 | í˜„ì¬ ID ì‚­ì œ | `langchain_current_chat_id` í‚¤ ì œê±° |
| 4 | HTML ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ | `components.html(clear_script, height=0)` |
| 5 | ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ | `st.success("ë¸Œë¼ìš°ì € ì €ì¥ì†Œê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.")` |

### 4. ë‹¤í¬ ëª¨ë“œ í† ê¸€ (ui/components/sidebar.py)

**êµ¬í˜„ ìœ„ì¹˜:**

ì‚¬ì´ë“œë°” ë‚´ë¶€ (`with st.sidebar:` ë¸”ë¡)

**ì²˜ë¦¬ íë¦„:**

| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|------|------|------|
| 1 | ì„¤ì • í—¤ë” í‘œì‹œ | `st.markdown("### âš™ï¸ ì„¤ì •")` |
| 2 | í† ê¸€ ìœ„ì ¯ ìƒì„± | `st.toggle("ğŸŒ™ ë‹¤í¬ ëª¨ë“œ", value=...)` |
| 3 | ì„¸ì…˜ ìƒíƒœì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸° | `st.session_state.get("dark_mode", False)` |
| 4 | ë‹¤í¬ ëª¨ë“œ ì—¬ë¶€ í™•ì¸ | `if dark_mode:` |
| 5 | CSS ìŠ¤íƒ€ì¼ ì ìš© | `st.markdown(..., unsafe_allow_html=True)` |

**ë‹¤í¬ ëª¨ë“œ CSS ì„¤ì •:**

| ì„ íƒì | ì†ì„± | ê°’ | ì„¤ëª… |
|--------|------|-----|------|
| `.stApp` | `background-color` | `#0E1117` | ë©”ì¸ ë°°ê²½ìƒ‰ (ì–´ë‘ìš´ íšŒìƒ‰) |
| `.stApp` | `color` | `#FAFAFA` | ë©”ì¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒ (ë°ì€ íšŒìƒ‰) |
| `.stSidebar` | `background-color` | `#262730` | ì‚¬ì´ë“œë°” ë°°ê²½ìƒ‰ (ì§„í•œ íšŒìƒ‰) |

### 5. ë‹µë³€ ë³µì‚¬ ë²„íŠ¼ (ui/components/chat_interface.py)

**êµ¬í˜„ ë°©ì‹:** JavaScript ê¸°ë°˜ í´ë¦½ë³´ë“œ ë³µì‚¬

**ì²˜ë¦¬ íë¦„:**

| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|------|------|------|
| 1 | ë‹µë³€ í…ìŠ¤íŠ¸ JSON ì§ë ¬í™” | `json.dumps(answer)` (ì•ˆì „í•œ ë¬¸ìì—´ ë³€í™˜) |
| 2 | ê³ ìœ  ID ìƒì„± | `abs(hash(answer))` (ì¶©ëŒ ë°©ì§€) |
| 3 | HTML ë²„íŠ¼ ìƒì„± | `<button id="copy_btn_{unique_id}">` |
| 4 | JavaScript í•¨ìˆ˜ ì •ì˜ | `copyToClipboard_{unique_id}()` |
| 5 | Clipboard API í˜¸ì¶œ | `navigator.clipboard.writeText(text)` |
| 6 | ì„±ê³µ ì‹œ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½ | `'âœ… ë³µì‚¬ë¨!'`ìœ¼ë¡œ ë³€ê²½ |
| 7 | HTML ë Œë”ë§ | `st.markdown(..., unsafe_allow_html=True)` |

**ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì†ì„±:**

| ì†ì„± | ê°’ | ì„¤ëª… |
|------|-----|------|
| `background-color` | `#FF4B4B` | Streamlit ë¹¨ê°„ìƒ‰ |
| `color` | `white` | í°ìƒ‰ í…ìŠ¤íŠ¸ |
| `border` | `none` | í…Œë‘ë¦¬ ì—†ìŒ |
| `padding` | `0.5rem 1rem` | ë‚´ë¶€ ì—¬ë°± |
| `border-radius` | `0.25rem` | ë‘¥ê·¼ ëª¨ì„œë¦¬ |
| `cursor` | `pointer` | í¬ì¸í„° ì»¤ì„œ |

**ê³ ìœ  ID ì‚¬ìš© ì´ìœ :**
- ì—¬ëŸ¬ ë‹µë³€ ë™ì‹œ í‘œì‹œ ì‹œ JavaScript í•¨ìˆ˜ ì¶©ëŒ ë°©ì§€
- ê° ë²„íŠ¼ë§ˆë‹¤ ë…ë¦½ì ì¸ ë³µì‚¬ ê¸°ëŠ¥ ì œê³µ

---

## ì£¼ìš” ê¸°ëŠ¥ ì„¤ëª…

### 1. ë‹¤ì¤‘ ì±„íŒ… ì„¸ì…˜ ê´€ë¦¬

**êµ¬í˜„ ë°©ì‹:**
- `st.session_state.chats`: ë”•ì…”ë„ˆë¦¬ë¡œ ëª¨ë“  ì±„íŒ… ì €ì¥
- `current_chat_id`: í˜„ì¬ í™œì„± ì±„íŒ… ID ì¶”ì 
- UUID ê¸°ë°˜ ê³ ìœ  ID ìƒì„±

**ê¸°ëŠ¥:**
- ë¬´ì œí•œ ì±„íŒ… ìƒì„±
- ì±„íŒ… ê°„ ì „í™˜
- ê°œë³„ ì±„íŒ… ì‚­ì œ
- ì±„íŒ… ì œëª© ìë™ ìƒì„± (ì²« ë©”ì‹œì§€ ê¸°ë°˜)

### 2. ChatGPT ìŠ¤íƒ€ì¼ ë‚ ì§œë³„ ê·¸ë£¹í™”

**ê·¸ë£¹ ë¶„ë¥˜:**
- ì˜¤ëŠ˜: ì˜¤ëŠ˜ ìƒì„±ëœ ì±„íŒ…
- ì–´ì œ: ì–´ì œ ìƒì„±ëœ ì±„íŒ…
- ì§€ë‚œ 7ì¼: ìµœê·¼ 7ì¼ ì´ë‚´
- ê·¸ ì´ì „: 7ì¼ ì´ì „ ì±„íŒ…

**í•¨ìˆ˜: `group_chats_by_date(chat_list)`**

| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì„¤ëª… |
|----------|------|------|
| `chat_list` | `list` | ì±„íŒ… ë¦¬ìŠ¤íŠ¸ |

**ì²˜ë¦¬ íë¦„:**

| ë‹¨ê³„ | ì‘ì—… | ì„¤ëª… |
|------|------|------|
| 1 | í˜„ì¬ ì‹œê°„ ê°€ì ¸ì˜¤ê¸° | `datetime.now()` |
| 2 | ì˜¤ëŠ˜ ì‹œì‘ ì‹œê°„ ê³„ì‚° | `now.replace(hour=0, minute=0, second=0, microsecond=0)` |
| 3 | ì–´ì œ ì‹œì‘ ì‹œê°„ ê³„ì‚° | `today_start - timedelta(days=1)` |
| 4 | ì¼ì£¼ì¼ ì „ ì‹œê°„ ê³„ì‚° | `today_start - timedelta(days=7)` |
| 5 | ê·¸ë£¹ ë”•ì…”ë„ˆë¦¬ ì´ˆê¸°í™” | 4ê°œ í‚¤: "ì˜¤ëŠ˜", "ì–´ì œ", "ì§€ë‚œ 7ì¼", "ê·¸ ì´ì „" |
| 6 | ì±„íŒ… ë¦¬ìŠ¤íŠ¸ ìˆœíšŒ | `for chat in chat_list:` |
| 7 | ìƒì„± ì‹œê°„ íŒŒì‹± | `datetime.strptime(chat["created_at"], "%Y-%m-%d %H:%M:%S")` |
| 8 | ì‹œê°„ëŒ€ë³„ ë¶„ë¥˜ | if/elif ì¡°ê±´ë¬¸ìœ¼ë¡œ ê·¸ë£¹ì— ì¶”ê°€ |
| 9 | ë¹ˆ ê·¸ë£¹ ì œê±° í›„ ë°˜í™˜ | `{k: v for k, v in groups.items() if v}` |

**ë¶„ë¥˜ ì¡°ê±´:**

| ê·¸ë£¹ | ì¡°ê±´ | ì„¤ëª… |
|------|------|------|
| "ì˜¤ëŠ˜" | `created_at >= today_start` | ì˜¤ëŠ˜ 00:00 ì´í›„ |
| "ì–´ì œ" | `created_at >= yesterday_start` | ì–´ì œ 00:00 ~ ì˜¤ëŠ˜ 00:00 |
| "ì§€ë‚œ 7ì¼" | `created_at >= week_ago` | ì¼ì£¼ì¼ ì „ ~ ì–´ì œ |
| "ê·¸ ì´ì „" | `else` | ì¼ì£¼ì¼ ì´ì „ |

### 3. LocalStorage ì˜ì†ì„±

**ì¥ì :**
- í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œì—ë„ ì±„íŒ… ìœ ì§€
- ì„œë²„ ë¶€ë‹´ ì—†ìŒ
- ë¹ ë¥¸ ë¡œë“œ ì†ë„

**ì €ì¥ ë°ì´í„°:**
- ëª¨ë“  ì±„íŒ… ì„¸ì…˜ (messages, difficulty, created_at, title)
- í˜„ì¬ í™œì„± ì±„íŒ… ID
- ë§ˆì§€ë§‰ ë‚œì´ë„ ì„¤ì •

### 4. ë‹¤í¬ ëª¨ë“œ

**êµ¬í˜„ ë°©ì‹:**
- CSS ê¸°ë°˜ ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼
- `st.markdown()` + `unsafe_allow_html=True`
- ë°°ê²½ìƒ‰, í…ìŠ¤íŠ¸ ìƒ‰ìƒ, ì‚¬ì´ë“œë°” ìƒ‰ìƒ ë³€ê²½

**í† ê¸€ ìƒíƒœ ì €ì¥:**

ì„¸ì…˜ ìƒíƒœ í‚¤: `st.session_state.dark_mode`

| ê°’ | ì˜ë¯¸ |
|----|------|
| `True` | ë‹¤í¬ ëª¨ë“œ í™œì„±í™” |
| `False` | ë¼ì´íŠ¸ ëª¨ë“œ (ê¸°ë³¸ê°’) |

### 5. StreamlitCallbackHandler ì—°ë™

**ê¸°ëŠ¥:**
- Agent ì²˜ë¦¬ ê³¼ì • ì‹¤ì‹œê°„ í‘œì‹œ
- Expanderë¡œ ì ‘íŒ ìƒíƒœ í‘œì‹œ
- ì™„ë£Œëœ ë‹¨ê³„ ìë™ ì ‘ê¸°

**ì‚¬ìš© íŒ¨í„´:**

| ë‹¨ê³„ | ì‘ì—… | ì½”ë“œ |
|------|------|------|
| 1 | Expander ì»¨í…Œì´ë„ˆ ìƒì„± | `st.expander("ğŸ” ì²˜ë¦¬ ê³¼ì • ë³´ê¸°", expanded=False)` |
| 2 | CallbackHandler ì´ˆê¸°í™” | `StreamlitCallbackHandler(...)` |
| 3 | Agent ì‹¤í–‰ | `agent_executor.invoke({...}, config={"callbacks": [...]})` |

**StreamlitCallbackHandler íŒŒë¼ë¯¸í„°:**

| íŒŒë¼ë¯¸í„° | ê°’ | ì„¤ëª… |
|----------|-----|------|
| `parent_container` | `process_expander` | í‘œì‹œí•  Streamlit ì»¨í…Œì´ë„ˆ |
| `expand_new_thoughts` | `False` | ìƒˆ ë‹¨ê³„ ìë™ í™•ì¥ ì—¬ë¶€ |
| `collapse_completed_thoughts` | `True` | ì™„ë£Œëœ ë‹¨ê³„ ìë™ ì ‘ê¸° |

**Agent í˜¸ì¶œ ì‹œ config ì„¤ì •:**

| í‚¤ | ê°’ | ì„¤ëª… |
|-----|-----|------|
| `callbacks` | `[st_callback]` | CallbackHandler ë¦¬ìŠ¤íŠ¸ |

---

## ExperimentManager í†µí•©

### UI ë¡œê¹…

**ë¡œê·¸ íŒŒì¼ êµ¬ì¡°:**
```
experiments/20251103/20251103_103015_session_001/
â”œâ”€â”€ chatbot.log                  # ì±—ë´‡ ì‹¤í–‰ ë¡œê·¸
â”œâ”€â”€ ui/
â”‚   â””â”€â”€ user_interactions.log    # UI ì´ë²¤íŠ¸ ë¡œê·¸
â”‚   â””â”€â”€ errors.log               # UI ì—ëŸ¬ ë¡œê·¸
â”œâ”€â”€ outputs/
â”‚   â””â”€â”€ response.txt             # ìµœì¢… ë‹µë³€ ì €ì¥
â””â”€â”€ metadata.json                # ì„¸ì…˜ ë©”íƒ€ë°ì´í„°
```

**ë¡œê¹… í•¨ìˆ˜:**

| í•¨ìˆ˜ | ìš©ë„ | ì‚¬ìš© ì˜ˆ |
|------|------|---------|
| `log_ui_interaction()` | UI ì´ë²¤íŠ¸ ë¡œê·¸ | `"ì‚¬ìš©ì ì§ˆë¬¸: {prompt}"` |
| `log_ui_interaction()` | ì±„íŒ… ìƒì„± ë¡œê·¸ | `"ìƒˆ ì±„íŒ… ìƒì„±: ë‚œì´ë„=easy"` |
| `log_ui_interaction()` | ì„¤ì • ë³€ê²½ ë¡œê·¸ | `"ë‹¤í¬ ëª¨ë“œ í™œì„±í™”"` |
| `update_metadata()` | ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸ | `user_query=prompt, tool_used=tool_choice, success=True` |
| `save_output()` | ë‹µë³€ ì €ì¥ | `save_output("response.txt", answer)` |

**ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸ íŒŒë¼ë¯¸í„°:**

| íŒŒë¼ë¯¸í„° | íƒ€ì… | ì„¤ëª… |
|----------|------|------|
| `user_query` | `str` | ì‚¬ìš©ì ì§ˆë¬¸ |
| `tool_used` | `str` | ì‚¬ìš©ëœ ë„êµ¬ ì´ë¦„ |
| `success` | `bool` | ì„±ê³µ ì—¬ë¶€ |

---

## í…ŒìŠ¤íŠ¸ ì½”ë“œ

### 1. ì±„íŒ… ì„¸ì…˜ ê´€ë¦¬ í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ íŒŒì¼:** `tests/test_chat_manager.py`

**ì„í¬íŠ¸ ëª¨ë“ˆ:**

| ëª¨ë“ˆ | ìš©ë„ |
|------|------|
| `pytest` | í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ |
| `create_new_chat` | ìƒˆ ì±„íŒ… ìƒì„± í•¨ìˆ˜ |
| `switch_chat` | ì±„íŒ… ì „í™˜ í•¨ìˆ˜ |
| `delete_chat` | ì±„íŒ… ì‚­ì œ í•¨ìˆ˜ |
| `get_current_messages` | í˜„ì¬ ë©”ì‹œì§€ ì¡°íšŒ í•¨ìˆ˜ |

**í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ 1: `test_create_new_chat()`**

| ë‹¨ê³„ | ì‘ì—… | ê²€ì¦ |
|------|------|------|
| 1 | `create_new_chat("easy")` í˜¸ì¶œ | `chat_id` ë°˜í™˜ í™•ì¸ |
| 2 | ì±„íŒ… ì¡´ì¬ í™•ì¸ | `chat_id in st.session_state.chats` |
| 3 | ë‚œì´ë„ í™•ì¸ | `difficulty == "easy"` |

**í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ 2: `test_switch_chat()`**

| ë‹¨ê³„ | ì‘ì—… | ê²€ì¦ |
|------|------|------|
| 1 | ë‘ ê°œì˜ ì±„íŒ… ìƒì„± | `chat_id_1`, `chat_id_2` |
| 2 | ì²« ë²ˆì§¸ ì±„íŒ…ìœ¼ë¡œ ì „í™˜ | `switch_chat(chat_id_1)` |
| 3 | í˜„ì¬ ì±„íŒ… ID í™•ì¸ | `current_chat_id == chat_id_1` |

**í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ 3: `test_delete_chat()`**

| ë‹¨ê³„ | ì‘ì—… | ê²€ì¦ |
|------|------|------|
| 1 | ìƒˆ ì±„íŒ… ìƒì„± | `chat_id` ë°˜í™˜ |
| 2 | ì±„íŒ… ì‚­ì œ | `delete_chat(chat_id)` |
| 3 | ì‚­ì œ í™•ì¸ | `chat_id not in st.session_state.chats` |

---

## ì°¸ê³  PRD ë¬¸ì„œ

ê°œë°œ ì‹œ ì°¸ê³ í•œ PRD ë¬¸ì„œ ëª©ë¡:

### í•„ìˆ˜ ì°¸ê³  ë¬¸ì„œ
1. [01_í”„ë¡œì íŠ¸_ê°œìš”.md](../PRD/01_í”„ë¡œì íŠ¸_ê°œìš”.md) - í”„ë¡œì íŠ¸ ì „ì²´ ê°œìš”
2. [02_í”„ë¡œì íŠ¸_êµ¬ì¡°.md](../PRD/02_í”„ë¡œì íŠ¸_êµ¬ì¡°.md) - í´ë” êµ¬ì¡° (ui/)
3. [05_ë¡œê¹…_ì‹œìŠ¤í…œ.md](../PRD/05_ë¡œê¹…_ì‹œìŠ¤í…œ.md) - Logger ì‚¬ìš©ë²•
4. [06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md](../PRD/06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md) - ExperimentManager ë° Session í´ë” êµ¬ì¡°
5. [16_UI_ì„¤ê³„.md](../PRD/16_UI_ì„¤ê³„.md) - Streamlit êµ¬í˜„ ê°€ì´ë“œ

### ì°¸ê³  ë¬¸ì„œ
- [ë‹´ë‹¹ì—­í• _01-1_ìµœí˜„í™”_ì‹¤í—˜_ê´€ë¦¬_ì‹œìŠ¤í…œ.md](ë‹´ë‹¹ì—­í• _01-1_ìµœí˜„í™”_ì‹¤í—˜_ê´€ë¦¬_ì‹œìŠ¤í…œ.md) - ExperimentManager í´ë˜ìŠ¤
- [ë‹´ë‹¹ì—­í• _01-2_ìµœí˜„í™”_ë¡œê¹…_ëª¨ë‹ˆí„°ë§.md](ë‹´ë‹¹ì—­í• _01-2_ìµœí˜„í™”_ë¡œê¹…_ëª¨ë‹ˆí„°ë§.md) - ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ
- [ì‹¤í—˜_í´ë”_êµ¬ì¡°.md](../rules/ì‹¤í—˜_í´ë”_êµ¬ì¡°.md) - ì‹¤í—˜ í´ë” êµ¬ì¡°

---

## ì°¸ê³  ìë£Œ

- Streamlit ê³µì‹ ë¬¸ì„œ: https://docs.streamlit.io/
- Streamlit Chat Elements: https://docs.streamlit.io/library/api-reference/chat
- Streamlit Components: https://docs.streamlit.io/library/components
- StreamlitCallbackHandler: https://python.langchain.com/docs/integrations/callbacks/streamlit
