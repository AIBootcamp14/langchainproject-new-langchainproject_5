## 제목: 추가 선택 기능 구현 (Text-to-SQL, 성능 평가, Reranking 등)

---

## 📋 작업 개요
**작업 주제:** 핵심 기능 완료 후 선택 구현 (가산점 기능)
**작성자:** 최현화[팀장]
**담당자:** @먼저_완료한_팀원
**마감일:** 11/05 24:00

## 📅 기간
- 시작일: 2025-11-04
- 종료일: 2025-11-05

---

## 📌 이슈 목적

핵심 기능(AI Agent, RAG, 용어집, 웹 검색, UI)을 먼저 완료한 팀원이 추가로 선택하여 구현할 수 있는 가산점 기능입니다.

**선택 기준:**
1. 프로젝트에 가산점을 줄 수 있는 기능
2. 구현 난이도와 시간 고려
3. 팀원의 관심사 및 강점

**참고**: 모든 선택 기능은 **필수가 아니며**, 핵심 기능을 먼저 완성한 후 시간이 남을 때만 구현합니다.

---

## ✅ 선택 기능 목록

### 선택 기능 1: Text-to-SQL 도구 (⭐⭐⭐ 가산점, 2-3일)

**기능 설명:** 자연어 질문을 SQL 쿼리로 변환하여 논문 통계 정보 조회

**사용 예시:**
- "2024년에 발표된 논문 개수는?"
- "가장 많이 인용된 논문 Top 5는?"
- "저자별 논문 수 알려줘"

**구현 사항:**
- [x] SQLDatabaseChain 설정 (`src/tools/text2sql.py`)
  - SQLDatabase.from_uri()로 PostgreSQL 연결
  - ChatOpenAI (gpt-5, temperature=0) 사용
  - SQLDatabaseChain 생성
- [x] query_paper_statistics 도구 구현
  - @tool 데코레이터 정의
  - 자연어 → SQL 쿼리 변환
  - 결과 Markdown 포맷팅
- [x] 커스텀 SQL 생성 (선택)
  - SQL_GENERATION_PROMPT 정의
  - custom_sql_query() 구현
  - 오류 처리

**참고 자료:**
- [Langchain SQL Database](https://python.langchain.com/docs/integrations/tools/sql_database)
- roles 문서: [담당역할_05_추가선택기능.md](../roles/담당역할_05_추가선택기능.md) 21-192줄

---

### 선택 기능 2: 성능 평가 시스템 (⭐⭐ 가산점, 2-3일)

**기능 설명:** 챗봇 답변 품질을 자동 평가하는 LLM-as-a-Judge 시스템

**평가 항목:**
1. 정확도 (0-10점): 논문 내용과 일치하는지
2. 관련성 (0-10점): 질문과 답변이 관련있는지
3. 난이도 적합성 (0-10점): Easy/Hard 모드에 맞는지
4. 출처 명시 (0-10점): 논문 제목, 저자 명시 여부

**구현 사항:**
- [x] LLM-as-a-Judge 평가 구현 (`src/evaluation/evaluator.py`)
  - EVALUATION_PROMPT 정의
  - AnswerEvaluator 클래스 및 evaluate() 메서드
  - JSON 파싱 및 결과 반환
- [x] 평가 결과 저장
  - save_evaluation_results() 함수
  - PostgreSQL evaluation_results 테이블 생성
  - 평가 결과 INSERT
- [x] Streamlit UI 표시 (선택)
  - 평가 점수 차트
  - 평가 코멘트 표시

**참고 자료:**
- [LangChain Evaluation](https://python.langchain.com/docs/guides/evaluation/)
- roles 문서: [담당역할_05_추가선택기능.md](../roles/담당역할_05_추가선택기능.md) 195-414줄

---

### 선택 기능 3: Reranking (검색 최적화) (⭐⭐, 1-2일)

**기능 설명:** RAG 검색 결과를 재순위화하여 관련성 높은 문서 상위 배치

**구현 사항:**
- [x] Cohere Rerank 구현 (`src/rag/reranking.py`)
  - create_rerank_retriever() 함수
  - CohereRerank 압축기 생성 (model: rerank-english-v2.0)
  - ContextualCompressionRetriever 생성
- [x] 또는 LLMChainExtractor 구현
  - create_llm_extractor_retriever() 함수
  - LLM 기반 문서 압축
- [x] RAG 검색 도구에 Reranking 적용
- [x] 성능 비교 (Before/After)

**효과:** 상위 20개 → 재순위화 → 상위 5개 선택, 검색 정확도 향상

**참고 자료:**
- [ContextualCompressionRetriever](https://python.langchain.com/docs/modules/data_connection/retrievers/contextual_compression/)
- roles 문서: [담당역할_05_추가선택기능.md](../roles/담당역할_05_추가선택기능.md) 417-466줄

---

### 선택 기능 4: 논문 비교 도구 (⭐, 1일)

**기능 설명:** 여러 논문의 차이점을 비교하여 표로 정리

**사용 예시:**
- "BERT와 GPT 비교해줘"
- "Transformer와 RNN의 차이는?"

**구현 사항:**
- [x] compare_papers 도구 구현 (`src/tools/paper_comparison.py`)
  - @tool 데코레이터 정의 (paper1_title, paper2_title)
  - RAG Retriever로 두 논문 검색
  - 비교 프롬프트 구성 (주요 기여, 구조, 장단점, 성능)
  - LLM 호출하여 Markdown 표 생성

**참고:** roles 문서 469-497줄

---

### 선택 기능 5: 대화 이력 시각화 (⭐, 1일)

**기능 설명:** 사용자 질문 패턴, 도구 사용 빈도 등을 시각화

**구현 사항:**
- [x] 분석 페이지 구현 (`ui/analytics.py`)
  - show_analytics() 함수
  - PostgreSQL query_logs 테이블 조회
  - 도구 사용 통계 차트 (plotly 막대 그래프)
  - 난이도별 질문 분포 차트 (plotly 파이 차트)
- [x] Streamlit 메뉴에 분석 페이지 추가

**시각화 내용:**
- 도구 사용 빈도
- 난이도별 질문 분포
- 시간대별 질문 패턴

**참고:** roles 문서 500-527줄

---

### 선택 기능 6: 멀티모달 지원 (이미지 논문) (⭐⭐⭐, 2-3일)

**기능 설명:** 논문 내 그래프, 표, 수식 이미지를 GPT-5 Vision으로 분석

**구현 사항:**
- [x] GPT-5 Vision 연동
  - ChatOpenAI 초기화 (model: gpt-5-vision-preview)
  - analyze_paper_image() 함수
  - 이미지 Base64 인코딩
  - HumanMessage 생성 (text + image_url)
  - GPT-5 Vision 호출

**참고:** roles 문서 530-554줄

---

## 📦 설치 명령어

```bash
# Text-to-SQL
pip install langchain-community sqlalchemy psycopg2-binary

# 성능 평가
pip install langchain-openai

# Reranking
pip install cohere

# 대화 이력 시각화
pip install plotly pandas

# 멀티모달
pip install langchain-openai pillow
```

---

## ⚡️ 우선순위 추천

### High Priority (가산점 크고 구현 가능)
1. **Text-to-SQL** (⭐⭐⭐) - 2-3일
2. **성능 평가 시스템** (⭐⭐) - 2-3일

### Medium Priority (구현 간단)
3. **Reranking** (⭐⭐) - 1-2일
4. **논문 비교 도구** (⭐) - 1일
5. **대화 이력 시각화** (⭐) - 1일

### Low Priority (시간 많이 소요)
6. **멀티모달 지원** (⭐⭐⭐) - 2-3일

---

## 🔖 선택 가이드

- **시간이 2일 남았다면** → Text-to-SQL 또는 성능 평가 시스템
- **시간이 1일 남았다면** → Reranking 또는 논문 비교 도구
- **시간이 여유 있다면** → 멀티모달 지원

---

## 📚 참고 자료

### 필수 참고 문서
- [담당역할_05_추가선택기능.md](../roles/담당역할_05_추가선택기능.md) ⭐ - 전체 구현 가이드
- [담당역할_01-1_최현화_실험_관리_시스템.md](../roles/담당역할_01-1_최현화_실험_관리_시스템.md) - ExperimentManager 사용법
- [05_로깅_시스템.md](../PRD/05_로깅_시스템.md) - Logger 사용법
- [06_실험_추적_관리.md](../PRD/06_실험_추적_관리.md) - 실험 폴더 구조
- [11_데이터베이스_설계.md](../PRD/11_데이터베이스_설계.md) - DB 스키마 (Text-to-SQL용)

### 외부 링크
- [Langchain SQL Database](https://python.langchain.com/docs/integrations/tools/sql_database)
- [LangChain Evaluation](https://python.langchain.com/docs/guides/evaluation/)
- [ContextualCompressionRetriever](https://python.langchain.com/docs/modules/data_connection/retrievers/contextual_compression/)

---

## 🔖 추천 라벨

`enhancement` `text2sql` `evaluation` `optimization` `experiment` `medium`

---

## ⚠️ 중요 사항

1. **선택 기능은 필수가 아닙니다**
   - 핵심 기능 완성 우선
   - 시간이 남을 때만 구현

2. **ExperimentManager 사용 필수**
   - 모든 추가 기능 개발 시 ExperimentManager 사용
   - 로깅 및 실험 추적 관리

3. **Feature 브랜치 생성 필수**
   - 기능별로 별도 브랜치 생성
   - 예: `feature/text2sql`, `feature/evaluation`

4. **팀원 간 역할 분배**
   - 팀원들과 상의하여 선택
   - 중복 구현 방지

---
