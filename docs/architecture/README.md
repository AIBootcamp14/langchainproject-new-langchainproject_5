# AI Agent 아키텍처 문서

## 📋 문서 정보
- **작성일**: 2025-11-07
- **작성자**: 최현화[팀장]
- **프로젝트명**: 논문 리뷰 챗봇 (AI Agent + RAG)
- **팀명**: 연결의 민족
- **문서 버전**: 1.0

---

## 📑 목차
1. [개요](#개요)
2. [폴더 구조](#폴더-구조)
3. [문서의 목적](#문서의-목적)
4. [7가지 AI Agent 도구](#7가지-ai-agent-도구)
5. [도구 자동 전환 규칙](#도구-자동-전환-규칙)
6. [문서 읽는 방법](#문서-읽는-방법)
7. [초보 개발자를 위한 학습 순서](#초보-개발자를-위한-학습-순서)
8. [핵심 문서 추천](#핵심-문서-추천)
9. [데이터베이스 구조 개요](#데이터베이스-구조-개요)
10. [기술 스택](#기술-스택)
11. [문서 작성 규칙](#문서-작성-규칙)
12. [문서 활용 방법](#문서-활용-방법)

---

## 📌 개요

### 이 폴더의 목적

이 폴더는 **논문 리뷰 챗봇 AI Agent 시스템의 상세 아키텍처 문서**를 담고 있습니다. 초보 개발자도 쉽게 이해할 수 있도록 각 기능의 동작 방식, 데이터 흐름, 도구 간 연계를 상세히 설명합니다.

### 문서 작성 원칙

1. **초보 개발자 이해 수준**: 기술 용어를 최소화하고, 그림(Mermaid 다이어그램)을 적극 활용하여 시각적으로 설명합니다.
2. **실무 중심**: 실제 사용자 요청 예시와 실행 흐름을 포함하여 실무에 바로 적용할 수 있도록 작성했습니다.
3. **완전성**: 모든 가능한 실행 경로(성공/실패 케이스)를 문서화하여 예외 상황에도 대응할 수 있도록 했습니다.

---

## 📁 폴더 구조

```
docs/architecture/
├── README.md                   # 이 파일 (전체 개요)
├── single_request/             # 단일 요청 문서 (8개)
│   ├── 01_RAG_논문_검색.md
│   ├── 02_RAG_용어집_검색.md
│   ├── 03_Web_논문_검색.md
│   ├── 04_Text2SQL.md
│   ├── 05_논문_요약.md
│   ├── 06_저장.md
│   ├── 07_일반_답변.md
│   └── 08_멀티턴_대화.md
└── multiple_request/           # 다중 요청 문서 (16개)
    ├── 01_이중요청_RAG논문검색_논문요약.md
    ├── 02_이중요청_RAG논문검색_저장.md
    ├── 03_이중요청_RAG용어집검색_저장.md
    ├── 04_이중요청_RAG용어집검색_일반답변.md
    ├── 05_이중요청_Web논문검색_논문요약.md
    ├── 06_이중요청_Web논문검색_저장.md
    ├── 07_이중요청_Text2SQL_저장.md
    ├── 08_이중요청_Text2SQL_일반답변.md
    ├── 09_삼중요청_RAG논문검색_논문요약_저장.md
    ├── 10_삼중요청_Web논문검색_논문요약_저장.md
    ├── 11_삼중요청_RAG용어집검색_RAG논문검색_논문요약.md
    ├── 12_삼중요청_Text2SQL_일반답변_저장.md
    ├── 13_삼중요청_Web논문검색_일반답변_저장.md
    ├── 14_삼중요청_RAG논문검색_일반답변_저장.md
    ├── 15_사중요청_용어집_논문검색_요약_저장.md
    └── 16_사중요청_Web논문검색_논문요약_일반답변_저장.md
```

---

## 🎯 문서의 목적

### 단일 요청 문서의 역할

**단일 요청 문서**는 하나의 도구만 사용하는 가장 기본적인 시나리오를 설명합니다.

- **학습 목적**: 각 도구의 기본 동작 원리를 이해하는 출발점입니다.
- **구성 요소**: 도구의 입력, 처리 과정, 출력, 실패 처리 방법을 상세히 설명합니다.
- **예시**:
  - `01_RAG_논문_검색.md`: 사용자가 "Transformer 논문 찾아줘"라고 요청할 때 동작
  - `02_RAG_용어집_검색.md`: 사용자가 "RAG가 뭐야?"라고 요청할 때 동작
  - `04_Text2SQL.md`: 사용자가 "논문 통계 보여줘"라고 요청할 때 동작

### 다중 요청 문서의 역할

**다중 요청 문서**는 두 개 이상의 도구를 순차적으로 연결하여 복잡한 작업을 처리하는 시나리오를 설명합니다.

- **실무 활용**: 실제 사용자는 여러 작업을 한 번에 요청하는 경우가 많으므로, 이를 처리하는 방법을 다룹니다.
- **Fallback 메커니즘**: 각 단계에서 실패할 경우 자동으로 대체 도구로 전환하는 방법을 설명합니다.
- **예시**:
  - `15_사중요청_용어집_논문검색_요약_저장.md`: "RAG 설명하고 논문 찾아서 요약하고 저장해줘" 처리
  - `05_이중요청_Web논문검색_논문요약.md`: "최신 Transformer 논문 찾아서 요약해줘" 처리

---

## 🤖 7가지 AI Agent 도구

### 1. RAG 논문 검색 도구 (`search_paper`)

**역할**: 벡터 DB(ChromaDB)에서 논문을 검색합니다.

- **입력**: 사용자의 논문 검색 키워드 (예: "Transformer", "RAG")
- **처리**: 하이브리드 검색 (벡터 검색 70% + 키워드 검색 30%)
- **출력**: 관련 논문 목록 (제목, 저자, 요약)
- **실패 시**: Web 논문 검색 또는 일반 답변으로 전환

### 2. RAG 용어집 검색 도구 (`glossary`)

**역할**: 벡터 DB에서 AI 용어 정의를 검색합니다.

- **입력**: 사용자의 용어 질문 (예: "RAG가 뭐야?")
- **처리**: 하이브리드 검색 (벡터 검색 50% + 키워드 검색 50%)
- **출력**: 용어 정의와 설명
- **실패 시**: 일반 답변 도구로 전환

### 3. Web 논문 검색 도구 (`web_search`)

**역할**: Tavily API를 사용하여 최신 논문을 웹에서 검색합니다.

- **입력**: 사용자의 논문 검색 키워드 (특히 "최신", "최근" 포함 시)
- **처리**: Tavily API 호출 및 결과 파싱
- **출력**: 최신 논문 목록 (제목, URL, 요약)
- **실패 시**: 일반 답변 도구로 전환

### 4. Text2SQL 도구 (`text2sql`)

**역할**: 자연어 질문을 SQL 쿼리로 변환하여 PostgreSQL에서 통계를 조회합니다.

- **입력**: 사용자의 통계 질문 (예: "논문이 몇 개야?")
- **처리**: Solar-Pro2 모델이 SQL 생성 (Temperature=0.0) 및 실행
- **출력**: 쿼리 결과 (통계 데이터)
- **실패 시**: 일반 답변 도구로 전환

### 5. 논문 요약 도구 (`summarize`)

**역할**: 논문 내용을 요약합니다.

- **입력**: 논문 텍스트 또는 URL
- **처리**: LLM이 논문을 읽고 요약 (Temperature=0.3)
- **출력**: 논문 요약문
- **실패 시**: 일반 답변 도구로 전환

### 6. 저장 도구 (`save_file`)

**역할**: 대화 내용이나 결과를 파일로 저장합니다.

- **입력**: 저장할 텍스트
- **처리**: 파일 시스템에 저장
- **출력**: 저장 완료 메시지
- **실패 시**: 오류 메시지 반환 (Fallback 없음)

### 7. 일반 답변 도구 (`general`)

**역할**: 일반적인 질문에 답변하거나, 다른 도구 실패 시 최종 Fallback으로 동작합니다.

- **입력**: 모든 종류의 질문
- **처리**: LLM이 직접 답변 생성 (Temperature=0.7)
- **출력**: 자연어 답변
- **특징**: 항상 성공 (시스템의 안전망)

---

## 🔄 도구 자동 전환 규칙

시스템은 도구 실행 실패 시 자동으로 대체 도구로 전환하는 **Fallback Chain** 메커니즘을 갖추고 있습니다.

### 1. 용어 검색

```
RAG 용어집 검색 (glossary)
    ↓ 성공
    정의 제공
    ↓ 실패 (용어집에 없음)
    일반 답변 도구 (general)
    ↓
    LLM이 직접 설명
```

**예시**:
- 사용자: "RAG가 뭐야?"
- 시스템: glossary 검색 → 성공 → RAG 정의 제공
- 사용자: "희귀한 AI 용어가 뭐야?"
- 시스템: glossary 검색 → 실패 → general 도구로 LLM이 직접 설명

### 2. 논문 검색 (키워드 기반 분기)

#### ⚡ '최신', '최근' 등 시간 키워드 포함 시

```
Web 논문 검색 (web_search) - RAG 건너뜀
    ↓ 성공
    최신 논문 제공
    ↓ 실패 (웹에서도 못 찾음)
    일반 답변 도구 (general)
    ↓
    LLM이 직접 논문 정보 제공
```

**예시**:
- 사용자: "최신 Transformer 논문 찾아줘"
- 시스템: web_search 직접 호출 → 최신 논문 제공

#### 📚 시간 키워드 없을 시

```
RAG 논문 검색 (search_paper)
    ↓ 성공
    DB에서 논문 제공
    ↓ 실패 (DB에 논문 없음)
    Web 논문 검색 (web_search)
    ↓ 성공
    웹에서 논문 제공
    ↓ 실패 (웹에서도 못 찾음)
    일반 답변 도구 (general)
    ↓
    LLM이 직접 논문 정보 제공
```

**예시**:
- 사용자: "Transformer 논문 찾아줘"
- 시스템: search_paper → 성공 → DB 논문 제공
- 사용자: "희귀한 논문 찾아줘"
- 시스템: search_paper → 실패 → web_search → 실패 → general로 LLM이 설명

### 3. 통계 조회

```
Text2SQL (text2sql)
    ↓ 성공
    SQL 결과 제공
    ↓ 실패 (SQL 생성/실행 오류)
    일반 답변 도구 (general)
    ↓
    LLM이 일반적인 통계 정보 제공
```

**예시**:
- 사용자: "논문이 몇 개야?"
- 시스템: text2sql → SQL 실행 → 통계 제공
- 사용자: "복잡한 통계 보여줘"
- 시스템: text2sql → SQL 생성 실패 → general로 일반 정보 제공

### 4. 논문 요약

```
논문 요약 도구 (summarize)
    ↓ 성공
    논문 요약 제공
    ↓ 실패 (요약 생성 오류)
    일반 답변 도구 (general)
    ↓
    LLM이 직접 요약
```

**예시**:
- 사용자: "이 논문 요약해줘"
- 시스템: summarize → 성공 → 요약문 제공
- 시스템: summarize → 실패 → general로 LLM이 직접 요약

### 5. 일반 질문

```
일반 답변 도구 (general)
    ↓
    LLM이 직접 답변
```

**예시**:
- 사용자: "AI의 미래는 어떻게 될까?"
- 시스템: general 도구로 직접 답변

---

## 📖 문서 읽는 방법

### 각 문서의 구조

모든 아키텍처 문서는 일관된 구조를 따릅니다:

1. **문서 정보**: 작성일, 작성자, 프로젝트명, 팀명, 버전
2. **목차**: 문서의 전체 구조
3. **시나리오 개요**: 이 문서가 다루는 시나리오 설명
4. **사용자 요청 분석**: 실제 사용자 요청 예시
5. **도구 자동 전환 및 Fallback**: 실패 시 대체 경로
6. **단순 흐름 아키텍처**: Mermaid 다이어그램으로 전체 흐름 시각화
7. **상세 기능 동작 흐름도**: 각 단계의 세부 동작
8. **전체 흐름 요약 표**: 표 형식으로 정리
9. **동작 설명 (초보 개발자용)**: 단계별 상세 설명
10. **실행 예시**: 실제 실행 결과
11. **핵심 포인트**: 중요한 사항 요약

### Mermaid 다이어그램 활용법

문서에 포함된 Mermaid 다이어그램은 시스템의 데이터 흐름을 시각적으로 보여줍니다.

- **노드(상자)**: 각 처리 단계나 도구
- **화살표**: 데이터 흐름 방향
- **색상**:
  - 파란색: 정상 흐름
  - 빨간색: 오류/실패 흐름
  - 초록색: 성공 완료
  - 주황색: 조건 분기

**읽는 방법**:
1. 다이어그램의 시작 노드(Start)부터 따라갑니다.
2. 각 화살표의 라벨을 읽으며 조건을 확인합니다.
3. 성공/실패 경로를 모두 확인하여 전체 흐름을 파악합니다.

---

## 🎓 초보 개발자를 위한 학습 순서

### 1단계: 기본 개념 이해

먼저 단일 요청 문서를 읽으며 각 도구의 기본 동작을 이해합니다.

1. `single_request/07_일반_답변.md` - 가장 단순한 도구
2. `single_request/02_RAG_용어집_검색.md` - RAG의 기본 개념
3. `single_request/01_RAG_논문_검색.md` - 벡터 검색 이해
4. `single_request/04_Text2SQL.md` - 자연어를 SQL로 변환

### 2단계: 복잡한 도구 이해

1. `single_request/03_Web_논문_검색.md` - 외부 API 활용
2. `single_request/05_논문_요약.md` - LLM 활용 요약
3. `single_request/06_저장.md` - 파일 저장 메커니즘
4. `single_request/08_멀티턴_대화.md` - 대화 컨텍스트 유지

### 3단계: 이중 요청 이해

두 도구를 연결하는 방법을 학습합니다.

1. `multiple_request/01_이중요청_RAG논문검색_논문요약.md`
2. `multiple_request/05_이중요청_Web논문검색_논문요약.md`
3. `multiple_request/03_이중요청_RAG용어집검색_저장.md`

### 4단계: 삼중 요청 이해

세 도구를 연결하고 Fallback을 이해합니다.

1. `multiple_request/09_삼중요청_RAG논문검색_논문요약_저장.md`
2. `multiple_request/11_삼중요청_RAG용어집검색_RAG논문검색_논문요약.md`

### 5단계: 사중 요청 마스터 (필독)

가장 복잡한 시나리오로 전체 시스템을 이해합니다.

1. `multiple_request/15_사중요청_용어집_논문검색_요약_저장.md` - 핵심 문서
2. `multiple_request/16_사중요청_Web논문검색_논문요약_일반답변_저장.md`

---

## 📚 핵심 문서 추천

### 필독 문서 (우선순위 순)

#### 1. 사중 요청 핵심 문서
- **파일**: `multiple_request/15_사중요청_용어집_논문검색_요약_저장.md`
- **중요도**: ⭐⭐⭐⭐⭐
- **이유**: 모든 Fallback 메커니즘과 도구 연계를 포함한 가장 복잡하고 완전한 시나리오입니다. 이 문서를 이해하면 시스템 전체를 이해할 수 있습니다.

#### 2. Web 논문 검색 관련 문서
- **파일**: `single_request/03_Web_논문_검색.md`
- **중요도**: ⭐⭐⭐⭐
- **이유**: "최신", "최근" 키워드가 포함된 요청 처리 방법을 설명합니다. RAG를 건너뛰고 직접 웹 검색하는 특수 케이스를 다룹니다.

#### 3. 일반 답변 도구 문서
- **파일**: `single_request/07_일반_답변.md`
- **중요도**: ⭐⭐⭐⭐
- **이유**: 모든 도구의 최종 Fallback 역할을 합니다. 시스템의 안전망이므로 반드시 이해해야 합니다.

#### 4. 멀티턴 대화 문서
- **파일**: `single_request/08_멀티턴_대화.md`
- **중요도**: ⭐⭐⭐⭐
- **이유**: 사용자와의 연속적인 대화를 처리하는 방법을 설명합니다. 실무에서 가장 자주 사용되는 시나리오입니다.

#### 5. RAG 논문 검색 문서
- **파일**: `single_request/01_RAG_논문_검색.md`
- **중요도**: ⭐⭐⭐
- **이유**: 시스템의 핵심 기능인 RAG 기반 검색의 기본 동작을 설명합니다.

---

## 🗄️ 데이터베이스 구조 개요

### PostgreSQL (관계형 DB)

**역할**: 논문 메타데이터와 통계 정보를 저장합니다.

**주요 테이블**:
- `papers`: 논문 정보 (제목, 저자, 발행년도, URL 등)
- `users`: 사용자 정보
- `chat_history`: 대화 내역
- `search_logs`: 검색 로그

**활용**:
- Text2SQL 도구가 이 DB를 쿼리하여 통계를 제공합니다.
- 예: "2023년에 발행된 논문이 몇 개야?"

### ChromaDB (벡터 DB)

**역할**: 논문과 용어의 임베딩 벡터를 저장하여 유사도 검색을 수행합니다.

**주요 컬렉션**:
- `papers`: 논문 임베딩
- `glossary`: 용어 정의 임베딩

**활용**:
- RAG 논문 검색 도구와 RAG 용어집 검색 도구가 이 DB를 쿼리합니다.
- 하이브리드 검색 (벡터 검색 + 키워드 검색)을 지원합니다.

---

## 🛠️ 기술 스택

### LLM (언어 모델)

#### Easy 모드 (한국어 특화, 비용 절감)
- **모델**: Solar-Pro2
- **제공자**: Upstage
- **용도**: 일반 답변, Text2SQL, RAG MultiQuery
- **설정**: Temperature 0.7 (답변 생성), 0.0 (SQL/라우팅)

#### Hard 모드 (기술적 정확도)
- **모델**: GPT-5
- **제공자**: OpenAI
- **용도**: 복잡한 논문 분석, 고급 추론
- **설정**: Temperature 0.7

### 임베딩 모델
- **모델**: text-embedding-3-small
- **제공자**: OpenAI
- **차원**: 1536
- **용도**: 논문 및 용어 벡터화

### 데이터베이스
- **PostgreSQL**: 관계형 데이터 저장
- **ChromaDB**: 벡터 검색

### 외부 API
- **Tavily API**: 최신 논문 웹 검색

### 프레임워크
- **LangChain**: AI Agent 오케스트레이션
- **LangGraph**: 복잡한 워크플로우 관리
- **Pydantic**: 데이터 검증

---

## 📝 문서 작성 규칙

### Mermaid 스타일 준수

모든 Mermaid 다이어그램은 `docs/mermaid_style_2.md`에 정의된 스타일을 100% 준수합니다.

**주요 규칙**:
- 노드 ID는 의미 있는 이름 사용 (예: `Start`, `RAGSearch`, `Fallback`)
- 화살표 라벨은 명확한 조건 또는 동작 설명
- 색상 코드 일관성 유지

### 커밋 메시지 형식 준수

모든 Git 커밋 메시지는 `docs/commit_msg.md` 형식을 100% 준수합니다.

**형식**:
```
prefix: 제목 (한글)

- 상세 설명 (한글)
```

**Prefix 종류**:
- `feat`: 기능 개발
- `fix`: 오류 수정
- `docs`: 문서 작업
- `test`: 테스트 코드
- `conf`: 환경 설정

**금지 사항**:
- AI 출처 표시 절대 금지 (예: "Generated with Claude Code")

---

## 💼 문서 활용 방법

### 신규 개발자 온보딩

1. 이 README를 먼저 읽습니다.
2. "초보 개발자를 위한 학습 순서"를 따라 단계적으로 문서를 읽습니다.
3. 각 문서의 실행 예시를 직접 테스트해봅니다.
4. 핵심 문서를 반복해서 읽으며 시스템 전체를 이해합니다.

### 기능 추가/수정 시

1. 추가하려는 기능과 유사한 문서를 찾습니다.
2. 해당 문서의 아키텍처를 참고하여 새 기능을 설계합니다.
3. Fallback 메커니즘을 포함하여 실패 케이스도 고려합니다.
4. 새 기능에 대한 아키텍처 문서를 작성합니다.

### 버그 디버깅 시

1. 버그가 발생한 시나리오와 일치하는 문서를 찾습니다.
2. 문서의 "상세 기능 동작 흐름도"를 따라가며 어느 단계에서 문제가 발생했는지 파악합니다.
3. Fallback 경로가 제대로 동작하는지 확인합니다.
4. 문제를 해결한 후, 필요시 문서를 업데이트합니다.

---

## 📊 문서 통계

- **단일 요청 문서**: 8개
- **다중 요청 문서**: 16개
- **총 문서 수**: 24개 + README
- **총 시나리오 커버리지**: 단일 요청 8개 + 이중 요청 8개 + 삼중 요청 6개 + 사중 요청 2개 = 24개 시나리오

---

**작성일**: 2025-11-07
**문서 버전**: 1.0
