## 제목: UI 프롬프트 템플릿 구현 (미구현 기능)

---

## 📋 작업 개요
**작업 주제:** 프롬프트 템플릿 및 스트리밍 기능 구현
**담당자:** @임예슬
**마감일:** 11/03 24:00

## 📅 기간
- 시작일: 2025-10-28
- 종료일: 2025-11-03

---

## 📌 이슈 목적

**현재 상태**:
- ✅ **Streamlit 기본 UI**: 최현화가 구현 완료 ([담당역할_01-3_최현화_Streamlit_UI_구현.md](../roles/담당역할_01-3_최현화_Streamlit_UI_구현.md) 참조)
- ✅ **웹 검색 도구**: 최현화가 구현 완료 (Tavily API, arXiv 논문 자동 저장)
- ✅ **파일 다운로드 기능**: 최현화가 구현 완료 (개별 답변, 전체 대화)

**미구현 기능 (임예슬 담당)**:
- ❌ Easy/Hard 난이도별 프롬프트 템플릿
- ❌ 스트리밍 응답 (선택 사항)
- ❌ @tool 기반 파일 저장 도구 (Agent 도구로 사용)

---

## ✅ 작업 항목 체크리스트

### Phase 1: 프롬프트 템플릿 개발 (1일) ⭐ 우선순위

**파일 경로**: `src/prompts/templates.py`

- [ ] Easy/Hard 모드 프롬프트 구현
  - [ ] EASY_SYSTEM_PROMPT 정의
    - 전문 용어를 쉬운 말로 설명
    - 실생활 비유 사용
    - 수식 최소화 및 직관적 설명
    - 핵심 아이디어 3가지 이내 요약
    - 초심자도 이해할 수 있는 언어 사용
  - [ ] HARD_SYSTEM_PROMPT 정의
    - 기술적 세부사항 및 수식 포함
    - 알고리즘의 시간/공간 복잡도 분석
    - 관련 논문과의 비교 (장단점)
    - 구현 시 고려사항 설명
    - 최신 연구 동향과의 연결
  - [ ] ChatPromptTemplate 생성
    - SystemMessagePromptTemplate 사용
    - HumanMessagePromptTemplate 사용
  - [ ] get_difficulty_prompt(difficulty) 함수 구현

- [ ] RAG 프롬프트 구현
  - [ ] RAG_PROMPT_TEMPLATE 정의
    - context (검색 결과), question, difficulty 포함
    - 출처 명시 규칙 포함
  - [ ] RAG_CHAT_PROMPT = ChatPromptTemplate.from_template()

- [ ] FewShotPromptTemplate 구현 (선택 사항)
  - [ ] 예시 데이터 리스트 정의
  - [ ] example_prompt 생성
  - [ ] FewShotPromptTemplate 생성

**프롬프트 엔지니어링 팁**:
- Easy 모드: "마치 ~처럼", "예를 들어", "쉽게 말하면" 표현 사용
- Hard 모드: "알고리즘", "시간 복잡도", "수식", "논문 비교" 포함
- RAG 프롬프트: 검색 결과(context)를 명확히 전달, 출처 명시 강조

**참고**: roles 문서 171-303줄

---

### Phase 2: 스트리밍 응답 구현 (선택 사항)

**파일 경로**: `ui/app_streaming.py`

- [ ] StreamlitCallbackHandler 생성
  - [ ] st.container() 전달하여 초기화
- [ ] 응답 표시용 placeholder 생성
  - [ ] st.empty()로 빈 컨테이너 생성
- [ ] Agent 스트리밍 실행
  - [ ] agent.astream_events() 비동기 이벤트 스트림
  - [ ] question, difficulty 전달
- [ ] 이벤트 처리
  - [ ] "on_chat_model_stream" 이벤트에서 청크 추출
  - [ ] 청크를 full_response에 누적
  - [ ] placeholder에 실시간 응답 업데이트 (커서 효과: "▌")
- [ ] 최종 응답 표시

**참고**: roles 문서 150-168줄

---

### Phase 3: 파일 저장 도구 (Agent 도구, 선택 사항)

**파일 경로**: `src/tools/file_save.py`

**참고**: 현재 Streamlit UI에서 다운로드 기능은 이미 구현되어 있습니다.
이 도구는 Agent가 자동으로 파일을 저장할 때 사용하는 도구입니다.

- [ ] 텍스트 파일 저장 도구
  - [ ] @tool 데코레이터로 save_to_file 함수 정의
    - 인자: content, filename (선택적)
    - 파일명이 없으면 타임스탬프 기반 자동 생성
    - data/outputs 폴더에 저장
    - 저장 성공 메시지 반환

- [ ] Markdown 형식 저장 도구
  - [ ] @tool 데코레이터로 save_to_markdown 함수 정의
    - 인자: content, title, filename (선택적)
    - Markdown 형식 포맷팅 (제목, 생성일, 내용, 푸터)
    - data/outputs 폴더에 저장

- [ ] Agent 노드 추가 (선택 사항)
  - [ ] save_file_node 구현 (`src/agent/nodes.py`)

**참고**: roles 문서 323-568줄 (파일 저장 도구 섹션)

---

## 📦 설치/실행 명령어

```bash
# 가상환경 활성화
pyenv activate langchain_py3_11_9

# 프롬프트 템플릿 테스트
python -c "from src.prompts.templates import get_difficulty_prompt; print(get_difficulty_prompt('easy'))"

# 스트리밍 앱 실행 (구현 후)
streamlit run ui/app_streaming.py
```

---

## ⚡️ 우선순위 및 현재 상태

### ✅ 구현 완료 (최현화 담당)
1. **Streamlit 기본 UI** - 완료
   - 페이지 설정, 난이도 선택, 채팅 인터페이스
   - 다중 채팅 세션 관리 (ChatGPT 스타일)
   - 다크 모드 토글
   - LocalStorage 영속성 저장
   - 상세: [담당역할_01-3_최현화_Streamlit_UI_구현.md](../roles/담당역할_01-3_최현화_Streamlit_UI_구현.md)

2. **웹 검색 도구** - 완료
   - Tavily API 기반 웹 검색
   - arXiv 논문 자동 저장
   - 난이도별 프롬프트 적용

3. **파일 다운로드 기능** - 완료
   - 개별 답변 다운로드
   - 전체 대화 다운로드
   - 복사 기능 (JavaScript 기반)

### ❌ 미구현 (임예슬 담당)
1. **프롬프트 템플릿** ⭐ 우선순위 1
   - Easy/Hard 모드 프롬프트
   - RAG 프롬프트
   - FewShotPromptTemplate (선택)

2. **스트리밍 응답** - 선택 사항
   - 실시간 응답 표시
   - 커서 효과

3. **@tool 파일 저장 도구** - 선택 사항
   - Agent가 자동으로 파일 저장할 때 사용
   - Streamlit 다운로드 기능은 이미 구현됨

---

## 📚 참고 자료

### 필수 참고 문서
- [담당역할_04_임예슬_UI_프롬프트.md](../roles/담당역할_04_임예슬_UI_프롬프트.md) ⭐ - 전체 구현 가이드
- [담당역할_01-3_최현화_Streamlit_UI_구현.md](../roles/담당역할_01-3_최현화_Streamlit_UI_구현.md) - 구현 완료된 UI 기능
- [15_프롬프트_엔지니어링.md](../PRD/15_프롬프트_엔지니어링.md) - Easy/Hard 프롬프트 템플릿
- [16_UI_설계.md](../PRD/16_UI_설계.md) - Streamlit 구현 가이드

### 외부 링크
- [Langchain Prompts](https://python.langchain.com/docs/modules/model_io/prompts/)
- [ChatPromptTemplate](https://python.langchain.com/docs/modules/model_io/prompts/quick_start)
- [FewShotPromptTemplate](https://python.langchain.com/docs/modules/model_io/prompts/few_shot_examples)
- [StreamlitCallbackHandler](https://python.langchain.com/docs/integrations/callbacks/streamlit)

---

## 🔖 추천 라벨

`feature` `prompt` `streaming` `medium`

---

## ⚠️ 중요 사항

1. **기본 UI는 이미 구현 완료**
   - Streamlit UI, 웹 검색, 파일 다운로드는 최현화가 구현
   - 임예슬은 프롬프트 템플릿에 집중

2. **프롬프트 템플릿 우선**
   - Easy/Hard 모드 프롬프트가 최우선
   - 스트리밍은 선택 사항

3. **난이도 모드 명확히 구분**
   - Easy: 초심자용 (쉬운 용어, 비유, 핵심 요약)
   - Hard: 전문가용 (기술 용어, 수식, 복잡도, 논문 비교)

4. **ExperimentManager 사용**
   - 모든 기능 개발 시 ExperimentManager 사용
   - 프롬프트 저장: exp_manager.save_prompt()

---
