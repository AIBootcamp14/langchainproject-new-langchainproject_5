# ì‚¬ì¤‘ ìš”ì²­: ìš©ì–´ì§‘ ê²€ìƒ‰ â†’ ë…¼ë¬¸ ê²€ìƒ‰ â†’ ë…¼ë¬¸ ìš”ì•½ â†’ ì €ì¥ ì•„í‚¤í…ì²˜

## ğŸ“‹ ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì¼**: 2025-11-07
- **ì‘ì„±ì**: ìµœí˜„í™”[íŒ€ì¥]
- **í”„ë¡œì íŠ¸ëª…**: ë…¼ë¬¸ ë¦¬ë·° ì±—ë´‡ (AI Agent + RAG)
- **íŒ€ëª…**: ì—°ê²°ì˜ ë¯¼ì¡±
- **ë¬¸ì„œ ë²„ì „**: 1.0

---

## ğŸ“‘ ëª©ì°¨
1. [ì‹œë‚˜ë¦¬ì˜¤ ê°œìš”](#ì‹œë‚˜ë¦¬ì˜¤-ê°œìš”)
2. [ì‚¬ìš©ì ìš”ì²­ ë¶„ì„](#ì‚¬ìš©ì-ìš”ì²­-ë¶„ì„)
3. [ë„êµ¬ ìë™ ì „í™˜ ë° Fallback](#ë„êµ¬-ìë™-ì „í™˜-ë°-fallback)
4. [ë‹¨ìˆœ íë¦„ ì•„í‚¤í…ì²˜](#ë‹¨ìˆœ-íë¦„-ì•„í‚¤í…ì²˜)
5. [ìƒì„¸ ê¸°ëŠ¥ ë™ì‘ íë¦„ë„](#ìƒì„¸-ê¸°ëŠ¥-ë™ì‘-íë¦„ë„)
6. [ì „ì²´ íë¦„ ìš”ì•½ í‘œ](#ì „ì²´-íë¦„-ìš”ì•½-í‘œ)
7. [ë™ì‘ ì„¤ëª… (ì´ˆë³´ ê°œë°œììš©)](#ë™ì‘-ì„¤ëª…-ì´ˆë³´-ê°œë°œììš©)
8. [ì‹¤í–‰ ì˜ˆì‹œ](#ì‹¤í–‰-ì˜ˆì‹œ)
9. [í•µì‹¬ í¬ì¸íŠ¸](#í•µì‹¬-í¬ì¸íŠ¸)

---

## ğŸ“Œ ì‹œë‚˜ë¦¬ì˜¤ ê°œìš”

### ë‹¤ì¤‘ ìš”ì²­ì˜ ëª©ì 

ì‚¬ìš©ìê°€ AI ìš©ì–´ì˜ ì •ì˜ë¥¼ í™•ì¸í•˜ê³ , ê´€ë ¨ ë…¼ë¬¸ì„ ê²€ìƒ‰í•œ í›„ ìš”ì•½í•˜ê³ , ìµœì¢… ê²°ê³¼ë¥¼ íŒŒì¼ë¡œ ì €ì¥í•˜ê³  ì‹¶ì„ ë•Œ, ë„¤ ê°€ì§€ ë„êµ¬ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ í•œ ë²ˆì— ì²˜ë¦¬í•©ë‹ˆë‹¤. ì´ëŠ” **ê°€ì¥ ë³µì¡í•œ ì›Œí¬í”Œë¡œìš°**ë¡œ, ëª¨ë“  Fallback ë©”ì»¤ë‹ˆì¦˜ì„ í¬í•¨í•©ë‹ˆë‹¤.

**ì™„ì „í•œ ì‹¤í–‰ íë¦„ (ëª¨ë“  Fallback í¬í•¨):**

```
1ë‹¨ê³„: glossary (ìš©ì–´ì§‘ ê²€ìƒ‰)
â”œâ”€ ì„±ê³µ â†’ RAG ì •ì˜ ì œê³µ, 2ë‹¨ê³„ë¡œ
â””â”€ ì‹¤íŒ¨ (ìš©ì–´ì§‘ì— ì—†ìŒ)
    â†“
    1-F: general (ì¼ë°˜ ë‹µë³€)
    â””â”€ LLMì´ ìš©ì–´ ì„¤ëª…, 2ë‹¨ê³„ë¡œ
â†“
2ë‹¨ê³„: search_paper (RAG ë…¼ë¬¸ ê²€ìƒ‰)
â”œâ”€ ì„±ê³µ â†’ ê´€ë ¨ ë…¼ë¬¸ ë°œê²¬, 3ë‹¨ê³„ë¡œ
â””â”€ ì‹¤íŒ¨ (DBì— ë…¼ë¬¸ ì—†ìŒ)
    â†“
    2-F1: web_search (ì›¹ ë…¼ë¬¸ ê²€ìƒ‰)
    â”œâ”€ ì„±ê³µ â†’ ê´€ë ¨ ë…¼ë¬¸ ë°œê²¬, 3ë‹¨ê³„ë¡œ
    â””â”€ ì‹¤íŒ¨ (ì›¹ì—ì„œë„ ëª» ì°¾ìŒ)
        â†“
        2-F2: general (ì¼ë°˜ ë‹µë³€)
        â””â”€ LLMì´ ì§ì ‘ ë…¼ë¬¸ ë‚´ìš© ì„¤ëª…, 3ë‹¨ê³„ë¡œ
â†“
3ë‹¨ê³„: summarize (ë…¼ë¬¸ ìš”ì•½)
â”œâ”€ ì„±ê³µ â†’ ë…¼ë¬¸ ìš”ì•½ ìƒì„±, 4ë‹¨ê³„ë¡œ
â””â”€ ì‹¤íŒ¨ (ìš”ì•½ ìƒì„± ì˜¤ë¥˜)
    â†“
    3-F: general (ì¼ë°˜ ë‹µë³€)
    â””â”€ LLMì´ ì§ì ‘ ìš”ì•½, 4ë‹¨ê³„ë¡œ
â†“
4ë‹¨ê³„: save_file (íŒŒì¼ ì €ì¥)
â”œâ”€ ì„±ê³µ â†’ ì €ì¥ ì™„ë£Œ ë©”ì‹œì§€ ë°˜í™˜
â””â”€ ì‹¤íŒ¨ â†’ ì˜¤ë¥˜ ë©”ì‹œì§€ ë°˜í™˜
```

### ì‚¬ìš©ì ìš”ì²­ ì˜ˆì‹œ

- **"RAGê°€ ë­”ì§€ ì„¤ëª…í•˜ê³  ê´€ë ¨ ë…¼ë¬¸ë„ ìš”ì•½í•´ì„œ ì €ì¥í•´ì¤˜"**
- **"Attention Mechanism ì •ì˜í•˜ê³  ë…¼ë¬¸ ì°¾ì•„ì„œ ìš”ì•½í•˜ê³  ì €ì¥í•´ì¤˜"**
- **"Transformerê°€ ë¬´ì—‡ì¸ì§€ ì•Œë ¤ì£¼ê³  ë…¼ë¬¸ ì •ë¦¬í•´ì„œ ì €ì¥í•´ì¤˜"**

### ê°€ëŠ¥í•œ ì‹¤í–‰ ê²½ë¡œ (ì´ 12ê°€ì§€)

ì´ ì‚¬ì¤‘ ìš”ì²­ ì‹œìŠ¤í…œì€ ê° ë‹¨ê³„ì˜ ì„±ê³µ/ì‹¤íŒ¨ ì¡°í•©ì— ë”°ë¼ **ì´ 12ê°€ì§€ ì‹¤í–‰ ê²½ë¡œ**ê°€ ì¡´ì¬í•©ë‹ˆë‹¤:

#### 1ë‹¨ê³„ (ìš©ì–´ ì •ì˜) ê²½ë¡œ
- **ê²½ë¡œ A**: glossary ì„±ê³µ â†’ 2ë‹¨ê³„ë¡œ
- **ê²½ë¡œ B**: glossary ì‹¤íŒ¨ â†’ general (1-F) â†’ 2ë‹¨ê³„ë¡œ

#### 2ë‹¨ê³„ (ë…¼ë¬¸ ê²€ìƒ‰) ê²½ë¡œ
- **ê²½ë¡œ C**: search_paper ì„±ê³µ â†’ 3ë‹¨ê³„ë¡œ
- **ê²½ë¡œ D**: search_paper ì‹¤íŒ¨ â†’ web_search (2-F1) ì„±ê³µ â†’ 3ë‹¨ê³„ë¡œ
- **ê²½ë¡œ E**: search_paper ì‹¤íŒ¨ â†’ web_search (2-F1) ì‹¤íŒ¨ â†’ general (2-F2) â†’ 3ë‹¨ê³„ë¡œ

#### 3ë‹¨ê³„ (ë…¼ë¬¸ ìš”ì•½) ê²½ë¡œ
- **ê²½ë¡œ F**: summarize ì„±ê³µ â†’ 4ë‹¨ê³„ë¡œ
- **ê²½ë¡œ G**: summarize ì‹¤íŒ¨ â†’ general (3-F) â†’ 4ë‹¨ê³„ë¡œ

#### 4ë‹¨ê³„ (íŒŒì¼ ì €ì¥) ê²½ë¡œ
- **ê²½ë¡œ H**: save_file ì„±ê³µ â†’ ì™„ë£Œ
- **ê²½ë¡œ I**: save_file ì‹¤íŒ¨ â†’ ì˜¤ë¥˜ ë°˜í™˜

#### ìµœì„ ì˜ ê²½ë¡œ (ëª¨ë‘ ì„±ê³µ)
```
glossary â†’ search_paper â†’ summarize â†’ save_file
(ê²½ë¡œ: A â†’ C â†’ F â†’ H)
ì‹¤í–‰ ì‹œê°„: ì•½ 8-12ì´ˆ
ê²°ê³¼ í’ˆì§ˆ: ìµœìƒ (ëª¨ë“  ë‹¨ê³„ì—ì„œ ìµœì ì˜ ê²°ê³¼)
```

#### ìµœì•…ì˜ ê²½ë¡œ (ëª¨ë‘ Fallback)
```
glossary ì‹¤íŒ¨ â†’ general â†’ search_paper ì‹¤íŒ¨ â†’ web_search ì‹¤íŒ¨ â†’ general â†’ summarize ì‹¤íŒ¨ â†’ general â†’ save_file
(ê²½ë¡œ: B â†’ E â†’ G â†’ H)
ì‹¤í–‰ ì‹œê°„: ì•½ 25-35ì´ˆ
ê²°ê³¼ í’ˆì§ˆ: ì¤‘í•˜ (ëª¨ë“  ë‹¨ê³„ì—ì„œ LLM ì§€ì‹ ê¸°ë°˜ ë‹µë³€)
```

#### ëŒ€í‘œì ì¸ ì¤‘ê°„ ê²½ë¡œ
```
1. glossary â†’ search_paper ì‹¤íŒ¨ â†’ web_search â†’ summarize â†’ save_file
   (ê²½ë¡œ: A â†’ D â†’ F â†’ H)
   ì‹¤í–‰ ì‹œê°„: ì•½ 12-18ì´ˆ
   ê²°ê³¼ í’ˆì§ˆ: ìƒ (ìš©ì–´ ì •ì˜ëŠ” RAG, ë…¼ë¬¸ì€ ì›¹ ê²€ìƒ‰)

2. glossary â†’ search_paper â†’ summarize ì‹¤íŒ¨ â†’ general â†’ save_file
   (ê²½ë¡œ: A â†’ C â†’ G â†’ H)
   ì‹¤í–‰ ì‹œê°„: ì•½ 10-15ì´ˆ
   ê²°ê³¼ í’ˆì§ˆ: ìƒ (ê²€ìƒ‰ì€ ì„±ê³µ, ìš”ì•½ë§Œ LLM)

3. glossary ì‹¤íŒ¨ â†’ general â†’ search_paper â†’ summarize â†’ save_file
   (ê²½ë¡œ: B â†’ C â†’ F â†’ H)
   ì‹¤í–‰ ì‹œê°„: ì•½ 10-14ì´ˆ
   ê²°ê³¼ í’ˆì§ˆ: ìƒ (ìš©ì–´ë§Œ LLM, ë‚˜ë¨¸ì§€ëŠ” ì„±ê³µ)
```

---

## ğŸ”„ ì‚¬ìš©ì ìš”ì²­ ë¶„ì„

### ì§ˆë¬¸ í•´ì„

**ì‚¬ìš©ì ì…ë ¥:** "RAGê°€ ë­”ì§€ ì„¤ëª…í•˜ê³  ê´€ë ¨ ë…¼ë¬¸ë„ ìš”ì•½í•´ì„œ ì €ì¥í•´ì¤˜"

**Router ë¶„ì„ ê²°ê³¼:**
```json
{
  "question_type": "quadruple_request",
  "sub_types": [
    "term_definition",
    "paper_search",
    "paper_summary",
    "file_save"
  ],
  "primary_tool": "glossary",
  "fallback_chain": ["general"],
  "secondary_tool": "search_paper",
  "fallback_chain_2": ["web_search", "general"],
  "tertiary_tool": "summarize",
  "fallback_chain_3": ["general"],
  "quaternary_tool": "save_file",
  "execution_mode": "pipeline",
  "data_flow": "1ë‹¨ê³„ ê²°ê³¼ + 3ë‹¨ê³„ ê²°ê³¼ â†’ 4ë‹¨ê³„ ì €ì¥"
}
```

### ë³µì¡ë„ ë¶„ì„

- **ì´ ë„êµ¬ ìˆ˜**: 4ê°œ (ì£¼ ë„êµ¬) + 3ê°œ (Fallback ë„êµ¬) = ìµœëŒ€ 7ê°œ
- **Fallback ì²´ì¸**: 3ê°œ ë‹¨ê³„ì—ì„œ ê°ê° 1-2ê°œì˜ Fallback
- **ë°ì´í„° íŒŒì´í”„ë¼ì¸**: 1ë‹¨ê³„ â†’ ì„¸ì…˜ ì €ì¥ â†’ 4ë‹¨ê³„, 2ë‹¨ê³„ â†’ 3ë‹¨ê³„ â†’ 4ë‹¨ê³„
- **ì‹¤í–‰ ëª¨ë“œ**: Pipeline Mode (ìë™ ë°ì´í„° ì „ë‹¬)
- **ì˜ˆìƒ ì‹¤í–‰ ì‹œê°„**: 8-35ì´ˆ (ê²½ë¡œì— ë”°ë¼ ë‹¤ë¦„)

---

## ğŸ”€ ë„êµ¬ ìë™ ì „í™˜ ë° Fallback

### 1ë‹¨ê³„: ìš©ì–´ ì •ì˜ (glossary â†’ general)

#### 1ë‹¨ê³„ ì£¼ ë„êµ¬: glossary (ìš©ì–´ì§‘ ê²€ìƒ‰)

**ì„±ê³µ ì¡°ê±´:**
- ìš©ì–´ì§‘ DBì— í•´ë‹¹ ìš©ì–´ê°€ ì¡´ì¬
- ë‚œì´ë„ ëª¨ë“œ(easy/hard)ì— ë§ëŠ” ì„¤ëª… ì¡´ì¬
- í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (ë²¡í„° 50% + í‚¤ì›Œë“œ 50%) ì ìˆ˜ â‰¥ 0.7

**ì‹¤í–‰ ë‚´ìš©:**
```python
# src/tools/glossary.py
@tool
def search_glossary(question: str, mode: str = "auto") -> str:
    """
    ìš©ì–´ì§‘ì—ì„œ AI ìš©ì–´ ê²€ìƒ‰ (í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰)

    Args:
        question: ì‚¬ìš©ì ì§ˆë¬¸
        mode: easy/hard/auto

    Returns:
        ìš©ì–´ ì •ì˜ (ë‚œì´ë„ë³„ ì„¤ëª…)
    """
    # 1. ì§ˆë¬¸ì—ì„œ ìš©ì–´ ì¶”ì¶œ
    term = _extract_term_from_question(question)

    # 2. PostgreSQL + PGVector í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰
    #    - ë²¡í„° ê²€ìƒ‰ (ìœ ì‚¬ë„): 50%
    #    - í‚¤ì›Œë“œ ê²€ìƒ‰ (ILIKE): 50%
    results = _hybrid_search_glossary(term, top_k=5)

    # 3. ë‚œì´ë„ ëª¨ë“œì— ë§ëŠ” ì„¤ëª… ì„ íƒ
    if mode == "easy" or (mode == "auto" and is_korean_question(question)):
        return results[0]["easy_explanation"]
    else:
        return results[0]["hard_explanation"]
```

**DB í…Œì´ë¸”:** `glossary_terms`
- `term` (ìš©ì–´ëª…)
- `easy_explanation` (ì‰¬ìš´ ì„¤ëª… - Solar-pro2)
- `hard_explanation` (ì–´ë ¤ìš´ ì„¤ëª… - GPT-5)
- `category` (ì¹´í…Œê³ ë¦¬)
- `embedding` (ë²¡í„°)

**ì„±ê³µ ì‹œ:** ìš©ì–´ ì •ì˜ ë°˜í™˜ â†’ ì„¸ì…˜ ì €ì¥ â†’ 2ë‹¨ê³„ë¡œ

**ì‹¤íŒ¨ ì¡°ê±´:**
- ìš©ì–´ì§‘ DBì— í•´ë‹¹ ìš©ì–´ê°€ ì—†ìŒ
- í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ì ìˆ˜ < 0.7
- DB ì—°ê²° ì˜¤ë¥˜

**ì‹¤íŒ¨ ì‹œ:** 1-F Fallback (general) ì‹¤í–‰

---

#### 1-F Fallback: general (ì¼ë°˜ ë‹µë³€)

**ì „í™˜ ì‹œì :**
- glossary ë„êµ¬ ì‹¤íŒ¨ (ìš©ì–´ì§‘ì— ì—†ìŒ)

**ì‹¤í–‰ ë‚´ìš©:**
```python
# src/tools/general_answer.py
@tool
def general(question: str, difficulty: str = "easy") -> str:
    """
    LLM ì§€ì‹ ê¸°ë°˜ ì¼ë°˜ ë‹µë³€

    Args:
        question: ì‚¬ìš©ì ì§ˆë¬¸
        difficulty: easy/hard

    Returns:
        LLMì´ ì§ì ‘ ìƒì„±í•œ ë‹µë³€
    """
    # ë‚œì´ë„ë³„ ëª¨ë¸ ì„ íƒ
    if difficulty == "easy":
        llm = LLMClient(provider="solar", model="solar-pro2")
    else:
        llm = LLMClient(provider="openai", model="gpt-5")

    # ìš©ì–´ ì •ì˜ í”„ë¡¬í”„íŠ¸ ì‚¬ìš©
    prompt = get_tool_prompt("general_term_definition")
    response = llm.invoke([
        SystemMessage(content=prompt),
        HumanMessage(content=question)
    ])

    return response
```

**ëª¨ë¸ ì„ íƒ:**
- **Easy ëª¨ë“œ**: Solar-pro2 (í•œêµ­ì–´ íŠ¹í™”, ë¹„ìš© íš¨ìœ¨)
- **Hard ëª¨ë“œ**: GPT-5 (ê¸°ìˆ ì  ì •í™•ë„)

**ì„±ê³µ ì‹œ:** LLMì´ ìƒì„±í•œ ìš©ì–´ ì„¤ëª… â†’ ì„¸ì…˜ ì €ì¥ â†’ 2ë‹¨ê³„ë¡œ

---

### 2ë‹¨ê³„: ë…¼ë¬¸ ê²€ìƒ‰ (search_paper â†’ web_search â†’ general)

#### 2ë‹¨ê³„ ì£¼ ë„êµ¬: search_paper (RAG ë…¼ë¬¸ ê²€ìƒ‰)

**ì„±ê³µ ì¡°ê±´:**
- ë…¼ë¬¸ DBì— ê´€ë ¨ ë…¼ë¬¸ ì¡´ì¬
- í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (ë²¡í„° 70% + í‚¤ì›Œë“œ 30%) ì ìˆ˜ â‰¥ 0.7
- ìµœì†Œ 1ê°œ ì´ìƒì˜ ë…¼ë¬¸ ë°œê²¬

**ì‹¤í–‰ ë‚´ìš©:**
```python
# src/tools/search_paper.py
@tool
def search_paper(question: str, top_k: int = 5) -> str:
    """
    RAG ê¸°ë°˜ ë…¼ë¬¸ ê²€ìƒ‰ (í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰)

    Args:
        question: ê²€ìƒ‰ ì¿¼ë¦¬
        top_k: ë°˜í™˜í•  ë…¼ë¬¸ ê°œìˆ˜

    Returns:
        ê²€ìƒ‰ëœ ë…¼ë¬¸ ì •ë³´ (ì œëª©, ì €ì, ì´ˆë¡, URL)
    """
    # 1. í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ì‹¤í–‰
    #    - ë²¡í„° ê²€ìƒ‰ (ìœ ì‚¬ë„): 70%
    #    - í‚¤ì›Œë“œ ê²€ìƒ‰ (BM25): 30%
    results = _hybrid_search_papers(question, top_k=top_k)

    # 2. ë…¼ë¬¸ ì •ë³´ í¬ë§·íŒ…
    formatted_results = []
    for paper in results:
        formatted_results.append({
            "title": paper["title"],
            "authors": paper["authors"],
            "abstract": paper["abstract"],
            "url": paper["url"],
            "score": paper["score"]
        })

    return json.dumps(formatted_results, ensure_ascii=False)
```

**DB í…Œì´ë¸”:** `papers`
- `title` (ë…¼ë¬¸ ì œëª©)
- `authors` (ì €ì)
- `abstract` (ì´ˆë¡)
- `url` (ë…¼ë¬¸ URL)
- `embedding` (ë²¡í„°)

**ì„±ê³µ ì‹œ:** ë…¼ë¬¸ ì •ë³´ ë°˜í™˜ â†’ 3ë‹¨ê³„ë¡œ ì „ë‹¬

**ì‹¤íŒ¨ ì¡°ê±´:**
- ë…¼ë¬¸ DBì— ê´€ë ¨ ë…¼ë¬¸ ì—†ìŒ
- ê²€ìƒ‰ ì ìˆ˜ < 0.7
- DB ì—°ê²° ì˜¤ë¥˜

**ì‹¤íŒ¨ ì‹œ:** 2-F1 Fallback (web_search) ì‹¤í–‰

---

#### 2-F1 Fallback: web_search (ì›¹ ë…¼ë¬¸ ê²€ìƒ‰)

**ì „í™˜ ì‹œì :**
- search_paper ë„êµ¬ ì‹¤íŒ¨ (DBì— ë…¼ë¬¸ ì—†ìŒ)

**ì‹¤í–‰ ë‚´ìš©:**
```python
# src/tools/web_search.py
@tool
def web_search(query: str, num_results: int = 5) -> str:
    """
    ì›¹ì—ì„œ ë…¼ë¬¸ ê²€ìƒ‰ (arXiv API ì‚¬ìš©)

    Args:
        query: ê²€ìƒ‰ ì¿¼ë¦¬
        num_results: ë°˜í™˜í•  ë…¼ë¬¸ ê°œìˆ˜

    Returns:
        ê²€ìƒ‰ëœ ë…¼ë¬¸ ì •ë³´ (ì œëª©, ì €ì, ì´ˆë¡, URL)
    """
    # 1. arXiv API í˜¸ì¶œ
    import arxiv

    search = arxiv.Search(
        query=query,
        max_results=num_results,
        sort_by=arxiv.SortCriterion.Relevance
    )

    # 2. ê²€ìƒ‰ ê²°ê³¼ í¬ë§·íŒ…
    results = []
    for paper in search.results():
        results.append({
            "title": paper.title,
            "authors": [author.name for author in paper.authors],
            "abstract": paper.summary,
            "url": paper.entry_id,
            "published": paper.published.strftime("%Y-%m-%d")
        })

    return json.dumps(results, ensure_ascii=False)
```

**API:** arXiv API
- ì‹¤ì‹œê°„ ë…¼ë¬¸ ê²€ìƒ‰
- ìµœì‹  ë…¼ë¬¸ í¬í•¨

**ì„±ê³µ ì‹œ:** ì›¹ì—ì„œ ê²€ìƒ‰í•œ ë…¼ë¬¸ ì •ë³´ ë°˜í™˜ â†’ 3ë‹¨ê³„ë¡œ ì „ë‹¬

**ì‹¤íŒ¨ ì¡°ê±´:**
- ì›¹ì—ì„œë„ ê´€ë ¨ ë…¼ë¬¸ì„ ì°¾ì§€ ëª»í•¨
- API í˜¸ì¶œ ì˜¤ë¥˜
- ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜

**ì‹¤íŒ¨ ì‹œ:** 2-F2 Fallback (general) ì‹¤í–‰

---

#### 2-F2 Fallback: general (ì¼ë°˜ ë‹µë³€)

**ì „í™˜ ì‹œì :**
- search_paper ì‹¤íŒ¨ â†’ web_search ì‹¤íŒ¨

**ì‹¤í–‰ ë‚´ìš©:**
```python
# src/tools/general_answer.py
@tool
def general(question: str, difficulty: str = "easy") -> str:
    """
    LLM ì§€ì‹ ê¸°ë°˜ ë…¼ë¬¸ ë‚´ìš© ì„¤ëª…

    Args:
        question: ì‚¬ìš©ì ì§ˆë¬¸
        difficulty: easy/hard

    Returns:
        LLMì´ ì§ì ‘ ìƒì„±í•œ ë…¼ë¬¸ ë‚´ìš© ì„¤ëª…
    """
    # ë‚œì´ë„ë³„ ëª¨ë¸ ì„ íƒ
    if difficulty == "easy":
        llm = LLMClient(provider="solar", model="solar-pro2")
    else:
        llm = LLMClient(provider="openai", model="gpt-5")

    # ë…¼ë¬¸ ì„¤ëª… í”„ë¡¬í”„íŠ¸ ì‚¬ìš©
    prompt = get_tool_prompt("general_paper_explanation")
    response = llm.invoke([
        SystemMessage(content=prompt),
        HumanMessage(content=question)
    ])

    return response
```

**ëª¨ë¸ ì„ íƒ:**
- **Easy ëª¨ë“œ**: Solar-pro2
- **Hard ëª¨ë“œ**: GPT-5

**ì„±ê³µ ì‹œ:** LLMì´ ìƒì„±í•œ ë…¼ë¬¸ ë‚´ìš© ì„¤ëª… â†’ 3ë‹¨ê³„ë¡œ ì „ë‹¬

---

### 3ë‹¨ê³„: ë…¼ë¬¸ ìš”ì•½ (summarize â†’ general)

#### 3ë‹¨ê³„ ì£¼ ë„êµ¬: summarize (ë…¼ë¬¸ ìš”ì•½)

**ì„±ê³µ ì¡°ê±´:**
- 2ë‹¨ê³„ì—ì„œ ë…¼ë¬¸ ë‚´ìš© ì „ë‹¬ë°›ìŒ
- ìš”ì•½ ìƒì„± ì„±ê³µ

**ì‹¤í–‰ ë‚´ìš©:**
```python
# src/tools/summarize.py
@tool
def summarize(papers: str, difficulty: str = "easy") -> str:
    """
    ë…¼ë¬¸ ìš”ì•½ ìƒì„±

    Args:
        papers: 2ë‹¨ê³„ì—ì„œ ì „ë‹¬ë°›ì€ ë…¼ë¬¸ ì •ë³´ (JSON)
        difficulty: easy/hard

    Returns:
        ë…¼ë¬¸ ìš”ì•½ í…ìŠ¤íŠ¸
    """
    # 1. ë…¼ë¬¸ ì •ë³´ íŒŒì‹±
    paper_data = json.loads(papers)

    # 2. ë‚œì´ë„ë³„ ëª¨ë¸ ì„ íƒ
    if difficulty == "easy":
        llm = LLMClient(provider="solar", model="solar-pro2")
    else:
        llm = LLMClient(provider="openai", model="gpt-5")

    # 3. ìš”ì•½ í”„ë¡¬í”„íŠ¸ ì‚¬ìš©
    prompt = get_tool_prompt("summarize")

    # 4. ë…¼ë¬¸ë³„ ìš”ì•½ ìƒì„±
    summaries = []
    for paper in paper_data:
        response = llm.invoke([
            SystemMessage(content=prompt),
            HumanMessage(content=f"ì œëª©: {paper['title']}\nì´ˆë¡: {paper['abstract']}")
        ])
        summaries.append({
            "title": paper["title"],
            "summary": response
        })

    return json.dumps(summaries, ensure_ascii=False)
```

**ëª¨ë¸ ì„ íƒ:**
- **Easy ëª¨ë“œ**: Solar-pro2 (Temperature: 0.3)
- **Hard ëª¨ë“œ**: GPT-5 (Temperature: 0.3)

**ì„±ê³µ ì‹œ:** ë…¼ë¬¸ ìš”ì•½ ë°˜í™˜ â†’ 4ë‹¨ê³„ë¡œ ì „ë‹¬

**ì‹¤íŒ¨ ì¡°ê±´:**
- ìš”ì•½ ìƒì„± ì˜¤ë¥˜
- LLM í˜¸ì¶œ ì‹¤íŒ¨
- ì˜ëª»ëœ ì…ë ¥ í˜•ì‹

**ì‹¤íŒ¨ ì‹œ:** 3-F Fallback (general) ì‹¤í–‰

---

#### 3-F Fallback: general (ì¼ë°˜ ë‹µë³€)

**ì „í™˜ ì‹œì :**
- summarize ë„êµ¬ ì‹¤íŒ¨

**ì‹¤í–‰ ë‚´ìš©:**
```python
# src/tools/general_answer.py
@tool
def general(question: str, difficulty: str = "easy") -> str:
    """
    LLM ì§€ì‹ ê¸°ë°˜ ë…¼ë¬¸ ìš”ì•½

    Args:
        question: ìš”ì•½ ìš”ì²­ (2ë‹¨ê³„ ê²°ê³¼ í¬í•¨)
        difficulty: easy/hard

    Returns:
        LLMì´ ì§ì ‘ ìƒì„±í•œ ìš”ì•½
    """
    # ë‚œì´ë„ë³„ ëª¨ë¸ ì„ íƒ
    if difficulty == "easy":
        llm = LLMClient(provider="solar", model="solar-pro2")
    else:
        llm = LLMClient(provider="openai", model="gpt-5")

    # ìš”ì•½ í”„ë¡¬í”„íŠ¸ ì‚¬ìš©
    prompt = get_tool_prompt("general_summarize")
    response = llm.invoke([
        SystemMessage(content=prompt),
        HumanMessage(content=question)
    ])

    return response
```

**ì„±ê³µ ì‹œ:** LLMì´ ìƒì„±í•œ ìš”ì•½ â†’ 4ë‹¨ê³„ë¡œ ì „ë‹¬

---

### 4ë‹¨ê³„: íŒŒì¼ ì €ì¥ (save_file)

#### 4ë‹¨ê³„ ì£¼ ë„êµ¬: save_file (íŒŒì¼ ì €ì¥)

**ì„±ê³µ ì¡°ê±´:**
- 1ë‹¨ê³„ ê²°ê³¼ + 3ë‹¨ê³„ ê²°ê³¼ë¥¼ ì„¸ì…˜ì—ì„œ ê°€ì ¸ì˜´
- íŒŒì¼ ì €ì¥ ê²½ë¡œ ìœ íš¨
- ì“°ê¸° ê¶Œí•œ ì¡´ì¬

**ì‹¤í–‰ ë‚´ìš©:**
```python
# src/tools/save_file.py
@tool
def save_file(session_id: str, difficulty: str = "easy") -> str:
    """
    ëŒ€í™” ê²°ê³¼ë¥¼ íŒŒì¼ë¡œ ì €ì¥

    Args:
        session_id: ì„¸ì…˜ ID
        difficulty: easy/hard

    Returns:
        ì €ì¥ ì™„ë£Œ ë©”ì‹œì§€ (íŒŒì¼ ê²½ë¡œ í¬í•¨)
    """
    # 1. ì„¸ì…˜ì—ì„œ ìµœì¢… ë‹µë³€ ê°€ì ¸ì˜¤ê¸°
    final_answers = get_session_data(session_id, "final_answers")

    # 2. ë‚œì´ë„ë³„ íŒŒì¼ëª… ìƒì„±
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"{difficulty}_answer_{timestamp}.md"

    # 3. íŒŒì¼ ë‚´ìš© êµ¬ì„±
    content = f"""# ë…¼ë¬¸ ë¦¬ë·° ê²°ê³¼

## ìš©ì–´ ì •ì˜
{final_answers.get('term_definition', 'N/A')}

## ê´€ë ¨ ë…¼ë¬¸ ìš”ì•½
{final_answers.get('paper_summary', 'N/A')}

---
ìƒì„± ì‹œê°„: {timestamp}
ë‚œì´ë„: {difficulty}
"""

    # 4. íŒŒì¼ ì €ì¥
    save_path = Path(f"outputs/{filename}")
    save_path.parent.mkdir(parents=True, exist_ok=True)
    save_path.write_text(content, encoding="utf-8")

    return f"âœ… ì €ì¥ ì™„ë£Œ: {save_path}"
```

**ì €ì¥ ìš°ì„ ìˆœìœ„:**
1. `final_answers` (ìµœì¢… ë‹µë³€) - ìš°ì„ 
2. `tool_result` (ë„êµ¬ ì‹¤í–‰ ê²°ê³¼) - ëŒ€ì²´

**ì €ì¥ íŒŒì¼:**
- `easy_answer_20251107_143025.md` (Easy ëª¨ë“œ)
- `hard_answer_20251107_143025.md` (Hard ëª¨ë“œ)
- `auto_answer_20251107_143025.md` (Auto ëª¨ë“œ)
- `easy_answer_20251107_143025_raw.json` (ì›ë³¸ ë°ì´í„°)

**ì„±ê³µ ì‹œ:** ì €ì¥ ì™„ë£Œ ë©”ì‹œì§€ ë°˜í™˜ â†’ ì™„ë£Œ

**ì‹¤íŒ¨ ì‹œ:** ì˜¤ë¥˜ ë©”ì‹œì§€ ë°˜í™˜ (Fallback ì—†ìŒ)

---

## ğŸ“Š ë‹¨ìˆœ íë¦„ ì•„í‚¤í…ì²˜

### ì „ì²´ ì›Œí¬í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨

ì´ ë‹¤ì´ì–´ê·¸ë¨ì€ 4ë‹¨ê³„ ì „ì²´ íë¦„ê³¼ ëª¨ë“  Fallback ê²½ë¡œë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.

```mermaid
graph TB
    subgraph MainFlow["ğŸ“‹ ìš©ì–´ì§‘ â†’ ë…¼ë¬¸ ê²€ìƒ‰ â†’ ìš”ì•½ â†’ ì €ì¥ íŒŒì´í”„ë¼ì¸"]
        direction TB

        subgraph Init["ğŸ”¸ ì´ˆê¸°í™” & ë¼ìš°íŒ…"]
            direction LR
            Start([â–¶ï¸ ì‹œì‘]) --> A[ì‚¬ìš©ì ì§ˆë¬¸:<br/>RAGê°€ ë­”ì§€ ì„¤ëª…í•˜ê³ <br/>ê´€ë ¨ ë…¼ë¬¸ë„ ìš”ì•½í•´ì„œ ì €ì¥í•´ì¤˜]
            A --> B[router_node<br/>íŒ¨í„´ ë§¤ì¹­]
            B --> C[Pipeline ì„¤ì •<br/>4ë‹¨ê³„ íŒŒì´í”„ë¼ì¸]
        end

        subgraph Step1["ğŸ”¹ 1ë‹¨ê³„: ìš©ì–´ ì •ì˜"]
            direction LR
            D[glossary ì‹¤í–‰<br/>ìš©ì–´ì§‘ ê²€ìƒ‰] --> E{ê²€ìƒ‰ ì„±ê³µ?<br/>score >= 0.7}
            E -->|Yes| F[ìš©ì–´ ì •ì˜ íšë“<br/>ğŸ’¾ term_definition]
            E -->|No| G[1-F: general<br/>LLM ì§€ì‹ ê¸°ë°˜]
            G --> H[ìš©ì–´ ì„¤ëª… ìƒì„±<br/>ğŸ’¾ term_definition]
        end

        subgraph Step2["ğŸ”º 2ë‹¨ê³„: ë…¼ë¬¸ ê²€ìƒ‰"]
            direction LR
            I[search_paper ì‹¤í–‰<br/>RAG ë…¼ë¬¸ ê²€ìƒ‰] --> J{ê²€ìƒ‰ ì„±ê³µ?<br/>score >= 0.7}
            J -->|Yes| K[ë…¼ë¬¸ ì •ë³´ íšë“<br/>ğŸ’¾ papers]
            J -->|No| L[2-F1: web_search<br/>ì›¹ ë…¼ë¬¸ ê²€ìƒ‰]
            L --> M{ê²€ìƒ‰ ì„±ê³µ?<br/>ê²°ê³¼ ì¡´ì¬}
            M -->|Yes| N[ì›¹ ë…¼ë¬¸ íšë“<br/>ğŸ’¾ papers]
            M -->|No| O[2-F2: general<br/>LLM ì§€ì‹ ê¸°ë°˜]
            O --> P[ë…¼ë¬¸ ì„¤ëª… ìƒì„±<br/>ğŸ’¾ papers]
        end

        subgraph Step3["ğŸ”¶ 3ë‹¨ê³„: ë…¼ë¬¸ ìš”ì•½"]
            direction LR
            Q[summarize ì‹¤í–‰<br/>ë…¼ë¬¸ ìš”ì•½] --> R{ìš”ì•½ ì„±ê³µ?}
            R -->|Yes| S[ë…¼ë¬¸ ìš”ì•½ ìƒì„±<br/>ğŸ’¾ paper_summary]
            R -->|No| T[3-F: general<br/>LLM ì§€ì‹ ê¸°ë°˜]
            T --> U[ìš”ì•½ ìƒì„±<br/>ğŸ’¾ paper_summary]
        end

        subgraph Step4["âœ¨ 4ë‹¨ê³„: íŒŒì¼ ì €ì¥"]
            direction LR
            V[save_file ì‹¤í–‰<br/>ì„¸ì…˜ ë°ì´í„° ë¡œë“œ] --> W[íŒŒì¼ ë‚´ìš© êµ¬ì„±<br/>term_definition +<br/>paper_summary]
            W --> X{ì €ì¥ ì„±ê³µ?}
            X -->|Yes| Y[4ê°œ íŒŒì¼ ìƒì„±<br/>easy/hard/auto/raw]
            X -->|No| Z[ì €ì¥ ì‹¤íŒ¨<br/>ì˜¤ë¥˜ ë©”ì‹œì§€]
        end

        subgraph Output["ğŸ’¡ 5ë‹¨ê³„: ìµœì¢… ì¶œë ¥"]
            direction LR
            AA[UI í‘œì‹œ] --> AB[ì €ì¥ ì™„ë£Œ ë©”ì‹œì§€<br/>íŒŒì¼ ê²½ë¡œ í¬í•¨]
            AB --> End([âœ… ì™„ë£Œ])
        end

        %% ë‹¨ê³„ ê°„ ì—°ê²°
        Init --> Step1
        Step1 --> Step2
        Step2 --> Step3
        Step3 --> Step4
        Step4 --> Output
    end

    %% ë©”ì¸ ì›Œí¬í”Œë¡œìš° ë°°ê²½
    style MainFlow fill:#fffde7,stroke:#f9a825,stroke-width:4px,color:#000

    %% Subgraph ìŠ¤íƒ€ì¼
    style Init fill:#e0f7fa,stroke:#006064,stroke-width:3px,color:#000
    style Step1 fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000
    style Step2 fill:#fff3e0,stroke:#e65100,stroke-width:3px,color:#000
    style Step3 fill:#ffebee,stroke:#c62828,stroke-width:3px,color:#000
    style Step4 fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px,color:#000
    style Output fill:#e3f2fd,stroke:#1565c0,stroke-width:3px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì´ˆê¸°í™” - ì²­ë¡ ê³„ì—´)
    style Start fill:#4db6ac,stroke:#00695c,stroke-width:3px,color:#000
    style A fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000
    style B fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000
    style C fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (1ë‹¨ê³„ - ë³´ë¼ ê³„ì—´)
    style D fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style E fill:#ce93d8,stroke:#7b1fa2,stroke-width:2px,color:#000
    style F fill:#ce93d8,stroke:#6a1b9a,stroke-width:2px,color:#000
    style G fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style H fill:#ce93d8,stroke:#6a1b9a,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (2ë‹¨ê³„ - ì£¼í™© ê³„ì—´)
    style I fill:#ffcc80,stroke:#f57c00,stroke-width:2px,color:#000
    style J fill:#ffb74d,stroke:#f57c00,stroke-width:2px,color:#000
    style K fill:#ffa726,stroke:#ef6c00,stroke-width:2px,color:#000
    style L fill:#ffcc80,stroke:#f57c00,stroke-width:2px,color:#000
    style M fill:#ffb74d,stroke:#f57c00,stroke-width:2px,color:#000
    style N fill:#ffa726,stroke:#ef6c00,stroke-width:2px,color:#000
    style O fill:#ffcc80,stroke:#f57c00,stroke-width:2px,color:#000
    style P fill:#ffa726,stroke:#ef6c00,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (3ë‹¨ê³„ - ë¹¨ê°• ê³„ì—´)
    style Q fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style R fill:#e57373,stroke:#c62828,stroke-width:2px,color:#000
    style S fill:#ef5350,stroke:#b71c1c,stroke-width:2px,color:#000
    style T fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style U fill:#ef5350,stroke:#b71c1c,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (4ë‹¨ê³„ - ë…¹ìƒ‰ ê³„ì—´)
    style V fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style W fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style X fill:#66bb6a,stroke:#2e7d32,stroke-width:2px,color:#000
    style Y fill:#66bb6a,stroke:#1b5e20,stroke-width:2px,color:#000
    style Z fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì¶œë ¥ - íŒŒë‘ ê³„ì—´)
    style AA fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style AB fill:#64b5f6,stroke:#1976d2,stroke-width:2px,color:#000
    style End fill:#66bb6a,stroke:#2e7d32,stroke-width:3px,color:#000

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ì´ˆê¸°í™” - ì²­ë¡ 0~2)
    linkStyle 0 stroke:#006064,stroke-width:2px
    linkStyle 1 stroke:#006064,stroke-width:2px
    linkStyle 2 stroke:#006064,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (1ë‹¨ê³„ - ë³´ë¼ 3~6)
    linkStyle 3 stroke:#7b1fa2,stroke-width:2px
    linkStyle 4 stroke:#7b1fa2,stroke-width:2px
    linkStyle 5 stroke:#7b1fa2,stroke-width:2px
    linkStyle 6 stroke:#7b1fa2,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (2ë‹¨ê³„ - ì£¼í™© 7~13)
    linkStyle 7 stroke:#e65100,stroke-width:2px
    linkStyle 8 stroke:#e65100,stroke-width:2px
    linkStyle 9 stroke:#e65100,stroke-width:2px
    linkStyle 10 stroke:#e65100,stroke-width:2px
    linkStyle 11 stroke:#e65100,stroke-width:2px
    linkStyle 12 stroke:#e65100,stroke-width:2px
    linkStyle 13 stroke:#e65100,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (3ë‹¨ê³„ - ë¹¨ê°• 14~17)
    linkStyle 14 stroke:#c62828,stroke-width:2px
    linkStyle 15 stroke:#c62828,stroke-width:2px
    linkStyle 16 stroke:#c62828,stroke-width:2px
    linkStyle 17 stroke:#c62828,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (4ë‹¨ê³„ - ë…¹ìƒ‰ 18~21)
    linkStyle 18 stroke:#2e7d32,stroke-width:2px
    linkStyle 19 stroke:#2e7d32,stroke-width:2px
    linkStyle 20 stroke:#2e7d32,stroke-width:2px
    linkStyle 21 stroke:#2e7d32,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ì¶œë ¥ - íŒŒë‘ 22~23)
    linkStyle 22 stroke:#1565c0,stroke-width:2px
    linkStyle 23 stroke:#1565c0,stroke-width:2px

    %% ë‹¨ê³„ ê°„ ì—°ê²° (íšŒìƒ‰ 24~28)
    linkStyle 24 stroke:#616161,stroke-width:3px
    linkStyle 25 stroke:#616161,stroke-width:3px
    linkStyle 26 stroke:#616161,stroke-width:3px
    linkStyle 27 stroke:#616161,stroke-width:3px
    linkStyle 28 stroke:#616161,stroke-width:3px
```

### ë‹¤ì´ì–´ê·¸ë¨ ë¶„ì„

#### êµ¬ì¡°
- **MainFlow**: ì „ì²´ íŒŒì´í”„ë¼ì¸ ë˜í¼ (ë…¸ë€ìƒ‰)
- **6ê°œ subgraph**: ì´ˆê¸°í™” â†’ ìš©ì–´ì •ì˜ â†’ ë…¼ë¬¸ê²€ìƒ‰ â†’ ìš”ì•½ â†’ ì €ì¥ â†’ ì¶œë ¥
- **ì´ ë…¸ë“œ ìˆ˜**: 33ê°œ (Start ~ End)
- **ì´ ì—°ê²°ì„  ìˆ˜**: 29ê°œ (linkStyle 0~28)

#### ìƒ‰ìƒ êµ¬ë¶„
- ğŸ”¸ **ì²­ë¡ìƒ‰ (ì´ˆê¸°í™”)**: ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥ ë° ë¼ìš°íŒ…
- ğŸ”¹ **ë³´ë¼ìƒ‰ (1ë‹¨ê³„)**: glossary ë˜ëŠ” general Fallback
- ğŸ”º **ì£¼í™©ìƒ‰ (2ë‹¨ê³„)**: search_paper â†’ web_search â†’ general Fallback ì²´ì¸
- ğŸ”¶ **ë¹¨ê°•ìƒ‰ (3ë‹¨ê³„)**: summarize ë˜ëŠ” general Fallback
- âœ¨ **ë…¹ìƒ‰ (4ë‹¨ê³„)**: save_file ì‹¤í–‰
- ğŸ’¡ **íŒŒë€ìƒ‰ (ì¶œë ¥)**: ìµœì¢… ê²°ê³¼ ë°˜í™˜

#### Fallback ê²½ë¡œ
- **1ë‹¨ê³„**: glossary ì‹¤íŒ¨ â†’ general (1-F)
- **2ë‹¨ê³„**: search_paper ì‹¤íŒ¨ â†’ web_search (2-F1) â†’ general (2-F2)
- **3ë‹¨ê³„**: summarize ì‹¤íŒ¨ â†’ general (3-F)
- **4ë‹¨ê³„**: Fallback ì—†ìŒ (ì‹¤íŒ¨ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€)

---

## ğŸ” ìƒì„¸ ê¸°ëŠ¥ ë™ì‘ íë¦„ë„

### ì „ì²´ ì‹¤í–‰ íë¦„ (main.py â†’ ë„êµ¬ ì‹¤í–‰)

ì´ ë‹¤ì´ì–´ê·¸ë¨ì€ ì‹¤ì œ íŒŒì¼ëª…ê³¼ ë©”ì„œë“œëª…ì„ í¬í•¨í•œ ìƒì„¸ ì‹¤í–‰ íë¦„ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.

```mermaid
graph TB
    subgraph MainFlow["ğŸ“‹ ìƒì„¸ ì‹¤í–‰ íë¦„"]
        direction TB

        subgraph Entry["ğŸ”¸ Entry Point"]
            direction LR
            A[main.py<br/>ChatService.process_message] --> B[src/agent/router.py<br/>Router.route]
            B --> C{quadruple_request?}
            C -->|Yes| D[4ë‹¨ê³„ íŒŒì´í”„ë¼ì¸<br/>ìƒì„±]
        end

        subgraph Step1["ğŸ”¹ 1ë‹¨ê³„: ìš©ì–´ ì •ì˜"]
            direction LR
            E1[src/agent/nodes.py<br/>glossary_node] --> E2[src/tools/glossary.py<br/>search_glossary]
            E2 --> E3{status==success?}
            E3 -->|success| E6[ì„¸ì…˜ ì €ì¥<br/>ğŸ’¾ term_definition]
            E3 -->|failed| E4[src/agent/nodes.py<br/>general_node]
            E4 --> E5[src/tools/general_answer.py<br/>general]
            E5 --> E6
        end

        subgraph Step2["ğŸ”º 2ë‹¨ê³„: ë…¼ë¬¸ ê²€ìƒ‰"]
            direction LR
            F1[src/agent/nodes.py<br/>search_paper_node] --> F2[src/tools/search_paper.py<br/>search_paper]
            F2 --> F3{status==success?}
            F3 -->|success| F9[papers ë°ì´í„°<br/>3ë‹¨ê³„ë¡œ ì „ë‹¬]
            F3 -->|failed| F4[src/agent/nodes.py<br/>web_search_node]
            F4 --> F5[src/tools/web_search.py<br/>web_search]
            F5 --> F6{status==success?}
            F6 -->|success| F9
            F6 -->|failed| F7[src/agent/nodes.py<br/>general_node]
            F7 --> F8[src/tools/general_answer.py<br/>general]
            F8 --> F9
        end

        subgraph Step3["ğŸ”¶ 3ë‹¨ê³„: ë…¼ë¬¸ ìš”ì•½"]
            direction LR
            G1[src/agent/nodes.py<br/>summarize_node] --> G2[src/tools/summarize.py<br/>summarize]
            G2 --> G3{status==success?}
            G3 -->|success| G6[ì„¸ì…˜ ì €ì¥<br/>ğŸ’¾ paper_summary]
            G3 -->|failed| G4[src/agent/nodes.py<br/>general_node]
            G4 --> G5[src/tools/general_answer.py<br/>general]
            G5 --> G6
        end

        subgraph Step4["âœ¨ 4ë‹¨ê³„: íŒŒì¼ ì €ì¥"]
            direction LR
            H1[src/agent/nodes.py<br/>save_file_node] --> H3[ì„¸ì…˜ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°<br/>term_definition +<br/>paper_summary]
            H3 --> H2[src/tools/save_file.py<br/>save_file]
            H2 --> H4{ì €ì¥ ì„±ê³µ?}
            H4 -->|success| H5[4ê°œ íŒŒì¼ ìƒì„±]
            H4 -->|failed| H6[ì˜¤ë¥˜ ë©”ì‹œì§€]
        end

        subgraph Output["ğŸ’¡ ì‘ë‹µ ë°˜í™˜"]
            direction LR
            I1[ìµœì¢… ì‘ë‹µ ìƒì„±] --> I2[ì‚¬ìš©ìì—ê²Œ ë°˜í™˜]
        end

        %% ë‹¨ê³„ ê°„ ì—°ê²°
        Entry --> Step1
        Step1 --> Step2
        Step2 --> Step3
        Step3 --> Step4
        Step4 --> Output
    end

    %% ë©”ì¸ ì›Œí¬í”Œë¡œìš° ë°°ê²½
    style MainFlow fill:#fffde7,stroke:#f9a825,stroke-width:4px,color:#000

    %% Subgraph ìŠ¤íƒ€ì¼
    style Entry fill:#e0f7fa,stroke:#006064,stroke-width:3px,color:#000
    style Step1 fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000
    style Step2 fill:#fff3e0,stroke:#e65100,stroke-width:3px,color:#000
    style Step3 fill:#ffebee,stroke:#c62828,stroke-width:3px,color:#000
    style Step4 fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px,color:#000
    style Output fill:#e3f2fd,stroke:#1565c0,stroke-width:3px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (Entry - ì²­ë¡ ê³„ì—´)
    style A fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000
    style B fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000
    style C fill:#80deea,stroke:#006064,stroke-width:2px,color:#000
    style D fill:#4dd0e1,stroke:#006064,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (1ë‹¨ê³„ - ë³´ë¼ ê³„ì—´)
    style E1 fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style E2 fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style E3 fill:#ce93d8,stroke:#7b1fa2,stroke-width:2px,color:#000
    style E4 fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style E5 fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px,color:#000
    style E6 fill:#ce93d8,stroke:#6a1b9a,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (2ë‹¨ê³„ - ì£¼í™© ê³„ì—´)
    style F1 fill:#ffcc80,stroke:#f57c00,stroke-width:2px,color:#000
    style F2 fill:#ffcc80,stroke:#f57c00,stroke-width:2px,color:#000
    style F3 fill:#ffb74d,stroke:#f57c00,stroke-width:2px,color:#000
    style F4 fill:#ffcc80,stroke:#f57c00,stroke-width:2px,color:#000
    style F5 fill:#ffcc80,stroke:#f57c00,stroke-width:2px,color:#000
    style F6 fill:#ffb74d,stroke:#f57c00,stroke-width:2px,color:#000
    style F7 fill:#ffcc80,stroke:#f57c00,stroke-width:2px,color:#000
    style F8 fill:#ffcc80,stroke:#f57c00,stroke-width:2px,color:#000
    style F9 fill:#ffa726,stroke:#ef6c00,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (3ë‹¨ê³„ - ë¹¨ê°• ê³„ì—´)
    style G1 fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style G2 fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style G3 fill:#e57373,stroke:#c62828,stroke-width:2px,color:#000
    style G4 fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style G5 fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000
    style G6 fill:#ef5350,stroke:#b71c1c,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (4ë‹¨ê³„ - ë…¹ìƒ‰ ê³„ì—´)
    style H1 fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style H2 fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style H3 fill:#81c784,stroke:#2e7d32,stroke-width:2px,color:#000
    style H4 fill:#66bb6a,stroke:#2e7d32,stroke-width:2px,color:#000
    style H5 fill:#66bb6a,stroke:#1b5e20,stroke-width:2px,color:#000
    style H6 fill:#ef9a9a,stroke:#c62828,stroke-width:2px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì¶œë ¥ - íŒŒë‘ ê³„ì—´)
    style I1 fill:#90caf9,stroke:#1976d2,stroke-width:2px,color:#000
    style I2 fill:#64b5f6,stroke:#1976d2,stroke-width:2px,color:#000

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (Entry - ì²­ë¡ 0~3)
    linkStyle 0 stroke:#006064,stroke-width:2px
    linkStyle 1 stroke:#006064,stroke-width:2px
    linkStyle 2 stroke:#006064,stroke-width:2px
    linkStyle 3 stroke:#006064,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (1ë‹¨ê³„ - ë³´ë¼ 4~9)
    linkStyle 4 stroke:#7b1fa2,stroke-width:2px
    linkStyle 5 stroke:#7b1fa2,stroke-width:2px
    linkStyle 6 stroke:#7b1fa2,stroke-width:2px
    linkStyle 7 stroke:#7b1fa2,stroke-width:2px
    linkStyle 8 stroke:#7b1fa2,stroke-width:2px
    linkStyle 9 stroke:#7b1fa2,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (2ë‹¨ê³„ - ì£¼í™© 10~18)
    linkStyle 10 stroke:#e65100,stroke-width:2px
    linkStyle 11 stroke:#e65100,stroke-width:2px
    linkStyle 12 stroke:#e65100,stroke-width:2px
    linkStyle 13 stroke:#e65100,stroke-width:2px
    linkStyle 14 stroke:#e65100,stroke-width:2px
    linkStyle 15 stroke:#e65100,stroke-width:2px
    linkStyle 16 stroke:#e65100,stroke-width:2px
    linkStyle 17 stroke:#e65100,stroke-width:2px
    linkStyle 18 stroke:#e65100,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (3ë‹¨ê³„ - ë¹¨ê°• 19~24)
    linkStyle 19 stroke:#c62828,stroke-width:2px
    linkStyle 20 stroke:#c62828,stroke-width:2px
    linkStyle 21 stroke:#c62828,stroke-width:2px
    linkStyle 22 stroke:#c62828,stroke-width:2px
    linkStyle 23 stroke:#c62828,stroke-width:2px
    linkStyle 24 stroke:#c62828,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (4ë‹¨ê³„ - ë…¹ìƒ‰ 25~29)
    linkStyle 25 stroke:#2e7d32,stroke-width:2px
    linkStyle 26 stroke:#2e7d32,stroke-width:2px
    linkStyle 27 stroke:#2e7d32,stroke-width:2px
    linkStyle 28 stroke:#2e7d32,stroke-width:2px
    linkStyle 29 stroke:#2e7d32,stroke-width:2px

    %% ì—°ê²°ì„  ìŠ¤íƒ€ì¼ (ì¶œë ¥ - íŒŒë‘ 30)
    linkStyle 30 stroke:#1565c0,stroke-width:2px

    %% ë‹¨ê³„ ê°„ ì—°ê²° (íšŒìƒ‰ 31~35)
    linkStyle 31 stroke:#616161,stroke-width:3px
    linkStyle 32 stroke:#616161,stroke-width:3px
    linkStyle 33 stroke:#616161,stroke-width:3px
    linkStyle 34 stroke:#616161,stroke-width:3px
    linkStyle 35 stroke:#616161,stroke-width:3px
```

### ë°ì´í„° íŒŒì´í”„ë¼ì¸ ìƒì„¸ ì„¤ëª…

#### 1ë‹¨ê³„ â†’ ì„¸ì…˜ ì €ì¥
```python
# 1ë‹¨ê³„ ì™„ë£Œ í›„
session_data = {
    "term_definition": glossary_result or general_result,
    "timestamp": "2025-11-07 14:30:25"
}
save_to_session(session_id, session_data)
```

#### 2ë‹¨ê³„ â†’ 3ë‹¨ê³„ ì§ì ‘ ì „ë‹¬
```python
# 2ë‹¨ê³„ ê²°ê³¼ë¥¼ 3ë‹¨ê³„ ì…ë ¥ìœ¼ë¡œ ì§ì ‘ ì „ë‹¬
papers = search_paper_result or web_search_result or general_result
summary_result = summarize(papers=papers)
```

#### 3ë‹¨ê³„ â†’ ì„¸ì…˜ ì €ì¥
```python
# 3ë‹¨ê³„ ì™„ë£Œ í›„
session_data.update({
    "paper_summary": summary_result,
    "timestamp": "2025-11-07 14:30:45"
})
save_to_session(session_id, session_data)
```

#### ì„¸ì…˜ â†’ 4ë‹¨ê³„ ì „ë‹¬
```python
# 4ë‹¨ê³„ì—ì„œ ì„¸ì…˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
term_definition = get_from_session(session_id, "term_definition")
paper_summary = get_from_session(session_id, "paper_summary")

# íŒŒì¼ ì €ì¥
save_file_content = f"""
{term_definition}

{paper_summary}
"""
```

---

## ğŸ“‹ ì „ì²´ íë¦„ ìš”ì•½ í‘œ

| ë‹¨ê³„ | ë„êµ¬ëª… | íŒŒì¼ëª… | ë©”ì„œë“œëª… | ë™ì‘ ì„¤ëª… | ì…ë ¥ | ì¶œë ¥ | Fallback | ì„¸ì…˜ ì €ì¥ |
|------|--------|--------|----------|-----------|------|------|----------|----------|
| **1** | glossary | src/tools/<br/>glossary.py | search_glossary | ìš©ì–´ì§‘ DBì—ì„œ<br/>í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰<br/>(ë²¡í„° 50% +<br/>í‚¤ì›Œë“œ 50%) | question<br/>mode | ìš©ì–´ ì •ì˜<br/>(ë‚œì´ë„ë³„) | 1-F: general | term_definition |
| **1-F** | general | src/tools/<br/>general_answer.py | general | LLMì´ ì§ì ‘<br/>ìš©ì–´ ì„¤ëª… ìƒì„±<br/>(Solar-pro2/<br/>GPT-5) | question<br/>difficulty | ìš©ì–´ ì„¤ëª… | ì—†ìŒ | term_definition |
| **2** | search_paper | src/tools/<br/>search_paper.py | search_paper | ë…¼ë¬¸ DBì—ì„œ<br/>í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰<br/>(ë²¡í„° 70% +<br/>í‚¤ì›Œë“œ 30%) | question<br/>top_k | ë…¼ë¬¸ ì •ë³´<br/>(JSON) | 2-F1: web_search | - |
| **2-F1** | web_search | src/tools/<br/>web_search.py | web_search | arXiv APIë¡œ<br/>ì›¹ì—ì„œ ë…¼ë¬¸ ê²€ìƒ‰ | query<br/>num_results | ë…¼ë¬¸ ì •ë³´<br/>(JSON) | 2-F2: general | - |
| **2-F2** | general | src/tools/<br/>general_answer.py | general | LLMì´ ì§ì ‘<br/>ë…¼ë¬¸ ë‚´ìš© ì„¤ëª…<br/>(Solar-pro2/<br/>GPT-5) | question<br/>difficulty | ë…¼ë¬¸ ì„¤ëª… | ì—†ìŒ | - |
| **3** | summarize | src/tools/<br/>summarize.py | summarize | 2ë‹¨ê³„ ê²°ê³¼<br/>ê¸°ë°˜ ë…¼ë¬¸ ìš”ì•½<br/>(Solar-pro2/<br/>GPT-5) | papers<br/>difficulty | ë…¼ë¬¸ ìš”ì•½<br/>(JSON) | 3-F: general | paper_summary |
| **3-F** | general | src/tools/<br/>general_answer.py | general | LLMì´ ì§ì ‘<br/>ë…¼ë¬¸ ìš”ì•½ ìƒì„±<br/>(Solar-pro2/<br/>GPT-5) | question<br/>difficulty | ë…¼ë¬¸ ìš”ì•½ | ì—†ìŒ | paper_summary |
| **4** | save_file | src/tools/<br/>save_file.py | save_file | ì„¸ì…˜ ë°ì´í„°<br/>íŒŒì¼ë¡œ ì €ì¥<br/>(1ë‹¨ê³„ + 3ë‹¨ê³„) | session_id<br/>difficulty | ì €ì¥ ì™„ë£Œ<br/>ë©”ì‹œì§€ | ì—†ìŒ | - |

### í‘œ ì„¤ëª…

**ë‹¨ê³„ ë²ˆí˜¸ ì˜ë¯¸:**
- **1, 2, 3, 4**: ì£¼ ë„êµ¬ (Primary Tool)
- **1-F, 2-F1, 2-F2, 3-F**: Fallback ë„êµ¬

**Fallback ì²´ì¸:**
- **1ë‹¨ê³„**: glossary â†’ general (1-F)
- **2ë‹¨ê³„**: search_paper â†’ web_search (2-F1) â†’ general (2-F2)
- **3ë‹¨ê³„**: summarize â†’ general (3-F)
- **4ë‹¨ê³„**: save_file (Fallback ì—†ìŒ)

**ë°ì´í„° íë¦„:**
- **1ë‹¨ê³„ â†’ ì„¸ì…˜**: term_definition ì €ì¥
- **2ë‹¨ê³„ â†’ 3ë‹¨ê³„**: papers ì§ì ‘ ì „ë‹¬
- **3ë‹¨ê³„ â†’ ì„¸ì…˜**: paper_summary ì €ì¥
- **ì„¸ì…˜ â†’ 4ë‹¨ê³„**: term_definition + paper_summary ê°€ì ¸ì™€ì„œ ì €ì¥

**DB ì‚¬ìš©:**
- **glossary**: `glossary_terms` í…Œì´ë¸” (PostgreSQL + PGVector)
- **search_paper**: `papers` í…Œì´ë¸” (PostgreSQL + PGVector)
- **web_search**: arXiv API (ì™¸ë¶€ API)
- **others**: DB ì‚¬ìš© ì•ˆ í•¨

---

## ğŸ“– ë™ì‘ ì„¤ëª… (ì´ˆë³´ ê°œë°œììš©)

### 4ë‹¨ê³„ ì›Œí¬í”Œë¡œìš° ì™„ì „ ê°€ì´ë“œ

ì´ ì‹œìŠ¤í…œì€ **4ë‹¨ê³„ ìˆœì°¨ ì‹¤í–‰ + 3ê°œ Fallback ì²´ì¸**ìœ¼ë¡œ êµ¬ì„±ëœ ê°€ì¥ ë³µì¡í•œ ì›Œí¬í”Œë¡œìš°ì…ë‹ˆë‹¤. ê° ë‹¨ê³„ë¥¼ ìƒì„¸íˆ ì„¤ëª…í•©ë‹ˆë‹¤.

---

#### 1ë‹¨ê³„: ìš©ì–´ ì •ì˜ (glossary â†’ general)

**ëª©ì :** ì‚¬ìš©ìê°€ ë¬¼ì–´ë³¸ AI ìš©ì–´ì˜ ì •ì˜ë¥¼ ì œê³µ

**ì‹¤í–‰ ì‹œì :** ì‚¬ìš©ì ì§ˆë¬¸ ì§í›„ (ì²« ë²ˆì§¸ ë‹¨ê³„)

**ì£¼ ë„êµ¬: glossary**

1. **ì§ˆë¬¸ ë¶„ì„**
   - ì‚¬ìš©ì ì§ˆë¬¸: "RAGê°€ ë­”ì§€ ì„¤ëª…í•˜ê³ ..."
   - í•µì‹¬ ìš©ì–´ ì¶”ì¶œ: "RAG"

2. **ìš©ì–´ì§‘ DB ê²€ìƒ‰**
   ```sql
   -- í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (PostgreSQL + PGVector)
   SELECT term, easy_explanation, hard_explanation
   FROM glossary_terms
   WHERE term ILIKE '%RAG%'  -- í‚¤ì›Œë“œ ê²€ìƒ‰ (50%)
   ORDER BY embedding <=> query_embedding  -- ë²¡í„° ê²€ìƒ‰ (50%)
   LIMIT 5;
   ```

3. **ë‚œì´ë„ë³„ ì„¤ëª… ì„ íƒ**
   - Easy ëª¨ë“œ: `easy_explanation` (Solar-pro2ë¡œ ìƒì„±ëœ ì‰¬ìš´ ì„¤ëª…)
   - Hard ëª¨ë“œ: `hard_explanation` (GPT-5ë¡œ ìƒì„±ëœ ê¸°ìˆ ì  ì„¤ëª…)

4. **ê²°ê³¼ ì €ì¥**
   - ì„¸ì…˜ì— `term_definition` í‚¤ë¡œ ì €ì¥
   - 4ë‹¨ê³„ íŒŒì¼ ì €ì¥ì—ì„œ ì‚¬ìš©

**ì„±ê³µ ì˜ˆì‹œ:**
```
ìš©ì–´: RAG (Retrieval-Augmented Generation)
ì •ì˜: RAGëŠ” ê²€ìƒ‰ ì¦ê°• ìƒì„± ê¸°ë²•ìœ¼ë¡œ, ì™¸ë¶€ ì§€ì‹ ë² ì´ìŠ¤ì—ì„œ ê´€ë ¨ ì •ë³´ë¥¼ ê²€ìƒ‰í•œ í›„
LLMì´ ì´ë¥¼ ì°¸ê³ í•˜ì—¬ ë‹µë³€ì„ ìƒì„±í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.
```

**Fallback: general (1-F)**

**ì‹¤í–‰ ì‹œì :** glossary ì‹¤íŒ¨ (ìš©ì–´ì§‘ì— ì—†ìŒ)

1. **LLM ëª¨ë¸ ì„ íƒ**
   - Easy ëª¨ë“œ: Solar-pro2 (í•œêµ­ì–´ íŠ¹í™”)
   - Hard ëª¨ë“œ: GPT-5 (ê¸°ìˆ ì  ì •í™•ë„)

2. **í”„ë¡¬í”„íŠ¸ ì‚¬ìš©**
   ```python
   prompt = """
   ë‹¹ì‹ ì€ AI ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ë¬¼ì–´ë³¸ ìš©ì–´ë¥¼ ì‰½ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”.

   ê·œì¹™:
   - Easy ëª¨ë“œ: ì´ˆë“±í•™ìƒë„ ì´í•´í•  ìˆ˜ ìˆê²Œ ì„¤ëª…
   - Hard ëª¨ë“œ: ì „ë¬¸ì ì´ê³  ê¸°ìˆ ì ìœ¼ë¡œ ì„¤ëª…
   """
   ```

3. **LLM í˜¸ì¶œ**
   ```python
   response = llm.invoke([
       SystemMessage(content=prompt),
       HumanMessage(content="RAGê°€ ë­”ê°€ìš”?")
   ])
   ```

4. **ê²°ê³¼ ì €ì¥**
   - ì„¸ì…˜ì— `term_definition` í‚¤ë¡œ ì €ì¥

**ì°¨ì´ì :**
- glossaryëŠ” **ë¯¸ë¦¬ ê²€ì¦ëœ ì •ì˜** ì œê³µ (ë” ì •í™•)
- generalì€ **LLMì´ ì¦‰ì‹œ ìƒì„±** (ìš©ì–´ì§‘ì— ì—†ëŠ” ìš©ì–´ë„ ì²˜ë¦¬ ê°€ëŠ¥)

---

#### 2ë‹¨ê³„: ë…¼ë¬¸ ê²€ìƒ‰ (search_paper â†’ web_search â†’ general)

**ëª©ì :** 1ë‹¨ê³„ì—ì„œ ì •ì˜í•œ ìš©ì–´ì™€ ê´€ë ¨ëœ ë…¼ë¬¸ì„ ì°¾ìŒ

**ì‹¤í–‰ ì‹œì :** 1ë‹¨ê³„ ì™„ë£Œ ì§í›„

**ì£¼ ë„êµ¬: search_paper**

1. **ì§ˆë¬¸ ì „ì²˜ë¦¬**
   - ì›ë³¸ ì§ˆë¬¸: "RAGê°€ ë­”ì§€ ì„¤ëª…í•˜ê³  ê´€ë ¨ ë…¼ë¬¸ë„ ìš”ì•½í•´ì„œ..."
   - ê²€ìƒ‰ ì¿¼ë¦¬: "RAG", "Retrieval-Augmented Generation"

2. **ë…¼ë¬¸ DB ê²€ìƒ‰**
   ```sql
   -- í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (PostgreSQL + PGVector)
   SELECT title, authors, abstract, url
   FROM papers
   WHERE title ILIKE '%RAG%' OR abstract ILIKE '%Retrieval%'  -- í‚¤ì›Œë“œ ê²€ìƒ‰ (30%)
   ORDER BY embedding <=> query_embedding  -- ë²¡í„° ê²€ìƒ‰ (70%)
   LIMIT 5;
   ```

3. **ê²€ìƒ‰ ê²°ê³¼ í¬ë§·íŒ…**
   ```json
   [
     {
       "title": "Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks",
       "authors": ["Patrick Lewis", "Ethan Perez", ...],
       "abstract": "Large pre-trained language models...",
       "url": "https://arxiv.org/abs/2005.11401",
       "score": 0.89
     }
   ]
   ```

4. **3ë‹¨ê³„ë¡œ ì§ì ‘ ì „ë‹¬**
   - ì„¸ì…˜ ì €ì¥ ì—†ì´ ë°”ë¡œ summarize ë„êµ¬ë¡œ ì „ë‹¬

**ì„±ê³µ ì˜ˆì‹œ:**
```
âœ… 5ê°œ ë…¼ë¬¸ ë°œê²¬
- Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks (2020)
- REALM: Retrieval-Augmented Language Model Pre-Training (2020)
- ...
```

**Fallback 1: web_search (2-F1)**

**ì‹¤í–‰ ì‹œì :** search_paper ì‹¤íŒ¨ (DBì— ë…¼ë¬¸ ì—†ìŒ)

1. **arXiv API í˜¸ì¶œ**
   ```python
   import arxiv

   search = arxiv.Search(
       query="RAG OR Retrieval-Augmented Generation",
       max_results=5,
       sort_by=arxiv.SortCriterion.Relevance
   )
   ```

2. **ê²€ìƒ‰ ê²°ê³¼ í¬ë§·íŒ…**
   - search_paperì™€ ë™ì¼í•œ JSON í˜•ì‹

3. **3ë‹¨ê³„ë¡œ ì§ì ‘ ì „ë‹¬**

**ì„±ê³µ ì˜ˆì‹œ:**
```
âœ… ì›¹ì—ì„œ 3ê°œ ë…¼ë¬¸ ë°œê²¬
- Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks (arXiv)
- ...
```

**ì°¨ì´ì :**
- search_paperëŠ” **ë¡œì»¬ DB** (ë¹ ë¥´ê³  ì•ˆì •ì )
- web_searchëŠ” **ì‹¤ì‹œê°„ ì›¹ ê²€ìƒ‰** (ìµœì‹  ë…¼ë¬¸ í¬í•¨)

**Fallback 2: general (2-F2)**

**ì‹¤í–‰ ì‹œì :** search_paper ì‹¤íŒ¨ â†’ web_search ì‹¤íŒ¨

1. **LLM ëª¨ë¸ ì„ íƒ**
   - Easy ëª¨ë“œ: Solar-pro2
   - Hard ëª¨ë“œ: GPT-5

2. **í”„ë¡¬í”„íŠ¸ ì‚¬ìš©**
   ```python
   prompt = """
   ë‹¹ì‹ ì€ AI ë…¼ë¬¸ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ìš”ì²­í•œ ì£¼ì œì˜ ëŒ€í‘œ ë…¼ë¬¸ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.

   ê·œì¹™:
   - ë…¼ë¬¸ ì œëª©, ì €ì, ì£¼ìš” ë‚´ìš© í¬í•¨
   - ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ë…¼ë¬¸ë§Œ ì–¸ê¸‰
   """
   ```

3. **LLM í˜¸ì¶œ**
   ```python
   response = llm.invoke([
       SystemMessage(content=prompt),
       HumanMessage(content="RAG ê´€ë ¨ ë…¼ë¬¸ì„ ì•Œë ¤ì£¼ì„¸ìš”")
   ])
   ```

4. **ê²°ê³¼ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë³€í™˜**
   - LLM ì‘ë‹µì„ íŒŒì‹±í•˜ì—¬ ë…¼ë¬¸ ì •ë³´ ì¶”ì¶œ

5. **3ë‹¨ê³„ë¡œ ì§ì ‘ ì „ë‹¬**

**ì°¨ì´ì :**
- search_paper/web_searchëŠ” **ì‹¤ì œ ê²€ìƒ‰**
- generalì€ **LLM ì§€ì‹ ê¸°ë°˜** (ìµœì‹  ë…¼ë¬¸ì€ ì—†ì„ ìˆ˜ ìˆìŒ)

---

#### 3ë‹¨ê³„: ë…¼ë¬¸ ìš”ì•½ (summarize â†’ general)

**ëª©ì :** 2ë‹¨ê³„ì—ì„œ ì°¾ì€ ë…¼ë¬¸ë“¤ì„ ìš”ì•½

**ì‹¤í–‰ ì‹œì :** 2ë‹¨ê³„ ì™„ë£Œ ì§í›„

**ì£¼ ë„êµ¬: summarize**

1. **ì…ë ¥ ë°ì´í„° ìˆ˜ì‹ **
   - 2ë‹¨ê³„ì—ì„œ ì „ë‹¬ë°›ì€ ë…¼ë¬¸ ì •ë³´ (JSON)

2. **ë…¼ë¬¸ ì •ë³´ íŒŒì‹±**
   ```python
   papers = json.loads(input_data)
   # papers = [
   #   {"title": "...", "abstract": "...", ...},
   #   ...
   # ]
   ```

3. **ë‚œì´ë„ë³„ ëª¨ë¸ ì„ íƒ**
   - Easy ëª¨ë“œ: Solar-pro2 (Temperature: 0.3)
   - Hard ëª¨ë“œ: GPT-5 (Temperature: 0.3)

4. **ë…¼ë¬¸ë³„ ìš”ì•½ ìƒì„±**
   ```python
   for paper in papers:
       prompt = get_tool_prompt("summarize")
       summary = llm.invoke([
           SystemMessage(content=prompt),
           HumanMessage(content=f"ì œëª©: {paper['title']}\nì´ˆë¡: {paper['abstract']}")
       ])
       summaries.append({
           "title": paper["title"],
           "summary": summary
       })
   ```

5. **ê²°ê³¼ ì €ì¥**
   - ì„¸ì…˜ì— `paper_summary` í‚¤ë¡œ ì €ì¥
   - 4ë‹¨ê³„ íŒŒì¼ ì €ì¥ì—ì„œ ì‚¬ìš©

**ì„±ê³µ ì˜ˆì‹œ:**
```json
[
  {
    "title": "Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks",
    "summary": "ì´ ë…¼ë¬¸ì€ RAG ê¸°ë²•ì„ ì œì•ˆí•©ë‹ˆë‹¤. ì£¼ìš” íŠ¹ì§•:\n- ê²€ìƒ‰ + ìƒì„± ê²°í•©\n- ì§€ì‹ ì§‘ì•½ì  NLP ì‘ì—…ì— íš¨ê³¼ì \n- BERT ê¸°ë°˜ ê²€ìƒ‰ + GPT ê¸°ë°˜ ìƒì„±"
  }
]
```

**Fallback: general (3-F)**

**ì‹¤í–‰ ì‹œì :** summarize ì‹¤íŒ¨ (ìš”ì•½ ìƒì„± ì˜¤ë¥˜)

1. **LLM ëª¨ë¸ ì„ íƒ**
   - Easy ëª¨ë“œ: Solar-pro2
   - Hard ëª¨ë“œ: GPT-5

2. **í”„ë¡¬í”„íŠ¸ ì‚¬ìš©**
   ```python
   prompt = """
   ë‹¹ì‹ ì€ AI ë…¼ë¬¸ ìš”ì•½ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì£¼ì–´ì§„ ë…¼ë¬¸ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìš”ì•½ì„ ìƒì„±í•´ì£¼ì„¸ìš”.
   """
   ```

3. **LLM í˜¸ì¶œ**
   ```python
   response = llm.invoke([
       SystemMessage(content=prompt),
       HumanMessage(content=f"ë‹¤ìŒ ë…¼ë¬¸ì„ ìš”ì•½í•´ì£¼ì„¸ìš”:\n{paper_info}")
   ])
   ```

4. **ê²°ê³¼ ì €ì¥**
   - ì„¸ì…˜ì— `paper_summary` í‚¤ë¡œ ì €ì¥

**ì°¨ì´ì :**
- summarizeëŠ” **êµ¬ì¡°í™”ëœ ìš”ì•½** (ì¼ê´€ëœ í˜•ì‹)
- generalì€ **ììœ  í˜•ì‹ ìš”ì•½** (ìœ ì—°í•˜ì§€ë§Œ í˜•ì‹ ë¶ˆì¼ì¹˜ ê°€ëŠ¥)

---

#### 4ë‹¨ê³„: íŒŒì¼ ì €ì¥ (save_file)

**ëª©ì :** 1ë‹¨ê³„ ìš©ì–´ ì •ì˜ + 3ë‹¨ê³„ ë…¼ë¬¸ ìš”ì•½ì„ íŒŒì¼ë¡œ ì €ì¥

**ì‹¤í–‰ ì‹œì :** 3ë‹¨ê³„ ì™„ë£Œ ì§í›„ (ë§ˆì§€ë§‰ ë‹¨ê³„)

**ì£¼ ë„êµ¬: save_file**

1. **ì„¸ì…˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°**
   ```python
   term_definition = get_from_session(session_id, "term_definition")
   paper_summary = get_from_session(session_id, "paper_summary")
   ```

2. **íŒŒì¼ ë‚´ìš© êµ¬ì„±**
   ```python
   content = f"""# ë…¼ë¬¸ ë¦¬ë·° ê²°ê³¼

## 1. ìš©ì–´ ì •ì˜
{term_definition}

## 2. ê´€ë ¨ ë…¼ë¬¸ ìš”ì•½
{paper_summary}

---
ìƒì„± ì‹œê°„: {timestamp}
ë‚œì´ë„: {difficulty}
ì„¸ì…˜ ID: {session_id}
"""
   ```

3. **ë‚œì´ë„ë³„ íŒŒì¼ ì €ì¥**
   ```python
   # Easy ëª¨ë“œ
   easy_file = "outputs/easy_answer_20251107_143025.md"

   # Hard ëª¨ë“œ
   hard_file = "outputs/hard_answer_20251107_143025.md"

   # Auto ëª¨ë“œ
   auto_file = "outputs/auto_answer_20251107_143025.md"

   # ì›ë³¸ ë°ì´í„°
   raw_file = "outputs/easy_answer_20251107_143025_raw.json"
   ```

4. **ì €ì¥ ìš°ì„ ìˆœìœ„**
   ```python
   # 1ìˆœìœ„: final_answers (ìµœì¢… ë‹µë³€)
   if "final_answers" in session_data:
       content = session_data["final_answers"]

   # 2ìˆœìœ„: tool_result (ë„êµ¬ ì‹¤í–‰ ê²°ê³¼)
   elif "tool_result" in session_data:
       content = session_data["tool_result"]
   ```

5. **íŒŒì¼ ì“°ê¸°**
   ```python
   save_path.write_text(content, encoding="utf-8")
   ```

**ì„±ê³µ ì˜ˆì‹œ:**
```
âœ… ì €ì¥ ì™„ë£Œ: outputs/easy_answer_20251107_143025.md
âœ… ì €ì¥ ì™„ë£Œ: outputs/hard_answer_20251107_143025.md
âœ… ì €ì¥ ì™„ë£Œ: outputs/auto_answer_20251107_143025.md
âœ… ì €ì¥ ì™„ë£Œ: outputs/easy_answer_20251107_143025_raw.json
```

**ì‹¤íŒ¨ ì‹œ:**
```
âŒ ì €ì¥ ì‹¤íŒ¨: ê¶Œí•œ ì˜¤ë¥˜ ë˜ëŠ” ë””ìŠ¤í¬ ë¶€ì¡±
```

**íŠ¹ì§•:**
- **Fallback ì—†ìŒ**: save_file ì‹¤íŒ¨ ì‹œ ê·¸ëŒ€ë¡œ ì˜¤ë¥˜ ë°˜í™˜
- **4ê°œ íŒŒì¼ ìƒì„±**: easy, hard, auto, raw
- **ì„¸ì…˜ ì˜ì¡´**: 1ë‹¨ê³„ + 3ë‹¨ê³„ ê²°ê³¼ë¥¼ ì„¸ì…˜ì—ì„œ ê°€ì ¸ì˜´

---

### ì¤‘ê°„ ë°ì´í„° ì €ì¥ ë©”ì»¤ë‹ˆì¦˜

#### ì„¸ì…˜ ì €ì¥ íƒ€ì´ë°

```python
# 1ë‹¨ê³„ ì™„ë£Œ í›„
save_to_session(session_id, {
    "term_definition": glossary_result or general_result,
    "timestamp_step1": "2025-11-07 14:30:25"
})

# 2ë‹¨ê³„ â†’ 3ë‹¨ê³„ (ì„¸ì…˜ ì €ì¥ ì—†ì´ ì§ì ‘ ì „ë‹¬)
papers = search_paper_result or web_search_result or general_result
summary_result = summarize(papers=papers)

# 3ë‹¨ê³„ ì™„ë£Œ í›„
save_to_session(session_id, {
    "paper_summary": summary_result,
    "timestamp_step3": "2025-11-07 14:30:45"
})

# 4ë‹¨ê³„ì—ì„œ ê°€ì ¸ì˜¤ê¸°
term_definition = get_from_session(session_id, "term_definition")
paper_summary = get_from_session(session_id, "paper_summary")
```

#### ë°ì´í„° íŒŒì´í”„ë¼ì¸ ìš”ì•½

```
1ë‹¨ê³„ (glossary/general)
    â†“ [ì„¸ì…˜ ì €ì¥: term_definition]
    â†“
2ë‹¨ê³„ (search_paper/web_search/general)
    â†“ [ì§ì ‘ ì „ë‹¬: papers]
    â†“
3ë‹¨ê³„ (summarize/general)
    â†“ [ì„¸ì…˜ ì €ì¥: paper_summary]
    â†“
4ë‹¨ê³„ (save_file)
    â†“ [ì„¸ì…˜ì—ì„œ ê°€ì ¸ì˜¤ê¸°: term_definition + paper_summary]
    â†“
íŒŒì¼ ì €ì¥ ì™„ë£Œ
```

---

## ğŸ’¡ ì‹¤í–‰ ì˜ˆì‹œ

### ì‹œë‚˜ë¦¬ì˜¤ A: ëª¨ë“  ë„êµ¬ ì„±ê³µ (ìµœì„ ì˜ ê²½ë¡œ)

**ì‚¬ìš©ì ì…ë ¥:**
```
"RAGê°€ ë­”ì§€ ì„¤ëª…í•˜ê³  ê´€ë ¨ ë…¼ë¬¸ë„ ìš”ì•½í•´ì„œ ì €ì¥í•´ì¤˜"
```

#### 1ë‹¨ê³„: glossary (ì„±ê³µ)

**ì‹¤í–‰:**
```python
glossary_result = search_glossary(
    question="RAGê°€ ë­”ì§€ ì„¤ëª…í•˜ê³  ê´€ë ¨ ë…¼ë¬¸ë„ ìš”ì•½í•´ì„œ ì €ì¥í•´ì¤˜",
    mode="auto"
)
```

**ê²°ê³¼:**
```
ìš©ì–´: RAG (Retrieval-Augmented Generation)

ì •ì˜ (Easy):
RAGëŠ” 'ê²€ìƒ‰ ì¦ê°• ìƒì„±'ì´ë¼ëŠ” AI ê¸°ìˆ ì…ë‹ˆë‹¤.
ë§ˆì¹˜ ì‹œí—˜ì„ ë³¼ ë•Œ êµê³¼ì„œë¥¼ ì°¸ê³ í•˜ë“¯ì´, AIê°€ ë‹µë³€ì„ ë§Œë“¤ ë•Œ
ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê´€ë ¨ ì •ë³´ë¥¼ ë¨¼ì € ì°¾ì•„ë³¸ í›„ ë‹µë³€í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

íŠ¹ì§•:
- ìµœì‹  ì •ë³´ ë°˜ì˜ ê°€ëŠ¥
- ì •í™•ë„ í–¥ìƒ
- í™˜ê°(Hallucination) ê°ì†Œ

ì¶œì²˜: ìš©ì–´ì§‘ DB (í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰)
```

**ìƒíƒœ:** âœ… success
**ë‹¤ìŒ ë‹¨ê³„:** 2ë‹¨ê³„ (search_paper)

---

#### 2ë‹¨ê³„: search_paper (ì„±ê³µ)

**ì‹¤í–‰:**
```python
papers = search_paper(
    question="RAG ê´€ë ¨ ë…¼ë¬¸",
    top_k=5
)
```

**ê²°ê³¼:**
```json
[
  {
    "title": "Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks",
    "authors": ["Patrick Lewis", "Ethan Perez", "Aleksandra Piktus", "Fabio Petroni", "Vladimir Karpukhin", "Naman Goyal", "Heinrich KÃ¼ttler", "Mike Lewis", "Wen-tau Yih", "Tim RocktÃ¤schel", "Sebastian Riedel", "Douwe Kiela"],
    "abstract": "Large pre-trained language models have been shown to store factual knowledge in their parameters...",
    "url": "https://arxiv.org/abs/2005.11401",
    "score": 0.92
  },
  {
    "title": "REALM: Retrieval-Augmented Language Model Pre-Training",
    "authors": ["Kelvin Guu", "Kenton Lee", "Zora Tung", "Panupong Pasupat", "Ming-Wei Chang"],
    "abstract": "Language model pre-training has been shown to capture a surprising amount of world knowledge...",
    "url": "https://arxiv.org/abs/2002.08909",
    "score": 0.88
  }
]
```

**ìƒíƒœ:** âœ… success
**ë‹¤ìŒ ë‹¨ê³„:** 3ë‹¨ê³„ (summarize)

---

#### 3ë‹¨ê³„: summarize (ì„±ê³µ)

**ì‹¤í–‰:**
```python
summary = summarize(
    papers='[{"title": "Retrieval-Augmented Generation...", ...}]',
    difficulty="easy"
)
```

**ê²°ê³¼:**
```json
[
  {
    "title": "Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks",
    "summary": "**ì£¼ìš” ë‚´ìš©**\nì´ ë…¼ë¬¸ì€ RAG ê¸°ë²•ì„ ìµœì´ˆë¡œ ì œì•ˆí•œ ì—°êµ¬ì…ë‹ˆë‹¤.\n\n**í•µì‹¬ ì•„ì´ë””ì–´**\n- ê¸°ì¡´ LLMì˜ í•œê³„: í•™ìŠµ ë°ì´í„°ì—ë§Œ ì˜ì¡´, ìµœì‹  ì •ë³´ ë¶€ì¡±\n- RAGì˜ í•´ê²°ì±…: ê²€ìƒ‰ + ìƒì„± ê²°í•©\n  1. ì§ˆë¬¸ì´ ë“¤ì–´ì˜¤ë©´ ë¨¼ì € ìœ„í‚¤í”¼ë””ì•„ì—ì„œ ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰\n  2. ê²€ìƒ‰ëœ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ LLMì´ ë‹µë³€ ìƒì„±\n\n**ì‹¤í—˜ ê²°ê³¼**\n- ê¸°ì¡´ GPT-3 ëŒ€ë¹„ ì •í™•ë„ 10-15% í–¥ìƒ\n- íŠ¹íˆ ìµœì‹  ì •ë³´ê°€ í•„ìš”í•œ ì§ˆë¬¸ì—ì„œ í° íš¨ê³¼\n\n**í™œìš© ë¶„ì•¼**\n- ì§ˆì˜ì‘ë‹µ ì‹œìŠ¤í…œ\n- ì‚¬ì‹¤ í™•ì¸ (Fact Verification)\n- ì§€ì‹ ì§‘ì•½ì  NLP ì‘ì—…"
  },
  {
    "title": "REALM: Retrieval-Augmented Language Model Pre-Training",
    "summary": "**ì£¼ìš” ë‚´ìš©**\nì´ ë…¼ë¬¸ì€ RAGë¥¼ ì‚¬ì „ í•™ìŠµ ë‹¨ê³„ì— ì ìš©í•œ ì—°êµ¬ì…ë‹ˆë‹¤.\n\n**í•µì‹¬ ì•„ì´ë””ì–´**\n- ê¸°ì¡´ BERTëŠ” ì‚¬ì „ í•™ìŠµ ì‹œ ê²€ìƒ‰ ì—†ì´ í…ìŠ¤íŠ¸ë§Œ í•™ìŠµ\n- REALMì€ ì‚¬ì „ í•™ìŠµ ì‹œë¶€í„° ê²€ìƒ‰ + ìƒì„± ê²°í•©\n- í•™ìŠµ ì¤‘ì—ë„ ê´€ë ¨ ë¬¸ì„œë¥¼ ê²€ìƒ‰í•˜ì—¬ ì°¸ê³ \n\n**ì¥ì **\n- ë” ì ì€ íŒŒë¼ë¯¸í„°ë¡œ ë” ë†’ì€ ì„±ëŠ¥\n- ì§€ì‹ ì—…ë°ì´íŠ¸ ìš©ì´ (ì¬í•™ìŠµ ë¶ˆí•„ìš”)\n\n**í™œìš©**\n- Google ê²€ìƒ‰ ì—”ì§„ì— ì ìš©ë¨"
  }
]
```

**ìƒíƒœ:** âœ… success
**ë‹¤ìŒ ë‹¨ê³„:** 4ë‹¨ê³„ (save_file)

---

#### 4ë‹¨ê³„: save_file (ì„±ê³µ)

**ì‹¤í–‰:**
```python
result = save_file(
    session_id="session_123456",
    difficulty="easy"
)
```

**íŒŒì¼ ë‚´ìš© (easy_answer_20251107_143025.md):**
```markdown
# ë…¼ë¬¸ ë¦¬ë·° ê²°ê³¼

## 1. ìš©ì–´ ì •ì˜

### RAG (Retrieval-Augmented Generation)

RAGëŠ” 'ê²€ìƒ‰ ì¦ê°• ìƒì„±'ì´ë¼ëŠ” AI ê¸°ìˆ ì…ë‹ˆë‹¤.
ë§ˆì¹˜ ì‹œí—˜ì„ ë³¼ ë•Œ êµê³¼ì„œë¥¼ ì°¸ê³ í•˜ë“¯ì´, AIê°€ ë‹µë³€ì„ ë§Œë“¤ ë•Œ
ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê´€ë ¨ ì •ë³´ë¥¼ ë¨¼ì € ì°¾ì•„ë³¸ í›„ ë‹µë³€í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

íŠ¹ì§•:
- ìµœì‹  ì •ë³´ ë°˜ì˜ ê°€ëŠ¥
- ì •í™•ë„ í–¥ìƒ
- í™˜ê°(Hallucination) ê°ì†Œ

## 2. ê´€ë ¨ ë…¼ë¬¸ ìš”ì•½

### ë…¼ë¬¸ 1: Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks

**ì£¼ìš” ë‚´ìš©**
ì´ ë…¼ë¬¸ì€ RAG ê¸°ë²•ì„ ìµœì´ˆë¡œ ì œì•ˆí•œ ì—°êµ¬ì…ë‹ˆë‹¤.

**í•µì‹¬ ì•„ì´ë””ì–´**
- ê¸°ì¡´ LLMì˜ í•œê³„: í•™ìŠµ ë°ì´í„°ì—ë§Œ ì˜ì¡´, ìµœì‹  ì •ë³´ ë¶€ì¡±
- RAGì˜ í•´ê²°ì±…: ê²€ìƒ‰ + ìƒì„± ê²°í•©
  1. ì§ˆë¬¸ì´ ë“¤ì–´ì˜¤ë©´ ë¨¼ì € ìœ„í‚¤í”¼ë””ì•„ì—ì„œ ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰
  2. ê²€ìƒ‰ëœ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì—¬ LLMì´ ë‹µë³€ ìƒì„±

**ì‹¤í—˜ ê²°ê³¼**
- ê¸°ì¡´ GPT-3 ëŒ€ë¹„ ì •í™•ë„ 10-15% í–¥ìƒ
- íŠ¹íˆ ìµœì‹  ì •ë³´ê°€ í•„ìš”í•œ ì§ˆë¬¸ì—ì„œ í° íš¨ê³¼

**í™œìš© ë¶„ì•¼**
- ì§ˆì˜ì‘ë‹µ ì‹œìŠ¤í…œ
- ì‚¬ì‹¤ í™•ì¸ (Fact Verification)
- ì§€ì‹ ì§‘ì•½ì  NLP ì‘ì—…

### ë…¼ë¬¸ 2: REALM: Retrieval-Augmented Language Model Pre-Training

**ì£¼ìš” ë‚´ìš©**
ì´ ë…¼ë¬¸ì€ RAGë¥¼ ì‚¬ì „ í•™ìŠµ ë‹¨ê³„ì— ì ìš©í•œ ì—°êµ¬ì…ë‹ˆë‹¤.

**í•µì‹¬ ì•„ì´ë””ì–´**
- ê¸°ì¡´ BERTëŠ” ì‚¬ì „ í•™ìŠµ ì‹œ ê²€ìƒ‰ ì—†ì´ í…ìŠ¤íŠ¸ë§Œ í•™ìŠµ
- REALMì€ ì‚¬ì „ í•™ìŠµ ì‹œë¶€í„° ê²€ìƒ‰ + ìƒì„± ê²°í•©
- í•™ìŠµ ì¤‘ì—ë„ ê´€ë ¨ ë¬¸ì„œë¥¼ ê²€ìƒ‰í•˜ì—¬ ì°¸ê³ 

**ì¥ì **
- ë” ì ì€ íŒŒë¼ë¯¸í„°ë¡œ ë” ë†’ì€ ì„±ëŠ¥
- ì§€ì‹ ì—…ë°ì´íŠ¸ ìš©ì´ (ì¬í•™ìŠµ ë¶ˆí•„ìš”)

**í™œìš©**
- Google ê²€ìƒ‰ ì—”ì§„ì— ì ìš©ë¨

---
ìƒì„± ì‹œê°„: 2025-11-07 14:30:45
ë‚œì´ë„: easy
ì„¸ì…˜ ID: session_123456
ëª¨ë¸: Solar-pro2 (í•œêµ­ì–´ íŠ¹í™”)
```

**ìµœì¢… ì¶œë ¥:**
```
âœ… ì €ì¥ ì™„ë£Œ: outputs/easy_answer_20251107_143025.md
âœ… ì €ì¥ ì™„ë£Œ: outputs/hard_answer_20251107_143025.md
âœ… ì €ì¥ ì™„ë£Œ: outputs/auto_answer_20251107_143025.md
âœ… ì €ì¥ ì™„ë£Œ: outputs/easy_answer_20251107_143025_raw.json

ğŸ“Š ì‹¤í–‰ ìš”ì•½:
- 1ë‹¨ê³„: glossary âœ… (0.5ì´ˆ)
- 2ë‹¨ê³„: search_paper âœ… (2.3ì´ˆ)
- 3ë‹¨ê³„: summarize âœ… (4.8ì´ˆ)
- 4ë‹¨ê³„: save_file âœ… (0.2ì´ˆ)
- ì´ ì‹¤í–‰ ì‹œê°„: 7.8ì´ˆ
- ê²½ë¡œ: A â†’ C â†’ F â†’ H (ìµœì„ ì˜ ê²½ë¡œ)
```

---

### ì‹œë‚˜ë¦¬ì˜¤ B: RAG ê²€ìƒ‰ ì‹¤íŒ¨, Web ì„±ê³µ (ì¤‘ê°„ ê²½ë¡œ)

**ì‚¬ìš©ì ì…ë ¥:**
```
"Graph Neural Networkê°€ ë­”ì§€ ì„¤ëª…í•˜ê³  ê´€ë ¨ ë…¼ë¬¸ë„ ìš”ì•½í•´ì„œ ì €ì¥í•´ì¤˜"
```

#### 1ë‹¨ê³„: glossary (ì„±ê³µ)

**ê²°ê³¼:**
```
ìš©ì–´: GNN (Graph Neural Network)

ì •ì˜ (Easy):
GNNì€ ê·¸ë˜í”„ êµ¬ì¡° ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì‹ ê²½ë§ì…ë‹ˆë‹¤.
ì†Œì…œ ë„¤íŠ¸ì›Œí¬, ë¶„ì êµ¬ì¡°, ì§€ì‹ ê·¸ë˜í”„ ë“±ì— ì‚¬ìš©ë©ë‹ˆë‹¤.

ì¶œì²˜: ìš©ì–´ì§‘ DB
```

**ìƒíƒœ:** âœ… success

---

#### 2ë‹¨ê³„: search_paper (ì‹¤íŒ¨)

**ì‹¤í–‰:**
```python
papers = search_paper(question="Graph Neural Network ê´€ë ¨ ë…¼ë¬¸", top_k=5)
```

**ê²°ê³¼:**
```
âŒ ê²€ìƒ‰ ì‹¤íŒ¨: ë…¼ë¬¸ DBì— "Graph Neural Network" ê´€ë ¨ ë…¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.
(score: 0.62 < threshold: 0.7)
```

**ìƒíƒœ:** âŒ failed
**ë‹¤ìŒ ë‹¨ê³„:** 2-F1 Fallback (web_search)

---

#### 2-F1 Fallback: web_search (ì„±ê³µ)

**ì‹¤í–‰:**
```python
papers = web_search(query="Graph Neural Network", num_results=5)
```

**ê²°ê³¼:**
```json
[
  {
    "title": "Semi-Supervised Classification with Graph Convolutional Networks",
    "authors": ["Thomas N. Kipf", "Max Welling"],
    "abstract": "We present a scalable approach for semi-supervised learning on graph-structured data...",
    "url": "https://arxiv.org/abs/1609.02907",
    "published": "2016-09-09"
  }
]
```

**ìƒíƒœ:** âœ… success
**ë‹¤ìŒ ë‹¨ê³„:** 3ë‹¨ê³„ (summarize)

---

#### 3ë‹¨ê³„: summarize (ì„±ê³µ)

**ê²°ê³¼:**
```
ë…¼ë¬¸ ìš”ì•½ ìƒì„± ì™„ë£Œ (ì›¹ ê²€ìƒ‰ ê²°ê³¼ ê¸°ë°˜)
```

**ìƒíƒœ:** âœ… success

---

#### 4ë‹¨ê³„: save_file (ì„±ê³µ)

**ìµœì¢… ì¶œë ¥:**
```
âœ… ì €ì¥ ì™„ë£Œ: outputs/easy_answer_20251107_144123.md

ğŸ“Š ì‹¤í–‰ ìš”ì•½:
- 1ë‹¨ê³„: glossary âœ… (0.5ì´ˆ)
- 2ë‹¨ê³„: search_paper âŒ â†’ web_search âœ… (5.2ì´ˆ)
- 3ë‹¨ê³„: summarize âœ… (4.5ì´ˆ)
- 4ë‹¨ê³„: save_file âœ… (0.2ì´ˆ)
- ì´ ì‹¤í–‰ ì‹œê°„: 10.4ì´ˆ
- ê²½ë¡œ: A â†’ D â†’ F â†’ H (ì¤‘ê°„ ê²½ë¡œ)
```

---

### ì‹œë‚˜ë¦¬ì˜¤ C: ëª¨ë“  ê²€ìƒ‰ ì‹¤íŒ¨, ì¼ë°˜ ë‹µë³€ìœ¼ë¡œ ì²˜ë¦¬ (ìµœì•…ì˜ ê²½ë¡œ)

**ì‚¬ìš©ì ì…ë ¥:**
```
"ìµœì‹  AI ê¸°ìˆ ì¸ XYZê°€ ë­”ì§€ ì„¤ëª…í•˜ê³  ê´€ë ¨ ë…¼ë¬¸ë„ ìš”ì•½í•´ì„œ ì €ì¥í•´ì¤˜"
```

#### 1ë‹¨ê³„: glossary (ì‹¤íŒ¨) â†’ general (ì„±ê³µ)

**glossary ê²°ê³¼:**
```
âŒ ê²€ìƒ‰ ì‹¤íŒ¨: ìš©ì–´ì§‘ DBì— "XYZ" ìš©ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.
```

**general ê²°ê³¼:**
```
ì£„ì†¡í•©ë‹ˆë‹¤. "XYZ"ëŠ” ì œê°€ ì•Œì§€ ëª»í•˜ëŠ” ìš©ì–´ì…ë‹ˆë‹¤.
ì¼ë°˜ì ì¸ ìµœì‹  AI ê¸°ìˆ ì— ëŒ€í•´ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

(LLMì´ ìƒì„±í•œ ì¼ë°˜ì ì¸ AI ê¸°ìˆ  ì„¤ëª…)
```

**ìƒíƒœ:** âœ… success (Fallback)

---

#### 2ë‹¨ê³„: search_paper (ì‹¤íŒ¨) â†’ web_search (ì‹¤íŒ¨) â†’ general (ì„±ê³µ)

**search_paper ê²°ê³¼:**
```
âŒ ê²€ìƒ‰ ì‹¤íŒ¨: ë…¼ë¬¸ DBì— "XYZ" ê´€ë ¨ ë…¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.
```

**web_search ê²°ê³¼:**
```
âŒ ê²€ìƒ‰ ì‹¤íŒ¨: arXivì—ì„œ "XYZ" ê´€ë ¨ ë…¼ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
```

**general ê²°ê³¼:**
```
ìµœì‹  AI ê¸°ìˆ ì— ëŒ€í•œ ì¼ë°˜ì ì¸ ë…¼ë¬¸ë“¤ì„ ì†Œê°œí•˜ê² ìŠµë‹ˆë‹¤.

1. Attention Is All You Need (Transformer)
2. BERT: Pre-training of Deep Bidirectional Transformers
3. GPT-3: Language Models are Few-Shot Learners

(LLMì´ ìƒì„±í•œ ë…¼ë¬¸ ì •ë³´)
```

**ìƒíƒœ:** âœ… success (Fallback)

---

#### 3ë‹¨ê³„: summarize (ì‹¤íŒ¨) â†’ general (ì„±ê³µ)

**summarize ê²°ê³¼:**
```
âŒ ìš”ì•½ ì‹¤íŒ¨: ì…ë ¥ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.
(general ë„êµ¬ì—ì„œ ìƒì„±í•œ ë°ì´í„°ê°€ JSON í˜•ì‹ì´ ì•„ë‹˜)
```

**general ê²°ê³¼:**
```
ìœ„ì—ì„œ ì–¸ê¸‰í•œ ë…¼ë¬¸ë“¤ì˜ ìš”ì•½ì…ë‹ˆë‹¤:

1. Transformer: Attention ë©”ì»¤ë‹ˆì¦˜ì„ ì‚¬ìš©í•œ í˜ì‹ ì ì¸ ëª¨ë¸...
2. BERT: ì–‘ë°©í–¥ ì‚¬ì „ í•™ìŠµì„ í†µí•´ ì–¸ì–´ ì´í•´ í–¥ìƒ...
3. GPT-3: ëŒ€ê·œëª¨ íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•œ Few-Shot Learning...

(LLMì´ ìƒì„±í•œ ìš”ì•½)
```

**ìƒíƒœ:** âœ… success (Fallback)

---

#### 4ë‹¨ê³„: save_file (ì„±ê³µ)

**ìµœì¢… ì¶œë ¥:**
```
âœ… ì €ì¥ ì™„ë£Œ: outputs/easy_answer_20251107_145456.md

ğŸ“Š ì‹¤í–‰ ìš”ì•½:
- 1ë‹¨ê³„: glossary âŒ â†’ general âœ… (3.2ì´ˆ)
- 2ë‹¨ê³„: search_paper âŒ â†’ web_search âŒ â†’ general âœ… (12.5ì´ˆ)
- 3ë‹¨ê³„: summarize âŒ â†’ general âœ… (5.8ì´ˆ)
- 4ë‹¨ê³„: save_file âœ… (0.2ì´ˆ)
- ì´ ì‹¤í–‰ ì‹œê°„: 21.7ì´ˆ
- ê²½ë¡œ: B â†’ E â†’ G â†’ H (ìµœì•…ì˜ ê²½ë¡œ)
- í’ˆì§ˆ: ì¤‘í•˜ (ëª¨ë“  ë‹¨ê³„ì—ì„œ LLM ì§€ì‹ ê¸°ë°˜ ë‹µë³€)
```

---

## ğŸ¯ í•µì‹¬ í¬ì¸íŠ¸

### 1. 4ë‹¨ê³„ Fallback ì²´ì¸ (ê°€ì¥ ë³µì¡í•œ ì›Œí¬í”Œë¡œìš°)

ì´ ì‹œìŠ¤í…œì€ **3ê°œì˜ ë…ë¦½ì ì¸ Fallback ì²´ì¸**ì„ ê°€ì§„ ê°€ì¥ ë³µì¡í•œ ì•„í‚¤í…ì²˜ì…ë‹ˆë‹¤:

**1ë‹¨ê³„ Fallback ì²´ì¸ (1ê°œ):**
```
glossary â†’ general
```
- ìš©ì–´ì§‘ DB ì‹¤íŒ¨ ì‹œ LLM ì§€ì‹ ê¸°ë°˜ ì„¤ëª…

**2ë‹¨ê³„ Fallback ì²´ì¸ (2ê°œ):**
```
search_paper â†’ web_search â†’ general
```
- ë…¼ë¬¸ DB ì‹¤íŒ¨ ì‹œ ì›¹ ê²€ìƒ‰
- ì›¹ ê²€ìƒ‰ë„ ì‹¤íŒ¨ ì‹œ LLM ì§€ì‹ ê¸°ë°˜ ì„¤ëª…

**3ë‹¨ê³„ Fallback ì²´ì¸ (1ê°œ):**
```
summarize â†’ general
```
- ìš”ì•½ ìƒì„± ì‹¤íŒ¨ ì‹œ LLMì´ ì§ì ‘ ìš”ì•½

**4ë‹¨ê³„ Fallback:**
```
save_file (Fallback ì—†ìŒ)
```
- íŒŒì¼ ì €ì¥ ì‹¤íŒ¨ ì‹œ ê·¸ëŒ€ë¡œ ì˜¤ë¥˜ ë°˜í™˜

### 2. ë³µì¡í•œ ë°ì´í„° íŒŒì´í”„ë¼ì¸

**3ê°€ì§€ ë°ì´í„° íë¦„:**

1. **1ë‹¨ê³„ â†’ ì„¸ì…˜ â†’ 4ë‹¨ê³„**
   ```
   glossary/general (ìš©ì–´ ì •ì˜)
       â†“ [ì„¸ì…˜ ì €ì¥: term_definition]
       â†“
   save_file (íŒŒì¼ ì €ì¥ ì‹œ ê°€ì ¸ì˜¤ê¸°)
   ```

2. **2ë‹¨ê³„ â†’ 3ë‹¨ê³„ (ì§ì ‘ ì „ë‹¬)**
   ```
   search_paper/web_search/general (ë…¼ë¬¸ ê²€ìƒ‰)
       â†“ [ì§ì ‘ ì „ë‹¬: papers]
       â†“
   summarize/general (ë…¼ë¬¸ ìš”ì•½)
   ```

3. **3ë‹¨ê³„ â†’ ì„¸ì…˜ â†’ 4ë‹¨ê³„**
   ```
   summarize/general (ë…¼ë¬¸ ìš”ì•½)
       â†“ [ì„¸ì…˜ ì €ì¥: paper_summary]
       â†“
   save_file (íŒŒì¼ ì €ì¥ ì‹œ ê°€ì ¸ì˜¤ê¸°)
   ```

### 3. í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ì˜ ì¤‘ìš”ì„±

**glossary (ìš©ì–´ì§‘):**
- ë²¡í„° ê²€ìƒ‰: 50% (ì˜ë¯¸ì  ìœ ì‚¬ë„)
- í‚¤ì›Œë“œ ê²€ìƒ‰: 50% (ì •í™•í•œ ë§¤ì¹­)
- ìš©ì–´ ê²€ìƒ‰ì€ ì •í™•í•œ ë§¤ì¹­ì´ ì¤‘ìš”í•˜ë¯€ë¡œ ê°€ì¤‘ì¹˜ ë™ì¼

**search_paper (ë…¼ë¬¸ ê²€ìƒ‰):**
- ë²¡í„° ê²€ìƒ‰: 70% (ì˜ë¯¸ì  ìœ ì‚¬ë„)
- í‚¤ì›Œë“œ ê²€ìƒ‰: 30% (ì •í™•í•œ ë§¤ì¹­)
- ë…¼ë¬¸ ê²€ìƒ‰ì€ ì˜ë¯¸ì  ìœ ì‚¬ë„ê°€ ë” ì¤‘ìš”

### 4. ë‚œì´ë„ë³„ ëª¨ë¸ ì„ íƒ ì „ëµ

**Easy ëª¨ë“œ (Solar-pro2):**
- í•œêµ­ì–´ íŠ¹í™”
- ë¹„ìš© íš¨ìœ¨ì 
- ì¼ë°˜ ì‚¬ìš©ì ëŒ€ìƒ

**Hard ëª¨ë“œ (GPT-5):**
- ê¸°ìˆ ì  ì •í™•ë„
- ì „ë¬¸ì ì¸ ì„¤ëª…
- ê°œë°œì/ì—°êµ¬ì ëŒ€ìƒ

**Auto ëª¨ë“œ:**
- ì§ˆë¬¸ ì–¸ì–´ ìë™ ê°ì§€
- í•œêµ­ì–´ â†’ Solar-pro2
- ì˜ì–´ â†’ GPT-5

### 5. 4ê°œ íŒŒì¼ ì €ì¥ ì‹œìŠ¤í…œ

**íŒŒì¼ êµ¬ì„±:**
1. `easy_answer_YYYYMMDD_HHMMSS.md` (ì‰¬ìš´ ì„¤ëª…)
2. `hard_answer_YYYYMMDD_HHMMSS.md` (ì „ë¬¸ì  ì„¤ëª…)
3. `auto_answer_YYYYMMDD_HHMMSS.md` (ìë™ ì„ íƒ)
4. `easy_answer_YYYYMMDD_HHMMSS_raw.json` (ì›ë³¸ ë°ì´í„°)

**ì €ì¥ ìš°ì„ ìˆœìœ„:**
1. `final_answers` (ìµœì¢… ë‹µë³€) - ìš°ì„ 
2. `tool_result` (ë„êµ¬ ì‹¤í–‰ ê²°ê³¼) - ëŒ€ì²´

### 6. Skip ë¡œì§ (ë„êµ¬ ì‹¤í–‰ ìµœì í™”)

**search_paper ì„±ê³µ ì‹œ:**
```python
if search_paper_status == "success":
    skip_web_search = True  # web_search ìŠ¤í‚µ
```

**web_search ì„±ê³µ ì‹œ:**
```python
if web_search_status == "success":
    skip_general_2 = True  # 2-F2 general ìŠ¤í‚µ
```

**summarize ì„±ê³µ ì‹œ:**
```python
if summarize_status == "success":
    skip_general_3 = True  # 3-F general ìŠ¤í‚µ
```

### 7. Pipeline Modeì˜ ì¥ì 

**ìë™ ë°ì´í„° ì „ë‹¬:**
- 2ë‹¨ê³„ â†’ 3ë‹¨ê³„: papers ìë™ ì „ë‹¬
- ê°œë°œìê°€ ìˆ˜ë™ìœ¼ë¡œ ë°ì´í„° ì „ë‹¬í•  í•„ìš” ì—†ìŒ

**ì¤‘ê°„ ê²°ê³¼ ì„¸ì…˜ ì €ì¥:**
- 1ë‹¨ê³„ ê²°ê³¼: ì„¸ì…˜ ì €ì¥ (4ë‹¨ê³„ì—ì„œ ì‚¬ìš©)
- 3ë‹¨ê³„ ê²°ê³¼: ì„¸ì…˜ ì €ì¥ (4ë‹¨ê³„ì—ì„œ ì‚¬ìš©)

**ì˜¤ë¥˜ ì²˜ë¦¬ ìë™í™”:**
- ê° ë‹¨ê³„ ì‹¤íŒ¨ ì‹œ ìë™ Fallback
- ì‚¬ìš©ìëŠ” í•­ìƒ ê²°ê³¼ë¥¼ ë°›ìŒ

### 8. ì´ ì‹¤í–‰ ê²½ë¡œ (12ê°€ì§€)

**ìµœì„ ì˜ ê²½ë¡œ (A â†’ C â†’ F â†’ H):**
- ì‹¤í–‰ ì‹œê°„: 7-8ì´ˆ
- í’ˆì§ˆ: ìµœìƒ

**ìµœì•…ì˜ ê²½ë¡œ (B â†’ E â†’ G â†’ H):**
- ì‹¤í–‰ ì‹œê°„: 20-25ì´ˆ
- í’ˆì§ˆ: ì¤‘í•˜

**ì¤‘ê°„ ê²½ë¡œ (10ê°€ì§€):**
- ì‹¤í–‰ ì‹œê°„: 9-18ì´ˆ
- í’ˆì§ˆ: ìƒ~ì¤‘

---

## ğŸ“… ë¬¸ì„œ ë²„ì „

- **ë²„ì „**: 1.0
- **ì‘ì„±ì¼**: 2025-11-07
