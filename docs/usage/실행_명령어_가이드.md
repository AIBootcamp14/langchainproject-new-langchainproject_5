# 실행 명령어 가이드

## 문서 정보
- **작성일**: 2025-11-04
- **작성자**: 최현화[팀장]
- **최종 수정일**: 2025-11-04
- **프로젝트명**: 논문 리뷰 챗봇 (AI Agent + RAG)
- **팀명**: 연결의 민족
- **목적**: 프로젝트의 모든 실행 명령어를 정리한 종합 가이드

---

## 목차
1. [개요](#1-개요)
2. [필수 사전 작업](#2-필수-사전-작업)
3. [메인 진입점 실행](#3-메인-진입점-실행)
4. [Streamlit UI 실행](#4-streamlit-ui-실행)
5. [데이터 파이프라인 실행](#5-데이터-파이프라인-실행)
6. [성능 평가 시스템](#6-성능-평가-시스템)
7. [테스트 실행](#7-테스트-실행)
8. [시스템 관리 스크립트](#8-시스템-관리-스크립트)
9. [디버깅 스크립트](#9-디버깅-스크립트)
10. [트러블슈팅](#10-트러블슈팅)

---

## 1. 개요

### 1.1 프로젝트 구조

```
langchain-project/
├── main.py                     # CLI 진입점
├── ui/app.py                   # Streamlit UI 진입점
├── scripts/                    # 각종 스크립트
│   ├── data/                   # 데이터 처리
│   ├── system/                 # 시스템 관리
│   ├── tests/                  # 테스트
│   ├── debug/                  # 디버깅
│   └── evaluate_answers.py     # 성능 평가
└── src/                        # 소스 코드
```

### 1.2 명령어 실행 환경

모든 명령어는 **프로젝트 루트 디렉토리**에서 실행해야 합니다.

```bash
# 프로젝트 루트로 이동
cd /home/<username>/AI_Lab/langchain-project

# 또는
cd ~/AI_Lab/langchain-project
```

---

## 2. 필수 사전 작업

### 2.1 Python 3.11.9 확인

```bash
# Python 버전 확인
python --version

# 출력 예시: Python 3.11.9
```

**주의**: Python 3.11.9가 아닌 경우, pyenv를 사용하여 버전을 설정하세요.

```bash
# pyenv로 Python 3.11.9 설정
pyenv local 3.11.9

# 또는 가상 환경 활성화
pyenv activate langchain_py3_11_9
```

### 2.2 가상 환경 활성화

**방법 1: venv 사용**
```bash
# 가상 환경 활성화
source venv/bin/activate        # Linux/macOS
# venv\Scripts\activate         # Windows
```

**방법 2: pyenv-virtualenv 사용 (권장)**
```bash
# 가상 환경 활성화
pyenv activate langchain_py3_11_9

# 가상 환경 확인
which python
# 출력: /home/<username>/.pyenv/versions/langchain_py3_11_9/bin/python
```

### 2.3 의존성 설치

```bash
# pip 업그레이드
pip install --upgrade pip

# 필수 패키지 설치
pip install -r requirements.txt
```

### 2.4 환경 변수 설정

```bash
# .env 파일 존재 확인
ls -la .env

# .env 파일이 없으면 .env.example 복사
cp .env.example .env

# .env 파일 편집 (API 키 입력)
vi .env
```

**필수 환경 변수:**
```bash
# OpenAI API
OPENAI_API_KEY=sk-your-openai-api-key-here

# Solar API
SOLAR_API_KEY=up-your-solar-api-key-here

# PostgreSQL
POSTGRES_USER=langchain
POSTGRES_PASSWORD=your_password
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=papers

# Tavily Search
TAVILY_API_KEY=tvly-your-tavily-api-key-here
```

### 2.5 PostgreSQL 실행 확인

```bash
# PostgreSQL 상태 확인
sudo systemctl status postgresql

# PostgreSQL 시작 (중지된 경우)
sudo systemctl start postgresql

# 데이터베이스 연결 테스트
psql -U langchain -d papers -h localhost -c "SELECT version();"
```

---

## 3. 메인 진입점 실행

### 3.1 main.py 실행 (CLI)

**파일**: `main.py`

**설명**: AI Agent를 CLI 모드로 실행합니다.

**실행 명령어:**
```bash
python main.py
```

**체크리스트:**
- [x] Python 3.11.9 활성화
- [x] 가상 환경 활성화 (`pyenv activate langchain_py3_11_9`)
- [x] requirements.txt 설치
- [x] .env 파일 설정
- [x] PostgreSQL 실행 확인

**출력 예시:**
```
==========================================================
AI Agent 초기화 완료
==========================================================
사용자 질문을 입력하세요 (종료: exit):
```

**주요 기능:**
- AI Agent 실행
- 사용자 질문 입력
- 도구 자동 선택 (Router)
- 답변 생성 및 출력
- 실험 로그 기록 (`logs/experiments/YYYYMMDD_HHMMSS/`)

---

## 4. Streamlit UI 실행

### 4.1 ui/app.py 실행

**파일**: `ui/app.py`

**설명**: Streamlit 웹 UI를 실행합니다.

**실행 명령어:**
```bash
streamlit run ui/app.py
```

**체크리스트:**
- [x] Python 3.11.9 활성화
- [x] 가상 환경 활성화
- [x] requirements.txt 설치 (특히 `streamlit==1.28.2`)
- [x] .env 파일 설정
- [x] PostgreSQL 실행 확인

**출력 예시:**
```
  You can now view your Streamlit app in your browser.

  Local URL: http://localhost:8501
  Network URL: http://192.168.0.100:8501
```

**브라우저 자동 열림**: http://localhost:8501

**주요 기능:**
- 채팅 인터페이스
- 난이도 모드 선택 (Easy/Hard)
- 대화 히스토리 관리
- 파일 다운로드 (논문 PDF)
- 용어집 페이지 (http://localhost:8501/Glossary)

**포트 변경 (선택사항):**
```bash
# 8502 포트로 실행
streamlit run ui/app.py --server.port 8502
```

**백그라운드 실행:**
```bash
# nohup으로 백그라운드 실행
nohup streamlit run ui/app.py > streamlit.log 2>&1 &

# 프로세스 확인
ps aux | grep streamlit

# 종료
pkill -f "streamlit run ui/app.py"
```

---

## 5. 데이터 파이프라인 실행

### 5.1 전체 파이프라인 실행 순서

데이터베이스 초기 설정부터 VectorDB 구축까지 전체 파이프라인을 실행하는 순서입니다.

| 순서 | 스크립트 | 실행 명령어 | 설명 |
|-----|---------|------------|------|
| **1** | setup_database.py | `python scripts/data/setup_database.py` | PostgreSQL 데이터베이스 및 테이블 생성 |
| **2** | collect_arxiv_papers.py | `python scripts/data/collect_arxiv_papers.py` | arXiv 논문 메타데이터 수집 |
| **3** | process_documents.py | `python scripts/data/process_documents.py` | 논문 PDF 다운로드 및 청킹 |
| **4** | load_embeddings.py | `python scripts/data/load_embeddings.py` | 임베딩 생성 및 VectorDB 로드 |

### 5.2 setup_database.py

**파일**: `scripts/data/setup_database.py`

**설명**: PostgreSQL 데이터베이스와 테이블을 생성합니다.

**실행 명령어:**
```bash
python scripts/data/setup_database.py
```

**생성되는 테이블:**
- `papers`: 논문 메타데이터
- `glossary`: 용어집
- `query_logs`: 사용자 질의 로그
- `evaluation_results`: 성능 평가 결과

**출력 예시:**
```
데이터베이스 초기화 시작
papers 테이블 생성 완료
glossary 테이블 생성 완료
query_logs 테이블 생성 완료
evaluation_results 테이블 생성 완료
```

### 5.3 collect_arxiv_papers.py

**파일**: `scripts/data/collect_arxiv_papers.py`

**설명**: arXiv API를 통해 논문 메타데이터를 수집하고 PostgreSQL에 저장합니다.

**실행 명령어:**
```bash
python scripts/data/collect_arxiv_papers.py
```

**수집 카테고리:**
- `cs.AI`: Artificial Intelligence
- `cs.CL`: Computation and Language
- `cs.CV`: Computer Vision
- `cs.LG`: Machine Learning

**출력 예시:**
```
arXiv 논문 수집 시작
카테고리: cs.AI
수집 논문 수: 100
PostgreSQL에 저장 완료
```

### 5.4 process_documents.py

**파일**: `scripts/data/process_documents.py`

**설명**: 논문 PDF를 다운로드하고 텍스트를 청킹합니다.

**실행 명령어:**
```bash
python scripts/data/process_documents.py
```

**처리 과정:**
1. PDF 다운로드 (arXiv URL)
2. PDF 텍스트 추출 (pypdf)
3. 텍스트 청킹 (RecursiveCharacterTextSplitter, chunk_size=1000)
4. PostgreSQL에 저장

**출력 예시:**
```
문서 처리 시작
PDF 다운로드: 10/100
텍스트 청킹: 10/100
PostgreSQL에 저장 완료
```

### 5.5 load_embeddings.py

**파일**: `scripts/data/load_embeddings.py`

**설명**: 청킹된 텍스트의 임베딩을 생성하고 VectorDB에 로드합니다.

**실행 명령어:**
```bash
python scripts/data/load_embeddings.py
```

**임베딩 모델**: `text-embedding-3-small` (OpenAI)

**출력 예시:**
```
임베딩 생성 시작
임베딩 생성: 1000/5000
PGVector에 저장 완료
```

### 5.6 update_glossary_explanations.py

**파일**: `scripts/data/update_glossary_explanations.py`

**설명**: 용어집의 Easy/Hard 설명을 GPT-4로 자동 생성합니다.

**실행 명령어:**
```bash
python scripts/data/update_glossary_explanations.py
```

**출력 예시:**
```
용어집 업데이트 시작
업데이트 완료: Transformer
업데이트 완료: BERT
총 100개 용어 업데이트 완료
```

### 5.7 run_full_pipeline.py

**파일**: `scripts/data/run_full_pipeline.py`

**설명**: 전체 데이터 파이프라인을 순서대로 자동 실행합니다.

**실행 명령어:**
```bash
python scripts/data/run_full_pipeline.py
```

**실행 순서:**
1. setup_database.py
2. collect_arxiv_papers.py
3. process_documents.py
4. load_embeddings.py

**출력 예시:**
```
==========================================================
전체 데이터 파이프라인 실행
==========================================================
[1/4] 데이터베이스 초기화 중...
[2/4] arXiv 논문 수집 중...
[3/4] 문서 처리 중...
[4/4] 임베딩 생성 및 로드 중...
==========================================================
전체 파이프라인 완료
==========================================================
```

### 5.8 inspect_vector_db.py

**파일**: `scripts/data/inspect_vector_db.py`

**설명**: VectorDB 상태를 확인합니다.

**실행 명령어:**
```bash
python scripts/data/inspect_vector_db.py
```

**출력 예시:**
```
VectorDB 검사 시작
총 청크 수: 5000
평균 임베딩 차원: 1536
샘플 벡터 검색 테스트:
  쿼리: "Transformer architecture"
  상위 5개 결과:
    1. Attention Is All You Need (유사도: 0.92)
    2. BERT: Pre-training... (유사도: 0.88)
    ...
```

---

## 6. 성능 평가 시스템

### 6.1 evaluate_answers.py

**파일**: `scripts/evaluate_answers.py`

**설명**: LLM-as-a-Judge 방식으로 챗봇 답변의 품질을 평가합니다.

**실행 명령어:**
```bash
python scripts/evaluate_answers.py
```

**평가 기준:**
- 정확도 (Accuracy): 0-10점
- 관련성 (Relevance): 0-10점
- 난이도 적합성 (Difficulty): 0-10점
- 출처 명시 (Citation): 0-10점
- **총점**: 0-40점

**출력 예시:**
```
==========================================================
답변 평가 스크립트 실행
==========================================================
테스트 케이스 2개 평가 시작
[1/2] 평가 중...
[2/2] 평가 중...
평가 결과 PostgreSQL에 저장
평가 통계: {
  "total_count": 2,
  "avg_accuracy": 8.5,
  "avg_relevance": 9.0,
  "avg_difficulty": 8.0,
  "avg_citation": 7.5,
  "avg_total": 33.0
}
==========================================================
평가 완료
==========================================================
[테스트 1]
질문: Transformer 논문 설명해줘
총점: 35/40
- 정확도: 9/10
- 관련성: 10/10
- 난이도 적합성: 8/10
- 출처 명시: 8/10
코멘트: 논문의 핵심 내용을 정확히 설명했으며...
```

**평가 결과 조회:**
```bash
# PostgreSQL에서 평가 결과 조회
psql -U langchain -d papers -h localhost -c "SELECT * FROM evaluation_results ORDER BY created_at DESC LIMIT 5;"
```

---

## 7. 테스트 실행

### 7.1 단위 테스트 (Unit Tests)

**디렉토리**: `scripts/tests/unit/`

#### 7.1.1 전체 단위 테스트 실행

```bash
# pytest로 전체 단위 테스트 실행
pytest scripts/tests/unit/ -v

# 또는
python -m pytest scripts/tests/unit/ -v
```

#### 7.1.2 개별 단위 테스트 실행

| 테스트 | 실행 명령어 | 설명 |
|--------|------------|------|
| **DB 연결** | `python scripts/tests/unit/test_db_connection.py` | PostgreSQL 연결 테스트 |
| **실험 관리** | `python scripts/tests/unit/test_experiment_manager.py` | ExperimentManager 테스트 |
| **CRUD 연산** | `python scripts/tests/unit/test_crud_operations.py` | 논문 CRUD 테스트 |
| **VectorDB** | `python scripts/tests/unit/test_vector_store.py` | PGVector 테스트 |
| **RAG** | `python scripts/tests/unit/test_rag.py` | RAG 검색 테스트 |
| **DB 초기화** | `python scripts/tests/unit/init_database.py` | 데이터베이스 초기화 |

**예시: DB 연결 테스트**
```bash
python scripts/tests/unit/test_db_connection.py
```

**출력 예시:**
```
==========================================================
PostgreSQL 연결 테스트
==========================================================
✓ PostgreSQL 버전: 15.3
✓ papers 테이블 레코드 수: 100
✓ Connection Pool 정상 작동
==========================================================
테스트 완료
==========================================================
```

#### 7.1.3 도구 테스트 (Tools)

**디렉토리**: `scripts/tests/unit/tools/`

| 테스트 | 실행 명령어 | 설명 |
|--------|------------|------|
| **arXiv 도구** | `python scripts/tests/unit/tools/test_arxiv_handler.py` | arXiv 논문 다운로드 테스트 |
| **요약 도구** | `python scripts/tests/unit/tools/test_summarize.py` | 논문 요약 테스트 |

**예시: arXiv 도구 테스트**
```bash
python scripts/tests/unit/tools/test_arxiv_handler.py
```

### 7.2 통합 테스트 (Integration Tests)

**디렉토리**: `scripts/tests/integration/`

#### 7.2.1 전체 통합 테스트 실행

```bash
# pytest로 전체 통합 테스트 실행
pytest scripts/tests/integration/ -v

# 또는
python -m pytest scripts/tests/integration/ -v
```

#### 7.2.2 개별 통합 테스트 실행

| 테스트 | 실행 명령어 | 설명 |
|--------|------------|------|
| **통합 테스트** | `python scripts/tests/integration/test_integration.py` | 전체 시스템 통합 테스트 |
| **데이터 파이프라인** | `python scripts/tests/integration/test_data_pipeline.py` | 데이터 파이프라인 통합 테스트 |

**예시: 데이터 파이프라인 통합 테스트**
```bash
python scripts/tests/integration/test_data_pipeline.py
```

**출력 예시:**
```
==========================================================
데이터 파이프라인 통합 테스트
==========================================================
[1/4] 데이터베이스 초기화 테스트... ✓
[2/4] arXiv 논문 수집 테스트... ✓
[3/4] 문서 처리 테스트... ✓
[4/4] 임베딩 생성 테스트... ✓
==========================================================
모든 테스트 통과
==========================================================
```

### 7.3 pytest 옵션

```bash
# 상세 출력 모드 (-v)
pytest scripts/tests/unit/ -v

# 특정 테스트만 실행 (-k)
pytest scripts/tests/unit/ -k "test_db"

# 커버리지 리포트 (--cov)
pytest scripts/tests/unit/ --cov=src --cov-report=html

# 실패 시 즉시 중단 (-x)
pytest scripts/tests/unit/ -x

# 병렬 실행 (-n auto, pytest-xdist 필요)
pytest scripts/tests/unit/ -n auto
```

---

## 8. 시스템 관리 스크립트

**디렉토리**: `scripts/system/`

### 8.1 find_experiments.py

**파일**: `scripts/system/find_experiments.py`

**설명**: 실험 로그를 검색합니다.

**실행 명령어:**
```bash
python scripts/system/find_experiments.py
```

**출력 예시:**
```
실험 로그 검색 중...
총 10개 실험 발견:
  1. 20251104_143022 (성공)
  2. 20251104_120511 (성공)
  ...
```

**특정 날짜 검색:**
```bash
# 2025-11-04 실험만 검색
python scripts/system/find_experiments.py --date 20251104
```

### 8.2 aggregate_metrics.py

**파일**: `scripts/system/aggregate_metrics.py`

**설명**: 실험 메트릭을 집계합니다.

**실행 명령어:**
```bash
python scripts/system/aggregate_metrics.py
```

**출력 예시:**
```
메트릭 집계 중...
평균 응답 시간: 3.2초
평균 정확도: 8.5/10
총 실험 수: 10
```

---

## 9. 디버깅 스크립트

**디렉토리**: `scripts/debug/`

### 9.1 check_db.py

**파일**: `scripts/debug/check_db.py`

**설명**: PostgreSQL 데이터베이스 상태를 확인합니다.

**실행 명령어:**
```bash
python scripts/debug/check_db.py
```

**출력 예시:**
```
PostgreSQL 상태 확인:
  - papers 테이블: 100개 레코드
  - glossary 테이블: 50개 레코드
  - query_logs 테이블: 200개 레코드
```

### 9.2 check_bert_chunks.py

**파일**: `scripts/debug/check_bert_chunks.py`

**설명**: BERT 논문의 청크 상태를 확인합니다.

**실행 명령어:**
```bash
python scripts/debug/check_bert_chunks.py
```

**출력 예시:**
```
BERT 논문 청크 확인:
  총 청크 수: 50
  평균 청크 길이: 950자
  샘플 청크:
    [1] BERT: Pre-training of Deep Bidirectional Transformers...
```

### 9.3 test_summarize_debug.py

**파일**: `scripts/debug/test_summarize_debug.py`

**설명**: 논문 요약 기능을 디버깅합니다.

**실행 명령어:**
```bash
python scripts/debug/test_summarize_debug.py
```

**출력 예시:**
```
논문 요약 디버깅:
  논문: BERT
  요약 길이: 500자
  요약: BERT는 Bidirectional Encoder Representations...
```

---

## 10. 트러블슈팅

### 10.1 Python 버전 오류

**문제:**
```
python --version
Python 3.8.10
```

**해결:**
```bash
# pyenv로 Python 3.11.9 설정
pyenv local 3.11.9

# 또는 가상 환경 활성화
pyenv activate langchain_py3_11_9

# 확인
python --version
# 출력: Python 3.11.9
```

### 10.2 가상 환경 미활성화

**문제:**
```
which python
/usr/bin/python
```

**해결:**
```bash
# 가상 환경 활성화
pyenv activate langchain_py3_11_9

# 확인
which python
# 출력: /home/<username>/.pyenv/versions/langchain_py3_11_9/bin/python
```

### 10.3 패키지 미설치

**문제:**
```
ModuleNotFoundError: No module named 'langchain'
```

**해결:**
```bash
# requirements.txt 설치
pip install -r requirements.txt

# 특정 패키지 설치
pip install langchain==0.1.0
```

### 10.4 환경 변수 미설정

**문제:**
```
KeyError: 'OPENAI_API_KEY'
```

**해결:**
```bash
# .env 파일 확인
cat .env | grep OPENAI_API_KEY

# .env 파일 편집
vi .env

# OPENAI_API_KEY 추가
OPENAI_API_KEY=sk-your-openai-api-key-here
```

### 10.5 PostgreSQL 미실행

**문제:**
```
psycopg2.OperationalError: could not connect to server
```

**해결:**
```bash
# PostgreSQL 상태 확인
sudo systemctl status postgresql

# PostgreSQL 시작
sudo systemctl start postgresql

# 연결 테스트
psql -U langchain -d papers -h localhost -c "SELECT version();"
```

### 10.6 포트 충돌 (Streamlit)

**문제:**
```
Port 8501 is already in use
```

**해결:**
```bash
# 8502 포트로 실행
streamlit run ui/app.py --server.port 8502

# 또는 기존 프로세스 종료
pkill -f "streamlit run ui/app.py"
```

### 10.7 임베딩 생성 오류

**문제:**
```
openai.error.RateLimitError: Rate limit exceeded
```

**해결:**
```bash
# 스크립트 내에서 rate limit 처리 대기
# 또는 OpenAI API 플랜 업그레이드
```

### 10.8 메모리 부족 오류

**문제:**
```
MemoryError: Unable to allocate array
```

**해결:**
```bash
# 배치 크기 줄이기 (스크립트 내 BATCH_SIZE 변수 수정)
# 예: BATCH_SIZE = 10 → BATCH_SIZE = 5
```

---

## 요약

### 핵심 실행 명령어

| 목적 | 실행 명령어 | 체크리스트 |
|------|------------|----------|
| **CLI 실행** | `python main.py` | Python 3.11.9, venv, .env, PostgreSQL |
| **UI 실행** | `streamlit run ui/app.py` | Python 3.11.9, venv, .env, PostgreSQL |
| **DB 초기화** | `python scripts/data/setup_database.py` | .env, PostgreSQL |
| **논문 수집** | `python scripts/data/collect_arxiv_papers.py` | .env, PostgreSQL, OpenAI API |
| **문서 처리** | `python scripts/data/process_documents.py` | .env, PostgreSQL |
| **임베딩 로드** | `python scripts/data/load_embeddings.py` | .env, PostgreSQL, OpenAI API |
| **전체 파이프라인** | `python scripts/data/run_full_pipeline.py` | .env, PostgreSQL, OpenAI API |
| **성능 평가** | `python scripts/evaluate_answers.py` | .env, PostgreSQL, OpenAI API |
| **단위 테스트** | `pytest scripts/tests/unit/ -v` | Python 3.11.9, venv |
| **통합 테스트** | `pytest scripts/tests/integration/ -v` | .env, PostgreSQL, OpenAI API |

### 필수 체크리스트

프로젝트 실행 전 반드시 확인해야 할 항목:

- [x] **Python 3.11.9** 활성화 (`python --version`)
- [x] **가상 환경** 활성화 (`pyenv activate langchain_py3_11_9`)
- [x] **requirements.txt** 설치 (`pip install -r requirements.txt`)
- [x] **.env 파일** 설정 (API 키, DB 설정)
- [x] **PostgreSQL** 실행 확인 (`sudo systemctl status postgresql`)

### 다음 단계

1. ✅ 환경 설정 완료
2. ✅ 데이터베이스 초기화 (`python scripts/data/setup_database.py`)
3. ⭐ 논문 데이터 수집 (`python scripts/data/collect_arxiv_papers.py`)
4. ⭐ VectorDB 구축 (`python scripts/data/run_full_pipeline.py`)
5. ⭐ Streamlit UI 실행 (`streamlit run ui/app.py`)

---

## 참고 문서

- [docs/modularization/00_프로젝트_구조.md](../modularization/00_프로젝트_구조.md) - 프로젝트 구조
- [docs/modularization/01_개발환경_및_기술스택.md](../modularization/01_개발환경_및_기술스택.md) - 개발 환경 설정
- [docs/usage/데이터베이스_설치_및_설정_가이드.md](./데이터베이스_설치_및_설정_가이드.md) - PostgreSQL 설정
- [docs/modularization/10_성능평가시스템.md](../modularization/10_성능평가시스템.md) - 성능 평가 시스템
- [README.md](../../README.md) - 프로젝트 소개

---

## 작성자

- **최현화[팀장]** (실행 명령어 가이드 문서화)
