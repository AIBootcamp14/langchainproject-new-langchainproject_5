# 03. ì‹¤í—˜ ê´€ë¦¬ ì‹œìŠ¤í…œ (ExperimentManager)

## ğŸ“‹ ë¬¸ì„œ ì •ë³´
- **ìµœì´ˆ ì‘ì„±ì¼**: 2025-11-03
- **ìµœê·¼ ì—…ë°ì´íŠ¸**: 2025-11-04
- **ì‹œìŠ¤í…œëª…**: ì‹¤í—˜ ê´€ë¦¬ ì‹œìŠ¤í…œ
- **êµ¬í˜„ íŒŒì¼**: `src/utils/experiment_manager.py`
- **ìš°ì„ ìˆœìœ„**: â­â­â­ (ìµœìš°ì„  - ëª¨ë“  ì‹¤í—˜ì˜ ê¸°ë°˜)
- **ì‘ì„±ì**: ìµœí˜„í™”[íŒ€ì¥]
- **ì°¸ê³  ë¬¸ì„œ**: [PRD/06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md](../PRD/06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md), [docs/rules/ì‹¤í—˜_í´ë”_êµ¬ì¡°.md](../rules/ì‹¤í—˜_í´ë”_êµ¬ì¡°.md)

---

## ğŸ“Œ ì‹œìŠ¤í…œ ê°œìš”

### ëª©ì  ë° ë°°ê²½

ì‹¤í—˜ ê´€ë¦¬ ì‹œìŠ¤í…œì€ **ëª¨ë“  ì±—ë´‡ ì‹¤í–‰ì„ ì²´ê³„ì ìœ¼ë¡œ ì¶”ì í•˜ê³  ê´€ë¦¬í•˜ëŠ” í•µì‹¬ ì‹œìŠ¤í…œ**ìœ¼ë¡œ, `src/utils/experiment_manager.py`ì— `ExperimentManager` í´ë˜ìŠ¤ë¡œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤. ë³¸ ì‹œìŠ¤í…œì€ Session ID ìë™ ë¶€ì—¬, í´ë” êµ¬ì¡° ìë™ ìƒì„±, Logger í†µí•©, ë©”íƒ€ë°ì´í„° ê´€ë¦¬ ë“±ì„ í†µí•©ì ìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤.

### ì£¼ìš” ì—­í• 

1. **Session ID ìë™ ë¶€ì—¬**: ë‹¹ì¼ ê¸°ì¤€ ìˆœì°¨ì  ID ìƒì„± (session_001, 002...)
2. **í´ë” êµ¬ì¡° ìë™ ìƒì„±**: 7ê°œ ì„œë¸Œ í´ë” ìë™ ìƒì„± (tools, database, prompts, ui, outputs, evaluation, debug)
3. **Logger í†µí•©**: ë©”ì¸ Logger ë° ë„êµ¬ë³„ Logger ìë™ ìƒì„±
4. **ë©”íƒ€ë°ì´í„° ê´€ë¦¬**: `metadata.json`ìœ¼ë¡œ ì‹¤í—˜ ì •ë³´ ì¶”ì 
5. **DB ì¿¼ë¦¬ ê¸°ë¡**: SQL ì¿¼ë¦¬ ë° pgvector ê²€ìƒ‰ ê¸°ë¡
6. **í”„ë¡¬í”„íŠ¸ ì €ì¥**: ì‹œìŠ¤í…œ/ì‚¬ìš©ì/ìµœì¢… í”„ë¡¬í”„íŠ¸ ì €ì¥
7. **í‰ê°€ ì§€í‘œ ì €ì¥**: RAG, Agent, ë¹„ìš©, ì‘ë‹µ ì‹œê°„ ë“± í‰ê°€ ë°ì´í„° ì €ì¥

### ì˜ì¡´ ê´€ê³„

```
ExperimentManager (ì‹¤í—˜ ê´€ë¦¬)
  â†“
â”œâ”€â”€ Logger (ë¡œê¹…)
â”œâ”€â”€ DB Queries (ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë¡)
â”œâ”€â”€ Prompts (í”„ë¡¬í”„íŠ¸ ì €ì¥)
â”œâ”€â”€ UI Events (UI ì¸í„°ë™ì…˜)
â”œâ”€â”€ Outputs (ê²°ê³¼ë¬¼ ì €ì¥)
â””â”€â”€ Evaluation (í‰ê°€ ì§€í‘œ)
```

---

## âœ… êµ¬í˜„ í˜„í™© (2025-11-04 ê¸°ì¤€)

### ì™„ì „ êµ¬í˜„ëœ ê¸°ëŠ¥

#### 1. í‰ê°€ ì‹œìŠ¤í…œ ì™„ì „ ì‘ë™ âœ…
- **íŒŒì¼**: `src/evaluation/evaluator.py:282-305`
- **ê°œì„  ë‚´ìš©**: KeyError 'question' ë¬¸ì œ í•´ê²°
- **êµ¬í˜„ ìƒì„¸**:
  - í‰ê°€ ê²°ê³¼ì— question, answer, reference_docs, difficulty í•„ë“œ ì¶”ê°€
  - ì—ëŸ¬ ì²˜ë¦¬ ì‹œì—ë„ ëª¨ë“  í•„ë“œ í¬í•¨í•˜ë„ë¡ ê°œì„ 
  - DB ì €ì¥ ë° UI í‘œì‹œ ì •ìƒ ì‘ë™

```python
# src/evaluation/evaluator.py:287-295
result = json.loads(result_text)

# ì§ˆë¬¸ê³¼ ë‹µë³€ ì¶”ê°€ (DB ì €ì¥ìš©)
result["question"] = question
result["answer"] = answer
result["reference_docs"] = reference_docs
result["difficulty"] = difficulty

self.logger.write(f"í‰ê°€ ì™„ë£Œ: ì´ì  {result.get('total_score', 0)}/40")
return result
```

#### 2. LLM ì‘ë‹µ ì „ì²´ ë‚´ìš© ë¡œê¹… âœ…
- **ëŒ€ìƒ ë„êµ¬**: general_answer, search_paper, web_search, glossary, summarize, text2sql
- **ê°œì„  ë‚´ìš©**: ê¸°ì¡´ì—ëŠ” ê¸€ì ìˆ˜ë§Œ ê¸°ë¡, ì´ì œ ì „ì²´ ì‘ë‹µ ë‚´ìš© ë¡œê¹…
- **êµ¬í˜„ ìœ„ì¹˜**:
  - `src/tools/general_answer.py:72-77`
  - `src/tools/search_paper.py:320-326`
  - `src/tools/web_search.py:149-155`
  - `src/tools/glossary.py:494-500`
  - `src/tools/summarize.py:208-213`
  - `src/tools/text2sql.py` (text2sql.logì— ê¸°ë¡)

```python
# ëª¨ë“  ë„êµ¬ì˜ ê³µí†µ íŒ¨í„´
if tool_logger:
    tool_logger.write(f"ë‹µë³€ ìƒì„± ì™„ë£Œ: {len(response.content)} ê¸€ì")
    tool_logger.write("=" * 80)
    tool_logger.write("[LLM ë‹µë³€ ì „ì²´ ë‚´ìš©]")
    tool_logger.write(response.content)
    tool_logger.write("=" * 80)
    tool_logger.close()
```

#### 3. í‰ê°€ ê²°ê³¼ ìë™ ì €ì¥ âœ…
- **íŒŒì¼**: `src/utils/experiment_manager.py:263-275`, `ui/components/chat_interface.py:266-272`
- **ì €ì¥ ìœ„ì¹˜**: `evaluation/evaluation_YYYYMMDD_HHMMSS.json`
- **êµ¬í˜„ ìƒì„¸**:
  - ë‹µë³€ í‰ê°€ ì™„ë£Œ í›„ ìë™ìœ¼ë¡œ evaluation í´ë”ì— JSON ì €ì¥
  - íƒ€ì„ìŠ¤íƒ¬í”„ í¬í•¨í•˜ì—¬ ì¤‘ë³µ ë°©ì§€
  - í‰ê°€ ì ìˆ˜, ì§ˆë¬¸, ë‹µë³€, ì°¸ê³  ë¬¸ì„œ ëª¨ë‘ í¬í•¨

```python
# src/utils/experiment_manager.py:263-275
def save_evaluation_result(self, evaluation_data: Dict):
    """ë‹µë³€ í‰ê°€ ê²°ê³¼ ì €ì¥"""
    evaluation_data['timestamp'] = datetime.now().isoformat()
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    eval_file = self.evaluation_dir / f"evaluation_{timestamp}.json"

    with open(eval_file, 'w', encoding='utf-8') as f:
        json.dump(evaluation_data, f, ensure_ascii=False, indent=2)

    self.logger.write(f"í‰ê°€ ê²°ê³¼ ì €ì¥: {eval_file.name}")
```

#### 4. ì „ì²´ ëŒ€í™” ìë™ ì €ì¥ âœ… (2025-11-04 ê°œì„ )
- **íŒŒì¼**: `src/utils/experiment_manager.py:559-596`, `ui/components/chat_interface.py:462`
- **ì €ì¥ ìœ„ì¹˜**: `outputs/conversation_{difficulty}_{timestamp}.json`
- **ê°œì„  ë‚´ìš©**:
  - âœ… **ëª¨ë“œë³„ íŒŒì¼ëª… êµ¬ë¶„**: conversation_easy_*, conversation_hard_* í˜•ì‹ìœ¼ë¡œ ì €ì¥
  - âœ… **ì´ì–´ì“°ê¸° ë°©ì‹**: ì„¸ì…˜ë‹¹ ëª¨ë“œë³„ë¡œ í•˜ë‚˜ì˜ íŒŒì¼ ì‚¬ìš©, ìƒˆ ë©”ì‹œì§€ë§Œ ì¶”ê°€
  - âœ… **ì¤‘ë³µ ë°©ì§€**: ê¸°ì¡´ ë©”ì‹œì§€ ë‚´ìš© ì²´í¬í•˜ì—¬ ì¤‘ë³µ ë©”ì‹œì§€ ì œì™¸
  - âœ… **íƒ€ì„ìŠ¤íƒ¬í”„**: ì„¸ì…˜ ì‹œì‘ ì‹œ í•œ ë²ˆë§Œ ìƒì„±, íŒŒì¼ëª…ì— í¬í•¨

**êµ¬í˜„ ìƒì„¸**:
```python
# src/utils/experiment_manager.py:559-596
def save_conversation(self, conversation_data: list, difficulty: str = "easy"):
    """ì „ì²´ ëŒ€í™” ê¸°ë¡ ì €ì¥ (ì´ì–´ì“°ê¸° ë°©ì‹)"""
    # ì„¸ì…˜ë‹¹ ëª¨ë“œë³„ë¡œ í•˜ë‚˜ì˜ íŒŒì¼ ì‚¬ìš©
    if not hasattr(self, f'conversation_file_{difficulty}'):
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        conv_file = self.outputs_dir / f"conversation_{difficulty}_{timestamp}.json"
        setattr(self, f'conversation_file_{difficulty}', conv_file)
    else:
        conv_file = getattr(self, f'conversation_file_{difficulty}')

    # ê¸°ì¡´ ë‚´ìš© ì½ê¸° (ìˆë‹¤ë©´)
    if conv_file.exists():
        with open(conv_file, 'r', encoding='utf-8') as f:
            try:
                existing_data = json.load(f)
            except json.JSONDecodeError:
                existing_data = []
    else:
        existing_data = []

    # ìƒˆ ë©”ì‹œì§€ë§Œ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
    existing_contents = {msg.get('content', '') for msg in existing_data}
    for msg in conversation_data:
        if msg.get('content', '') not in existing_contents:
            existing_data.append(msg)
            existing_contents.add(msg.get('content', ''))

    # ì €ì¥
    with open(conv_file, 'w', encoding='utf-8') as f:
        json.dump(existing_data, f, ensure_ascii=False, indent=2)

    self.logger.write(f"ëŒ€í™” ì €ì¥: {conv_file.name} ({len(existing_data)}ê°œ ë©”ì‹œì§€)")

# ui/components/chat_interface.py:462
exp_manager.save_conversation(messages, difficulty=difficulty)
```

**ë³€ê²½ ì „í›„ ë¹„êµ**:
- **ë³€ê²½ ì „**: ë§¤ ë‹µë³€ë§ˆë‹¤ ìƒˆ íŒŒì¼ ìƒì„± (conversation_20251104_213739.json, conversation_20251104_213805.json...)
- **ë³€ê²½ í›„**: ëª¨ë“œë³„ë¡œ í•˜ë‚˜ì˜ íŒŒì¼ì— ì´ì–´ì“°ê¸° (conversation_easy_20251104_213739.json)

**ì¥ì **:
- ëŒ€í™” íˆìŠ¤í† ë¦¬ ì¶”ì  ìš©ì´
- íŒŒì¼ ê°œìˆ˜ ê°ì†Œ (ì„¸ì…˜ë‹¹ ìµœëŒ€ 2ê°œ: easy + hard)
- ëª¨ë“œ ì „í™˜ ì‹œì—ë„ ê° ëª¨ë“œë³„ ëŒ€í™” ë¶„ë¦¬ ì €ì¥

**ìƒì„¸ ë¬¸ì„œ**: [03-1_Conversation_íŒŒì¼_ê´€ë¦¬.md](./03-1_Conversation_íŒŒì¼_ê´€ë¦¬.md)

#### 5. SQL ì¿¼ë¦¬ ìë™ ì €ì¥ âœ…
- **íŒŒì¼**: `src/utils/experiment_manager.py:291-312`, `close()` ë©”ì„œë“œì—ì„œ ìë™ í˜¸ì¶œ
- **ì €ì¥ ìœ„ì¹˜**: `database/queries_YYYYMMDD_HHMMSS.sql`
- **êµ¬í˜„ ìƒì„¸**:
  - ì‹¤í—˜ ì„¸ì…˜ ì¢…ë£Œ ì‹œ ìˆ˜ì§‘ëœ ëª¨ë“  SQL ì¿¼ë¦¬ ìë™ ì €ì¥
  - ì¿¼ë¦¬ë³„ íƒ€ì„ìŠ¤íƒ¬í”„, ì‹¤í–‰ ì‹œê°„ í¬í•¨
  - ì£¼ì„ìœ¼ë¡œ ë©”íƒ€ë°ì´í„° ê¸°ë¡

```python
# src/utils/experiment_manager.py:304-312
with open(query_file, 'w', encoding='utf-8') as f:
    f.write("-- SQL Queries Log\n")
    f.write(f"-- Generated at: {datetime.now().isoformat()}\n\n")

    for i, query_info in enumerate(self.db_queries, 1):
        f.write(f"-- Query {i}\n")
        f.write(f"-- Time: {query_info.get('timestamp', 'N/A')}\n")
        f.write(f"-- Execution Time: {query_info.get('execution_time_ms', 'N/A')} ms\n")
        f.write(f"{query_info['query']}\n\n")
```

#### 6. í”„ë¡¬í”„íŠ¸ ìë™ ì €ì¥ âœ…
- **ëŒ€ìƒ ë„êµ¬**: general_answer, search_paper, web_search, glossary, summarize
- **ì €ì¥ ìœ„ì¹˜**: `prompts/system_prompt_YYYYMMDD_HHMMSS.txt`, `prompts/user_prompt_YYYYMMDD_HHMMSS.txt`
- **êµ¬í˜„ ìœ„ì¹˜**:
  - `src/tools/general_answer.py:42-50`
  - `src/tools/search_paper.py:280-308`
  - `src/tools/web_search.py:127-130`
  - `src/tools/glossary.py:468-496`
  - `src/tools/summarize.py:172-174`

```python
# ê³µí†µ íŒ¨í„´ (ì˜ˆ: search_paper.py:280-308)
if exp_manager:
    exp_manager.save_system_prompt(system_prompt, {
        "tool": "search_paper",
        "difficulty": difficulty
    })

if exp_manager:
    exp_manager.save_user_prompt(user_content, {
        "tool": "search_paper",
        "difficulty": difficulty,
        "search_results_length": len(raw_results)
    })
```

### ë¶€ë¶„ êµ¬í˜„ëœ ê¸°ëŠ¥ (ì¸í”„ë¼ ì¡´ì¬, í˜¸ì¶œ í•„ìš”)

#### 1. pgvector ê²€ìƒ‰ ê¸°ë¡ ğŸŸ¡
- **ë©”ì„œë“œ**: `log_pgvector_search()` - âœ… êµ¬í˜„ë¨
- **í˜¸ì¶œ ìƒíƒœ**: summarize.pyì—ì„œë§Œ í˜¸ì¶œ (`src/tools/summarize.py:138-145`)
- **í•„ìš” ì‘ì—…**: search_paper, glossary ë„êµ¬ì—ì„œë„ í˜¸ì¶œ í•„ìš”

#### 2. DB ê²€ìƒ‰ ê²°ê³¼ ì €ì¥ ğŸŸ¡
- **ë©”ì„œë“œ**: `save_search_results()` - âœ… êµ¬í˜„ë¨
- **í˜¸ì¶œ ìƒíƒœ**: ë¯¸í˜¸ì¶œ
- **í•„ìš” ì‘ì—…**: ê° ë„êµ¬ì—ì„œ ê²€ìƒ‰ ê²°ê³¼ ì €ì¥ í˜¸ì¶œ

#### 3. DB ì„±ëŠ¥ ì €ì¥ ğŸŸ¡
- **ë©”ì„œë“œ**: `save_db_performance()` - âœ… êµ¬í˜„ë¨
- **í˜¸ì¶œ ìƒíƒœ**: ë¯¸í˜¸ì¶œ
- **í•„ìš” ì‘ì—…**: ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ ì¸¡ì • í›„ ì €ì¥

#### 4. Streamlit ì„¸ì…˜ ì €ì¥ ğŸŸ¡
- **ë©”ì„œë“œ**: `save_streamlit_session()` - âœ… êµ¬í˜„ë¨
- **í˜¸ì¶œ ìƒíƒœ**: ë¯¸í˜¸ì¶œ
- **í•„ìš” ì‘ì—…**: UIì—ì„œ ì„¸ì…˜ ìƒíƒœ ì €ì¥ í˜¸ì¶œ

#### 5. UI ì´ë²¤íŠ¸ ê¸°ë¡ ğŸŸ¡
- **ë©”ì„œë“œ**: `log_ui_event()` - âœ… êµ¬í˜„ë¨
- **í˜¸ì¶œ ìƒíƒœ**: ë¯¸í˜¸ì¶œ
- **í•„ìš” ì‘ì—…**: UI ì´ë²¤íŠ¸ ë°œìƒ ì‹œë§ˆë‹¤ ê¸°ë¡

### ë¯¸êµ¬í˜„ ê¸°ëŠ¥ âŒ

#### 1. final_prompt.txt âŒ
- **ìœ„ì¹˜**: `prompts/final_prompt.txt`
- **ëª©ì **: LLMì— ì „ë‹¬ëœ ìµœì¢… í”„ë¡¬í”„íŠ¸ (system + user ê²°í•©)
- **êµ¬í˜„ í•„ìš”**: ë©”ì„œë“œëŠ” ì¡´ì¬í•˜ë‚˜ í˜¸ì¶œí•˜ëŠ” ê³³ ì—†ìŒ

#### 2. prompt_template.yaml âŒ
- **ìœ„ì¹˜**: `prompts/prompt_template.yaml`
- **ëª©ì **: í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë©”íƒ€ë°ì´í„°
- **êµ¬í˜„ í•„ìš”**: ë©”ì„œë“œëŠ” ì¡´ì¬í•˜ë‚˜ í˜¸ì¶œí•˜ëŠ” ê³³ ì—†ìŒ

#### 3. summary.md (ìš”ì•½ ë„êµ¬) âŒ
- **ìœ„ì¹˜**: `outputs/summary.md`
- **ëª©ì **: summarize ë„êµ¬ ì‹¤í–‰ ê²°ê³¼ë¥¼ Markdownìœ¼ë¡œ ì €ì¥
- **êµ¬í˜„ í•„ìš”**: summarize_nodeì—ì„œ ê²°ê³¼ë¥¼ summary.mdë¡œ ì €ì¥

#### 4. config.yaml âŒ
- **ìœ„ì¹˜**: `config.yaml` (ì‹¤í—˜ í´ë” ë£¨íŠ¸)
- **ëª©ì **: ì‹¤í—˜ ì‹¤í–‰ ì‹œ ì‚¬ìš©ëœ ì „ì²´ ì„¤ì • ìŠ¤ëƒ…ìƒ·
- **êµ¬í˜„ í•„ìš”**: ì‹¤í—˜ ì‹œì‘ ì‹œ config íŒŒì¼ ë³µì‚¬

#### 5. RAG í‰ê°€ ì§€í‘œ âŒ
- **ë©”ì„œë“œ**: `save_rag_metrics()` - âœ… êµ¬í˜„ë¨
- **í˜¸ì¶œ ìƒíƒœ**: ë¯¸í˜¸ì¶œ
- **í•„ìš” ì‘ì—…**: Recall@K, Precision ê³„ì‚° í›„ ì €ì¥

#### 6. Agent ì •í™•ë„ âŒ
- **ë©”ì„œë“œ**: `save_agent_accuracy()` - âœ… êµ¬í˜„ë¨
- **í˜¸ì¶œ ìƒíƒœ**: ë¯¸í˜¸ì¶œ
- **í•„ìš” ì‘ì—…**: ë„êµ¬ ì„ íƒ ì •í™•ë„ ê³„ì‚° í›„ ì €ì¥

#### 7. ì‘ë‹µ ì‹œê°„ ë¶„ì„ âŒ
- **ë©”ì„œë“œ**: `save_latency_report()` - âœ… êµ¬í˜„ë¨
- **í˜¸ì¶œ ìƒíƒœ**: ë¯¸í˜¸ì¶œ
- **í•„ìš” ì‘ì—…**: ë‹¨ê³„ë³„ ì‘ë‹µ ì‹œê°„ ì¸¡ì • í›„ ì €ì¥

#### 8. ë¹„ìš© ë¶„ì„ âŒ
- **ë©”ì„œë“œ**: `save_cost_analysis()` - âœ… êµ¬í˜„ë¨
- **í˜¸ì¶œ ìƒíƒœ**: ë¯¸í˜¸ì¶œ
- **í•„ìš” ì‘ì—…**: í† í° ì‚¬ìš©ëŸ‰ ë° ë¹„ìš© ê³„ì‚° í›„ ì €ì¥

---

## ğŸ“ ìµœê·¼ ê°œì„ ì‚¬í•­ (2025-11-04)

### ì»¤ë°‹ ê¸°ë¡ (7ê°œ)

#### 1. fix: í‰ê°€ ê²°ê³¼ì— question, answer í•„ë“œ ëˆ„ë½ ìˆ˜ì • (35c2480)
**ë¬¸ì œ**: í‰ê°€ ì‹œìŠ¤í…œì—ì„œ `KeyError: 'question'` ë°œìƒ
**ì›ì¸**: evaluator.pyì˜ evaluate() ë©”ì„œë“œê°€ ì ìˆ˜ë§Œ ë°˜í™˜, question/answer ë¯¸í¬í•¨
**í•´ê²°**:
- evaluate() ë°˜í™˜ ë”•ì…”ë„ˆë¦¬ì— question, answer, reference_docs, difficulty ì¶”ê°€
- ì—ëŸ¬ ì²˜ë¦¬ ì¼€ì´ìŠ¤ì—ë„ ë™ì¼ í•„ë“œ ì¶”ê°€
- í‰ê°€ ê²°ê³¼ DB ì €ì¥ ë° UI í‘œì‹œ ì •ìƒí™”

**ìˆ˜ì • íŒŒì¼**: `src/evaluation/evaluator.py`

#### 2-3. feat: ë„êµ¬ë³„ LLM ë‹µë³€ ì „ì²´ ë‚´ìš© ë¡œê·¸ ê¸°ë¡ ì¶”ê°€ (aaf1dfc, b21cbec)
**ë¬¸ì œ**: ë¡œê·¸ì— "LLM ì‘ë‹µ ìƒì„± ì™„ë£Œ: 590 ê¸€ì"ë§Œ ê¸°ë¡, ì‹¤ì œ ë‚´ìš© ì—†ìŒ
**ì›ì¸**: ê° ë„êµ¬ì—ì„œ response.contentë¥¼ ë¡œê¹…í•˜ì§€ ì•ŠìŒ
**í•´ê²°**:
- 6ê°œ ë„êµ¬(general_answer, search_paper, web_search, glossary, summarize, text2sql)ì— ì „ì²´ ì‘ë‹µ ë¡œê¹… ì¶”ê°€
- 80ì êµ¬ë¶„ì„ (`"=" * 80`)ìœ¼ë¡œ ê°€ë…ì„± í–¥ìƒ
- "[LLM ë‹µë³€ ì „ì²´ ë‚´ìš©]" í—¤ë”ë¡œ êµ¬ë¶„

**ìˆ˜ì • íŒŒì¼**:
- `src/tools/general_answer.py`
- `src/tools/search_paper.py`
- `src/tools/web_search.py`
- `src/tools/glossary.py`
- `src/tools/summarize.py`
- `src/tools/text2sql.py`

#### 4. feat: ExperimentManager ì €ì¥ ë©”ì„œë“œ ì¶”ê°€ (95834c2)
**ë¬¸ì œ**: í‰ê°€ ê²°ê³¼, ëŒ€í™” ë‚´ì—­, SQL ì¿¼ë¦¬ê°€ ì €ì¥ë˜ì§€ ì•ŠìŒ
**ì›ì¸**: ì¸í”„ë¼ ë©”ì„œë“œê°€ ì—†ì—ˆìŒ
**í•´ê²°**:
- `save_evaluation_result()`: evaluation í´ë”ì— í‰ê°€ ê²°ê³¼ JSON ì €ì¥
- `save_conversation()`: outputs í´ë”ì— ì „ì²´ ëŒ€í™” JSON ì €ì¥
- `flush_queries_to_file()`: database í´ë”ì— SQL ì¿¼ë¦¬ ì €ì¥
- `close()` ë©”ì„œë“œì—ì„œ flush_queries_to_file() ìë™ í˜¸ì¶œ

**ìˆ˜ì • íŒŒì¼**: `src/utils/experiment_manager.py`

#### 5. feat: í‰ê°€ ê²°ê³¼ ë° ì „ì²´ ëŒ€í™” ìë™ ì €ì¥ ê¸°ëŠ¥ ì¶”ê°€ (465ba4c)
**ë¬¸ì œ**: í‰ê°€/ëŒ€í™” ì €ì¥ ë©”ì„œë“œê°€ ìˆì§€ë§Œ ì‹¤ì œë¡œ í˜¸ì¶œë˜ì§€ ì•ŠìŒ
**ì›ì¸**: UIì—ì„œ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
**í•´ê²°**:
- í‰ê°€ ì™„ë£Œ í›„ `exp_manager.save_evaluation_result()` í˜¸ì¶œ
- ë‹µë³€ ì¶”ê°€ í›„ `exp_manager.save_conversation()` í˜¸ì¶œ
- get_current_messages()ë¡œ ì„¸ì…˜ ìƒíƒœì—ì„œ ëŒ€í™” ì¶”ì¶œ

**ìˆ˜ì • íŒŒì¼**: `ui/components/chat_interface.py`

#### 6. feat: ì¼ë°˜ ë‹µë³€ ë„êµ¬ í”„ë¡¬í”„íŠ¸ ìë™ ì €ì¥ (b149e21)
**ë¬¸ì œ**: í”„ë¡¬í”„íŠ¸ê°€ prompts í´ë”ì— ì €ì¥ë˜ì§€ ì•ŠìŒ
**ì›ì¸**: ë„êµ¬ì—ì„œ save_system_prompt/save_user_prompt í˜¸ì¶œ ì•ˆ í•¨
**í•´ê²°**:
- general_answer_nodeì— í”„ë¡¬í”„íŠ¸ ì €ì¥ ë¡œì§ ì¶”ê°€
- ë©”íƒ€ë°ì´í„°(tool, difficulty) í¬í•¨í•˜ì—¬ ì €ì¥

**ìˆ˜ì • íŒŒì¼**: `src/tools/general_answer.py`

#### 7. feat: ìš©ì–´ì§‘ ë„êµ¬ í”„ë¡¬í”„íŠ¸ ìë™ ì €ì¥ (25b7bb6)
**ë¬¸ì œ**: glossary ë„êµ¬ì˜ í”„ë¡¬í”„íŠ¸ ë¯¸ì €ì¥
**ì›ì¸**: search_paper, web_search, summarizeëŠ” ì¶”ê°€í–ˆì§€ë§Œ glossary ëˆ„ë½
**í•´ê²°**:
- glossary_nodeì— save_system_prompt(), save_user_prompt() í˜¸ì¶œ ì¶”ê°€
- ê²€ìƒ‰ ê²°ê³¼ ê¸¸ì´(search_results_length) ë©”íƒ€ë°ì´í„° í¬í•¨

**ìˆ˜ì • íŒŒì¼**: `src/tools/glossary.py`

**ì°¸ê³ **: search_paper, web_search, summarizeëŠ” ì´ë¯¸ í”„ë¡¬í”„íŠ¸ ì €ì¥ ê¸°ëŠ¥ì´ êµ¬í˜„ë˜ì–´ ìˆì—ˆìŒ

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì‹¤í—˜ í´ë” ìƒì„± íë¦„

```mermaid
graph TB
    subgraph Init["ğŸ”¸ ì´ˆê¸°í™” & í´ë” ìƒì„±"]
        direction LR
        A[ì±—ë´‡ ì‹¤í–‰<br/>ì‹œì‘] --> B[ë‚ ì§œ/ì‹œê°„ ìƒì„±<br/>Session ID ë¶€ì—¬]
        B --> C[í´ë” ìƒì„±<br/>ë‚ ì§œ_ì‹œê°„_session_XXX]
        C --> D[ì„œë¸Œ í´ë” 7ê°œ ìƒì„±<br/>tools, database, prompts, ui, outputs, evaluation, debug]
        D --> E[ğŸ’¾ metadata.json<br/>Logger ì´ˆê¸°í™”]
    end

    subgraph Execute["ğŸ”¹ ì±—ë´‡ ì‹¤í–‰ & ê¸°ë¡"]
        direction LR
        F[ì‚¬ìš©ì ì§ˆë¬¸<br/>ë‚œì´ë„ ì„ íƒ] --> G[AI Agent<br/>ë„êµ¬ ì„ íƒ]
        G --> H[ë„êµ¬ ì‹¤í–‰<br/>RAG/ì›¹ê²€ìƒ‰/ìš©ì–´ì§‘...]
        H --> I[ê° í´ë”ì— ê¸°ë¡<br/>ë¡œê·¸, ì¿¼ë¦¬, í”„ë¡¬í”„íŠ¸, UI]
        I --> J[í‰ê°€ ì§€í‘œ ìˆ˜ì§‘<br/>Recall, ë¹„ìš©, ì‘ë‹µì‹œê°„]
    end

    subgraph Finish["ğŸ”º ì¢…ë£Œ & ì €ì¥"]
        direction LR
        K[ìµœì¢… ë‹µë³€ ìƒì„±] --> L[ğŸ’¾ outputs/<br/>response.txt ì €ì¥]
        L --> M[metadata.json<br/>ì—…ë°ì´íŠ¸]
        M --> N[Logger ì¢…ë£Œ<br/>ì‹¤í—˜ ì™„ë£Œ]
    end

    Init --> Execute
    Execute --> Finish

    %% Subgraph ìŠ¤íƒ€ì¼
    style Init fill:#e1f5ff,stroke:#01579b,stroke-width:3px,color:#000
    style Execute fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000
    style Finish fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì´ˆê¸°í™” - íŒŒë‘ ê³„ì—´)
    style A fill:#90caf9,stroke:#1976d2,color:#000
    style B fill:#81d4fa,stroke:#0288d1,color:#000
    style C fill:#64b5f6,stroke:#1976d2,color:#000
    style D fill:#42a5f5,stroke:#1565c0,color:#000
    style E fill:#42a5f5,stroke:#1565c0,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì‹¤í–‰ - ë³´ë¼ ê³„ì—´)
    style F fill:#ce93d8,stroke:#7b1fa2,color:#000
    style G fill:#ba68c8,stroke:#7b1fa2,color:#fff
    style H fill:#ab47bc,stroke:#4a148c,color:#fff
    style I fill:#9c27b0,stroke:#4a148c,color:#fff
    style J fill:#9c27b0,stroke:#4a148c,color:#fff

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼ (ì¢…ë£Œ - ë…¹ìƒ‰ ê³„ì—´)
    style K fill:#a5d6a7,stroke:#388e3c,color:#000
    style L fill:#81c784,stroke:#2e7d32,color:#000
    style M fill:#66bb6a,stroke:#2e7d32,color:#fff
    style N fill:#66bb6a,stroke:#2e7d32,color:#fff
```

**ì‹¤í—˜ í´ë” ìƒì„± íë¦„ ì„¤ëª…:**
- **ì´ˆê¸°í™” ë‹¨ê³„**: ì±—ë´‡ ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ Session ID ë¶€ì—¬ (session_001, 002...) â†’ í´ë” ë° ì„œë¸Œ í´ë” 7ê°œ ìƒì„± â†’ metadata.jsonê³¼ Logger ì´ˆê¸°í™”
- **ì‹¤í–‰ ë‹¨ê³„**: ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥ ë° ë‚œì´ë„ ì„ íƒ â†’ AI Agentê°€ ì ì ˆí•œ ë„êµ¬ ì„ íƒ (RAG, ì›¹ê²€ìƒ‰, ìš©ì–´ì§‘ ë“±) â†’ ì‹¤í–‰ ê³¼ì •ì„ ê° í´ë”ì— ê¸°ë¡ (ë„êµ¬ ë¡œê·¸, DB ì¿¼ë¦¬, í”„ë¡¬í”„íŠ¸, UI ì¸í„°ë™ì…˜) â†’ í‰ê°€ ì§€í‘œ ìˆ˜ì§‘ (Recall@K, ë¹„ìš©, ì‘ë‹µì‹œê°„)
- **ì¢…ë£Œ ë‹¨ê³„**: ìµœì¢… ë‹µë³€ ìƒì„± â†’ outputs/response.txt ì €ì¥ â†’ metadata.json ì—…ë°ì´íŠ¸ â†’ Logger ì¢…ë£Œ ë° ì‹¤í—˜ ì™„ë£Œ

---

## ğŸ“ ì‹¤í—˜ í´ë” êµ¬ì¡°

### í•„ìˆ˜ ë””ë ‰í† ë¦¬ êµ¬ì¡°

ëª¨ë“  ì±—ë´‡ ì‹¤í–‰ ê²°ê³¼ëŠ” `experiments/ë‚ ì§œ/ë‚ ì§œ_ì‹œê°„_session_XXX/` êµ¬ì¡°ë¡œ ì €ì¥ë©ë‹ˆë‹¤:

```
experiments/
â””â”€â”€ 20251103/                                # ë‚ ì§œ (YYYYMMDD)
    â””â”€â”€ 20251103_103015_session_001/         # ì‹œê°„_session_ID
        â”‚
        â”œâ”€â”€ metadata.json                    # â­ ì „ì²´ ì‹¤í—˜ ë©”íƒ€ë°ì´í„°
        â”œâ”€â”€ chatbot.log                      # ë©”ì¸ ì‹¤í–‰ ë¡œê·¸
        â”œâ”€â”€ config.yaml                      # ì „ì²´ ì„¤ì •
        â”‚
        â”œâ”€â”€ tools/                           # ğŸ”§ ë„êµ¬ ì‹¤í–‰ ë¡œê·¸
        â”‚   â”œâ”€â”€ rag_paper.log                # ë…¼ë¬¸ ê²€ìƒ‰ ë¡œê·¸
        â”‚   â”œâ”€â”€ rag_glossary.log             # ìš©ì–´ì§‘ ê²€ìƒ‰ ë¡œê·¸
        â”‚   â”œâ”€â”€ web_search.log               # ì›¹ ê²€ìƒ‰ ë¡œê·¸
        â”‚   â”œâ”€â”€ summary_paper.log            # ë…¼ë¬¸ ìš”ì•½ ë¡œê·¸
        â”‚   â”œâ”€â”€ file_save.log                # íŒŒì¼ ì €ì¥ ë¡œê·¸
        â”‚   â””â”€â”€ general.log                  # ì¼ë°˜ ë‹µë³€ ë¡œê·¸
        â”‚
        â”œâ”€â”€ database/                        # ğŸ—„ï¸ DB ê´€ë ¨ ê¸°ë¡
        â”‚   â”œâ”€â”€ queries.sql                  # ì‹¤í–‰ëœ SQL ì¿¼ë¦¬ ëª¨ìŒ
        â”‚   â”œâ”€â”€ pgvector_searches.json       # pgvector ê²€ìƒ‰ ê¸°ë¡
        â”‚   â”œâ”€â”€ search_results.json          # DB ê²€ìƒ‰ ê²°ê³¼
        â”‚   â””â”€â”€ db_performance.json          # ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ ë“±
        â”‚
        â”œâ”€â”€ prompts/                         # ğŸ’¬ í”„ë¡¬í”„íŠ¸ ê¸°ë¡
        â”‚   â”œâ”€â”€ system_prompt.txt            # ì‚¬ìš©ëœ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
        â”‚   â”œâ”€â”€ user_prompt.txt              # ì‚¬ìš©ì ì§ˆë¬¸ + ì»¨í…ìŠ¤íŠ¸
        â”‚   â”œâ”€â”€ final_prompt.txt             # LLMì— ì „ë‹¬ëœ ìµœì¢… í”„ë¡¬í”„íŠ¸
        â”‚   â””â”€â”€ prompt_template.yaml         # í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì •ë³´
        â”‚
        â”œâ”€â”€ ui/                              # ğŸ–¥ï¸ UI ê´€ë ¨ ê¸°ë¡
        â”‚   â”œâ”€â”€ streamlit_session.json       # Streamlit ì„¸ì…˜ ìƒíƒœ
        â”‚   â”œâ”€â”€ user_interactions.log        # ì‚¬ìš©ì ì¸í„°ë™ì…˜ ë¡œê·¸
        â”‚   â””â”€â”€ ui_events.json               # UI ì´ë²¤íŠ¸ ê¸°ë¡
        â”‚
        â”œâ”€â”€ outputs/                         # ğŸ“„ ìƒì„±ëœ ê²°ê³¼ë¬¼
        â”‚   â”œâ”€â”€ response.txt                 # ìµœì¢… ë‹µë³€
        â”‚   â”œâ”€â”€ summary.md                   # ìš”ì•½ë³¸ (ìˆì„ ê²½ìš°)
        â”‚   â””â”€â”€ saved_file.txt               # ì‚¬ìš©ìê°€ ì €ì¥ ìš”ì²­í•œ íŒŒì¼
        â”‚
        â”œâ”€â”€ evaluation/                      # ğŸ“Š í‰ê°€ ì§€í‘œ
        â”‚   â”œâ”€â”€ rag_metrics.json             # RAG í‰ê°€ ì§€í‘œ
        â”‚   â”œâ”€â”€ agent_accuracy.json          # Agent ì •í™•ë„
        â”‚   â”œâ”€â”€ latency_report.json          # ì‘ë‹µ ì‹œê°„ ë¶„ì„
        â”‚   â”œâ”€â”€ cost_analysis.json           # ë¹„ìš© ë¶„ì„
        â”‚   â””â”€â”€ test_results.json            # í…ŒìŠ¤íŠ¸ ê²°ê³¼
        â”‚
        â””â”€â”€ debug/                           # ğŸ› ë””ë²„ê·¸ ì •ë³´ (ì„ íƒ)
            â”œâ”€â”€ agent_trace.json             # Agent ì‹¤í–‰ ì¶”ì 
            â”œâ”€â”€ llm_tokens.json              # í† í° ì‚¬ìš©ëŸ‰
            â””â”€â”€ error_trace.log              # ì—ëŸ¬ ë°œìƒ ì‹œ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤
```

### metadata.json êµ¬ì¡° (2025-11-04 ê°œì„ )

ê° ì‹¤í—˜ì˜ í•µì‹¬ ì •ë³´ë¥¼ í•œ ê³³ì— ìš”ì•½í•©ë‹ˆë‹¤:

```json
{
  "session_id": "001",
  "start_time": "2025-11-03T10:30:15",
  "end_time": "2025-11-03T10:32:45",
  "difficulty": "easy",
  "tool_used": "rag_paper",
  "user_query": "RAGì— ëŒ€í•´ ì•Œë ¤ì¤˜",
  "success": true,
  "response_time_ms": 2500,
  "response_length": 450,
  "model": "gpt-5",
  "temperature": 0.7,
  "tokens_used": {
    "prompt": 1200,
    "completion": 800,
    "total": 2000
  },
  "db_queries_count": 4,
  "db_total_time_ms": 120
}
```

**2025-11-04 ê°œì„ ì‚¬í•­**:
- âœ… **difficulty ìë™ ì—…ë°ì´íŠ¸**: Agent ì‹¤í–‰ ì‹œì‘ ì‹œ ë‚œì´ë„ ìë™ ê¸°ë¡
- âœ… **success ìë™ ì„¤ì •**: ë‹µë³€ ì„±ê³µ ì‹œ True, ì—ëŸ¬ ë°œìƒ ì‹œ False ìë™ ì—…ë°ì´íŠ¸
- âœ… **response_time_ms ìë™ ê³„ì‚°**: ì‹œì‘~ì¢…ë£Œ ì‹œê°„ ì°¨ì´ ë°€ë¦¬ì´ˆ ë‹¨ìœ„ë¡œ ìë™ ê³„ì‚°
- âœ… **end_time ìë™ ì—…ë°ì´íŠ¸**: ExperimentManager close() ì‹œ ìë™ ì„¤ì •

**êµ¬í˜„ ìœ„ì¹˜**: `ui/components/chat_interface.py:186-211, 488-489`

---

## ğŸ”§ ExperimentManager í´ë˜ìŠ¤ êµ¬ì¡°

### ì£¼ìš” ë©”ì„œë“œ ë¶„ë¥˜

#### 1. ë„êµ¬ (Tools) ê´€ë ¨

| ë©”ì„œë“œ | ì„¤ëª… | ì €ì¥ ìœ„ì¹˜ |
|--------|------|-----------|
| `get_tool_logger(tool_name)` | ë„êµ¬ë³„ ë…ë¦½ Logger ìƒì„± | `tools/{tool_name}.log` |

#### 2. ë°ì´í„°ë² ì´ìŠ¤ (Database) ê´€ë ¨

| ë©”ì„œë“œ | ì„¤ëª… | ì €ì¥ ìœ„ì¹˜ |
|--------|------|-----------|
| `log_sql_query(query, description, tool, execution_time_ms)` | SQL ì¿¼ë¦¬ ê¸°ë¡ | `database/queries.sql` |
| `log_pgvector_search(search_info)` | pgvector ê²€ìƒ‰ ê¸°ë¡ | `database/pgvector_searches.json` |
| `save_search_results(tool, results)` | DB ê²€ìƒ‰ ê²°ê³¼ ì €ì¥ | `database/search_results.json` |

#### 3. í”„ë¡¬í”„íŠ¸ (Prompts) ê´€ë ¨

| ë©”ì„œë“œ | ì„¤ëª… | ì €ì¥ ìœ„ì¹˜ |
|--------|------|-----------|
| `save_system_prompt(system_prompt, metadata)` | ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì €ì¥ | `prompts/system_prompt.txt` |
| `save_user_prompt(user_prompt, metadata)` | ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ ì €ì¥ | `prompts/user_prompt.txt` |
| `save_final_prompt(final_prompt)` | ìµœì¢… í”„ë¡¬í”„íŠ¸ ì €ì¥ | `prompts/final_prompt.txt` |
| `save_prompt_template(template_info)` | í…œí”Œë¦¿ ì •ë³´ ì €ì¥ | `prompts/prompt_template.yaml` |

#### 4. UI ê´€ë ¨

| ë©”ì„œë“œ | ì„¤ëª… | ì €ì¥ ìœ„ì¹˜ |
|--------|------|-----------|
| `log_ui_interaction(message)` | UI ì¸í„°ë™ì…˜ ë¡œê·¸ | `ui/user_interactions.log` |
| `log_ui_event(event_data)` | UI ì´ë²¤íŠ¸ ê¸°ë¡ | `ui/ui_events.json` |
| `save_streamlit_session(session_data)` | Streamlit ì„¸ì…˜ ì €ì¥ | `ui/streamlit_session.json` |

#### 5. í‰ê°€ (Evaluation) ê´€ë ¨

| ë©”ì„œë“œ | ì„¤ëª… | ì €ì¥ ìœ„ì¹˜ |
|--------|------|-----------|
| `save_rag_metrics(metrics)` | RAG í‰ê°€ ì§€í‘œ ì €ì¥ | `evaluation/rag_metrics.json` |
| `save_agent_accuracy(accuracy_data)` | Agent ì •í™•ë„ ì €ì¥ | `evaluation/agent_accuracy.json` |
| `save_latency_report(latency_data)` | ì‘ë‹µ ì‹œê°„ ë¶„ì„ ì €ì¥ | `evaluation/latency_report.json` |
| `save_cost_analysis(cost_data)` | ë¹„ìš© ë¶„ì„ ì €ì¥ | `evaluation/cost_analysis.json` |

#### 6. ê²°ê³¼ë¬¼ (Outputs) ê´€ë ¨

| ë©”ì„œë“œ | ì„¤ëª… | ì €ì¥ ìœ„ì¹˜ |
|--------|------|-----------|
| `save_output(filename, content)` | ê²°ê³¼ë¬¼ ì €ì¥ | `outputs/{filename}` |
| `update_metadata(**kwargs)` | metadata.json ì—…ë°ì´íŠ¸ | `metadata.json` |

---

## ğŸ“‹ Session ID ìë™ ë¶€ì—¬ ê·œì¹™

### ìë™ ìƒì„± ë°©ì‹

ExperimentManagerëŠ” ì±—ë´‡ ì‹¤í–‰ ì‹œë§ˆë‹¤ **Session IDë¥¼ ìë™ìœ¼ë¡œ ë¶€ì—¬**í•©ë‹ˆë‹¤:

- **í˜•ì‹**: `session_001`, `session_002`, `session_003` ...
- **ë¶€ì—¬ ë°©ì‹**: ë‹¹ì¼ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ìˆœì°¨ì ìœ¼ë¡œ ì¦ê°€
- **ì‹œì‘ ë²ˆí˜¸**: ë§¤ì¼ `001`ë¶€í„° ì‹œì‘
- **ì¤‘ë³µ ë°©ì§€**: ë‹¹ì¼ í´ë”ë¥¼ ìŠ¤ìº”í•˜ì—¬ ê°€ì¥ í° ë²ˆí˜¸ + 1 ë¶€ì—¬

### ì˜ˆì‹œ

```
experiments/20251103/
â”œâ”€â”€ 20251103_103015_session_001/   # ì˜¤ëŠ˜ ì²« ë²ˆì§¸ ì‹¤í–‰
â”œâ”€â”€ 20251103_110234_session_002/   # ì˜¤ëŠ˜ ë‘ ë²ˆì§¸ ì‹¤í–‰
â””â”€â”€ 20251103_143520_session_003/   # ì˜¤ëŠ˜ ì„¸ ë²ˆì§¸ ì‹¤í–‰

experiments/20251104/
â””â”€â”€ 20251104_090012_session_001/   # ë‹¤ìŒ ë‚ , ë‹¤ì‹œ 001ë¶€í„° ì‹œì‘
```

### êµ¬í˜„ ë¡œì§

ExperimentManager í´ë˜ìŠ¤ê°€ ìë™ìœ¼ë¡œ:
1. ë‹¹ì¼ í´ë” (`experiments/20251103/`) ìŠ¤ìº”
2. ê¸°ì¡´ session í´ë” í™•ì¸ (ì •ê·œì‹ìœ¼ë¡œ `session_XXX` íŒ¨í„´ ê²€ìƒ‰)
3. ê°€ì¥ í° ë²ˆí˜¸ ì¶”ì¶œ
4. ë‹¤ìŒ ë²ˆí˜¸ (max + 1) ë¶€ì—¬

---

## ğŸ”— í†µí•© ì‹œìŠ¤í…œ

### Logger í†µí•©

ExperimentManagerëŠ” Loggerë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤:

**ë©”ì¸ Logger:**
- ê²½ë¡œ: `experiments/ë‚ ì§œ/ë‚ ì§œ_ì‹œê°„_session_XXX/chatbot.log`
- ì ‘ê·¼: `exp.logger.write("ë©”ì‹œì§€")`
- ìë™ ì´ˆê¸°í™”/ì¢…ë£Œ: with ë¬¸ ì‚¬ìš© ì‹œ

**ë„êµ¬ë³„ Logger:**
```python
# ê° ë„êµ¬ëŠ” ë…ë¦½ ë¡œê·¸ íŒŒì¼ ì‚¬ìš©
rag_logger = exp.get_tool_logger('rag_paper')     # tools/rag_paper.log
web_logger = exp.get_tool_logger('web_search')    # tools/web_search.log
glossary_logger = exp.get_tool_logger('glossary') # tools/glossary.log
```

### AI Agent í†µí•©

AI Agentì˜ ëª¨ë“  ë…¸ë“œëŠ” ExperimentManagerë¥¼ í†µí•´ ì‹¤í–‰ ê³¼ì •ì„ ê¸°ë¡í•©ë‹ˆë‹¤:

- **Router ë…¸ë“œ**: ë„êµ¬ ì„ íƒ ë¡œê·¸
- **Tool ë…¸ë“œ**: ê° ë„êµ¬ì˜ ì‹¤í–‰ ë¡œê·¸ (ë„êµ¬ë³„ Logger ì‚¬ìš©)
- **DB ì¿¼ë¦¬**: SQL ë° pgvector ê²€ìƒ‰ ê¸°ë¡
- **í”„ë¡¬í”„íŠ¸**: ì‹œìŠ¤í…œ/ì‚¬ìš©ì/ìµœì¢… í”„ë¡¬í”„íŠ¸ ì €ì¥
- **í‰ê°€ ì§€í‘œ**: RAG, Agent, ë¹„ìš©, ì‘ë‹µ ì‹œê°„ ì €ì¥

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. with ë¬¸ ì‚¬ìš© í•„ìˆ˜

ExperimentManagerëŠ” **ë°˜ë“œì‹œ with ë¬¸ìœ¼ë¡œ ì‚¬ìš©**í•´ì•¼ í•©ë‹ˆë‹¤:

- âŒ **ì˜ëª»ëœ ì‚¬ìš©**:
  ```python
  exp = ExperimentManager()
  exp.logger.write("ë©”ì‹œì§€")
  # close() ëˆ„ë½ â†’ ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜
  ```

- âœ… **ì˜¬ë°”ë¥¸ ì‚¬ìš©**:
  ```python
  with ExperimentManager() as exp:
      exp.logger.write("ë©”ì‹œì§€")
  # ìë™ìœ¼ë¡œ close() ë° metadata.json ì—…ë°ì´íŠ¸
  ```

### 2. ë„êµ¬ë³„ Logger ì¢…ë£Œ

ë„êµ¬ë³„ LoggerëŠ” ì‚¬ìš© í›„ **ë°˜ë“œì‹œ close()** í˜¸ì¶œí•´ì•¼ í•©ë‹ˆë‹¤:

```python
tool_logger = exp.get_tool_logger('rag_paper')
tool_logger.write("ê²€ìƒ‰ ì™„ë£Œ")
tool_logger.close()  # í•„ìˆ˜!
```

### 3. metadata.json ì—…ë°ì´íŠ¸ íƒ€ì´ë°

`metadata.json`ì€ `update_metadata()` í˜¸ì¶œ ì‹œ ì¦‰ì‹œ ì €ì¥ë©ë‹ˆë‹¤:

```python
# ì‹¤í—˜ ì‹œì‘ ì‹œ
exp.update_metadata(user_query="RAGë€?", difficulty="easy")

# ì‹¤í—˜ ì¢…ë£Œ ì‹œ
exp.update_metadata(success=True, tool_used="rag_paper", response_time_ms=2500)
```

### 4. í´ë” ìë™ ìƒì„±

ExperimentManagerëŠ” 7ê°œ ì„œë¸Œ í´ë”ë¥¼ **ìë™ìœ¼ë¡œ ìƒì„±**í•˜ì§€ë§Œ, ì‚¬ìš©ìê°€ ì„ì˜ë¡œ ì‚­ì œí•˜ë©´ ì—ëŸ¬ ë°œìƒ:

- ìë™ ìƒì„± í´ë”: `tools/`, `database/`, `prompts/`, `ui/`, `outputs/`, `evaluation/`, `debug/`
- ì‚­ì œ ê¸ˆì§€: ì‹¤í–‰ ì¤‘ í´ë” ì‚­ì œ ì‹œ íŒŒì¼ ì €ì¥ ì‹¤íŒ¨

---

## ğŸ“Š ì‹¤í—˜ ê²€ìƒ‰ ë° ë¶„ì„

### ë©”íƒ€ë°ì´í„° ê¸°ë°˜ ê²€ìƒ‰

`metadata.json`ì„ í™œìš©í•˜ì—¬ ì‹¤í—˜ì„ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

**ê²€ìƒ‰ ì¡°ê±´ ì˜ˆì‹œ:**
- ë‚œì´ë„ë³„: `difficulty == "easy"`
- ë„êµ¬ë³„: `tool_used == "rag_paper"`
- ë‚ ì§œë³„: `experiments/20251103/` í´ë” íƒìƒ‰
- ì‘ë‹µ ì‹œê°„: `response_time_ms < 3000`
- ì„±ê³µ/ì‹¤íŒ¨: `success == true`

### í‰ê°€ ì§€í‘œ ì§‘ê³„

ì—¬ëŸ¬ ì‹¤í—˜ì˜ í‰ê°€ ì§€í‘œë¥¼ ì§‘ê³„í•˜ì—¬ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

**ì§‘ê³„ ëŒ€ìƒ:**
- RAG í‰ê°€: `evaluation/rag_metrics.json` (Recall@K, Precision, Faithfulness)
- Agent ì •í™•ë„: `evaluation/agent_accuracy.json` (ë„êµ¬ ì„ íƒ ì •í™•ë„)
- ì‘ë‹µ ì‹œê°„: `evaluation/latency_report.json` (p50/p95/p99)
- ë¹„ìš©: `evaluation/cost_analysis.json` (í† í° ì‚¬ìš©ëŸ‰, USD/KRW)

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- **[01_ë¡œê¹…_ì‹œìŠ¤í…œ.md](./01_ë¡œê¹…_ì‹œìŠ¤í…œ.md)** - Logger í´ë˜ìŠ¤ ìƒì„¸
- **[03_AI_Agent_ì‹œìŠ¤í…œ.md](./03_AI_Agent_ì‹œìŠ¤í…œ.md)** - Agentì—ì„œ ExperimentManager ì‚¬ìš©
- **[PRD/06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md](../PRD/06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md)** - ì‹¤í—˜ ì¶”ì  ê´€ë¦¬ ì „ì²´ ëª…ì„¸
- **[PRD/09_í‰ê°€_ê¸°ì¤€.md](../PRD/09_í‰ê°€_ê¸°ì¤€.md)** - RAG, Agent, DB í‰ê°€ ì§€í‘œ

---

## ğŸ“ ìš”ì•½

### ì™„ì „ êµ¬í˜„ëœ ê¸°ëŠ¥ (2025-11-04 ê¸°ì¤€)

1. âœ… **Session ID ìë™ ë¶€ì—¬**: ë‹¹ì¼ ê¸°ì¤€ ìˆœì°¨ ì¦ê°€ (session_001, 002...)
2. âœ… **7ê°œ ì„œë¸Œ í´ë” ìë™ ìƒì„±**: tools, database, prompts, ui, outputs, evaluation, debug
3. âœ… **Logger ìë™ í†µí•©**: ë©”ì¸ + ë„êµ¬ë³„ Logger ìë™ ìƒì„± ë° ê´€ë¦¬
4. âœ… **metadata.json ìë™ ê´€ë¦¬**: ì‹¤í—˜ ë©”íƒ€ë°ì´í„° ìë™ ì¶”ì 
5. âœ… **LLM ì‘ë‹µ ì „ì²´ ë¡œê¹…**: 6ê°œ ë„êµ¬ ëª¨ë‘ ì „ì²´ ì‘ë‹µ ë‚´ìš© ê¸°ë¡
6. âœ… **í‰ê°€ ê²°ê³¼ ìë™ ì €ì¥**: evaluation í´ë”ì— JSON í˜•ì‹ ì €ì¥
7. âœ… **ì „ì²´ ëŒ€í™” ìë™ ì €ì¥**: outputs í´ë”ì— ëŒ€í™” ë‚´ì—­ JSON ì €ì¥
8. âœ… **SQL ì¿¼ë¦¬ ìë™ ì €ì¥**: database í´ë”ì— SQL íŒŒì¼ ìë™ ì €ì¥ (close ì‹œ)
9. âœ… **í”„ë¡¬í”„íŠ¸ ìë™ ì €ì¥**: 5ê°œ ì£¼ìš” ë„êµ¬ì—ì„œ system/user í”„ë¡¬í”„íŠ¸ ì €ì¥
10. âœ… **with ë¬¸ ì§€ì›**: ìë™ ë¦¬ì†ŒìŠ¤ ì •ë¦¬ ë° ì¢…ë£Œ ì²˜ë¦¬

### ë¶€ë¶„ êµ¬í˜„ (ì¸í”„ë¼ ìˆìŒ, í˜¸ì¶œ í•„ìš”)

1. ğŸŸ¡ **pgvector ê²€ìƒ‰ ê¸°ë¡**: summarizeë§Œ í˜¸ì¶œ, search_paper/glossary ë¯¸í˜¸ì¶œ
2. ğŸŸ¡ **DB ê²€ìƒ‰ ê²°ê³¼ ì €ì¥**: save_search_results() ë©”ì„œë“œ ì¡´ì¬í•˜ë‚˜ ë¯¸ì‚¬ìš©
3. ğŸŸ¡ **DB ì„±ëŠ¥ ì €ì¥**: save_db_performance() ë©”ì„œë“œ ì¡´ì¬í•˜ë‚˜ ë¯¸ì‚¬ìš©
4. ğŸŸ¡ **Streamlit ì„¸ì…˜ ì €ì¥**: save_streamlit_session() ë©”ì„œë“œ ì¡´ì¬í•˜ë‚˜ ë¯¸ì‚¬ìš©
5. ğŸŸ¡ **UI ì´ë²¤íŠ¸ ê¸°ë¡**: log_ui_event() ë©”ì„œë“œ ì¡´ì¬í•˜ë‚˜ ë¯¸ì‚¬ìš©

### ë¯¸êµ¬í˜„ ê¸°ëŠ¥

1. âŒ **final_prompt.txt**: LLM ìµœì¢… í”„ë¡¬í”„íŠ¸ ì €ì¥ ë¯¸êµ¬í˜„
2. âŒ **prompt_template.yaml**: í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë©”íƒ€ë°ì´í„° ë¯¸êµ¬í˜„
3. âŒ **summary.md**: ìš”ì•½ ë„êµ¬ ê²°ê³¼ Markdown ì €ì¥ ë¯¸êµ¬í˜„
4. âŒ **config.yaml**: ì‹¤í—˜ ì„¤ì • ìŠ¤ëƒ…ìƒ· ë³µì‚¬ ë¯¸êµ¬í˜„
5. âŒ **RAG í‰ê°€ ì§€í‘œ**: save_rag_metrics() ë©”ì„œë“œ ìˆìœ¼ë‚˜ ë¯¸í˜¸ì¶œ
6. âŒ **Agent ì •í™•ë„**: save_agent_accuracy() ë©”ì„œë“œ ìˆìœ¼ë‚˜ ë¯¸í˜¸ì¶œ
7. âŒ **ì‘ë‹µ ì‹œê°„ ë¶„ì„**: save_latency_report() ë©”ì„œë“œ ìˆìœ¼ë‚˜ ë¯¸í˜¸ì¶œ
8. âŒ **ë¹„ìš© ë¶„ì„**: save_cost_analysis() ë©”ì„œë“œ ìˆìœ¼ë‚˜ ë¯¸í˜¸ì¶œ

### ì‹¤ì œ ì €ì¥ë˜ëŠ” íŒŒì¼ êµ¬ì¡° (í˜„ì¬)

**ë£¨íŠ¸ í•„ìˆ˜ íŒŒì¼:**
- âœ… `chatbot.log` - ë©”ì¸ ì‹¤í–‰ ë¡œê·¸
- âœ… `metadata.json` - ì‹¤í—˜ ë©”íƒ€ë°ì´í„°
- âŒ `config.yaml` - ì „ì²´ ì„¤ì • (ë¯¸êµ¬í˜„)

**tools/ í´ë”:**
- âœ… `{tool_name}.log` - ë„êµ¬ë³„ ì‹¤í–‰ ë¡œê·¸ (6ê°œ ë„êµ¬)
- âœ… LLM ì‘ë‹µ ì „ì²´ ë‚´ìš© í¬í•¨

**database/ í´ë”:**
- âœ… `queries_YYYYMMDD_HHMMSS.sql` - SQL ì¿¼ë¦¬ (close ì‹œ ìë™ ì €ì¥)
- ğŸŸ¡ `pgvector_searches.json` - pgvector ê²€ìƒ‰ (ì¼ë¶€ë§Œ í˜¸ì¶œ)
- âŒ `search_results.json` - DB ê²€ìƒ‰ ê²°ê³¼ (ë¯¸ì‚¬ìš©)
- âŒ `db_performance.json` - ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ (ë¯¸ì‚¬ìš©)

**prompts/ í´ë”:**
- âœ… `system_prompt_YYYYMMDD_HHMMSS.txt` - ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (5ê°œ ë„êµ¬)
- âœ… `user_prompt_YYYYMMDD_HHMMSS.txt` - ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ (5ê°œ ë„êµ¬)
- âŒ `final_prompt.txt` - ìµœì¢… í”„ë¡¬í”„íŠ¸ (ë¯¸êµ¬í˜„)
- âŒ `prompt_template.yaml` - í…œí”Œë¦¿ ì •ë³´ (ë¯¸êµ¬í˜„)

**ui/ í´ë”:**
- âœ… `user_interactions.log` - ì‚¬ìš©ì ì¸í„°ë™ì…˜ ë¡œê·¸
- âŒ `streamlit_session.json` - Streamlit ì„¸ì…˜ (ë¯¸ì‚¬ìš©)
- âŒ `ui_events.json` - UI ì´ë²¤íŠ¸ (ë¯¸ì‚¬ìš©)

**outputs/ í´ë”:**
- âœ… `response_YYYYMMDD_HHMMSS.txt` - ìµœì¢… ë‹µë³€
- âœ… `conversation_YYYYMMDD_HHMMSS.json` - ì „ì²´ ëŒ€í™” (NEW!)
- âŒ `summary.md` - ìš”ì•½ë³¸ (ë¯¸êµ¬í˜„)
- âœ… `saved_file_YYYYMMDD_HHMMSS.txt` - ì‚¬ìš©ì ì €ì¥ íŒŒì¼

**evaluation/ í´ë”:**
- âœ… `evaluation_YYYYMMDD_HHMMSS.json` - í‰ê°€ ê²°ê³¼ (NEW!)
- âŒ `rag_metrics.json` - RAG í‰ê°€ ì§€í‘œ (ë¯¸ì‚¬ìš©)
- âŒ `agent_accuracy.json` - Agent ì •í™•ë„ (ë¯¸ì‚¬ìš©)
- âŒ `latency_report.json` - ì‘ë‹µ ì‹œê°„ ë¶„ì„ (ë¯¸ì‚¬ìš©)
- âŒ `cost_analysis.json` - ë¹„ìš© ë¶„ì„ (ë¯¸ì‚¬ìš©)
- âŒ `test_results.json` - í…ŒìŠ¤íŠ¸ ê²°ê³¼ (ë¯¸ì‚¬ìš©)

**debug/ í´ë”:**
- âŒ `agent_trace.json` - Agent ì¶”ì  (ë¯¸ì‚¬ìš©)
- âŒ `llm_tokens.json` - í† í° ì‚¬ìš©ëŸ‰ (ë¯¸ì‚¬ìš©)
- âŒ `error_trace.log` - ì—ëŸ¬ ìŠ¤íƒ (ë¯¸ì‚¬ìš©)

### í†µí•© ì‹œìŠ¤í…œ í˜„í™©

- âœ… **Logger ì‹œìŠ¤í…œ**: ì™„ì „ ì‘ë™ (ë©”ì¸ + ë„êµ¬ë³„)
- âœ… **AI Agent**: ëª¨ë“  ë…¸ë“œì—ì„œ ë¡œê¹… ì‘ë™
- ğŸŸ¡ **RAG ì‹œìŠ¤í…œ**: ê²€ìƒ‰ ì‘ë™í•˜ë‚˜ ì¼ë¶€ ê¸°ë¡ ëˆ„ë½
- âŒ **LLM Client**: í† í°/ë¹„ìš© ì¶”ì  ë¯¸êµ¬í˜„
- ğŸŸ¡ **UI (Streamlit)**: ì¸í„°ë™ì…˜ ë¡œê·¸ë§Œ ì‘ë™, ì„¸ì…˜/ì´ë²¤íŠ¸ ë¯¸ì‚¬ìš©

### ì‚¬ìš© íŒ¨í„´

#### ê¸°ë³¸ ì‚¬ìš© íŒ¨í„´
```python
# with ë¬¸ìœ¼ë¡œ ìë™ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬
with ExperimentManager() as exp:
    exp.logger.write("ì‹¤í—˜ ì‹œì‘")
    exp.update_metadata(user_query="RAGë€?", difficulty="easy")

    # ë„êµ¬ë³„ Logger ìƒì„± ë° ì‚¬ìš©
    tool_logger = exp.get_tool_logger('rag_paper')
    tool_logger.write("ê²€ìƒ‰ ì‹œì‘")
    tool_logger.write("ê²€ìƒ‰ ì™„ë£Œ")
    tool_logger.write("=" * 80)
    tool_logger.write("[LLM ë‹µë³€ ì „ì²´ ë‚´ìš©]")
    tool_logger.write(llm_response)
    tool_logger.write("=" * 80)
    tool_logger.close()  # í•„ìˆ˜!

    # ê²°ê³¼ ì €ì¥
    exp.save_output('response.txt', answer)
    exp.update_metadata(success=True, tool_used="rag_paper")
# close() ìë™ í˜¸ì¶œ â†’ flush_queries_to_file() ìë™ ì‹¤í–‰
```

#### í”„ë¡¬í”„íŠ¸ ì €ì¥ íŒ¨í„´
```python
# ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì €ì¥
exp_manager.save_system_prompt(system_prompt, {
    "tool": "search_paper",
    "difficulty": difficulty
})

# ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ ì €ì¥
exp_manager.save_user_prompt(user_content, {
    "tool": "search_paper",
    "difficulty": difficulty,
    "search_results_length": len(results)
})
```

#### í‰ê°€/ëŒ€í™” ì €ì¥ íŒ¨í„´
```python
# í‰ê°€ ê²°ê³¼ ì €ì¥
evaluation_result = evaluate_answer(question, answer)
exp_manager.save_evaluation_result(evaluation_result)

# ì „ì²´ ëŒ€í™” ì €ì¥
messages = get_current_messages()
exp_manager.save_conversation(messages)
```

### ë‹¤ìŒ ë‹¨ê³„ ìš°ì„ ìˆœìœ„

**ë†’ìŒ (ì¸í”„ë¼ ìˆìŒ, í˜¸ì¶œë§Œ ì¶”ê°€):**
1. pgvector ê²€ìƒ‰ ê¸°ë¡ - search_paper, glossaryì— log_pgvector_search() í˜¸ì¶œ
2. DB ê²€ìƒ‰ ê²°ê³¼ ì €ì¥ - ê° ë„êµ¬ì—ì„œ save_search_results() í˜¸ì¶œ
3. Streamlit ì„¸ì…˜ ì €ì¥ - UIì—ì„œ save_streamlit_session() í˜¸ì¶œ
4. UI ì´ë²¤íŠ¸ ê¸°ë¡ - UI ì´ë²¤íŠ¸ ë°œìƒ ì‹œ log_ui_event() í˜¸ì¶œ

**ì¤‘ê°„ (ê°„ë‹¨í•œ êµ¬í˜„):**
5. final_prompt.txt - system + user ê²°í•©í•˜ì—¬ ì €ì¥
6. summary.md - summarize ë„êµ¬ ê²°ê³¼ë¥¼ Markdownìœ¼ë¡œ ì €ì¥
7. config.yaml - ì‹¤í—˜ ì‹œì‘ ì‹œ config íŒŒì¼ ë³µì‚¬

**ë‚®ìŒ (ë³„ë„ ê³„ì‚° ë¡œì§ í•„ìš”):**
8. RAG í‰ê°€ ì§€í‘œ - Recall@K, Precision ê³„ì‚°
9. Agent ì •í™•ë„ - ë„êµ¬ ì„ íƒ ì •í™•ë„ ê³„ì‚°
10. ì‘ë‹µ ì‹œê°„ ë¶„ì„ - ë‹¨ê³„ë³„ ì‹œê°„ ì¸¡ì •
11. ë¹„ìš© ë¶„ì„ - í† í° ì‚¬ìš©ëŸ‰ ë° ë¹„ìš© ê³„ì‚°
